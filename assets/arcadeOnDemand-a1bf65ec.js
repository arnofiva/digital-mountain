import{_ as A}from"./preload-helper-41c905a7.js";import"./geometry-bad16232.js";import{s as D,a as T}from"./Error-685fdf30.js";import{r as O}from"./typedArrayUtil-ce39e5f4.js";import{f as j}from"./Extent-680ef92a.js";const E=D.getLogger("esri.support.arcadeOnDemand");let y;function L(){return y||(y=(async()=>{const a=await A(()=>import("./arcadeUtils-c893230e.js").then(e=>e.ax),["./arcadeUtils-c893230e.js","./geometry-bad16232.js","./ArrayPool-5813d861.js","./string-7a324480.js","./typedArrayUtil-ce39e5f4.js","./Error-685fdf30.js","./Extent-680ef92a.js","./cast-8b575ab3.js","./nextTick-3ee5a785.js","./promiseUtils-e37fe75d.js","./Ellipsoid-89682c5e.js","./Polyline-889037e7.js","./typeUtils-700e0da4.js","./preload-helper-41c905a7.js","./ArcadeDate-3d8ef842.js","./executionError-fb3f283a.js","./datetime-b6333958.js","./number-16638d88.js","./locale-30120714.js","./Field-1bc3a16a.js","./enumeration-4ec8d3f9.js","./fieldType-232282e5.js","./jsonUtils-03437bcd.js","./featureConversionUtils-c227ec85.js","./aaBoundingBox-04c58f5a.js","./aaBoundingRect-41e05474.js","./mathUtils-5b623c84.js","./vec3-015ca254.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./OptimizedFeature-7f37a325.js","./OptimizedFeatureSet-1d1ac4b9.js","./request-fc61835a.js","./hash-0ddfbf4b.js","./Portal-7ecdc9f0.js","./Loadable-695031ac.js","./Promise-e757e514.js","./PortalGroup-ea788274.js","./PortalUser-a1aa49cd.js","./sizeVariableUtils-d4870b0d.js"],import.meta.url);return{arcade:a.arcade,arcadeUtils:a,Dictionary:a.Dictionary,Feature:a.arcadeFeature}})()),y}const J=(a,e,s)=>o.create(a,e,s,null,["$feature"]),N=(a,e,s)=>o.create(a,e,s,null,["$feature","$view"]),V=(a,e,s,c)=>o.create(a,e,s,c,["$feature","$view"]);class o{constructor(e,s,c,l,m,n,r){this.script=e,this.evaluate=l;const f=Array.isArray(n)?n:n.fields;this.fields=f,this._syntaxTree=c,this._arcade=s,this._arcadeFeature=m,this._spatialReference=r,this._referencesGeometry=s.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,s,c,l,m,n){const{arcade:r,Feature:f,Dictionary:h}=await L(),d=j.fromJSON(s);let i;try{i=r.parseScript(e,n)}catch(t){return E.error(new T("arcade-bad-expression","Failed to parse arcade script",{script:e,error:t})),null}const _=m.reduce((t,x)=>({...t,[x]:null}),{});let u=null;O(l)&&(u=new h(l),u.immutable=!0,_.$config=null);const w=r.scriptUsesGeometryEngine(i),F=w&&r.enableGeometrySupport(),S=r.scriptUsesFeatureSet(i)&&r.enableFeatureSetSupport(),$=r.scriptIsAsync(i),v=$&&r.enableAsyncSupport(),b={vars:_,spatialReference:d,useAsync:!!v};await Promise.all([F,S,v]);const g=new Set;await r.loadDependentModules(g,i,null,$,w);const p=new h;p.immutable=!1,p.setField("scale",0);const G=r.compileScript(i,b),R=t=>("$view"in t&&t.$view&&(p.setField("scale",typeof t.$view=="object"?t.$view.scale:void 0),t.$view=p),u&&(t.$config=u),G({vars:t,spatialReference:d}));return new o(e,r,i,R,new f,c,d)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}}export{L as i,J as n,N as o,V as p,o as u};
