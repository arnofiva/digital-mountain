import{a as d}from"./Error-62cc7aff.js";import{a as u}from"./layerUtils-ff76096c.js";import{a as I}from"./lazyLayerLoader-82e85936.js";import L from"./PortalItem-476b4f2f.js";import{getNumLayersAndTables as l,preprocessFSItemData as S,getSubtypeGroupLayerIds as g,getFirstLayerOrTableId as T}from"./layersLoader-cc3b7ff4.js";import{s as m}from"./portalItemUtils-f08de884.js";import{t as c}from"./fetchService-047756b0.js";import"./string-7a2f1d87.js";import"./typedArrayUtil-70e1d79e.js";import"./request-f01affa1.js";import"./preload-helper-41c905a7.js";import"./promiseUtils-59dab60c.js";import"./JSONSupport-32b5ad86.js";import"./ensureType-249b88cd.js";import"./nextTick-3ee5a785.js";import"./assets-640b4d04.js";import"./Loadable-7c3ecd79.js";import"./Promise-3959c3ee.js";import"./Extent-2ad2c9a9.js";import"./Ellipsoid-89682c5e.js";import"./Portal-52d960e8.js";import"./locale-30120714.js";import"./PortalGroup-b49a7409.js";import"./PortalUser-85cf1ca9.js";import"./Layer-ab90f8be.js";import"./geometry-f89ca072.js";import"./Polyline-cf51ad23.js";import"./typeUtils-05f9d41d.js";import"./Evented-36093e88.js";import"./Identifiable-99d92428.js";import"./arcgisLayerUrl-1177870a.js";import"./persistableUrlUtils-ccf13db2.js";import"./jsonContext-49aec13d.js";import"./styleUtils-a2cb1d02.js";import"./asyncUtils-8de18dd2.js";import"./projection-d42b91be.js";import"./mathUtils-5b623c84.js";import"./vec3-015ca254.js";import"./common-d0b63c2d.js";import"./vec4-c7a19f0d.js";import"./SimpleObservable-a6d3d2d8.js";import"./mat4-4714ff8c.js";import"./aaBoundingRect-42f9721f.js";import"./zscale-d428b1da.js";async function je(e){!e.portalItem||e.portalItem instanceof L||(e={...e,portalItem:new L(e.portalItem)});const r=await v(e.portalItem);return new r.constructor({portalItem:e.portalItem,...r.properties})}async function v(e){return await e.load(),G(await F(e))}async function F(e){switch(e.type){case"Map Service":return M(e);case"Feature Service":return $(e);case"Feature Collection":return b(e);case"Scene Service":return h(e);case"Image Service":return C(e);case"Stream Service":return V();case"Vector Tile Service":return j();case"GeoJson":return W();case"CSV":return D();case"KML":return K();case"WFS":return O();case"WMTS":return x();case"WMS":return k();case"Feed":return A();default:throw new d("portal:unknown-item-type","Unknown item type '${type}'",{type:e.type})}}async function G(e){const r=I[e.className];return{constructor:await r(),properties:e.properties}}async function M(e){return await R(e)?{className:"TileLayer"}:{className:"MapImageLayer"}}async function $(e){if(m(e,"Oriented Imagery Layer"))return J(e);const r=await N(e);if(typeof r=="object"){const a={};return r.id!=null&&(a.layerId=r.id),{className:r.className||"FeatureLayer",properties:a}}return{className:"GroupLayer"}}async function h(e){var a,t;const r=await N(e);if(typeof r=="object"){const o={};let n;if(r.id!=null?(o.layerId=r.id,n=`${e.url}/layers/${r.id}`):n=e.url,(a=e.typeKeywords)==null?void 0:a.length){for(const i of Object.keys(u))if(e.typeKeywords.includes(i))return{className:u[i]}}const s=await c(n);return{className:u[s==null?void 0:s.layerType]||"SceneLayer",properties:o}}return r===!1?((t=await c(e.url))==null?void 0:t.layerType)==="Voxel"?{className:"VoxelLayer"}:{className:"GroupLayer"}:{className:"GroupLayer"}}async function b(e){await e.load();const r=m(e,"Map Notes"),a=m(e,"Markup");if(r||a)return{className:"MapNotesLayer"};if(m(e,"Route Layer"))return{className:"RouteLayer"};const t=await e.fetchData();return l(t)===1?{className:"FeatureLayer"}:{className:"GroupLayer"}}async function C(e){var s,i,y,f;await e.load();const r=((s=e.typeKeywords)==null?void 0:s.map(w=>w.toLowerCase()))??[];if(r.includes("elevation 3d layer"))return{className:"ElevationLayer"};if(r.includes("tiled imagery"))return{className:"ImageryTileLayer"};const a=(i=await e.fetchData())==null?void 0:i.layerType;if(a==="ArcGISTiledImageServiceLayer")return{className:"ImageryTileLayer"};if(a==="ArcGISImageServiceLayer")return{className:"ImageryLayer"};const t=await c(e.url),o=(y=t.cacheType)==null?void 0:y.toLowerCase(),n=(f=t.capabilities)==null?void 0:f.toLowerCase().includes("tilesonly");return o==="map"||n?{className:"ImageryTileLayer"}:{className:"ImageryLayer"}}function V(){return{className:"StreamLayer"}}function j(){return{className:"VectorTileLayer"}}function W(){return{className:"GeoJSONLayer"}}function D(){return{className:"CSVLayer"}}function K(){return{className:"KMLLayer"}}function O(){return{className:"WFSLayer"}}function k(){return{className:"WMSLayer"}}function x(){return{className:"WMTSLayer"}}function A(){return{className:"StreamLayer"}}async function J(e){await e.load();const r=await e.fetchData();return r.coverage?{className:"GroupLayer"}:{className:"OrientedImageryLayer",properties:r}}async function R(e){return(await c(e.url)).tileInfo}async function N(e){const r=e.url;if(!r||r.match(/\/\d+$/))return{};await e.load();const a=await e.fetchData();if(e.type==="Feature Service"){const t=p(await S(a,r));if(typeof t=="object"){const o=g(a);t.className=t.id!=null&&o.includes(t.id)?"SubtypeGroupLayer":"FeatureLayer"}return t}return l(a)>0?p(a):p(await c(r))}function p(e){return l(e)===1&&{id:T(e)}}export{je as fromItem,F as selectLayerClassPath};
