import{e as d,a as f}from"./cast-8b575ab3.js";import{a as c}from"./Error-685fdf30.js";import{r as h}from"./typedArrayUtil-ce39e5f4.js";import"./ArrayPool-5813d861.js";import"./string-7a324480.js";import{v as m,c as w}from"./fieldUtils-1ecec444.js";import{s as l,d as F}from"./popupUtils-d00ed938.js";const G=u=>{let r=class extends u{_validateFetchPopupFeatures(p){const{layer:e}=this,{popupEnabled:t}=e;if(!t)throw new c("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:e});if(!l(e,p))throw new c("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:e})}async prepareFetchPopupFeatures(p){}async fetchPopupFeatures(p,e){this._validateFetchPopupFeatures(e);const t=h(e)?e.clientGraphics:null;if(!t||t.length===0)return[];const y=this.layer.type==="scene"&&h(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer;let i=[];"fieldsIndex"in this.layer&&(i=m(this.layer.fieldsIndex,await F(y,l(this.layer,e)))),await this.prepareFetchPopupFeatures(i);const n=new Set,o=[],a=[];for(const s of t)w(i,s,n)?a.push(s):o.push(s);return a.length===0?o:this.whenGraphicAttributes(a,[...n]).catch(()=>a).then(s=>o.concat(s))}};return r=d([f("esri.views.3d.layers.support.PopupSceneLayerView")],r),r};export{G as c};
