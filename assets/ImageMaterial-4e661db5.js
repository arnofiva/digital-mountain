import{h as i}from"./Matrix3PassUniform-285be0f9.js";import{n as h}from"./basicInterfaces-7449a8bf.js";import{A as _,l as f,f as P,i as g,k as T,m as A,z as O,S as E,E as n,B as y,h as S}from"./objectResourceUtils-f1a10a8c.js";import{E as v,u as $}from"./VisualVariablePassParameters-ded3d86d.js";import{_ as w,$ as N}from"./index-8cd323f3.js";import{_ as R}from"./preload-helper-41c905a7.js";import{e as s}from"./JSONSupport-32b5ad86.js";import"./ShaderBuilder-c7fc4a30.js";import{s as D,t as b,e as x,o as I,W as C,h as M,a as L,_ as F}from"./EvaluateSceneLighting.glsl-ed7fcdc2.js";import{r as a}from"./ShaderTechniqueConfiguration-5b4afc58.js";import{o as u}from"./TransparencyPassType-a1cb0602.js";import{s as U}from"./DefaultTechniqueConfiguration-d3c0bf46.js";import{w as W}from"./ImageMaterial.glsl-44b698e0.js";import{R as m}from"./enums-fc527c7c.js";class p extends x{initializeProgram(t){return new I(t.rctx,p.shader.get().build(this.configuration),v)}_setPipelineState(t,e){const o=this.configuration,c=t===u.NONE,d=t===u.FrontFace;return C({blending:o.output!==i.Color&&o.output!==i.Alpha||!o.transparent?null:c?G:_(t),culling:M(o.cullFace),depthTest:{func:f(t)},depthWrite:c?o.writeDepth?L:null:P(t),colorWrite:F,stencilWrite:o.hasOccludees?g:null,stencilTest:o.hasOccludees?e?T:A:null,polygonOffset:c||d?null:O(o.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,e){return e?this._occludeePipelineState:super.getPipelineState(t,e)}}p.shader=new b(W,()=>R(()=>import("./ImageMaterial.glsl-06967eef.js"),["./ImageMaterial.glsl-06967eef.js","./vec2f64-f35767d6.js","./Matrix3PassUniform-285be0f9.js","./ShaderBuilder-c7fc4a30.js","./typedArrayUtil-70e1d79e.js","./Error-62cc7aff.js","./string-7a2f1d87.js","./mat4-4714ff8c.js","./vec3-015ca254.js","./common-d0b63c2d.js","./mat4f64-abdda1bb.js","./mat3f64-50f3b9f6.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./vec2-8acac370.js","./Texture2DPassUniform-1510cbb0.js","./View.glsl-725bf3cf.js","./mat4f32-60a2394b.js","./TransparencyPassType-a1cb0602.js","./ImageMaterial.glsl-44b698e0.js","./Slice.glsl-e5fdd8d3.js","./Transform.glsl-e6366353.js","./ForwardLinearDepth.glsl-3606f02d.js","./MultipassTerrainTest.glsl-029ffa3f.js","./ReadLinearDepth.glsl-9abddde9.js","./RgbaFloatEncoding.glsl-31b2b966.js","./AlphaCutoff-96178e0d.js","./FloatPassUniform-8a52db3d.js"],import.meta.url));const G=D(m.ONE,m.ONE_MINUS_SRC_ALPHA);class r extends U{constructor(){super(...arguments),this.output=i.Color,this.cullFace=h.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=u.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}s([a({count:i.COUNT})],r.prototype,"output",void 0),s([a({count:h.COUNT})],r.prototype,"cullFace",void 0),s([a()],r.prototype,"hasSlicePlane",void 0),s([a()],r.prototype,"transparent",void 0),s([a()],r.prototype,"enableOffset",void 0),s([a()],r.prototype,"writeDepth",void 0),s([a()],r.prototype,"hasOccludees",void 0),s([a({count:u.COUNT})],r.prototype,"transparencyPassType",void 0),s([a()],r.prototype,"hasMultipassTerrain",void 0),s([a()],r.prototype,"cullAboveGround",void 0);class st extends w{constructor(t){super(t,new H),this.supportsEdges=!0,this._configuration=new r}getConfiguration(t,e){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=e.transparencyPassType,this._configuration.enableOffset=e.camera.relativeElevation<E,this._configuration.hasMultipassTerrain=e.multipassTerrain.enabled,this._configuration.cullAboveGround=e.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(t,e){return e===i.Color||e===i.Alpha||e===i.Highlight?t===n.DRAPED_MATERIAL?!0:e===i.Highlight?t===n.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?n.TRANSPARENT_MATERIAL:n.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:n.OPAQUE_MATERIAL):!1}createGLMaterial(t){return new B(t)}createBufferWriter(){return new y(N)}}class B extends S{constructor(t){super({...t,...t.material.parameters})}_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(p,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:t.hasOccludees}),this._updateParameters(t))}beginSlot(t){return this._output!==i.Color&&this._output!==i.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class H extends ${constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=h.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}}export{st as c};
