import{a as F}from"./mathUtils-5b623c84.js";import{e as G,u as p}from"./screenUtils-410d12c0.js";import{j as O}from"./vec4-c7a19f0d.js";import{n as P}from"./vec4f64-6d0e93be.js";const g=2.4;function _(t){return G(t*g)}function k(t){return p(t)/g}function T(t,n,r,a){let{color:f,ratio:c}=n,{color:u,ratio:o}=r;o===c&&(o===1?c-=1e-6:o+=1e-6);const e=F((a-c)/(o-c),0,1);O(t,f.toArray(),u.toArray(),e)}function v(t){const r=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:o})=>o>=0&&o<=1).sort((o,e)=>o.ratio-e.ratio).map(({color:o,ratio:e})=>({color:o,ratio:Math.max(e,.001)})),t.length<1)return r;let a=t[0],f=t[0],c=1;const u=P();for(let o=0;o<512;o++){const e=(o+.5)/512;for(;e>f.ratio&&c<t.length;)a=f,f=t[c++];T(u,a,f,e),r.set(u,4*o)}return r}function z(t,n,r,a){const{radius:f,fieldOffset:c,field:u}=n,o=Math.round(p(f)),e=new Float64Array(r*a);let s,y=Number.NEGATIVE_INFINITY;const A=L(u,c),x=new Set;for(const I of t){const l=I.getCursor();for(;l.next();){const M=l.getObjectId();if(x.has(M))continue;x.add(M);const i=l.readLegacyPointGeometry(),m=128;if(i.x<-m||i.x>=r+m||i.y<-m||i.y>a+m)continue;const b=+A(l),N=Math.max(0,Math.round(i.x)-o),w=Math.max(0,Math.round(i.y)-o),$=Math.min(a,Math.round(i.y)+o),j=Math.min(r,Math.round(i.x)+o);for(let d=w;d<$;d++)for(let h=N;h<j;h++){const C=d*r+h,E=q(i.x-h,i.y-d,o);s=e[C]+=E*b,s>y&&(y=s)}}}return{matrix:e.buffer,max:y}}function q(t,n,r){const a=Math.sqrt(t**2+n**2)/r;return a>1?0:3/(Math.PI*r**2)*(1-a**2)**2}function B(t,n){return typeof t=="function"?t:t?typeof n=="string"?r=>-1*+r[t]:r=>+r[t]+n:()=>1}function L(t,n){return t!=null?typeof n=="string"?r=>-1*+r.readAttribute(t):r=>+r.readAttribute(t)+n:r=>1}export{g as a,k as c,_ as i,q as m,z as s,v as u,B as y};
