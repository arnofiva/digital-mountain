import{e as Z,y as Fe,a as rr}from"./cast-8b575ab3.js";import"./ArrayPool-5813d861.js";import"./typedArrayUtil-ce39e5f4.js";import{a as M}from"./Error-685fdf30.js";import{o as nr}from"./string-7a324480.js";import{l as or,i as ar,r as ur,a as sr,o as ir}from"./colorUtils-639f4d25.js";import{e as cr}from"./screenUtils-410d12c0.js";import{e as Ne}from"./mat4f32-60a2394b.js";import{s as P,o as X}from"./mat4-4714ff8c.js";const lr=(t,r)=>{const a=P(t,r,0,0,0,0,r,0,0,0,0,r,0,0,0,0,1);return X(a,a)},fr=(t,r)=>{const a=P(t,r,0,0,.5-.5*r,0,r,0,.5-.5*r,0,0,r,.5-.5*r,0,0,0,1);return X(a,a)},hr=(t,r)=>{const a=1-r,c=P(t,.2126+.7874*a,.7152-.7152*a,.0722-.0722*a,0,.2126-.2126*a,.7152+.2848*a,.0722-.0722*a,0,.2126-.2126*a,.7152-.7152*a,.0722+.9278*a,0,0,0,0,1);return X(c,c)},pr=(t,r)=>{const a=Math.sin(r*Math.PI/180),c=Math.cos(r*Math.PI/180),i=P(t,.213+.787*c-.213*a,.715-.715*c-.715*a,.072-.072*c+.928*a,0,.213-.213*c+.143*a,.715+.285*c+.14*a,.072-.072*c-.283*a,0,.213-.213*c-.787*a,.715-.715*c+.715*a,.072+.928*c+.072*a,0,0,0,0,1);return X(i,i)},mr=(t,r)=>{const a=1-2*r,c=P(t,a,0,0,r,0,a,0,r,0,0,a,r,0,0,0,1);return X(c,c)},gr=(t,r)=>{const a=P(t,.213+.787*r,.715-.715*r,.072-.072*r,0,.213-.213*r,.715+.285*r,.072-.072*r,0,.213-.213*r,.715-.715*r,.072+.928*r,0,0,0,0,1);return X(a,a)},dr=(t,r)=>{const a=1-r,c=P(t,.393+.607*a,.769-.769*a,.189-.189*a,0,.349-.349*a,.686+.314*a,.168-.168*a,0,.272-.272*a,.534-.534*a,.131+.869*a,0,0,0,0,1);return X(c,c)};let Re=class je{constructor(r,a,c){this.strength=r,this.radius=a,this.threshold=c,this.type="bloom"}interpolate(r,a,c){this.strength=C(r.strength,a.strength,c),this.radius=C(r.radius,a.radius,c),this.threshold=C(r.threshold,a.threshold,c)}clone(){return new je(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:T(this.radius),strength:this.strength,threshold:this.threshold}}},Je=class qe{constructor(r){this.radius=r,this.type="blur"}interpolate(r,a,c){this.radius=Math.round(C(r.radius,a.radius,c))}clone(){return new qe(this.radius)}toJSON(){return{type:"blur",radius:T(this.radius)}}};class U{constructor(r,a){this.type=r,this.amount=a,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(r,a,c){this.amount=C(r.amount,a.amount,c),this._updateMatrix()}clone(){return new U(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const r=this._colorMatrix||Ne();switch(this.type){case"brightness":this._colorMatrix=lr(r,this.amount);break;case"contrast":this._colorMatrix=fr(r,this.amount);break;case"grayscale":this._colorMatrix=hr(r,this.amount);break;case"invert":this._colorMatrix=mr(r,this.amount);break;case"saturate":this._colorMatrix=gr(r,this.amount);break;case"sepia":this._colorMatrix=dr(r,this.amount)}}}let Ie=class Pe{constructor(r,a,c,i){this.offsetX=r,this.offsetY=a,this.blurRadius=c,this.color=i,this.type="drop-shadow"}interpolate(r,a,c){this.offsetX=C(r.offsetX,a.offsetX,c),this.offsetY=C(r.offsetY,a.offsetY,c),this.blurRadius=C(r.blurRadius,a.blurRadius,c),this.color[0]=Math.round(C(r.color[0],a.color[0],c)),this.color[1]=Math.round(C(r.color[1],a.color[1],c)),this.color[2]=Math.round(C(r.color[2],a.color[2],c)),this.color[3]=C(r.color[3],a.color[3],c)}clone(){return new Pe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const r=[...this.color];return r[3]*=255,{type:"drop-shadow",xoffset:T(this.offsetX),yoffset:T(this.offsetY),blurRadius:T(this.blurRadius),color:r}}},Xe=class Ye{constructor(r){this.angle=r,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(r,a,c){this.angle=C(r.angle,a.angle,c),this._updateMatrix()}clone(){return new Ye(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const r=this._colorMatrix||Ne();this._colorMatrix=pr(r,this.angle)}},ze=class Be{constructor(r){this.amount=r,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(r,a,c){this.amount=C(r.amount,a.amount,c)}clone(){return new Be(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function C(t,r,a){return t+(r-t)*a}function T(t){return Math.round(1e3*cr(t))/1e3}function yr(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new U(t.type,0);case"saturate":case"brightness":case"contrast":return new U(t.type,1);case"opacity":return new ze(1);case"hue-rotate":return new Xe(0);case"blur":return new Je(0);case"drop-shadow":return new Ie(0,0,0,[...or("transparent")]);case"bloom":return new Re(0,0,1)}}function vr(t,r){const a=t.length>r.length?t:r;return(t.length>r.length?r:t).every((c,i)=>c.type===a[i].type)}function wr(t,r){const a=t.length>r.length?t:r,c=t.length>r.length?r:t;for(let i=c.length;i<a.length;i++)c.push(yr(a[i]))}function xr(t){const r=t[0];return!!r&&"type"in r}var ke,Oe,ee={};function Te(t){if(!t||t.length===0)return null;if(typeof t=="string"){const a=Ee(t);return a&&a.length!==0?a:null}const r=t.map(a=>{if(!Number.isFinite(a.scale)||a.scale<=0)throw new M("effect:invalid-scale","scale must be finite and greater than 0",{stop:a});return{scale:a.scale,effects:Ee(a.value)}});r.sort((a,c)=>c.effects.length-a.effects.length);for(let a=0;a<r.length-1;a++){if(!vr(r[a].effects,r[a+1].effects))throw new M("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:r[a].effects,b:r[a+1].effects});wr(r[a].effects,r[a+1].effects)}return r.sort((a,c)=>c.scale-a.scale),r}function Ee(t){let r;if(!t)return[];try{r=ee.parse(t)}catch(a){throw new M("effect:invalid-syntax","Invalid effect syntax",{value:t,error:a})}return r.map(a=>br(a))}function br(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return Ar(t);case"opacity":return $r(t);case"hue-rotate":return Mr(t);case"blur":return Cr(t);case"drop-shadow":return Fr(t);case"bloom":return kr(t)}}catch(r){throw r.details.filter=t,r}throw new M("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function Ar(t){let r=1;return z(t.parameters,1),t.parameters.length===1&&(r=E(t.parameters[0])),new U(t.name,r)}function $r(t){let r=1;return z(t.parameters,1),t.parameters.length===1&&(r=E(t.parameters[0])),new ze(r)}function Mr(t){let r=0;return z(t.parameters,1),t.parameters.length===1&&(r=Rr(t.parameters[0])),new Xe(r)}function Cr(t){let r=0;return z(t.parameters,1),t.parameters.length===1&&(r=ne(t.parameters[0]),D(r,t.parameters[0])),new Je(r)}function Fr(t){const r=[];let a=null;for(const c of t.parameters)if(c.type==="color"){if(r.length&&Object.freeze(r),a)throw new M("effect:type-error","Accepts only one color",{});a=jr(c)}else{const i=ne(c);if(Object.isFrozen(r))throw new M("effect:type-error","<length> parameters not consecutive",{lengths:r});r.push(i),r.length===3&&D(i,c)}if(r.length<2||r.length>3)throw new M("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${r.length}}`,{lengths:r});return new Ie(r[0],r[1],r[2]||0,a||Ue("black"))}function kr(t){let r=1,a=0,c=0;return z(t.parameters,3),t.parameters[0]&&(r=E(t.parameters[0])),t.parameters[1]&&(a=ne(t.parameters[1]),D(a,t.parameters[1])),t.parameters[2]&&(c=E(t.parameters[2])),new Re(r,a,c)}function z(t,r){if(t.length>r)throw new M("effect:type-error",`Function supports up to ${r} parameters, Actual: ${t.length}`,{parameters:t})}function K(t){if(t.type==="color")return"<color>";if(t.unit){if(re[t.unit])return"<length>";if(te[t.unit])return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function D(t,r){if(t<0)throw new M("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:r})}function Or(t){if(t.type!=="quantity"||t.unit!==null)throw new M("effect:type-error",`Expected <double>, Actual: ${K(t)}`,{term:t})}function Er(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new M("effect:type-error",`Expected <double> or <percentage>, Actual: ${K(t)}`,{term:t})}Oe=function(){function t(i,d){function y(){this.constructor=i}y.prototype=d.prototype,i.prototype=new y}function r(i,d,y,n){var v=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(v,r.prototype),v.expected=d,v.found=y,v.location=n,v.name="SyntaxError",v}function a(i,d,y){return y=y||" ",i.length>d?i:(d-=i.length,i+(y+=y.repeat(d)).slice(0,d))}function c(i,d){var y,n={},v=(d=d!==void 0?d:{}).grammarSource,_={start:Me},q=Me,I="none",Y=")",p=",",w="(",O="%",x="px",oe="cm",ae="mm",ue="in",se="pt",ie="pc",ce="deg",le="rad",fe="grad",he="turn",De="#",He=".",Le="e",pe=/^[ \t\n\r]/,me=/^[a-z\-]/,ge=/^[0-9a-fA-F]/,de=/^[+\-]/,j=/^[0-9]/,Ge=N("none"),Ke=b("none",!1),Qe=b(")",!1),ye=b(",",!1),Ve=N("whitespace"),ve=B([" ","	",`
`,"\r"],!1,!1),We=N("function"),Ze=b("(",!1),et=N("identifier"),we=B([["a","z"],"-"],!1,!1),tt=N("percentage"),rt=b("%",!1),nt=N("length"),ot=b("px",!1),at=b("cm",!1),ut=b("mm",!1),st=b("in",!1),it=b("pt",!1),ct=b("pc",!1),lt=N("angle"),ft=b("deg",!1),ht=b("rad",!1),pt=b("grad",!1),mt=b("turn",!1),gt=N("number"),dt=N("color"),yt=b("#",!1),xe=B([["0","9"],["a","f"],["A","F"]],!1,!1),be=B(["+","-"],!1,!1),J=B([["0","9"]],!1,!1),vt=b(".",!1),wt=b("e",!1),xt=function(){return[]},bt=function(e,u){return{type:"function",name:e,parameters:u||[]}},At=function(e,u){return u.length>0?tr(e,u,3):[e]},$t=function(e){return{type:"quantity",value:e.value,unit:e.unit}},Mt=function(e){return{type:"color",colorType:e.type,value:e.value}},Ct=function(e){return e},Ft=function(){return L()},kt=function(e){return{value:e,unit:"%"}},Ot=function(e){return{value:e,unit:"px"}},Et=function(e){return{value:e,unit:"cm"}},St=function(e){return{value:e,unit:"mm"}},_t=function(e){return{value:e,unit:"in"}},Nt=function(e){return{value:e,unit:"pt"}},Rt=function(e){return{value:e,unit:"pc"}},jt=function(e){return{value:e,unit:"deg"}},Jt=function(e){return{value:e,unit:"rad"}},qt=function(e){return{value:e,unit:"grad"}},It=function(e){return{value:e,unit:"turn"}},Pt=function(e){return{value:e,unit:null}},Xt=function(){return{type:"hex",value:L()}},Yt=function(e){return{type:"function",value:e}},zt=function(){return{type:"named",value:L()}},Bt=function(){return parseFloat(L())},o=0,m=0,H=[{line:1,column:1}],S=0,Q=[],l=0;if("startRule"in d){if(!(d.startRule in _))throw new Error(`Can't start parsing from rule "`+d.startRule+'".');q=_[d.startRule]}function L(){return i.substring(m,o)}function b(e,u){return{type:"literal",text:e,ignoreCase:u}}function B(e,u,s){return{type:"class",parts:e,inverted:u,ignoreCase:s}}function Tt(){return{type:"end"}}function N(e){return{type:"other",description:e}}function Ae(e){var u,s=H[e];if(s)return s;for(u=e-1;!H[u];)u--;for(s={line:(s=H[u]).line,column:s.column};u<e;)i.charCodeAt(u)===10?(s.line++,s.column=1):s.column++,u++;return H[e]=s,s}function $e(e,u){var s=Ae(e),h=Ae(u);return{source:v,start:{offset:e,line:s.line,column:s.column},end:{offset:u,line:h.line,column:h.column}}}function f(e){o<S||(o>S&&(S=o,Q=[]),Q.push(e))}function Ut(e,u,s){return new r(r.buildMessage(e,u),e,u,s)}function Me(){var e;return(e=Dt())===n&&(e=Ht()),e}function Dt(){var e,u;return l++,e=o,A(),i.substr(o,4)===I?(u=I,o+=4):(u=n,l===0&&f(Ke)),u!==n?(A(),m=e,e=xt()):(o=e,e=n),l--,e===n&&l===0&&f(Ge),e}function Ht(){var e,u;if(e=[],(u=V())!==n)for(;u!==n;)e.push(u),u=V();else e=n;return e}function V(){var e,u,s,h;return e=o,A(),(u=Gt())!==n?(A(),(s=Lt())===n&&(s=null),A(),i.charCodeAt(o)===41?(h=Y,o++):(h=n,l===0&&f(Qe)),h!==n?(A(),m=e,e=bt(u,s)):(o=e,e=n)):(o=e,e=n),e}function Lt(){var e,u,s,h,$,g,k,G;if(e=o,(u=W())!==n){for(s=[],h=o,$=A(),i.charCodeAt(o)===44?(g=p,o++):(g=n,l===0&&f(ye)),g===n&&(g=null),k=A(),(G=W())!==n?h=$=[$,g,k,G]:(o=h,h=n);h!==n;)s.push(h),h=o,$=A(),i.charCodeAt(o)===44?(g=p,o++):(g=n,l===0&&f(ye)),g===n&&(g=null),k=A(),(G=W())!==n?h=$=[$,g,k,G]:(o=h,h=n);m=e,e=At(u,s)}else o=e,e=n;return e}function W(){var e,u;return e=o,(u=Kt())===n&&(u=Qt())===n&&(u=Vt())===n&&(u=Wt()),u!==n&&(m=e,u=$t(u)),(e=u)===n&&(e=o,(u=Zt())!==n&&(m=e,u=Mt(u)),e=u),e}function A(){var e,u;for(l++,e=[],pe.test(i.charAt(o))?(u=i.charAt(o),o++):(u=n,l===0&&f(ve));u!==n;)e.push(u),pe.test(i.charAt(o))?(u=i.charAt(o),o++):(u=n,l===0&&f(ve));return l--,u=n,l===0&&f(Ve),e}function Gt(){var e,u,s;return l++,e=o,(u=Ce())!==n?(i.charCodeAt(o)===40?(s=w,o++):(s=n,l===0&&f(Ze)),s!==n?(m=e,e=Ct(u)):(o=e,e=n)):(o=e,e=n),l--,e===n&&(u=n,l===0&&f(We)),e}function Ce(){var e,u,s;if(l++,e=o,u=[],me.test(i.charAt(o))?(s=i.charAt(o),o++):(s=n,l===0&&f(we)),s!==n)for(;s!==n;)u.push(s),me.test(i.charAt(o))?(s=i.charAt(o),o++):(s=n,l===0&&f(we));else u=n;return u!==n&&(m=e,u=Ft()),l--,(e=u)===n&&(u=n,l===0&&f(et)),e}function Kt(){var e,u,s;return l++,e=o,A(),(u=F())!==n?(i.charCodeAt(o)===37?(s=O,o++):(s=n,l===0&&f(rt)),s!==n?(m=e,e=kt(u)):(o=e,e=n)):(o=e,e=n),l--,e===n&&l===0&&f(tt),e}function Qt(){var e,u,s;return l++,e=o,A(),(u=F())!==n?(i.substr(o,2)===x?(s=x,o+=2):(s=n,l===0&&f(ot)),s!==n?(m=e,e=Ot(u)):(o=e,e=n)):(o=e,e=n),e===n&&(e=o,A(),(u=F())!==n?(i.substr(o,2)===oe?(s=oe,o+=2):(s=n,l===0&&f(at)),s!==n?(m=e,e=Et(u)):(o=e,e=n)):(o=e,e=n),e===n&&(e=o,A(),(u=F())!==n?(i.substr(o,2)===ae?(s=ae,o+=2):(s=n,l===0&&f(ut)),s!==n?(m=e,e=St(u)):(o=e,e=n)):(o=e,e=n),e===n&&(e=o,A(),(u=F())!==n?(i.substr(o,2)===ue?(s=ue,o+=2):(s=n,l===0&&f(st)),s!==n?(m=e,e=_t(u)):(o=e,e=n)):(o=e,e=n),e===n&&(e=o,A(),(u=F())!==n?(i.substr(o,2)===se?(s=se,o+=2):(s=n,l===0&&f(it)),s!==n?(m=e,e=Nt(u)):(o=e,e=n)):(o=e,e=n),e===n&&(e=o,A(),(u=F())!==n?(i.substr(o,2)===ie?(s=ie,o+=2):(s=n,l===0&&f(ct)),s!==n?(m=e,e=Rt(u)):(o=e,e=n)):(o=e,e=n)))))),l--,e===n&&l===0&&f(nt),e}function Vt(){var e,u,s;return l++,e=o,(u=F())!==n?(i.substr(o,3)===ce?(s=ce,o+=3):(s=n,l===0&&f(ft)),s!==n?(m=e,e=jt(u)):(o=e,e=n)):(o=e,e=n),e===n&&(e=o,(u=F())!==n?(i.substr(o,3)===le?(s=le,o+=3):(s=n,l===0&&f(ht)),s!==n?(m=e,e=Jt(u)):(o=e,e=n)):(o=e,e=n),e===n&&(e=o,(u=F())!==n?(i.substr(o,4)===fe?(s=fe,o+=4):(s=n,l===0&&f(pt)),s!==n?(m=e,e=qt(u)):(o=e,e=n)):(o=e,e=n),e===n&&(e=o,(u=F())!==n?(i.substr(o,4)===he?(s=he,o+=4):(s=n,l===0&&f(mt)),s!==n?(m=e,e=It(u)):(o=e,e=n)):(o=e,e=n)))),l--,e===n&&(u=n,l===0&&f(lt)),e}function Wt(){var e,u;return l++,e=o,A(),(u=F())!==n?(m=e,e=Pt(u)):(o=e,e=n),l--,e===n&&l===0&&f(gt),e}function Zt(){var e,u,s,h;if(l++,e=o,i.charCodeAt(o)===35?(u=De,o++):(u=n,l===0&&f(yt)),u!==n){if(s=[],ge.test(i.charAt(o))?(h=i.charAt(o),o++):(h=n,l===0&&f(xe)),h!==n)for(;h!==n;)s.push(h),ge.test(i.charAt(o))?(h=i.charAt(o),o++):(h=n,l===0&&f(xe));else s=n;s!==n?(m=e,e=Xt()):(o=e,e=n)}else o=e,e=n;return e===n&&(e=o,(u=V())!==n&&(m=e,u=Yt(u)),(e=u)===n&&(e=o,(u=Ce())!==n&&(m=e,u=zt()),e=u)),l--,e===n&&(u=n,l===0&&f(dt)),e}function F(){var e,u,s,h,$,g,k;for(e=o,de.test(i.charAt(o))?(i.charAt(o),o++):l===0&&f(be),u=o,s=[],j.test(i.charAt(o))?(h=i.charAt(o),o++):(h=n,l===0&&f(J));h!==n;)s.push(h),j.test(i.charAt(o))?(h=i.charAt(o),o++):(h=n,l===0&&f(J));if(i.charCodeAt(o)===46?(h=He,o++):(h=n,l===0&&f(vt)),h!==n){if($=[],j.test(i.charAt(o))?(g=i.charAt(o),o++):(g=n,l===0&&f(J)),g!==n)for(;g!==n;)$.push(g),j.test(i.charAt(o))?(g=i.charAt(o),o++):(g=n,l===0&&f(J));else $=n;$!==n?u=s=[s,h,$]:(o=u,u=n)}else o=u,u=n;if(u===n)if(u=[],j.test(i.charAt(o))?(s=i.charAt(o),o++):(s=n,l===0&&f(J)),s!==n)for(;s!==n;)u.push(s),j.test(i.charAt(o))?(s=i.charAt(o),o++):(s=n,l===0&&f(J));else u=n;if(u!==n){if(s=o,i.charCodeAt(o)===101?(h=Le,o++):(h=n,l===0&&f(wt)),h!==n){if(de.test(i.charAt(o))?($=i.charAt(o),o++):($=n,l===0&&f(be)),$===n&&($=null),g=[],j.test(i.charAt(o))?(k=i.charAt(o),o++):(k=n,l===0&&f(J)),k!==n)for(;k!==n;)g.push(k),j.test(i.charAt(o))?(k=i.charAt(o),o++):(k=n,l===0&&f(J));else g=n;g!==n?s=h=[h,$,g]:(o=s,s=n)}else o=s,s=n;s===n&&(s=null),m=e,e=Bt()}else o=e,e=n;return e}function er(e,u){return e.map(function(s){return s[u]})}function tr(e,u,s){return[e].concat(er(u,s))}if((y=q())!==n&&o===i.length)return y;throw y!==n&&o<i.length&&f(Tt()),Ut(Q,S<i.length?i.charAt(S):null,S<i.length?$e(S,S+1):$e(S,S))}return t(r,Error),r.prototype.format=function(i){var d="Error: "+this.message;if(this.location){var y,n=null;for(y=0;y<i.length;y++)if(i[y].source===this.location.source){n=i[y].text.split(/\r\n|\n|\r/g);break}var v=this.location.start,_=this.location.source+":"+v.line+":"+v.column;if(n){var q=this.location.end,I=a("",v.line.toString().length," "),Y=n[v.line-1],p=(v.line===q.line?q.column:Y.length+1)-v.column||1;d+=`
 --> `+_+`
`+I+` |
`+v.line+" | "+Y+`
`+I+" | "+a("",v.column-1," ")+a("",p,"^")}else d+=`
 at `+_}return d},r.buildMessage=function(i,d){var y={literal:function(p){return'"'+v(p.text)+'"'},class:function(p){var w=p.parts.map(function(O){return Array.isArray(O)?_(O[0])+"-"+_(O[1]):_(O)});return"["+(p.inverted?"^":"")+w.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};function n(p){return p.charCodeAt(0).toString(16).toUpperCase()}function v(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+n(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+n(w)})}function _(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+n(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+n(w)})}function q(p){return y[p.type](p)}function I(p){var w,O,x=p.map(q);if(x.sort(),x.length>0){for(w=1,O=1;w<x.length;w++)x[w-1]!==x[w]&&(x[O]=x[w],O++);x.length=O}switch(x.length){case 1:return x[0];case 2:return x[0]+" or "+x[1];default:return x.slice(0,-1).join(", ")+", or "+x[x.length-1]}}function Y(p){return p?'"'+v(p)+'"':"end of input"}return"Expected "+I(i)+" but "+Y(d)+" found."},{SyntaxError:r,parse:c}},(ke={get exports(){return ee},set exports(t){ee=t}}).exports&&(ke.exports=Oe());const te={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Sr(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&te[t.unit]!=null))throw new M("effect:type-error",`Expected <angle>, Actual: ${K(t)}`,{term:t})}const re={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function _r(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&re[t.unit]!=null))throw new M("effect:type-error",`Expected <length>, Actual: ${K(t)}`,{term:t})}function E(t){Er(t);const r=t.value;return D(r,t),t.unit==="%"?.01*r:r}function Nr(t){return Or(t),D(t.value,t),t.value}function Rr(t){return Sr(t),t.value*te[t.unit]||0}function ne(t){return _r(t),t.value*re[t.unit]||0}function jr(t){switch(t.colorType){case"hex":return ar(t.value);case"named":return Ue(t.value);case"function":return Ir(t.value)}}function Ue(t){if(!ur(t))throw new M("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return sr(t)}const Jr=/^rgba?/i,qr=/^hsla?/i;function Ir(t){if(z(t.parameters,4),Jr.test(t.name))return[E(t.parameters[0]),E(t.parameters[1]),E(t.parameters[2]),t.parameters[3]?E(t.parameters[3]):1];if(qr.test(t.name))return ir(Nr(t.parameters[0]),E(t.parameters[1]),E(t.parameters[2]),t.parameters[3]?E(t.parameters[3]):1);throw new M("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function Pr(t,r,a){var c;try{return zr(t)}catch(i){(c=a==null?void 0:a.messages)==null||c.push(i)}return null}function Xr(t,r,a,c){try{const i=Yr(t);nr(a,i,r)}catch(i){c.messages&&c.messages.push(i)}}function Yr(t){const r=Te(t);return r?xr(r)?r.map(a=>a.toJSON()):r.map(({scale:a,effects:c})=>({scale:a,value:c.map(i=>i.toJSON())})):null}function zr(t){if(!t||t.length===0)return null;if(Br(t)){const r=[];for(const a of t)r.push({scale:a.scale,value:Se(a.value)});return r}return Se(t)}function Br(t){const r=t[0];return!!r&&"scale"in r}function Se(t){if(!t||!t.length)return"";const r=[];for(const a of t){let c=[];switch(a.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":c=[R(a,"amount")];break;case"blur":c=[R(a,"radius","pt")];break;case"hue-rotate":c=[R(a,"angle","deg")];break;case"drop-shadow":c=[R(a,"xoffset","pt"),R(a,"yoffset","pt"),R(a,"blurRadius","pt"),Tr(a,"color")];break;case"bloom":c=[R(a,"strength"),R(a,"radius","pt"),R(a,"threshold")]}const i=`${a.type}(${c.filter(Boolean).join(" ")})`;Te(i),r.push(i)}return r.join(" ")}function R(t,r,a){if(t[r]==null)throw new M("effect:missing-parameter",`Missing parameter '${r}' in ${t.type} effect`,{effect:t});return a?t[r]+a:""+t[r]}function Tr(t,r){if(t[r]==null)throw new M("effect:missing-parameter",`Missing parameter '${r}' in ${t.type} effect`,{effect:t});const a=t[r];return`rgba(${a[0]||0}, ${a[1]||0}, ${a[2]||0}, ${a[3]/255||0})`}const _e={read:{reader:Pr},write:{allowNull:!0,writer:Xr}},Zr=t=>{let r=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return Z([Fe({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],r.prototype,"blendMode",void 0),Z([Fe({json:{read:!1,write:!1,origins:{"web-map":_e,"portal-item":_e}}})],r.prototype,"effect",void 0),r=Z([rr("esri.layers.mixins.BlendLayer")],r),r};export{Zr as a,Pr as b,Xr as c,Te as d,wr as e,Se as i,vr as n};
