import{a as me,s as Ke}from"./Error-62cc7aff.js";import{r as Z,i as Ue,t as Fe,e as Se,S as Et}from"./typedArrayUtil-70e1d79e.js";import{u as et,b as se,f as Ee,s as $t,a as jt,h as ut,i as Be,j as zt,p as ht,k as Ce,_ as ft}from"./vectorFieldUtils-b0aae2f9.js";import{p as Wt,a as Kt,f as Jt}from"./promiseUtils-59dab60c.js";import{_ as Ht}from"./preload-helper-41c905a7.js";import{a as qt}from"./assets-640b4d04.js";import{e as $,y as W,a as tt,l as rt}from"./JSONSupport-32b5ad86.js";import{y as Yt}from"./colorUtils-7641d345.js";import"./ensureType-249b88cd.js";import{p as re,h as Xt}from"./string-7a2f1d87.js";import{w as Zt,e as dt,f as Qt}from"./Extent-2ad2c9a9.js";import"./geometry-f89ca072.js";import"./mathUtils-5b623c84.js";var _e,pt,mt,ve={},er={get exports(){return ve},set exports(e){ve=e}};pt=er,_e=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(t){var r=this.buffer,c=r?r.byteLength:0;if(t<c)return r;for(var o=512;o<t;)o<<=1;for(var l=new Uint8Array(o),u=0;u<c;++u)l[u]=r[u];return this.buffer=l},getByte:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(t){var r=this.pos;if(t){this.ensureBuffer(r+t);for(var c=r+t;!this.eof&&this.bufferLength<c;)this.readBlock();var o=this.bufferLength;c>o&&(c=o)}else{for(;!this.eof;)this.readBlock();c=this.bufferLength}return this.pos=c,this.buffer.subarray(r,c)},lookChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(t,r,c){for(var o=t+r;this.bufferLength<=o&&!this.eof;)this.readBlock();return new Stream(this.buffer,t,r,c)},skip:function(t){t||(t=1),this.pos+=t},reset:function(){this.pos=0}},e}(),(mt=function(){if(!self||!self.Uint32Array)return null;var e=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),r=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),c=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],o=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function l(i){throw new Error(i)}function u(i){var a=0,s=i[a++],n=i[a++];s!=-1&&n!=-1||l("Invalid header in flate stream"),(15&s)!=8&&l("Unknown compression method in flate stream"),((s<<8)+n)%31!=0&&l("Bad FCHECK in flate stream"),32&n&&l("FDICT bit set in flate stream"),this.bytes=i,this.bytesPos=a,this.codeSize=0,this.codeBuf=0,_e.call(this)}return u.prototype=Object.create(_e.prototype),u.prototype.getBits=function(i){for(var a,s=this.codeSize,n=this.codeBuf,m=this.bytes,d=this.bytesPos;s<i;)(a=m[d++])===void 0&&l("Bad encoding in flate stream"),n|=a<<s,s+=8;return a=n&(1<<i)-1,this.codeBuf=n>>i,this.codeSize=s-=i,this.bytesPos=d,a},u.prototype.getCode=function(i){for(var a=i[0],s=i[1],n=this.codeSize,m=this.codeBuf,d=this.bytes,p=this.bytesPos;n<s;){var I;(I=d[p++])===void 0&&l("Bad encoding in flate stream"),m|=I<<n,n+=8}var w=a[m&(1<<s)-1],v=w>>16,h=65535&w;return(n==0||n<v||v==0)&&l("Bad encoding in flate stream"),this.codeBuf=m>>v,this.codeSize=n-v,this.bytesPos=p,h},u.prototype.generateHuffmanTable=function(i){for(var a=i.length,s=0,n=0;n<a;++n)i[n]>s&&(s=i[n]);for(var m=1<<s,d=new Uint32Array(m),p=1,I=0,w=2;p<=s;++p,I<<=1,w<<=1)for(var v=0;v<a;++v)if(i[v]==p){var h=0,f=I;for(n=0;n<p;++n)h=h<<1|1&f,f>>=1;for(n=h;n<m;n+=w)d[n]=p<<16|v;++I}return[d,s]},u.prototype.readBlock=function(){function i(U,_,N,V,B){for(var X=U.getBits(N)+V;X-- >0;)_[w++]=B}var a=this.getBits(3);if(1&a&&(this.eof=!0),(a>>=1)!=0){var s,n;if(a==1)s=c,n=o;else if(a==2){for(var m=this.getBits(5)+257,d=this.getBits(5)+1,p=this.getBits(4)+4,I=Array(e.length),w=0;w<p;)I[e[w++]]=this.getBits(3);for(var v=this.generateHuffmanTable(I),h=0,f=(w=0,m+d),g=new Array(f);w<f;){var T=this.getCode(v);T==16?i(this,g,2,3,h):T==17?i(this,g,3,3,h=0):T==18?i(this,g,7,11,h=0):g[w++]=h=T}s=this.generateHuffmanTable(g.slice(0,m)),n=this.generateHuffmanTable(g.slice(m,f))}else l("Unknown block type in flate stream");for(var y=(R=this.buffer)?R.length:0,S=this.bufferLength;;){var b=this.getCode(s);if(b<256)S+1>=y&&(y=(R=this.ensureBuffer(S+1)).length),R[S++]=b;else{if(b==256)return void(this.bufferLength=S);var E=(b=t[b-=257])>>16;E>0&&(E=this.getBits(E)),h=(65535&b)+E,b=this.getCode(n),(E=(b=r[b])>>16)>0&&(E=this.getBits(E));var A=(65535&b)+E;S+h>=y&&(y=(R=this.ensureBuffer(S+h)).length);for(var P=0;P<h;++P,++S)R[S]=R[S-A]}}}else{var C,O=this.bytes,L=this.bytesPos;(C=O[L++])===void 0&&l("Bad block header in flate stream");var k=C;(C=O[L++])===void 0&&l("Bad block header in flate stream"),k|=C<<8,(C=O[L++])===void 0&&l("Bad block header in flate stream");var x=C;(C=O[L++])===void 0&&l("Bad block header in flate stream"),(x|=C<<8)!=(65535&~k)&&l("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var M=this.bufferLength,R=this.ensureBuffer(M+k),G=M+k;this.bufferLength=G;for(var D=M;D<G;++D){if((C=O[L++])===void 0){this.eof=!0;break}R[D]=C}this.bytesPos=L}},u}())!==void 0&&(pt.exports=mt);let tr=class kt{constructor(t){this._canvas=null,this._ctx=null,t&&(this._canvas=t.canvas,this._ctx=t.ctx||t.canvas&&t.canvas.getContext("2d"))}decode(t,r,c){if(!t||t.byteLength<10)throw new me("imagecanvasdecoder: decode","required a valid encoded data as input.");let{width:o=0,height:l=0,format:u}=r;const{applyJpegMask:i}=r;if(i&&(!o||!l))throw new me("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise((a,s)=>{let n=null;u==="jpg"&&i&&(n=kt._getMask(t,{width:o,height:l}));const m=new Blob([new Uint8Array(t)],{type:"image/"+u=="jpg"?"jpeg":u}),d=URL.createObjectURL(m),p=new Image;let I;p.src=d,p.onload=()=>{if(URL.revokeObjectURL(d),Wt(c))return void s(Kt());o=p.width,l=p.height,this._canvas&&this._ctx?(this._canvas.width===o&&this._canvas.height===l||(this._canvas.width=o,this._canvas.height=l),this._ctx.clearRect(0,0,o,l)):(this._canvas=document.createElement("canvas"),this._canvas.width=o,this._canvas.height=l,this._ctx=this._canvas.getContext("2d")),this._ctx.drawImage(p,0,0);const w=this._ctx.getImageData(0,0,o,l);let v;if(I=w.data,r.renderOnCanvas){if(n)for(v=0;v<n.length;v++)n[v]?I[4*v+3]=255:I[4*v+3]=0;return this._ctx.putImageData(w,0,0),void a(null)}const h=o*l,f=new Uint8Array(h),g=new Uint8Array(h),T=new Uint8Array(h);if(n)for(v=0;v<h;v++)f[v]=I[4*v],g[v]=I[4*v+1],T[v]=I[4*v+2];else for(n=new Uint8Array(h),v=0;v<h;v++)f[v]=I[4*v],g[v]=I[4*v+1],T[v]=I[4*v+2],n[v]=I[4*v+3];a({width:o,height:l,pixels:[f,g,T],mask:n,pixelType:"u8"})},p.onerror=()=>{URL.revokeObjectURL(d),s("cannot load image")}})}static _getMask(t,r){let c=null;try{const o=new Uint8Array(t),l=Math.ceil(o.length/2);let u=0;const i=o.length-2;for(u=l;u<i&&(o[u]!==255||o[u+1]!==217);u++);if(u+=2,u<o.length-1){const a=new ve(o.subarray(u)).getBytes();c=new Uint8Array(r.width*r.height);let s=0;for(let n=0;n<a.length;n++)for(let m=7;m>=0;m--)c[s++]=a[n]>>m&1}}catch{}return c}};var gt,yt,wt,Ge={},rr={get exports(){return Ge},set exports(e){Ge=e}};gt=rr,yt=function(){var e=function(){function t(r){this.message="JPEG error: "+r}return t.prototype=new Error,t.prototype.name="JpegError",t.constructor=t,t}();return function(){if(!self||!self.Uint8ClampedArray)return null;var t=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),r=4017,c=799,o=3406,l=2276,u=1567,i=3784,a=5793,s=2896;function n(){this.decodeTransform=null,this.colorTransform=-1}function m(h,f){for(var g,T,y=0,S=[],b=16;b>0&&!h[b-1];)b--;S.push({children:[],index:0});var E,A=S[0];for(g=0;g<b;g++){for(T=0;T<h[g];T++){for((A=S.pop()).children[A.index]=f[y];A.index>0;)A=S.pop();for(A.index++,S.push(A);S.length<=g;)S.push(E={children:[],index:0}),A.children[A.index]=E.children,A=E;y++}g+1<b&&(S.push(E={children:[],index:0}),A.children[A.index]=E.children,A=E)}return S[0].children}function d(h,f,g){return 64*((h.blocksPerLine+1)*f+g)}function p(h,f,g,T,y,S,b,E,A){var P=g.mcusPerLine,C=g.progressive,O=f,L=0,k=0;function x(){if(k>0)return k--,L>>k&1;if((L=h[f++])===255){var F=h[f++];if(F)throw new e("unexpected marker "+(L<<8|F).toString(16))}return k=7,L>>>7}function M(F){for(var z=F;;){if(typeof(z=z[x()])=="number")return z;if(typeof z!="object")throw new e("invalid huffman sequence")}}function R(F){for(var z=0;F>0;)z=z<<1|x(),F--;return z}function G(F){if(F===1)return x()===1?1:-1;var z=R(F);return z>=1<<F-1?z:z+(-1<<F)+1}function D(F,z){var J=M(F.huffmanTableDC),Q=J===0?0:G(J);F.blockData[z]=F.pred+=Q;for(var ie=1;ie<64;){var ce=M(F.huffmanTableAC),ee=15&ce,ae=ce>>4;if(ee!==0){var _t=t[ie+=ae];F.blockData[z+_t]=G(ee),ie++}else{if(ae<15)break;ie+=16}}}function U(F,z){var J=M(F.huffmanTableDC),Q=J===0?0:G(J)<<A;F.blockData[z]=F.pred+=Q}function _(F,z){F.blockData[z]|=x()<<A}var N=0;function V(F,z){if(N>0)N--;else for(var J=S,Q=b;J<=Q;){var ie=M(F.huffmanTableAC),ce=15&ie,ee=ie>>4;if(ce!==0){var ae=t[J+=ee];F.blockData[z+ae]=G(ce)*(1<<A),J++}else{if(ee<15){N=R(ee)+(1<<ee)-1;break}J+=16}}}var B,X=0;function ne(F,z){for(var J,Q,ie=S,ce=b,ee=0;ie<=ce;){var ae=t[ie];switch(X){case 0:if(ee=(Q=M(F.huffmanTableAC))>>4,(J=15&Q)==0)ee<15?(N=R(ee)+(1<<ee),X=4):(ee=16,X=1);else{if(J!==1)throw new e("invalid ACn encoding");B=G(J),X=ee?2:3}continue;case 1:case 2:F.blockData[z+ae]?F.blockData[z+ae]+=x()<<A:--ee==0&&(X=X===2?3:0);break;case 3:F.blockData[z+ae]?F.blockData[z+ae]+=x()<<A:(F.blockData[z+ae]=B<<A,X=0);break;case 4:F.blockData[z+ae]&&(F.blockData[z+ae]+=x()<<A)}ie++}X===4&&--N==0&&(X=0)}function fe(F,z,J,Q,ie){var ce=J%P;z(F,d(F,(J/P|0)*F.v+Q,ce*F.h+ie))}function de(F,z,J){z(F,d(F,J/F.blocksPerLine|0,J%F.blocksPerLine))}var H,K,le,ue,q,Pe,ge=T.length;Pe=C?S===0?E===0?U:_:E===0?V:ne:D;var oe,ye,Le,Oe,he=0;for(ye=ge===1?T[0].blocksPerLine*T[0].blocksPerColumn:P*g.mcusPerColumn;he<ye;){var Re=y?Math.min(ye-he,y):ye;for(K=0;K<ge;K++)T[K].pred=0;if(N=0,ge===1)for(H=T[0],q=0;q<Re;q++)de(H,Pe,he),he++;else for(q=0;q<Re;q++){for(K=0;K<ge;K++)for(Le=(H=T[K]).h,Oe=H.v,le=0;le<Oe;le++)for(ue=0;ue<Le;ue++)fe(H,Pe,he,le,ue);he++}k=0,(oe=v(h,f))&&oe.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+oe.invalid),f=oe.offset);var we=oe&&oe.marker;if(!we||we<=65280)throw new e("marker was not found");if(!(we>=65488&&we<=65495))break;f+=2}return(oe=v(h,f))&&oe.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+oe.invalid),f=oe.offset),f-O}function I(h,f,g){var T,y,S,b,E,A,P,C,O,L,k,x,M,R,G,D,U,_=h.quantizationTable,N=h.blockData;if(!_)throw new e("missing required Quantization Table.");for(var V=0;V<64;V+=8)O=N[f+V],L=N[f+V+1],k=N[f+V+2],x=N[f+V+3],M=N[f+V+4],R=N[f+V+5],G=N[f+V+6],D=N[f+V+7],O*=_[V],L|k|x|M|R|G|D?(L*=_[V+1],k*=_[V+2],x*=_[V+3],M*=_[V+4],R*=_[V+5],G*=_[V+6],D*=_[V+7],y=(T=(T=a*O+128>>8)+(y=a*M+128>>8)+1>>1)-y,U=(S=k)*i+(b=G)*u+128>>8,S=S*u-b*i+128>>8,P=(E=(E=s*(L-D)+128>>8)+(P=R<<4)+1>>1)-P,A=(C=(C=s*(L+D)+128>>8)+(A=x<<4)+1>>1)-A,b=(T=T+(b=U)+1>>1)-b,S=(y=y+S+1>>1)-S,U=E*l+C*o+2048>>12,E=E*o-C*l+2048>>12,C=U,U=A*c+P*r+2048>>12,A=A*r-P*c+2048>>12,P=U,g[V]=T+C,g[V+7]=T-C,g[V+1]=y+P,g[V+6]=y-P,g[V+2]=S+A,g[V+5]=S-A,g[V+3]=b+E,g[V+4]=b-E):(U=a*O+512>>10,g[V]=U,g[V+1]=U,g[V+2]=U,g[V+3]=U,g[V+4]=U,g[V+5]=U,g[V+6]=U,g[V+7]=U);for(var B=0;B<8;++B)O=g[B],(L=g[B+8])|(k=g[B+16])|(x=g[B+24])|(M=g[B+32])|(R=g[B+40])|(G=g[B+48])|(D=g[B+56])?(y=(T=4112+((T=a*O+2048>>12)+(y=a*M+2048>>12)+1>>1))-y,U=(S=k)*i+(b=G)*u+2048>>12,S=S*u-b*i+2048>>12,b=U,P=(E=(E=s*(L-D)+2048>>12)+(P=R)+1>>1)-P,A=(C=(C=s*(L+D)+2048>>12)+(A=x)+1>>1)-A,U=E*l+C*o+2048>>12,E=E*o-C*l+2048>>12,C=U,U=A*c+P*r+2048>>12,A=A*r-P*c+2048>>12,O=(O=(T=T+b+1>>1)+C)<16?0:O>=4080?255:O>>4,L=(L=(y=y+S+1>>1)+(P=U))<16?0:L>=4080?255:L>>4,k=(k=(S=y-S)+A)<16?0:k>=4080?255:k>>4,x=(x=(b=T-b)+E)<16?0:x>=4080?255:x>>4,M=(M=b-E)<16?0:M>=4080?255:M>>4,R=(R=S-A)<16?0:R>=4080?255:R>>4,G=(G=y-P)<16?0:G>=4080?255:G>>4,D=(D=T-C)<16?0:D>=4080?255:D>>4,N[f+B]=O,N[f+B+8]=L,N[f+B+16]=k,N[f+B+24]=x,N[f+B+32]=M,N[f+B+40]=R,N[f+B+48]=G,N[f+B+56]=D):(U=(U=a*O+8192>>14)<-2040?0:U>=2024?255:U+2056>>4,N[f+B]=U,N[f+B+8]=U,N[f+B+16]=U,N[f+B+24]=U,N[f+B+32]=U,N[f+B+40]=U,N[f+B+48]=U,N[f+B+56]=U)}function w(h,f){for(var g=f.blocksPerLine,T=f.blocksPerColumn,y=new Int16Array(64),S=0;S<T;S++)for(var b=0;b<g;b++)I(f,d(f,S,b),y);return f.blockData}function v(h,f,g){function T(A){return h[A]<<8|h[A+1]}var y=h.length-1,S=g<f?g:f;if(f>=y)return null;var b=T(f);if(b>=65472&&b<=65534)return{invalid:null,marker:b,offset:f};for(var E=T(S);!(E>=65472&&E<=65534);){if(++S>=y)return null;E=T(S)}return{invalid:b.toString(16),marker:E,offset:S}}return n.prototype={parse:function(h){function f(){var F=h[b]<<8|h[b+1];return b+=2,F}function g(){var F=f(),z=b+F-2,J=v(h,z,b);J&&J.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+J.invalid),z=J.offset);var Q=h.subarray(b,z);return b+=Q.length,Q}function T(F){for(var z=Math.ceil(F.samplesPerLine/8/F.maxH),J=Math.ceil(F.scanLines/8/F.maxV),Q=0;Q<F.components.length;Q++){q=F.components[Q];var ie=Math.ceil(Math.ceil(F.samplesPerLine/8)*q.h/F.maxH),ce=Math.ceil(Math.ceil(F.scanLines/8)*q.v/F.maxV),ee=z*q.h,ae=J*q.v*64*(ee+1);q.blockData=new Int16Array(ae),q.blocksPerLine=ie,q.blocksPerColumn=ce}F.mcusPerLine=z,F.mcusPerColumn=J}var y,S,b=0,E=null,A=null,P=[],C=[],O=[],L=f();if(L!==65496)throw new e("SOI not found");for(L=f();L!==65497;){var k,x,M;switch(L){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var R=g();L===65504&&R[0]===74&&R[1]===70&&R[2]===73&&R[3]===70&&R[4]===0&&(E={version:{major:R[5],minor:R[6]},densityUnits:R[7],xDensity:R[8]<<8|R[9],yDensity:R[10]<<8|R[11],thumbWidth:R[12],thumbHeight:R[13],thumbData:R.subarray(14,14+3*R[12]*R[13])}),L===65518&&R[0]===65&&R[1]===100&&R[2]===111&&R[3]===98&&R[4]===101&&(A={version:R[5]<<8|R[6],flags0:R[7]<<8|R[8],flags1:R[9]<<8|R[10],transformCode:R[11]});break;case 65499:for(var G=f()+b-2;b<G;){var D=h[b++],U=new Uint16Array(64);if(D>>4){if(D>>4!=1)throw new e("DQT - invalid table spec");for(x=0;x<64;x++)U[t[x]]=f()}else for(x=0;x<64;x++)U[t[x]]=h[b++];P[15&D]=U}break;case 65472:case 65473:case 65474:if(y)throw new e("Only single frame JPEGs supported");f(),(y={}).extended=L===65473,y.progressive=L===65474,y.precision=h[b++],y.scanLines=f(),y.samplesPerLine=f(),y.components=[],y.componentIds={};var _,N=h[b++],V=0,B=0;for(k=0;k<N;k++){_=h[b];var X=h[b+1]>>4,ne=15&h[b+1];V<X&&(V=X),B<ne&&(B=ne);var fe=h[b+2];M=y.components.push({h:X,v:ne,quantizationId:fe,quantizationTable:null}),y.componentIds[_]=M-1,b+=3}y.maxH=V,y.maxV=B,T(y);break;case 65476:var de=f();for(k=2;k<de;){var H=h[b++],K=new Uint8Array(16),le=0;for(x=0;x<16;x++,b++)le+=K[x]=h[b];var ue=new Uint8Array(le);for(x=0;x<le;x++,b++)ue[x]=h[b];k+=17+le,(H>>4?C:O)[15&H]=m(K,ue)}break;case 65501:f(),S=f();break;case 65498:f();var q,Pe=h[b++],ge=[];for(k=0;k<Pe;k++){var oe=y.componentIds[h[b++]];q=y.components[oe];var ye=h[b++];q.huffmanTableDC=O[ye>>4],q.huffmanTableAC=C[15&ye],ge.push(q)}var Le=h[b++],Oe=h[b++],he=h[b++],Re=p(h,b,y,ge,S,Le,Oe,he>>4,15&he);b+=Re;break;case 65535:h[b]!==255&&b--;break;default:if(h[b-3]===255&&h[b-2]>=192&&h[b-2]<=254){b-=3;break}throw new e("unknown marker "+L.toString(16))}L=f()}for(this.width=y.samplesPerLine,this.height=y.scanLines,this.jfif=E,this.eof=b,this.adobe=A,this.components=[],k=0;k<y.components.length;k++){var we=P[(q=y.components[k]).quantizationId];we&&(q.quantizationTable=we),this.components.push({output:w(y,q),scaleX:q.h/y.maxH,scaleY:q.v/y.maxV,blocksPerLine:q.blocksPerLine,blocksPerColumn:q.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(h,f){var g,T,y,S,b,E,A,P,C,O,L,k=this.width/h,x=this.height/f,M=0,R=this.components.length,G=h*f*R,D=new Uint8ClampedArray(G),U=new Uint32Array(h),_=4294967288;for(A=0;A<R;A++){for(T=(g=this.components[A]).scaleX*k,y=g.scaleY*x,M=A,L=g.output,S=g.blocksPerLine+1<<3,b=0;b<h;b++)P=0|b*T,U[b]=(P&_)<<3|7&P;for(E=0;E<f;E++)for(O=S*((P=0|E*y)&_)|(7&P)<<3,b=0;b<h;b++)D[M]=L[O+U[b]],M+=R}var N=this.decodeTransform;if(N)for(A=0;A<G;)for(P=0,C=0;P<R;P++,A++,C+=2)D[A]=(D[A]*N[C]>>8)+N[C+1];return D},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:this.numComponents===3?this.colorTransform!==0:this.colorTransform===1},_convertYccToRgb:function(h){for(var f,g,T,y=0,S=h.length;y<S;y+=3)f=h[y],g=h[y+1],T=h[y+2],h[y]=f-179.456+1.402*T,h[y+1]=f+135.459-.344*g-.714*T,h[y+2]=f-226.816+1.772*g;return h},_convertYcckToRgb:function(h){for(var f,g,T,y,S=0,b=0,E=h.length;b<E;b+=4)f=h[b],g=h[b+1],T=h[b+2],y=h[b+3],h[S++]=g*(-660635669420364e-19*g+.000437130475926232*T-54080610064599e-18*f+.00048449797120281*y-.154362151871126)-122.67195406894+T*(-.000957964378445773*T+.000817076911346625*f-.00477271405408747*y+1.53380253221734)+f*(.000961250184130688*f-.00266257332283933*y+.48357088451265)+y*(-.000336197177618394*y+.484791561490776),h[S++]=107.268039397724+g*(219927104525741e-19*g-.000640992018297945*T+.000659397001245577*f+.000426105652938837*y-.176491792462875)+T*(-.000778269941513683*T+.00130872261408275*f+.000770482631801132*y-.151051492775562)+f*(.00126935368114843*f-.00265090189010898*y+.25802910206845)+y*(-.000318913117588328*y-.213742400323665),h[S++]=g*(-.000570115196973677*g-263409051004589e-19*T+.0020741088115012*f-.00288260236853442*y+.814272968359295)-20.810012546947+T*(-153496057440975e-19*T-.000132689043961446*f+.000560833691242812*y-.195152027534049)+f*(.00174418132927582*f-.00255243321439347*y+.116935020465145)+y*(-.000343531996510555*y+.24165260232407);return h},_convertYcckToCmyk:function(h){for(var f,g,T,y=0,S=h.length;y<S;y+=4)f=h[y],g=h[y+1],T=h[y+2],h[y]=434.456-f-1.402*T,h[y+1]=119.541-f+.344*g+.714*T,h[y+2]=481.816-f-1.772*g;return h},_convertCmykToRgb:function(h){for(var f,g,T,y,S=0,b=1/255,E=0,A=h.length;E<A;E+=4)f=h[E]*b,g=h[E+1]*b,T=h[E+2]*b,y=h[E+3]*b,h[S++]=255+f*(-4.387332384609988*f+54.48615194189176*g+18.82290502165302*T+212.25662451639585*y-285.2331026137004)+g*(1.7149763477362134*g-5.6096736904047315*T-17.873870861415444*y-5.497006427196366)+T*(-2.5217340131683033*T-21.248923337353073*y+17.5119270841813)-y*(21.86122147463605*y+189.48180835922747),h[S++]=255+f*(8.841041422036149*f+60.118027045597366*g+6.871425592049007*T+31.159100130055922*y-79.2970844816548)+g*(-15.310361306967817*g+17.575251261109482*T+131.35250912493976*y-190.9453302588951)+T*(4.444339102852739*T+9.8632861493405*y-24.86741582555878)-y*(20.737325471181034*y+187.80453709719578),h[S++]=255+f*(.8842522430003296*f+8.078677503112928*g+30.89978309703729*T-.23883238689178934*y-14.183576799673286)+g*(10.49593273432072*g+63.02378494754052*T+50.606957656360734*y-112.23884253719248)+T*(.03296041114873217*T+115.60384449646641*y-193.58209356861505)-y*(22.33816807309886*y+180.12613974708367);return h},getData:function(h,f,g){if(this.numComponents>4)throw new e("Unsupported color mode");var T=this._getLinearizedBlockData(h,f);if(this.numComponents===1&&g){for(var y=T.length,S=new Uint8ClampedArray(3*y),b=0,E=0;E<y;E++){var A=T[E];S[b++]=A,S[b++]=A,S[b++]=A}return S}if(this.numComponents===3&&this._isColorConversionNeeded())return this._convertYccToRgb(T);if(this.numComponents===4){if(this._isColorConversionNeeded())return g?this._convertYcckToRgb(T):this._convertYcckToCmyk(T);if(g)return this._convertCmykToRgb(T)}return T}},n}()},(wt=yt())!==void 0&&(gt.exports=wt);let nr=class{static decode(t,r=!1){const c=new Uint8Array(t),o=new Ge;o.parse(c);const{width:l,height:u,numComponents:i,eof:a}=o,s=o.getData(l,u,!0),n=l*u;let m,d=null,p=0,I=0,w=0;if(!r&&a<c.length-1)try{const v=new ve(c.subarray(a)).getBytes();d=new Uint8Array(n);let h=0;for(p=0;p<v.length;p++)for(w=7;w>=0;w--)d[h++]=v[p]>>w&1}catch{}if(i===1&&s.length===l*u){const v=new Uint8Array(s.buffer);m=[v,v,v]}else{for(m=[],p=0;p<3;p++)m.push(new Uint8Array(n));for(w=0,I=0;I<n;I++)for(p=0;p<3;p++)m[p][I]=s[w++]}return{width:l,height:u,pixels:m,mask:d}}};const Pt=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}];let $e=null;function Ct(){return $e||($e=Ht(()=>import("./lerc-wasm-81cbfca1.js"),[],import.meta.url).then(e=>e.l).then(({default:e})=>e({locateFile:t=>qt(`esri/layers/support/rasterFormats/${t}`)})).then(e=>{sr(e)}),$e)}const Ne={getBlobInfo:null,decode:null};function ir(e){return 16+(e>>3<<3)}function pe(e,t,r){r.set(e.slice(t,t+r.length))}function sr(e){const{_malloc:t,_free:r,_lerc_getBlobInfo:c,_lerc_getDataRanges:o,_lerc_decode_4D:l,asm:u}=e;let i;const a=Object.values(u).find(n=>n&&"buffer"in n&&n.buffer===e.HEAPU8.buffer),s=n=>{const m=n.map(w=>ir(w)),d=m.reduce((w,v)=>w+v),p=t(d);i=new Uint8Array(a.buffer);let I=m[0];m[0]=p;for(let w=1;w<m.length;w++){const v=m[w];m[w]=m[w-1]+I,I=v}return m};Ne.getBlobInfo=n=>{const p=new Uint8Array(48),I=new Uint8Array(8*3),[w,v,h]=s([n.length,p.length,I.length]);i.set(n,w),i.set(p,v),i.set(I,h);let f=c(w,n.length,v,h,12,3);if(f)throw r(w),new Error(`lerc-getBlobInfo: error code is ${f}`);i=new Uint8Array(a.buffer),pe(i,v,p),pe(i,h,I);const g=new Uint32Array(p.buffer),T=new Float64Array(I.buffer),[y,S,,b,E,A,P,C,O,L,k]=g,x={version:y,depthCount:L,width:b,height:E,validPixelCount:P,bandCount:A,blobSize:C,maskCount:O,dataType:S,minValue:T[0],maxValue:T[1],maxZerror:T[2],statistics:[],bandCountWithNoData:k};if(k)return x;if(L===1&&A===1)return r(w),x.statistics.push({minValue:T[0],maxValue:T[1]}),x;const M=L*A*8,R=new Uint8Array(M),G=new Uint8Array(M);let D=w,U=0,_=0,N=!1;if(i.byteLength<w+2*M?(r(w),N=!0,[D,U,_]=s([n.length,M,M]),i.set(n,D)):[U,_]=s([M,M]),i.set(R,U),i.set(G,_),f=o(D,n.length,L,A,U,_),f)throw r(D),N||r(U),new Error(`lerc-getDataRanges: error code is ${f}`);i=new Uint8Array(a.buffer),pe(i,U,R),pe(i,_,G);const V=new Float64Array(R.buffer),B=new Float64Array(G.buffer),X=x.statistics;for(let ne=0;ne<A;ne++)if(L>1){const fe=V.slice(ne*L,(ne+1)*L),de=B.slice(ne*L,(ne+1)*L),H=Math.min.apply(null,fe),K=Math.max.apply(null,de);X.push({minValue:H,maxValue:K,depthStats:{minValues:fe,maxValues:de}})}else X.push({minValue:V[ne],maxValue:B[ne]});return r(D),N||r(U),x},Ne.decode=(n,m)=>{const{maskCount:d,depthCount:p,bandCount:I,width:w,height:v,dataType:h,bandCountWithNoData:f}=m,g=Pt[h],T=w*v,y=new Uint8Array(T*I),S=T*p*I*g.size,b=new Uint8Array(S),E=new Uint8Array(I),A=new Uint8Array(8*I),[P,C,O,L,k]=s([n.length,y.length,b.length,E.length,A.length]);i.set(n,P),i.set(y,C),i.set(b,O),i.set(E,L),i.set(A,k);const x=l(P,n.length,d,C,p,w,v,I,h,O,L,k);if(x)throw r(P),new Error(`lerc-decode: error code is ${x}`);i=new Uint8Array(a.buffer),pe(i,O,b),pe(i,C,y);let M=null;if(f){pe(i,L,E),pe(i,k,A),M=[];const R=new Float64Array(A.buffer);for(let G=0;G<E.length;G++)M.push(E[G]?R[G]:null)}return r(P),{data:b,maskData:y,noDataValues:M}}}function ar(e,t,r,c,o){if(r<2)return e;const l=new c(t*r);if(o)for(let u=0,i=0;u<t;u++)for(let a=0,s=u;a<r;a++,s+=t)l[s]=e[i++];else for(let u=0,i=0;u<t;u++)for(let a=0,s=u;a<r;a++,s+=t)l[i++]=e[s];return l}function Mt(e,t={}){const r=t.inputOffset??0,c=e instanceof Uint8Array?e.subarray(r):new Uint8Array(e,r),o=Ne.getBlobInfo(c),{data:l,maskData:u,noDataValues:i}=Ne.decode(c,o),{width:a,height:s,bandCount:n,depthCount:m,dataType:d,maskCount:p,statistics:I}=o,w=Pt[d],v=new w.ctor(l.buffer),h=[],f=[],g=a*s,T=g*m;for(let P=0;P<n;P++){const C=v.subarray(P*T,(P+1)*T);if(t.returnInterleaved)h.push(C);else{const O=ar(C,g,m,w.ctor,!0);h.push(O)}f.push(u.subarray(P*T,(P+1)*T))}const y=p===0?null:p===1?f[0]:new Uint8Array(g);if(p>1){y.set(f[0]);for(let P=1;P<f.length;P++){const C=f[P];for(let O=0;O<g;O++)y[O]=y[O]&C[O]}}const{noDataValue:S}=t,b=S!=null&&w.range[0]<=S&&w.range[1]>=S;if(p>0&&b)for(let P=0;P<n;P++){const C=h[P],O=f[P]||y;for(let L=0;L<g;L++)O[L]===0&&(C[L]=S)}const E=p===n&&n>1?f:null,{pixelType:A}=w;return{width:a,height:s,bandCount:n,pixelType:A,depthCount:m,statistics:I,pixels:h,mask:y,bandMasks:E,noDataValues:i}}function or(e,t,r,c=!0){if(t%4!=0||r%4!=0){const o=new ArrayBuffer(4*Math.ceil(r/4)),l=new Uint8Array(o),u=new Uint8Array(e,t,r);if(c)for(let i=0;i<l.length;i+=4)l[i]=u[i+3],l[i+1]=u[i+2],l[i+2]=u[i+1],l[i+3]=u[i];else l.set(u);return new Uint32Array(l.buffer)}if(c){const o=new Uint8Array(e,t,r),l=new Uint8Array(o.length);for(let u=0;u<l.length;u+=4)l[u]=o[u+3],l[u+1]=o[u+2],l[u+2]=o[u+1],l[u+3]=o[u];return new Uint32Array(l.buffer)}return new Uint32Array(e,t,r/4)}function bt(){const e=[];for(let t=0;t<=257;t++)e[t]=[t];return e}function St(e,t){for(let r=0;r<t.length;r++)e.push(t[r])}const xe=new Set;function nt(e,t,r,c=!0){const o=or(e,t,r,c);let l=9,u=bt(),i=32,a=u.length,s=[],n=1,m=o[0],d=0;const p=o.length,I=8*(4*p-r),w=[];for(;m!=null;){if(i>=l)i-=l,d=m>>>32-l,m<<=l;else{d=m>>>32-i,m=o[n++];const h=l-i;i=32-h,d=(d<<h)+(m>>>i),m<<=h}if(d===257)break;if(d===256){l=9,u=bt(),a=u.length,s=[];continue}const v=u[d];if(v==null){if(d>u.length)throw new Error("data integrity issue: code does not exist on code page");s.push(s[0]),u[a++]=s.slice(),St(w,s)}else St(w,v),s.push(v[0]),s.length>1&&(u[a++]=s.slice()),s=v.slice();if(xe.has(a)&&l++,i===0&&(m=o[n++],i=32),n>p||n===p&&i<=I)break}return new Uint8Array(w)}xe.add(511),xe.add(1023),xe.add(2047),xe.add(4095),xe.add(8191);const Tt=(e,t)=>{const r=t.width*t.height,c=t.pixelType;return Math.floor(e.byteLength/(r*Lt(c)))},Lt=e=>{let t=1;switch(e){case Uint8Array:case Int8Array:t=1;break;case Uint16Array:case Int16Array:t=2;break;case Uint32Array:case Int32Array:case Float32Array:t=4;break;case Float64Array:t=8}return t},lr=(e,t)=>{if(8*e.byteLength<t)return null;const r=new Uint8Array(e,0,Math.ceil(t/8)),c=new Uint8Array(t);let o=0,l=0,u=0,i=0;for(u=0;u<r.length-1;u++)for(l=r[u],i=7;i>=0;i--)c[o++]=l>>i&1;for(i=7;o<t-1;)l=r[r.length-1],c[o++]=l>>i&1,i--;return c};let cr=class{static decode(t,r){const c=r.pixelType,o=[],l=r.width*r.height,u=Tt(t,r),{bandIds:i,format:a}=r,s=i&&i.length||Tt(t,r),n=t.byteLength-t.byteLength%(l*Lt(c)),m=new c(t,0,l*u);let d,p,I,w,v=null;if(a==="bip")for(d=0;d<s;d++){for(I=new c(l),w=i?i[d]:d,p=0;p<l;p++)I[p]=m[p*u+w];o.push(I)}else if(a==="bsq")for(d=0;d<s;d++)w=i?i[d]:d,o.push(m.subarray(w*l,(w+1)*l));return n<t.byteLength-1&&(v=lr(t.slice(n),l)),{pixels:o,mask:v}}};function ur(e,t){let r=0,c="",o=0,l=0;const u=e.length;for(;r<u;)l=e[r++],o=l>>4,o<8?o=1:o===15?(o=4,l=(7&l)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++]):o===14?(o=3,l=(15&l)<<12|(63&e[r++])<<6|63&e[r++]):(o=2,l=(31&l)<<6|63&e[r++]),(l!==0||t)&&(c+=String.fromCharCode(l));return c}const it=(()=>{const e=[];return e[254]="NEWSUBFILETYPE",e[255]="SUBFILETYPE",e[256]="IMAGEWIDTH",e[257]="IMAGELENGTH",e[258]="BITSPERSAMPLE",e[259]="COMPRESSION",e[262]="PHOTOMETRICINTERPRETATION",e[263]="THRESHHOLDING",e[264]="CELLWIDTH",e[265]="CELLLENGTH",e[266]="FILLORDER",e[269]="DOCUMENTNAME",e[270]="IMAGEDESCRIPTION",e[271]="MAKE",e[272]="MODEL",e[273]="STRIPOFFSETS",e[274]="ORIENTATION",e[277]="SAMPLESPERPIXEL",e[278]="ROWSPERSTRIP",e[279]="STRIPBYTECOUNTS",e[280]="MINSAMPLEVALUE",e[281]="MAXSAMPLEVALUE",e[282]="XRESOLUTION",e[283]="YRESOLUTION",e[284]="PLANARCONFIGURATION",e[285]="PAGENAME",e[286]="XPOSITION",e[287]="YPOSITION",e[288]="FREEOFFSETS",e[289]="FREEBYTECOUNTS",e[290]="GRAYRESPONSEUNIT",e[291]="GRAYRESPONSECURVE",e[292]="T4OPTIONS",e[293]="T6OPTIONS",e[296]="RESOLUTIONUNIT",e[297]="PAGENUMBER",e[300]="COLORRESPONSEUNIT",e[301]="TRANSFERFUNCTION",e[305]="SOFTWARE",e[306]="DATETIME",e[315]="ARTIST",e[316]="HOSTCOMPUTER",e[317]="PREDICTOR",e[318]="WHITEPOINT",e[319]="PRIMARYCHROMATICITIES",e[320]="COLORMAP",e[321]="HALFTONEHINTS",e[322]="TILEWIDTH",e[323]="TILELENGTH",e[324]="TILEOFFSETS",e[325]="TILEBYTECOUNTS",e[326]="BADFAXLINES",e[327]="CLEANFAXDATA",e[328]="CONSECUTIVEBADFAXLINES",e[330]="SUBIFD",e[332]="INKSET",e[333]="INKNAMES",e[334]="NUMBEROFINKS",e[336]="DOTRANGE",e[337]="TARGETPRINTER",e[338]="EXTRASAMPLES",e[339]="SAMPLEFORMAT",e[340]="SMINSAMPLEVALUE",e[341]="SMAXSAMPLEVALUE",e[342]="TRANSFERRANGE",e[347]="JPEGTABLES",e[512]="JPEGPROC",e[513]="JPEGIFOFFSET",e[514]="JPEGIFBYTECOUNT",e[515]="JPEGRESTARTINTERVAL",e[517]="JPEGLOSSLESSPREDICTORS",e[518]="JPEGPOINTTRANSFORM",e[519]="JPEGQTABLES",e[520]="JPEGDCTABLES",e[521]="JPEGACTABLES",e[529]="YCBCRCOEFFICIENTS",e[530]="YCBCRSUBSAMPLING",e[531]="YCBCRPOSITIONING",e[532]="REFERENCEBLACKWHITE",e[700]="XMP",e[33550]="GEOPIXELSCALE",e[33922]="GEOTIEPOINTS",e[33432]="COPYRIGHT",e[42112]="GDAL_METADATA",e[42113]="GDAL_NODATA",e[50844]="RPCCOEFFICIENT",e[34264]="GEOTRANSMATRIX",e[34735]="GEOKEYDIRECTORY",e[34736]="GEODOUBLEPARAMS",e[34737]="GEOASCIIPARAMS",e[34665]="EXIFIFD",e[34853]="GPSIFD",e[40965]="INTEROPERABILITYIFD",e})(),hr=(()=>{const e=it.slice();return e[36864]="ExifVersion",e[40960]="FlashpixVersion",e[40961]="ColorSpace",e[42240]="Gamma",e[37121]="ComponentsConfiguration",e[37122]="CompressedBitsPerPixel",e[40962]="PixelXDimension",e[40963]="PixelYDimension",e[37500]="MakerNote",e[37510]="UserComment",e[40964]="RelatedSoundFile",e[36867]="DateTimeOriginal",e[36868]="DateTimeDigitized",e[36880]="OffsetTime",e[36881]="OffsetTimeOriginal",e[36882]="OffsetTimeDigitized",e[37520]="SubSecTime",e[37521]="SubSecTimeOriginal",e[37522]="SubSecTimeDigitized",e[37888]="Temperature",e[37889]="Humidity",e[37890]="Pressure",e[37891]="WaterDepth",e[37892]="Acceleration",e[37893]="CameraElevationAngle",e[42016]="ImageUniqueID",e[42032]="CameraOwnerName",e[42033]="BodySerialNumber",e[42034]="LensSpecification",e[42035]="LensMake",e[42036]="LensModel",e[42037]="LensSerialNumber",e[33434]="ExposureTime",e[33437]="FNumber",e[34850]="ExposureProgram",e[34852]="SpectralSensitivity",e[34855]="PhotographicSensitivity",e[34856]="OECF",e[34864]="SensitivityType",e[34865]="StandardOutputSensitivity",e[34866]="RecommendedExposureIndex",e[34867]="ISOSpeed",e[34868]="ISOSpeedLatitudeyyy",e[34869]="ISOSpeedLatitudezzz",e[37377]="ShutterSpeedValue",e[37378]="ApertureValue",e[37379]="BrightnessValue",e[37380]="ExposureBiasValue",e[37381]="MaxApertureValue",e[37382]="SubjectDistance",e[37383]="MeteringMode",e[37384]="LightSource",e[37385]="Flash",e[37386]="FocalLength",e[37396]="SubjectArea",e[41483]="FlashEnergy",e[41484]="SpatialFrequencyResponse",e[41486]="FocalPlaneXResolution",e[41487]="FocalPlaneYResolution",e[41488]="FocalPlaneResolutionUnit",e[41492]="SubjectLocation",e[41493]="ExposureIndex",e[41495]="SensingMethod",e[41728]="FileSource",e[41729]="SceneType",e[41730]="CFAPattern",e[41985]="CustomRendered",e[41986]="ExposureMode",e[41987]="WhiteBalance",e[41988]="DigitalZoomRatio",e[41989]="FocalLengthIn35mmFilm",e[41990]="SceneCaptureType",e[41991]="GainControl",e[41992]="Contrast",e[41993]="Saturation",e[41994]="Sharpness",e[41995]="DeviceSettingDescription",e[41996]="SubjectDistanceRange",e})(),fr=["GPSVersionID","GPSLatitudeRef","GPSLatitude","GPSLongitudeRef","GPSLongitude","GPSAltitudeRef","GPSAltitude","GPSTimeStamp","GPSSatellites","GPSStatus","GPSMeasureMode","GPSDOP","GPSSpeedRef","GPSSpeed","GPSTrackRef","GPSTrack","GPSImgDirectionRef","GPSImgDirection","GPSMapDatum","GPSDestLatitudeRef","GPSDestLatitude","GPSDestLongitudeRef","GPSDestLongitude","GPSDestBearingRef","GPSDestBearing","GPSDestDistanceRef","GPSDestDistance","GPSProcessingMethod","GPSAreaInformation","GPSDateStamp","GPSDifferential","GPSHPositioningError"],dr=(()=>{const e=[];return e[1024]="GTModelTypeGeoKey",e[1025]="GTRasterTypeGeoKey",e[1026]="GTCitationGeoKey",e[2048]="GeographicTypeGeoKey",e[2049]="GeogCitationGeoKey",e[2050]="GeogGeodeticDatumGeoKey",e[2051]="GeogPrimeMeridianGeoKey",e[2052]="GeogLinearUnitsGeoKey",e[2053]="GeogLinearUnitSizeGeoKey",e[2054]="GeogAngularUnitsGeoKey",e[2055]="GeogAngularUnitSizeGeoKey",e[2056]="GeogEllipsoidGeoKey",e[2057]="GeogSemiMajorAxisGeoKey",e[2058]="GeogSemiMinorAxisGeoKey",e[2059]="GeogInvFlatteningGeoKey",e[2061]="GeogPrimeMeridianLongGeoKey",e[2060]="GeogAzimuthUnitsGeoKey",e[3072]="ProjectedCSTypeGeoKey",e[3073]="PCSCitationGeoKey",e[3074]="ProjectionGeoKey",e[3075]="ProjCoordTransGeoKey",e[3076]="ProjLinearUnitsGeoKey",e[3077]="ProjLinearUnitSizeGeoKey",e[3078]="ProjStdParallel1GeoKey",e[3079]="ProjStdParallel2GeoKey",e[3080]="ProjNatOriginLongGeoKey",e[3081]="ProjNatOriginLatGeoKey",e[3082]="ProjFalseEastingGeoKey",e[3083]="ProjFalseNorthingGeoKey",e[3084]="ProjFalseOriginLongGeoKey",e[3085]="ProjFalseOriginLatGeoKey",e[3086]="ProjFalseOriginEastingGeoKey",e[3087]="ProjFalseOriginNorthingGeoKey",e[3088]="ProjCenterLongGeoKey",e[3090]="ProjCenterEastingGeoKey",e[3091]="ProjCenterNorthingGeoKey",e[3092]="ProjScaleAtNatOriginGeoKey",e[3093]="ProjScaleAtCenterGeoKey",e[3094]="ProjAzimuthAngleGeoKey",e[3095]="ProjStraightVertPoleLongGeoKey",e[4096]="VerticalCSTypeGeoKey",e[4097]="VerticalCitationGeoKey",e[4098]="VerticalDatumGeoKey",e[4099]="VerticalUnitsGeoKey",e})(),pr=(e,t)=>{let r=(t||it)[e];return r===void 0&&(r="unknown"+String(e)),r},Je=new Map;Je.set("EXIFIFD",hr),Je.set("GPSIFD",fr);const Ae={TIFF_TAGS:it,ifdTags:Je,GEO_KEYS:dr,getTagName:pr},st=(()=>{const e=new ArrayBuffer(4),t=new Uint8Array(e);return new Uint32Array(e)[0]=1,t[0]===1})(),vt=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],ke=4294967296,mr=new Set([1,5,6,7,8,34712,34887]);function at(e,t){let r="unknown";return e===3?r=t===64?"f64":"f32":e===1?t===1?r="u1":t===2?r="u2":t===4?r="u4":t<=8?r="u8":t<=16?r="u16":t<=32&&(r="u32"):e===2&&(t<=8?r="s8":t<=16?r="s16":t<=32&&(r="s32")),r}function Ve(e){let t=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"f64":t=Float64Array;break;default:t=Float32Array}return t}function gr(e,t){return{x:t[0]*e.x+t[1]*e.y+t[2],y:t[3]*e.x+t[4]*e.y+t[5]}}function Ot(e,t){var r;return(r=e.get(t))==null?void 0:r.values}function Te(e,t){var r;return(r=e.get(t))==null?void 0:r.values}function It(e,t){var r,c;return(c=(r=e.get(t))==null?void 0:r.values)==null?void 0:c[0]}function j(e,t){var r,c;return(c=(r=e.get(t))==null?void 0:r.values)==null?void 0:c[0]}function je(e,t,r,c=0,o=Ae.TIFF_TAGS,l=4){const u=l===8,i=u?ct(new DataView(e,r,8),0,t):new DataView(e,r,2).getUint16(0,t),a=4+2*l,s=u?8:2,n=s+i*a;if(r+n>e.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:n};const m=r+n+4<=e.byteLength?De(new DataView(e,r+n,l===8?8:4),0,t,l===8):null,d=r+s,p=new Map;let I,w,v,h,f,g=0,T=0;for(let y=0;y<i;y++){w=new DataView(e,d+a*y,a),v=w.getUint16(0,t),f=w.getUint16(2,t),h=Ae.getTagName(v,o);const S=[];l===2?(g=w.getUint16(4,t),T=w.getUint16(6,t)):l===4?(g=w.getUint32(4,t),T=w.getUint32(8,t)):l===8&&(g=De(w,4,t,!0),T=De(w,12,t,!0),S.push(w.getUint32(12,t)),S.push(w.getUint32(16,t))),I={id:v,type:f,valueCount:g,valueOffset:T,valueOffsets:S,values:null},vr(e,t,I,c,!1,l),p.set(h,I)}return{success:!0,ifd:p,nextIFD:m,requiredBufferSize:n}}const yr=(e,t)=>Mt(e,{inputOffset:t}).pixels[0];function He(e,t){if(t!==1&&t!==2&&t!==4)return e;const r=new Uint8Array(e),c=8/t,o=new Uint8Array(e.byteLength*c);let l=0;const u=2**t-1;for(let i=0;i<r.length;i++){const a=r[i];for(let s=0;s<c;s++)o[l++]=a<<t*s>>>8-t&u}return o.buffer}function qe(e,t,r){const c=new Ge;c.parse(e),c.colorTransform=r===6?-1:0;const o=c.getData(c.width,c.height,t!==1);return new Uint8Array(o.buffer)}function Ye(e){const t=new ve(e).getBytes(),r=new ArrayBuffer(t.length),c=new Uint8Array(r);return c.set(t),c}async function Xe(e,t,r,c,o){const l=st===t,u=j(r,"BITSPERSAMPLE"),i=j(r,"SAMPLESPERPIXEL"),a=j(r,"PHOTOMETRICINTERPRETATION"),s=at(j(r,"SAMPLEFORMAT")??1,u),n=j(r,"COMPRESSION")??1,m=Ve(s);let d,p,I;if(n===34887)return await Ct(),yr(e,c);if(n===1)d=e.slice(c,c+o),p=new Uint8Array(d);else if(n===8||n===32946)p=new Uint8Array(e,c,o),p=Ye(p),d=p.buffer;else if(n===6)p=new Uint8Array(e,c,o),p=qe(p,i,a),d=p.buffer;else if(n===7){const w=r.get("JPEGTABLES").values,v=w.length-2;p=new Uint8Array(v+o-2);for(let f=0;f<v;f++)p[f]=w[f];const h=new Uint8Array(e,c+2,o-2);for(let f=0;f<h.length;f++)p[v+f]=h[f];p=qe(p,i,a),d=p.buffer}else{if(n!==5)throw new Error("tiff-decode: unsupport compression "+n);p=nt(e,c,o,t),d=p.buffer}if(d=He(d,u),s==="u8"||s==="s8"||l)I=new m(d);else{d=new ArrayBuffer(p.length);const w=new Uint8Array(d);switch(s){case"u16":case"s16":for(let v=0;v<p.length;v+=2)w[v]=p[v+1],w[v+1]=p[v];break;case"u32":case"s32":case"f32":for(let v=0;v<p.length;v+=4)w[v]=p[v+3],w[v+1]=p[v+2],w[v+2]=p[v+1],w[v+3]=p[v]}I=new m(d)}return I}async function wr(e,t,r){const c=Te(r,"TILEOFFSETS");if(c===void 0)return null;const o=Te(r,"TILEBYTECOUNTS"),{width:l,height:u,pixelType:i,tileWidth:a,tileHeight:s}=ot([r]),n=lt(r,t),m=j(r,"SAMPLESPERPIXEL")||t.planes,d=l*u,p=j(r,"BITSPERSAMPLE"),I=(j(r,"COMPRESSION")??1)===34887,w=Ve(i),v=[];for(let x=0;x<m;x++)v.push(new w(d));let h,f,g,T,y,S,b,E,A,P,C,O,L;const k=Math.ceil(l/a);if(p%8==0){if(I&&n&&m>1){const x=Math.round(c.length/m);for(h=0;h<x;h++){S=Math.floor(h/k)*s,b=h%k*a,E=S*l+b;for(let M=0;M<m;M++){const R=h*m+M;if(o[R]!==0)for(g=await Xe(e,t.littleEndian,r,c[R],o[R]),P=0,A=E,O=Math.min(a,l-b),C=Math.min(s,u-S),L=v[M],T=0;T<C;T++)for(A=E+T*l,P=T*a,y=0;y<O;y++,A++,P++)L[A]=g[P]}}}else for(h=0;h<c.length;h++)if(o[h]!==0)for(S=Math.floor(h/k)*s,b=h%k*a,E=S*l+b,g=await Xe(e,t.littleEndian,r,c[h],o[h]),P=0,A=E,O=Math.min(a,l-b),C=Math.min(s,u-S),f=0;f<m;f++)if(L=v[f],n||I)for(T=0;T<C;T++)for(A=E+T*l,P=a*s*f+T*a,y=0;y<O;y++,A++,P++)L[A]=g[P];else for(T=0;T<C;T++)for(A=E+T*l,P=T*a*m+f,y=0;y<O;y++,A++,P+=m)L[A]=g[P]}return{width:l,height:u,pixelType:i,pixels:v}}const br=(e,t,r)=>{const c=st===t.littleEndian,o=Te(r,"STRIPOFFSETS");if(o===void 0)return null;const{width:l,height:u,pixelType:i}=ot([r]),a=j(r,"SAMPLESPERPIXEL")||t.planes,s=j(r,"PHOTOMETRICINTERPRETATION"),n=l*u,m=j(r,"BITSPERSAMPLE"),d=Ve(i),p=new d(n*a),I=Te(r,"STRIPBYTECOUNTS"),w=j(r,"ROWSPERSTRIP"),v=j(r,"COMPRESSION")??1;let h,f,g,T,y,S,b,E,A,P=w;if(m%8==0)for(h=0;h<o.length;h++){if(y=h*(w*l)*a,P=(h+1)*w>u?u-h*w:w,i==="u8"||i==="s8"||c)v===8||v===32946?(b=new Uint8Array(e,o[h],I[h]),b=Ye(b),S=b.buffer):v===6?(b=new Uint8Array(e,o[h],I[h]),b=qe(b,a,s),S=b.buffer):v===5?(b=nt(e,o[h],I[h],t.littleEndian),S=b.buffer):(I[h]!==P*l*a*m/8&&console.log("strip byte counts is different than expected"),S=e.slice(o[h],o[h]+I[h])),S=He(S,m),T=new d(S);else{switch(v===6||v===8||v===32946?(b=new Uint8Array(e,o[h],I[h]),E=Ye(b),S=E.buffer):(I[h]!==P*l*a*m/8&&console.log("strip byte counts is different than expected"),S=new ArrayBuffer(I[h]),b=new Uint8Array(e,o[h],I[h]),E=new Uint8Array(S)),i){case"u16":case"s16":for(g=0;g<b.length;g+=2)E[g]=b[g+1],E[g+1]=b[g];break;case"u32":case"s32":case"f32":for(g=0;g<b.length;g+=4)E[g]=b[g+3],E[g+1]=b[g+2],E[g+2]=b[g+1],E[g+3]=b[g]}S=He(S,m),T=new d(S)}p.set(T,y)}const C=[];if(a===1)C.push(p);else for(h=0;h<a;h++){for(A=new d(n),f=0;f<n;f++)A[f]=p[f*a+h];C.push(A)}return{width:l,height:u,pixelType:i,pixels:C}},Sr=(e,t,r)=>{if(!(e&&e.length>0&&t&&r))return null;let c,o,l;const u=e[0].length,i=e.length,a=new Uint8Array(u);for(let s=0;s<i;s++)if(c=e[s],o=t[s],l=r[s],s===0)for(let n=0;n<u;n++)a[n]=c[n]<o||c[n]>l?0:1;else for(let n=0;n<u;n++)a[n]&&(a[n]=c[n]<o||c[n]>l?0:1);return a},Tr=e=>{if(!e)return null;const t=e.match(/<Item(.*?)Item>/gi);if(!t||t.length===0)return null;const r=new Map;let c,o,l,u,i;for(let h=0;h<t.length;h++)c=t[h],o=c.slice(6,c.indexOf(">")),u=c.indexOf("sample="),u>-1&&(i=c.slice(u+8,c.indexOf('"',u+8))),u=c.indexOf("name="),u>-1&&(o=c.slice(u+6,c.indexOf('"',u+6))),o&&(l=c.slice(c.indexOf(">")+1,c.indexOf("</Item>")).trim(),i!=null?r.has(o)?r.get(o)[i]=l:r.set(o,[l]):r.set(o,l)),i=null;const a=r.get("STATISTICS_MINIMUM"),s=r.get("STATISTICS_MAXIMUM"),n=r.get("STATISTICS_MEAN"),m=r.get("STATISTICS_STDDEV");let d=null;if(a&&s){d=[];for(let h=0;h<a.length;h++)d.push({min:parseFloat(a[h]),max:parseFloat(s[h]),avg:n&&parseFloat(n[h]),stddev:m&&parseFloat(m[h])})}const p=r.get("BandName"),I=r.get("WavelengthMin"),w=r.get("WavelengthMax");let v=null;if(p){v=[];for(let h=0;h<p.length;h++)v.push({BandName:p[h],WavelengthMin:I&&parseFloat(I[h]),WavelengthMax:w&&parseFloat(w[h])})}return{statistics:d,bandProperties:v,dataType:r.get("DataType"),rawMetadata:r}};function vr(e,t,r,c=0,o=!1,l=4){if(r.values)return!0;const u=r.type,i=r.valueCount;let a=r.valueOffset,s=[];const n=vt[u],m=8*n,d=i*n,p=i*vt[u]*8;let I,w;const v=l===8?64:32,h=r.valueOffsets;if(p>v&&d>(o?e.byteLength:e?e.byteLength-a+c:0))return r.offlineOffsetSize=[a,d],r.values=null,!1;if(p<=v){if(!t)if(v<=32)a>>>=32-p;else{const f=h!=null&&h.length?h[0]:a>>>0,g=h!=null&&h.length?h[1]:Math.round((a-f)/ke);p<=32?(a=f>>>32-p,h[0]=a):(a=f*2**(32-p)+(g>>>32-p),h[0]=f,h[1]=g>>>32-p)}if(i===1&&m===v)s=[a];else if(v===64){const f=h!=null&&h.length?h[0]:a>>>0,g=h!=null&&h.length?h[1]:Math.round((a-f)/ke);let T=f,y=32;for(w=1;w<=i;w++){const S=32-m*w%32;if(y<m){const b=T<<S>>>32-y,E=g<<32-y>>>32-y;T=g,s.push(b+E*2**(m-y)),y-=32-(m-y)}else s.push(T<<S>>>32-m),y-=m;y===0&&(y=32,T=g)}}else for(w=1;w<=i;w++){const f=32-m*w;s.push(a<<f>>>32-m)}}else{a-=c,o&&(a=0);for(let f=a;f<a+d;f+=n){switch(u){case 1:case 2:case 7:I=new DataView(e,f,1).getUint8(0);break;case 3:I=new DataView(e,f,2).getUint16(0,t);break;case 4:case 13:I=new DataView(e,f,4).getUint32(0,t);break;case 5:I=new DataView(e,f,4).getUint32(0,t)/new DataView(e,f+4,4).getUint32(0,t);break;case 6:I=new DataView(e,f,1).getInt8(0);break;case 8:I=new DataView(e,f,2).getInt16(0,t);break;case 9:I=new DataView(e,f,4).getInt32(0,t);break;case 10:I=new DataView(e,f,4).getInt32(0,t)/new DataView(e,f+4,4).getInt32(0,t);break;case 11:I=new DataView(e,f,4).getFloat32(0,t);break;case 12:I=new DataView(e,f,8).getFloat64(0,t);break;case 16:case 18:I=ct(new DataView(e,f,8),0,t);break;case 17:I=xr(new DataView(e,f,8),0,t);break;default:I=null}s.push(I)}}if(u===2){let f="";const g=s;for(s=[],w=0;w<g.length;w++)g[w]===0&&f!==""?(s.push(f),f=""):f+=String.fromCharCode(g[w]);f===""&&s.length!==0||s.push(f)}return r.values=s,!0}function ot(e){const t=e[0],r=j(t,"TILEWIDTH"),c=j(t,"TILELENGTH"),o=j(t,"IMAGEWIDTH"),l=j(t,"IMAGELENGTH"),u=j(t,"BITSPERSAMPLE"),i=j(t,"SAMPLESPERPIXEL"),a=j(t,"SAMPLEFORMAT")??1,s=at(a,u),n=lt(t),m=Ot(t,"GDAL_NODATA");let d=null;m!=null&&m.length&&(d=m.map(D=>parseFloat(D)),d.some(D=>isNaN(D))&&(d=null));const p=j(t,"COMPRESSION")??1;let I;switch(p){case 1:I="NONE";break;case 2:case 3:case 4:case 32771:I="CCITT";break;case 5:I="LZW";break;case 6:case 7:I="JPEG";break;case 32773:I="PACKBITS";break;case 8:case 32946:I="DEFLATE";break;case 34712:I="JPEG2000";break;case 34887:I="LERC";break;default:I=String(p)}let w=!0,v="";mr.has(p)||(w=!1,v+="unsupported tag compression "+p),a>3&&(w=!1,v+="unsupported tag sampleFormat "+a),u!==1&&u!==2&&u!==4&&u%8!=0&&(w=!1,v+="unsupported tag bitsPerSample "+u);const h=It(t,"GEOASCIIPARAMS");let f;if(h){const D=h.split("|").find(_=>_.includes("ESRI PE String = ")),U=D?D.replace("ESRI PE String = ",""):"";f=U.startsWith("COMPD_CS")||U.startsWith("PROJCS")||U.startsWith("GEOGCS")?{wkid:null,wkt:U}:null}const g=Te(t,"GEOTIEPOINTS"),T=Te(t,"GEOPIXELSCALE"),y=Te(t,"GEOTRANSMATRIX"),S=t.has("GEOKEYDIRECTORY")?t.get("GEOKEYDIRECTORY").data:null;let b,E,A=!1,P=!1;if(S){A=j(S,"GTRasterTypeGeoKey")===2;const D=j(S,"GTModelTypeGeoKey");if(D===2){const U=j(S,"GeographicTypeGeoKey");U>=1024&&U<=32766&&(f={wkid:U}),f||U!==32767||(P=!0,f={wkid:4326})}else if(D===1){const U=j(S,"ProjectedCSTypeGeoKey");U>=1024&&U<=32766&&(f={wkid:U})}}if(T&&g&&g.length>=6?(b=[T[0],0,g[3]-g[0]*T[0],0,-Math.abs(T[1]),g[4]-g[1]*T[1]],A&&(b[2]-=.5*b[0]+.5*b[1],b[5]-=.5*b[3]+.5*b[4])):y&&y.length===16&&(b=A?[y[0],y[1],y[3]-.5*y[0],y[4],y[5],y[7]-.5*y[5]]:[y[0],y[1],y[3],y[4],y[5],y[7]]),b){const D=[{x:0,y:l},{x:0,y:0},{x:o,y:l},{x:o,y:0}];let U,_=Number.POSITIVE_INFINITY,N=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,B=Number.NEGATIVE_INFINITY;for(let X=0;X<D.length;X++)U=gr(D[X],b),_=U.x>_?_:U.x,V=U.x<V?V:U.x,N=U.y>N?N:U.y,B=U.y<B?B:U.y;E={xmin:_,xmax:V,ymin:N,ymax:B,spatialReference:f}}else E={xmin:-.5,ymin:.5-l,xmax:o-.5,ymax:.5,spatialReference:f};P&&(E.xmax-E.xmin>400||Math.max(Math.abs(E.xmin),Math.abs(E.xmax))>361)&&(f=null,E.spatialReference=null);const C=Rt(e);let O,L,k,x,M;if(C.length>0){k=Math.round(Math.log(o/j(C[0],"IMAGEWIDTH"))/Math.LN2);const D=C[C.length-1];x=Math.round(Math.log(o/j(D,"IMAGEWIDTH"))/Math.LN2),O=j(D,"TILEWIDTH"),L=j(D,"TILELENGTH")}O=x!=null&&x>0?O||r:null,L=x!=null&&x>0?L||c:null,r&&(M=[{maxCol:Math.ceil(o/r)-1,maxRow:Math.ceil(l/c)-1,minRow:0,minCol:0}],C.forEach(D=>{M.push({maxCol:Math.ceil(j(D,"IMAGEWIDTH")/j(D,"TILEWIDTH"))-1,maxRow:Math.ceil(j(D,"IMAGELENGTH")/j(D,"TILELENGTH"))-1,minRow:0,minCol:0})}));const R=It(e[0],"GDAL_METADATA"),G=Tr(R);return v+=" "+Dt({width:o,height:l,tileWidth:r,tileHeight:c,planes:i,ifds:e}),{width:o,height:l,tileWidth:r,tileHeight:c,planes:i,isBSQ:n,pixelType:s,compression:I,noData:d,hasMaskBand:Ut(e).length===C.length+1,isSupported:w,message:v,extent:E,isPseudoGeographic:P,affine:T?null:b,firstPyramidLevel:k,maximumPyramidLevel:x,pyramidBlockWidth:O,pyramidBlockHeight:L,tileBoundary:M,metadata:G}}function lt(e,t){const r=Ot(e,"PLANARCONFIGURATION");return r?r[0]===2:!!t&&t.isBSQ}function Rt(e){return e.filter(t=>j(t,"NEWSUBFILETYPE")===1)}function Ut(e){return e.filter(t=>{const r=(4&(j(t,"NEWSUBFILETYPE")??0))==4,c=j(t,"PHOTOMETRICINTERPRETATION")===4;return r&&c})}function Ir(e){const{littleEndian:t,isBigTiff:r,firstIFDPos:c}=Ar(e);let o=c;const l=[];do{const u=Er(e,t,o,0,Ae.TIFF_TAGS,r?8:4);if(!u.success)break;l.push(u.ifd),o=u.nextIFD}while(o>0);return{...ot(l),littleEndian:t,isBigTiff:r,ifds:l,pyramidIFDs:Rt(l),maskIFDs:Ut(l)}}function ct(e,t,r){const c=e.getUint32(t,r),o=e.getUint32(t+4,r);return r?o*ke+c:c*ke+o}function xr(e,t,r){let c=r?e.getInt32(t,r):e.getUint32(t,r),o=r?e.getUint32(t+4,r):e.getInt32(t+4,r);const l=(r?c:o)>=0?1:-1;return r?c*=l:o*=l,l*(r?o*ke+c:c*ke+o)}function De(e,t,r,c){return c?ct(e,t,r):e.getUint32(t,r)}function Ar(e){const t=new DataView(e,0,16),r=t.getUint16(0,!1);let c=null;if(r===18761)c=!0;else{if(r!==19789)throw new Error("unexpected endianess byte");c=!1}const o=t.getUint16(2,c);if(o!==42&&o!==43)throw new Error("unexpected tiff identifier");let l=4;const u=o===43;if(u){const i=t.getUint16(l,c);if(l+=2,i!==8)throw new Error("unsupported bigtiff version");if(t.getUint16(l,c)!==0)throw new Error("unsupported bigtiff version");l+=2}return{littleEndian:c,isBigTiff:u,firstIFDPos:De(t,l,c,u)}}function Er(e,t,r,c=0,o=Ae.TIFF_TAGS,l=4){const u=je(e,t,r,c,o,l);let i;const a=u.ifd;if(a){if(Ae.ifdTags.forEach((s,n)=>{a.has(n)&&(i=a.get(n),i.data=je(e,t,i.valueOffset-c,c,s).ifd)}),a.has("GEOKEYDIRECTORY")){i=a.get("GEOKEYDIRECTORY");const s=i.values;if(s&&s.length>4){const n=s[0]+"."+s[1]+"."+s[2];i.data=je(e,t,i.valueOffset+6-c,c,Ae.GEO_KEYS,2).ifd,i.data&&i.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[n]})}}if(a.has("XMP")){i=a.get("XMP");const s=i.values;typeof s[0]=="number"&&i.type===7&&(i.values=[ur(new Uint8Array(s))])}}return u}function Dt(e){const{width:t,height:r,tileHeight:c,tileWidth:o}=e,l=e.planes,u=o?o*c:t*r,i=j(e.ifds[0],"BITSPERSAMPLE");let a="";return u*l>2**30/(i>8?i/8:1)&&(a=o?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),a}async function kr(e,t){const{headerInfo:r,ifd:c,offsets:o,sizes:l}=t,u=[];for(let A=0;A<o.length;A++){const P=await Xe(e,r.littleEndian,c,o[A],l[A]||e.byteLength);u.push(P)}const i=lt(c,r),a=j(c,"BITSPERSAMPLE"),s=at(j(c,"SAMPLEFORMAT")??1,a),n=j(c,"SAMPLESPERPIXEL")||r.planes,m=Ve(s),d=j(c,"TILEWIDTH"),p=j(c,"TILELENGTH"),I=j(c,"COMPRESSION")??1,w=d*p;let v;const h=[];let f=u[0];const g=I===34887;for(let A=0;A<n;A++){if(v=new m(w),i&&g){if(f=u[A],f.length)for(let P=0;P<w;P++)v[P]=f[A][P+A]}else if(f.length)if(i||g&&!i)v=f.slice(w*A,w*(A+1));else for(let P=0;P<w;P++)v[P]=f[P*n+A];h.push(v)}const T=r.noData?r.noData[0]:t.noDataValue,y=r.metadata?r.metadata.statistics:null,S=y?y.map(A=>A.min):null,b=y?y.map(A=>A.max):null,E={pixelType:s,width:d,height:p,pixels:h,noDataValue:T};return T!=null?et(E,T):S&&b&&t.applyMinMaxConstraint&&(E.mask=Sr(h,S,b)),E}async function Pr(e,t={}){const r=t.pyramidLevel||0,c=t.headerInfo||Ir(e),{ifds:o,noData:l}=c;if(o.length===0)throw new Error("no valid image file directory");const u=Dt(c);if(u)throw u;let i=null;const a=r===-1?o[o.length-1]:o[r],s=l??t.noDataValue;return i=c.tileWidth?await wr(e,c,a):await br(e,c,a),i&&(s!=null&&et(i,s),i)}var Cr=function(e){var t,r,c,o,l,u;function i(a){var s,n,m,d,p,I,w,v,h,f,g,T,y;for(this.data=a,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},p=null;;){switch(s=this.readUInt32(),v=function(){var S,b;for(b=[],S=0;S<4;++S)b.push(String.fromCharCode(this.data[this.pos++]));return b}.call(this).join(""),v){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(s);break;case"fcTL":p&&this.animation.frames.push(p),this.pos+=4,p={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},d=this.readUInt16(),m=this.readUInt16()||100,p.delay=1e3*d/m,p.disposeOp=this.data[this.pos++],p.blendOp=this.data[this.pos++],p.data=[];break;case"IDAT":case"fdAT":for(v==="fdAT"&&(this.pos+=4,s-=4),a=(p!=null?p.data:void 0)||this.imgData,g=0;0<=s?g<s:g>s;0<=s?++g:--g)a.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(s),(h=255-this.transparency.indexed.length)>0)for(T=0;0<=h?T<h:T>h;0<=h?++T:--T)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(s)[0];break;case 2:this.transparency.rgb=this.read(s)}break;case"tEXt":I=(f=this.read(s)).indexOf(0),w=String.fromCharCode.apply(String,f.slice(0,I)),this.text[w]=String.fromCharCode.apply(String,f.slice(I+1));break;case"IEND":return p&&this.animation.frames.push(p),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(y=this.colorType)===4||y===6,n=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*n,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=s}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return i.load=function(a,s,n){var m;return typeof s=="function"&&(n=s),(m=new XMLHttpRequest).open("GET",a,!0),m.responseType="arraybuffer",m.onload=function(){var d;return d=new i(new Uint8Array(m.response||m.mozResponseArrayBuffer)),typeof(s!=null?s.getContext:void 0)=="function"&&d.render(s),typeof n=="function"?n(d):void 0},m.send(null)},r=1,c=2,t=0,i.prototype.read=function(a){var s,n;for(n=[],s=0;0<=a?s<a:s>a;0<=a?++s:--s)n.push(this.data[this.pos++]);return n},i.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.decodePixels=function(a){var s,n,m,d,p,I,w,v,h,f,g,T,y,S,b,E,A,P,C,O,L,k,x;if(a==null&&(a=this.imgData),a.length===0)return new Uint8Array(0);for(a=(a=new ve(a)).getBytes(),E=(T=this.pixelBitlength/8)*this.width,y=new Uint8Array(E*this.height),I=a.length,b=0,S=0,n=0;S<I;){switch(a[S++]){case 0:for(d=C=0;C<E;d=C+=1)y[n++]=a[S++];break;case 1:for(d=O=0;O<E;d=O+=1)s=a[S++],p=d<T?0:y[n-T],y[n++]=(s+p)%256;break;case 2:for(d=L=0;L<E;d=L+=1)s=a[S++],m=(d-d%T)/T,A=b&&y[(b-1)*E+m*T+d%T],y[n++]=(A+s)%256;break;case 3:for(d=k=0;k<E;d=k+=1)s=a[S++],m=(d-d%T)/T,p=d<T?0:y[n-T],A=b&&y[(b-1)*E+m*T+d%T],y[n++]=(s+Math.floor((p+A)/2))%256;break;case 4:for(d=x=0;x<E;d=x+=1)s=a[S++],m=(d-d%T)/T,p=d<T?0:y[n-T],b===0?A=P=0:(A=y[(b-1)*E+m*T+d%T],P=m&&y[(b-1)*E+(m-1)*T+d%T]),w=p+A-P,v=Math.abs(w-p),f=Math.abs(w-A),g=Math.abs(w-P),h=v<=f&&v<=g?p:f<=g?A:P,y[n++]=(s+h)%256;break;default:throw new Error("Invalid filter algorithm: "+a[S-1])}b++}return y},i.prototype.decodePalette=function(){var a,s,n,m,d,p,I,w,v;for(n=this.palette,p=this.transparency.indexed||[],d=new Uint8Array((p.length||0)+n.length),m=0,n.length,a=0,s=I=0,w=n.length;I<w;s=I+=3)d[m++]=n[s],d[m++]=n[s+1],d[m++]=n[s+2],d[m++]=(v=p[a++])!=null?v:255;return d},i.prototype.copyToImageData=function(a,s){var n,m,d,p,I,w,v,h,f,g,T;if(m=this.colors,f=null,n=this.hasAlphaChannel,this.palette.length&&(f=(T=this._decodedPalette)!=null?T:this._decodedPalette=this.decodePalette(),m=4,n=!0),h=(d=a.data||a).length,I=f||s,p=w=0,m===1)for(;p<h;)v=f?4*s[p/4]:w,g=I[v++],d[p++]=g,d[p++]=g,d[p++]=g,d[p++]=n?I[v++]:this.transparency.grayscale&&this.transparency.grayscale===g?0:255,w=v;else for(;p<h;)v=f?4*s[p/4]:w,d[p++]=I[v++],d[p++]=I[v++],d[p++]=I[v++],d[p++]=n?I[v++]:this.transparency.rgb&&this.transparency.rgb[1]===I[v-3]&&this.transparency.rgb[3]===I[v-2]&&this.transparency.rgb[5]===I[v-1]?0:255,w=v},i.prototype.decode=function(){var a;return a=new Uint8Array(this.width*this.height*4),this.copyToImageData(a,this.decodePixels()),a},l=e.document&&e.document.createElement("canvas"),u=l&&l.getContext("2d"),o=function(a){var s;return u.width=a.width,u.height=a.height,u.clearRect(0,0,a.width,a.height),u.putImageData(a,0,0),(s=new Image).src=l.toDataURL(),s},i.prototype.decodeFrames=function(a){var s,n,m,d,p,I,w,v;if(this.animation){for(v=[],n=p=0,I=(w=this.animation.frames).length;p<I;n=++p)s=w[n],m=a.createImageData(s.width,s.height),d=this.decodePixels(new Uint8Array(s.data)),this.copyToImageData(m,d),s.imageData=m,v.push(s.image=o(m));return v}},i.prototype.renderFrame=function(a,s){var n,m,d;return n=(m=this.animation.frames)[s],d=m[s-1],s===0&&a.clearRect(0,0,this.width,this.height),(d!=null?d.disposeOp:void 0)===r?a.clearRect(d.xOffset,d.yOffset,d.width,d.height):(d!=null?d.disposeOp:void 0)===c&&a.putImageData(d.imageData,d.xOffset,d.yOffset),n.blendOp===t&&a.clearRect(n.xOffset,n.yOffset,n.width,n.height),a.drawImage(n.image,n.xOffset,n.yOffset)},i.prototype.animate=function(a){var s,n,m,d,p,I,w=this;return n=0,I=this.animation,d=I.numFrames,m=I.frames,p=I.numPlays,(s=function(){var v,h;if(v=n++%d,h=m[v],w.renderFrame(a,v),d>1&&n/d<p)return w.animation._timeout=setTimeout(s,h.delay)})()},i.prototype.stopAnimation=function(){var a;return clearTimeout((a=this.animation)!=null?a._timeout:void 0)},i.prototype.render=function(a){var s,n;return a._png&&a._png.stopAnimation(),a._png=this,a.width=this.width,a.height=this.height,s=a.getContext("2d"),this.animation?(this.decodeFrames(s),this.animate(s)):(n=s.createImageData(this.width,this.height),this.copyToImageData(n,this.decodePixels()),s.putImageData(n,0,0))},i}(self);const Mr=new Set(["jpg","png","bmp","gif"]);async function Lr(e,t){if(!st)throw new me("rasterCoded:decode","lerc decoder is not supported on big endian platform");await Ct();const{offset:r}=t,{width:c,height:o,pixelType:l,statistics:u,depthCount:i,noDataValues:a,bandMasks:s,pixels:n,mask:m}=Mt(e,{inputOffset:r,returnInterleaved:t.returnInterleaved});return new se({width:c,height:o,pixelType:l.toLowerCase(),pixels:n,mask:m,statistics:u,bandMasks:s,depthCount:i,noDataValues:a})}async function Or(e,t){const r=await Pr(e,{...t,noDataValue:null});Ue(r);const c=new se({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return c.updateStatistics(),c}async function Rr(e,t){const r=await kr(e,t.customOptions),c=new se({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return c.updateStatistics(),c}function Gt(e,t){const r=t.pixelType||"u8",c=se.getPixelArrayConstructor(r),o=r==="u8"?e:new c(e.buffer),l=[],u=t.planes||1;if(u===1)l.push(o);else for(let a=0;a<u;a++){const s=(t.width||1)*(t.height||e.length),n=new c(s);for(let m=0;m<s;m++)n[m]=o[m*u+a];l.push(n)}const i=new se({width:t.width||1,height:t.height||e.length,pixels:l,pixelType:r,statistics:null});return i.updateStatistics(),i}function Ur(e,t){return Gt(new ve(new Uint8Array(e)).getBytes(),t)}function Dr(e,t){return Gt(nt(e,t.offset,t.eof,!t.isInputBigEndian),t)}function Gr(e,t,r){const{pixelTypeCtor:c}=_r(t.pixelType),o=(0,cr.decode)(e,{width:t.width,height:t.height,pixelType:c,format:r}),l=new se({width:t.width,height:t.height,pixels:o.pixels,pixelType:t.pixelType,mask:o.mask,statistics:null});return l.updateStatistics(),l}function Nr(e,t){const r=nr.decode(e,t.hasNoZlibMask??void 0),c=new se({width:r.width,height:r.height,pixels:r.pixels,pixelType:"U8",mask:r.mask,statistics:null});return c.updateStatistics(),c}function Fr(e,t){const r=new Uint8Array(e),c=new Cr(r),{width:o,height:l}=t,u=o*l,i=c.decode();let a,s=0,n=0;const m=new Uint8Array(u);for(s=0;s<u;s++)m[s]=i[4*s+3];const d=new se({width:o,height:l,pixels:[],pixelType:"U8",mask:m,statistics:[]});for(s=0;s<3;s++){for(a=new Uint8Array(u),n=0;n<u;n++)a[n]=i[4*n+s];d.addData({pixels:a})}return d.updateStatistics(),d}async function Vr(e,t,r,c){const o=new tr,l={applyJpegMask:!1,format:t,...r},u=await o.decode(e,l,c),i=new se(u);return i.updateStatistics(),i}function Nt(e){if(e==null)throw new me("rasterCodec:decode","parameter encodeddata is required.");const t=new Uint8Array(e,0,10);let r="";return t[0]===255&&t[1]===216?r="jpg":t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71?r="png":t[0]===67&&t[1]===110&&t[2]===116&&t[3]===90&&t[4]===73&&t[5]===109&&t[6]===97&&t[7]===103&&t[8]===101&&t[9]===32?r="lerc":t[0]===76&&t[1]===101&&t[2]===114&&t[3]===99&&t[4]===50&&t[5]===32?r="lerc2":t[0]===73&&t[1]===73&&t[2]===42&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===42||t[0]===73&&t[1]===73&&t[2]===43&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===43?r="tiff":t[0]===71&&t[1]===73&&t[2]===70?r="gif":t[0]===66&&t[1]===77?r="bmp":String.fromCharCode.apply(null,t).toLowerCase().includes("error")&&(r="error"),r}function Br(e){let t=null;switch(e){case"lerc":case"lerc2":t=Lr;break;case"jpg":t=Nr;break;case"png":t=Fr;break;case"bsq":case"bip":t=(r,c)=>Gr(r,c,e);break;case"tiff":t=Or;break;case"deflate":t=Ur;break;case"lzw":t=Dr;break;case"error":t=()=>{throw new me("rasterCodec:decode","input data contains error")};break;default:t=()=>{throw new me("rasterCodec:decode","unsupported raster format")}}return t}function _r(e){let t=null,r=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":r=255,t=Uint8Array;break;case"u16":r=r||65535,t=Uint16Array;break;case"u32":r=r||2**32-1,t=Uint32Array;break;case"s8":r=r||-128,t=Int8Array;break;case"s16":r=r||-32768,t=Int16Array;break;case"s32":r=r||0-2**31,t=Int32Array;break;default:t=Float32Array}return{pixelTypeCtor:t,noDataValue:r}}function $r(e,t=1){if(!e)return;const{pixels:r,width:c,height:o,mask:l}=e;if(!r||r.length===0)return;const u=r.length,i=c-1,a=o-1,s=[];let n,m,d,p,I,w,v=null;const h=se.getPixelArrayConstructor(e.pixelType);if(t===0){for(n=0;n<u;n++){for(I=r[n],w=new h(i*a),m=0;m<a;m++)for(p=m*c,d=0;d<i;d++)w[m*i+d]=I[p+d];s.push(w)}if(Z(l))for(v=new Uint8Array(i*a),m=0;m<a;m++)for(p=m*c,d=0;d<i;d++)v[m*i+d]=l[p+d]}else{for(n=0;n<u;n++){for(I=r[n],w=new h(i*a),m=0;m<a;m++)for(p=m*c,d=0;d<i;d++)w[m*i+d]=(I[p+d]+I[p+d+1]+I[p+c+d]+I[p+c+d+1])/4;s.push(w)}if(l)for(v=new Uint8Array(i*a),m=0;m<a;m++)for(p=m*c,d=0;d<i;d++)v[m*i+d]=Math.min.apply(null,[l[p+d],l[p+d+1],l[p+c+d],l[p+c+d+1]])}e.width=i,e.height=a,e.mask=v,e.pixels=s}function En(e){let t=Nt(e);return t==="lerc2"?t="lerc":t==="error"&&(t=""),t}async function kn(e,t={},r){if(e==null)throw new me("rasterCodec:decode","missing encodeddata parameter.");let c=t.format&&t.format.toLowerCase();if(!(c!=="bsq"&&c!=="bip"||t.width!=null&&t.height!=null))throw new me("rasterCodec:decode","requires width and height in options parameter.");if(c==="tiff"&&t.customOptions)return Rr(e,t);if((!c||c!=="bsq"&&c!=="bip"&&c!=="deflate"&&c!=="lzw")&&(c=Nt(e)),t.useCanvas&&Mr.has(c))return Vr(e,c,t,r);const o=Br(c);t.isPoint&&((t={...t}).width!=null&&t.width++,t.height!=null&&t.height++);const l=await o(e,t);return l&&(c!=="jpg"&&t.noDataValue!=null&&l.depthCount===1&&et(l,t.noDataValue,{customFloatTolerance:t.tolerance}),t.isPoint&&$r(l),l)}var Ze;let te=Ze=class extends rt{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isVirtualTileInfo=!1,this.tileInfo=null,this.transposeInfo=null,this.blockBoundary=null}clone(){return new Ze({blockWidth:this.blockWidth,blockHeight:this.blockHeight,compression:this.compression,origin:re(this.origin),firstPyramidLevel:this.firstPyramidLevel,maximumPyramidLevel:this.maximumPyramidLevel,pyramidResolutions:re(this.pyramidResolutions),pyramidScalingFactor:this.pyramidScalingFactor,pyramidBlockWidth:this.pyramidBlockWidth,pyramidBlockHeight:this.pyramidBlockHeight,isVirtualTileInfo:this.isVirtualTileInfo,tileInfo:re(this.tileInfo),transposeInfo:re(this.transposeInfo),blockBoundary:re(this.blockBoundary)})}};$([W({type:Number,json:{write:!0}})],te.prototype,"blockWidth",void 0),$([W({type:Number,json:{write:!0}})],te.prototype,"blockHeight",void 0),$([W({type:String,json:{write:!0}})],te.prototype,"compression",void 0),$([W({type:Zt,json:{write:!0}})],te.prototype,"origin",void 0),$([W({type:Number,json:{write:!0}})],te.prototype,"firstPyramidLevel",void 0),$([W({type:Number,json:{write:!0}})],te.prototype,"maximumPyramidLevel",void 0),$([W({json:{write:!0}})],te.prototype,"pyramidResolutions",void 0),$([W({type:Number,json:{write:!0}})],te.prototype,"pyramidScalingFactor",void 0),$([W({type:Number,json:{write:!0}})],te.prototype,"pyramidBlockWidth",void 0),$([W({type:Number,json:{write:!0}})],te.prototype,"pyramidBlockHeight",void 0),$([W({type:Boolean,json:{write:!0}})],te.prototype,"isVirtualTileInfo",void 0),$([W({json:{write:!0}})],te.prototype,"tileInfo",void 0),$([W()],te.prototype,"transposeInfo",void 0),$([W()],te.prototype,"blockBoundary",void 0),te=Ze=$([tt("esri.layers.support.RasterStorageInfo")],te);const jr=te;var Qe;let Y=Qe=class extends rt{constructor(e){super(e),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get dataType(){var t,r;const e=((r=(t=this.keyProperties)==null?void 0:t.DataType)==null?void 0:r.toLowerCase())??"generic";return e==="stdtime"?"standard-time":e}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(e){e&&this._set("nativeExtent",e)}get nativePixelSize(){if(Fe(this.transform)||!this.transform.affectsPixelSize)return this.pixelSize;const e=this.nativeExtent;return{x:e.width/this.width,y:e.height/this.height}}get hasMultidimensionalTranspose(){var e;return!!((e=this.storageInfo)!=null&&e.transposeInfo)}clone(){return new Qe({attributeTable:re(this.attributeTable),bandCount:this.bandCount,colormap:re(this.colormap),extent:re(this.extent),nativePixelSize:re(this.nativePixelSize),format:this.format,height:this.height,width:this.width,histograms:re(this.histograms),keyProperties:re(this.keyProperties),multidimensionalInfo:re(this.multidimensionalInfo),noDataValue:this.noDataValue,pixelSize:re(this.pixelSize),pixelType:this.pixelType,isPseudoSpatialReference:this.isPseudoSpatialReference,spatialReference:re(this.spatialReference),statistics:re(this.statistics),storageInfo:re(this.storageInfo),transform:re(this.transform)})}};$([W({json:{write:!0}})],Y.prototype,"attributeTable",void 0),$([W({json:{write:!0}})],Y.prototype,"bandCount",void 0),$([W({json:{write:!0}})],Y.prototype,"colormap",void 0),$([W({type:String,readOnly:!0})],Y.prototype,"dataType",null),$([W({type:dt,json:{write:!0}})],Y.prototype,"extent",void 0),$([W({type:dt,json:{write:!0}})],Y.prototype,"nativeExtent",null),$([W({json:{write:!0}})],Y.prototype,"nativePixelSize",null),$([W({json:{write:!0}})],Y.prototype,"format",void 0),$([W({json:{write:!0}})],Y.prototype,"height",void 0),$([W({json:{write:!0}})],Y.prototype,"width",void 0),$([W({json:{write:!0}})],Y.prototype,"hasMultidimensionalTranspose",null),$([W({json:{write:!0}})],Y.prototype,"histograms",void 0),$([W({json:{write:!0}})],Y.prototype,"keyProperties",void 0),$([W({json:{write:!0}})],Y.prototype,"multidimensionalInfo",void 0),$([W({json:{write:!0}})],Y.prototype,"noDataValue",void 0),$([W({json:{write:!0}})],Y.prototype,"pixelSize",void 0),$([W({json:{write:!0}})],Y.prototype,"pixelType",void 0),$([W()],Y.prototype,"isPseudoSpatialReference",void 0),$([W({type:Qt,json:{write:!0}})],Y.prototype,"spatialReference",void 0),$([W({json:{write:!0}})],Y.prototype,"statistics",void 0),$([W({type:jr,json:{write:!0}})],Y.prototype,"storageInfo",void 0),$([W({json:{write:!0}})],Y.prototype,"transform",void 0),Y=Qe=$([tt("esri.layers.support.RasterInfo")],Y);const zr=Y;function Ft(e){let{altitude:t,azimuth:r}=e;const{hillshadeType:c,pixelSizePower:o=1,pixelSizeFactor:l=1,scalingType:u,isGCS:i,resolution:a}=e,s=c==="multi-directional"?2*e.zFactor:e.zFactor,{x:n,y:m}=a;let d=s/(8*n),p=s/(8*m);if(i&&s>.001&&(d/=111e3,p/=111e3),u==="adjusted")if(i){const O=111e3*n,L=111e3*m;d=(s+O**o*l)/(8*O),p=(s+L**o*l)/(8*L)}else d=(s+n**o*l)/(8*n),p=(s+m**o*l)/(8*m);let I=(90-t)*Math.PI/180,w=Math.cos(I),v=(360-r+90)*Math.PI/180,h=Math.sin(I)*Math.cos(v),f=Math.sin(I)*Math.sin(v);const g=[315,270,225,360,180,0],T=[60,60,60,60,60,90],y=new Float32Array([3,5,3,2,1,4]),S=y.reduce((O,L)=>O+L),b=y.map(O=>O/S),E=c==="multi-directional"?g.length:1,A=new Float32Array(6),P=new Float32Array(6),C=new Float32Array(6);if(c==="multi-directional")for(let O=0;O<E;O++)t=T[O],r=g[O],I=(90-t)*Math.PI/180,w=Math.cos(I),v=(360-r+90)*Math.PI/180,h=Math.sin(I)*Math.cos(v),f=Math.sin(I)*Math.sin(v),A[O]=w,P[O]=h,C[O]=f;else A.fill(w),P.fill(h),C.fill(f);return{resolution:a,factor:[d,p],sinZcosA:h,sinZsinA:f,cosZ:w,sinZcosAs:P,sinZsinAs:C,cosZs:A,weights:b,hillshadeType:["traditional","multi-directional"].indexOf(c)}}function Wr(e,t){if(!Ee(e))return e;const{width:r,height:c,mask:o}=e,l=new Uint8Array(r*c);let u=1;if(Z(o)){for(let k=0;k<o.length;k++)if(o[k]){u=o[k];break}l.set(o)}const{factor:i,sinZcosA:a,sinZsinA:s,cosZ:n,sinZcosAs:m,sinZsinAs:d,cosZs:p,weights:I}=Ft(t),[w,v]=i,{hillshadeType:h}=t,f=e.pixels[0],g=new Uint8Array(r*c);let T,y,S,b,E,A,P,C;const O=1,L=Z(o);for(let k=O;k<c-O;k++){const x=k*r;for(let M=O;M<r-O;M++){if(o&&!o[x+M]){g[x+M]=0;continue}let R=8;if(L&&(R=(o[x-r+M-1]+o[x-r+M]+o[x-r+M+1]+o[x+M-1]+o[x+M+1]+o[x+r+M-1]+o[x+r+M]+o[x+r+M+1])/u,R<7)){g[x+M]=0,l[x+M]=0;continue}o&&R===7?(T=o[x-r+M-1]?f[x-r+M-1]:f[x+M],y=o[x-r+M]?f[x-r+M]:f[x+M],S=o[x-r+M+1]?f[x-r+M+1]:f[x+M],b=o[x+M-1]?f[x+M-1]:f[x+M],E=o[x+M+1]?f[x+M+1]:f[x+M],A=o[x+r+M-1]?f[x+r+M-1]:f[x+M],P=o[x+r+M]?f[x+r+M]:f[x+M],C=o[x+r+M+1]?f[x+r+M+1]:f[x+M]):(T=f[x-r+M-1],y=f[x-r+M],S=f[x-r+M+1],b=f[x+M-1],E=f[x+M+1],A=f[x+r+M-1],P=f[x+r+M],C=f[x+r+M+1]);const G=(S+E+E+C-(T+b+b+A))*w,D=(A+P+P+C-(T+y+y+S))*v,U=Math.sqrt(1+G*G+D*D);let _=0;if(h==="traditional"){let N=255*(n+s*D-a*G)/U;N<0&&(N=0),_=N}else{const N=d.length;for(let V=0;V<N;V++){let B=255*(p[V]+d[V]*D-m[V]*G)/U;B<0&&(B=0),_+=B*I[V]}}g[x+M]=255&_}}for(let k=0;k<c;k++)g[k*r]=g[k*r+1],g[(k+1)*r-1]=g[(k+1)*r-2];for(let k=1;k<r-1;k++)g[k]=g[k+r],g[k+(c-1)*r]=g[k+(c-2)*r];return new se({width:r,height:c,pixels:[g],mask:o?l:null,pixelType:"u8",validPixelCount:e.validPixelCount,statistics:[{minValue:0,maxValue:255}]})}function Kr(e,t,r,c){if(!Ee(e)||!Ee(t))return;const{min:o,max:l}=c,u=e.pixels[0],{pixels:i,mask:a}=t,s=i[0],n=255.00001/(l-o),m=new Uint8ClampedArray(s.length),d=new Uint8ClampedArray(s.length),p=new Uint8ClampedArray(s.length),I=r.length-1;for(let w=0;w<s.length;w++){if(a&&a[w]===0)continue;const v=Math.floor((s[w]-o)*n),[h,f]=r[v<0?0:v>I?I:v],g=u[w],T=g*f,y=T*(1-Math.abs(h%2-1)),S=g-T;switch(Math.floor(h)){case 0:m[w]=T+S,d[w]=y+S,p[w]=S;break;case 1:m[w]=y+S,d[w]=T+S,p[w]=S;break;case 2:m[w]=S,d[w]=T+S,p[w]=y+S;break;case 3:m[w]=S,d[w]=y+S,p[w]=T+S;break;case 4:m[w]=y+S,d[w]=S,p[w]=T+S;break;case 5:case 6:m[w]=T+S,d[w]=S,p[w]=y+S}}e.pixels=[m,d,p],e.updateStatistics()}function Pn(e,t){if(!Ee(e))return e;const r=t.zFactor,c=t.pixelSizePower??1,o=t.pixelSizeFactor??1,l=t.slopeType,u=t.isGCS,{width:i,height:a,mask:s}=e,n=e.pixels[0],m=new Uint8Array(i*a);let d=1;if(Z(s)){for(let L=0;L<s.length;L++)if(s[L]){d=s[L];break}m.set(s)}const p=new Float32Array(i*a),{x:I,y:w}=t.resolution;let v=r/(8*I),h=r/(8*w);u&&Math.abs(r-1)<1e-4&&(v/=111e3,h/=111e3),l==="adjusted"&&(v=(r+I**c*o)/(8*I),h=(r+w**c*o)/(8*w));const f=1;let g,T,y,S,b,E,A,P;const C=Z(s);for(let L=f;L<a-f;L++){const k=L*i;for(let x=f;x<i-f;x++){if(s&&!s[k+x]){p[k+x]=0;continue}let M=0;if(C&&(M=(s[k-i+x-1]+s[k-i+x]+s[k-i+x+1]+s[k+x-1]+s[k+x+1]+s[k+i+x-1]+s[k+i+x]+s[k+i+x+1])/d,M<7)){p[k+x]=0,m[k+x]=0;continue}s&&M===7?(g=s[k-i+x-1]?n[k-i+x-1]:n[k+x],T=s[k-i+x]?n[k-i+x]:n[k+x],y=s[k-i+x+1]?n[k-i+x+1]:n[k+x],S=s[k+x-1]?n[k+x-1]:n[k+x],b=s[k+x+1]?n[k+x+1]:n[k+x],E=s[k+i+x-1]?n[k+i+x-1]:n[k+x],A=s[k+i+x]?n[k+i+x]:n[k+x],P=s[k+i+x+1]?n[k+i+x+1]:n[k+x]):(g=n[k-i+x-1],T=n[k-i+x],y=n[k-i+x+1],S=n[k+x-1],b=n[k+x+1],E=n[k+i+x-1],A=n[k+i+x],P=n[k+i+x+1]);const R=(y+b+b+P-(g+S+S+E))*v,G=(E+A+A+P-(g+T+T+y))*h,D=Math.sqrt(R*R+G*G);p[k+x]=l==="percent-rise"?100*D:57.2957795*Math.atan(D)}}for(let L=0;L<a;L++)p[L*i]=p[L*i+1],p[(L+1)*i-1]=p[(L+1)*i-2];for(let L=1;L<i-1;L++)p[L]=p[L+i],p[L+(a-1)*i]=p[L+(a-2)*i];const O=new se({width:i,height:a,pixels:[p],mask:s?m:null,pixelType:"f32",validPixelCount:e.validPixelCount});return O.updateStatistics(),O}function Cn(e,t={}){if(!Ee(e))return e;const{width:r,height:c,mask:o}=e,l=e.pixels[0],u=new Uint8Array(r*c);Z(o)&&u.set(o);const i=new Float32Array(r*c),{resolution:a}=t,s=a?1/a.x:1,n=a?1/a.y:1,m=1;let d,p,I,w,v,h,f,g;const T=Z(o);for(let y=m;y<c-m;y++){const S=y*r;for(let b=m;b<r-m;b++){if(o&&!o[S+b]){i[S+b]=0;continue}let E=0;if(T&&(E=o[S-r+b-1]+o[S-r+b]+o[S-r+b+1]+o[S+b-1]+o[S+b+1]+o[S+r+b-1]+o[S+r+b]+o[S+r+b+1],E<7)){i[S+b]=0,u[S+b]=0;continue}o&&E===7?(d=o[S-r+b-1]?l[S-r+b-1]:l[S+b],p=o[S-r+b]?l[S-r+b]:l[S+b],I=o[S-r+b+1]?l[S-r+b+1]:l[S+b],w=o[S+b-1]?l[S+b-1]:l[S+b],v=o[S+b+1]?l[S+b+1]:l[S+b],h=o[S+r+b-1]?l[S+r+b-1]:l[S+b],f=o[S+r+b]?l[S+r+b]:l[S+b],g=o[S+r+b+1]?l[S+r+b+1]:l[S+b]):(d=l[S-r+b-1],p=l[S-r+b],I=l[S-r+b+1],w=l[S+b-1],v=l[S+b+1],h=l[S+r+b-1],f=l[S+r+b],g=l[S+r+b+1]);const A=(I+v+v+g-(d+w+w+h))*s,P=(h+f+f+g-(d+p+p+I))*n;let C=-1;A===0&&P===0||(C=90-57.29578*Math.atan2(P,-A),C<0&&(C+=360),C===360?C=0:C>360&&(C%=360)),i[S+b]=C}}for(let y=0;y<c;y++)i[y*r]=i[y*r+1],i[(y+1)*r-1]=i[(y+1)*r-2];for(let y=1;y<r-1;y++)i[y]=i[y+r],i[y+(c-1)*r]=i[y+(c-2)*r];return new se({width:r,height:c,pixels:[i],mask:o?u:null,pixelType:"f32",validPixelCount:e.validPixelCount,statistics:[{minValue:0,maxValue:360}]})}const ze=1,Jr=[.299,.587,.114];function Vt(e,t=256){t=Math.min(t,256);const{size:r,counts:c}=e,o=new Uint8Array(r),l=c.reduce((n,m)=>n+m/t,0);let u=0,i=0,a=0,s=l;for(let n=0;n<r;n++)if(a+=c[n],!(n<r-1&&a+c[n+1]<s)){for(;u<t-1&&s<a;)u++,s+=l;for(let m=i;m<=n;m++)o[m]=u;i=n+1}for(let n=i;n<r;n++)o[n]=t-1;return o}function xt(e){const{minCutOff:t,maxCutOff:r,gamma:c,pixelType:o,rounding:l}=e,u=e.outMin||0,i=e.outMax||255;if(!["u8","u16","s8","s16"].includes(o))return null;const a=t.length;let s,n,m=0;o==="s8"?m=-127:o==="s16"&&(m=-32767);let d=256;["u16","s16"].includes(o)&&(d=65536);const p=[],I=[],w=i-u;for(s=0;s<a;s++)I[s]=r[s]-t[s],p[s]=I[s]===0?0:w/I[s];let v;const h=[];let f,g,T;if(c&&c.length>=a){const y=Bt(a,c);for(s=0;s<a;s++){for(T=[],n=0;n<d;n++)if(I[s]!==0)if(f=n+m,v=(f-t[s])/I[s],g=1,c[s]>1&&(g-=(1/w)**(v*y[s])),f<r[s]&&f>t[s]){const S=g*w*v**(1/c[s])+u;T[n]=l==="floor"?Math.floor(S):l==="round"?Math.round(S):S}else f>=r[s]?T[n]=i:T[n]=u;else T[n]=u;h[s]=T}}else for(s=0;s<a;s++){for(T=[],n=0;n<d;n++)if(f=n+m,f<=t[s])T[n]=u;else if(f>=r[s])T[n]=i;else{const y=(f-t[s])*p[s]+u;T[n]=l==="floor"?Math.floor(y):l==="round"?Math.round(y):y}h[s]=T}if(e.contrastOffset!=null){const y=Hr(e.contrastOffset,e.brightnessOffset);for(s=0;s<a;s++)for(T=h[s],n=0;n<d;n++)T[n]=y[T[n]]}return{lut:h,offset:m}}function Hr(e,t){const r=Math.min(Math.max(e,-100),100),c=Math.min(Math.max(t??0,-100),100),o=255,l=128;let u=0,i=0;const a=new Uint8Array(256);for(u=0;u<256;u++)r>0&&r<100?i=(200*u-100*o+2*o*c)/(2*(100-r))+l:r<=0&&r>-100?i=(200*u-100*o+2*o*c)*(100+r)/2e4+l:r===100?(i=200*u-100*o+(o+1)*(100-r)+2*o*c,i=i>0?o:0):r===-100&&(i=l),a[u]=i>o?o:i<0?0:i;return a}function qr(e,t,r){const c=[];for(let o=0;o<t.length;o++){let l=0,u=0,i=0;"min"in t[o]?{min:l,max:u,avg:i}=t[o]:[l,u,i]=t[o];let a=i??0;e!=="u8"&&(a=255*(a-l)/(u-l)),r&&(a*=Jr[o]),c.push(Yr(a))}return c}function Yr(e){if(e<=0||e>=255)return ze;let t=0;e!==150&&(t=e<=150?45*Math.cos(.01047*e):17*Math.sin(.021*e));const r=255,c=e+t,o=Math.log(e/r),l=Math.log(c/r);if(l===0)return ze;const u=o/l;return isNaN(u)?ze:Math.min(9.9,Math.max(.01,u))}function Xr(e){var E;if(Fe(e)||!((E=e.pixels)!=null&&E.length))return null;const{pixels:t,mask:r,pixelType:c}=e,o=e.width*e.height,l=t.length;let u,i,a,s,n;const m=[],d=[];let p,I,w,v,h,f,g,T,y,S;const b=256;for(s=0;s<l;s++){if(p=new Uint32Array(b),w=t[s],c==="u8")if(u=-.5,i=255.5,r)for(n=0;n<o;n++)r[n]&&p[w[n]]++;else for(n=0;n<o;n++)p[w[n]]++;else{let A=!1;e.statistics||(e.updateStatistics(),A=!0);const P=e.statistics;if(u=P[s].minValue,i=P[s].maxValue,a=(i-u)/b,a===0){!P||e.validPixelCount||A||e.updateStatistics();const C=(e.validPixelCount||e.width*e.height)/b;for(let O=0;O<b;O++)p[O]=Math.round(C*(O+1))-Math.round(C*O)}else{for(I=new Uint32Array(b+1),n=0;n<o;n++)r&&!r[n]||I[Math.floor((w[n]-u)/a)]++;for(n=0;n<b-1;n++)p[n]=I[n];p[b-1]=I[b-1]+I[b]}}for(m.push({min:u,max:i,size:b,counts:p}),v=0,h=0,T=0,n=0;n<b;n++)v+=p[n],h+=n*p[n];for(y=h/v,n=0;n<b;n++)T+=p[n]*(n-y)**2;S=Math.sqrt(T/(v-1)),a=(i-u)/b,f=(y+.5)*a+u,g=S*a,d.push({min:u,max:i,avg:f,stddev:g})}return{statistics:d,histograms:m}}function Mn(e){const t=[];for(let r=0;r<e.length;r++){const{min:c,max:o,size:l,counts:u}=e[r];let i=0,a=0;for(let I=0;I<l;I++)i+=u[I],a+=I*u[I];const s=a/i;let n=0;for(let I=0;I<l;I++)n+=u[I]*(I-s)**2;const m=(o-c)/l,d=(s+.5)*m+c,p=Math.sqrt(n/(i-1))*m;t.push({min:c,max:o,avg:d,stddev:p})}return t}function Me(e,t){var P;const{pixelBlock:r,bandIds:c,returnHistogramLut:o,rasterInfo:l}=t;let u=null,i=null,a=e.stretchType;if(typeof a=="number"&&(a=jt[a]),e.dra)if(a==="minMax"&&Z(r)&&r.statistics)u=r.statistics.map(C=>[C.minValue,C.maxValue,0,0]);else{const C=Xr(r);u=Z(C)?C.statistics:null,i=Z(C)?C.histograms:null}else u=((P=e.statistics)==null?void 0:P.length)>0?e.statistics:Se(l.statistics),i=e.histograms||Se(l.histograms);a!=="percentClip"&&a!=="histogramEqualization"||i!=null&&i.length||(a="minMax");const s=(u==null?void 0:u.length)||(i==null?void 0:i.length)||l.bandCount,n=[],m=[];let d,p,I,w,v,h,f,g,T;u&&!Array.isArray(u[0])&&(u=u.map(C=>[C.min,C.max,C.avg,C.stddev]));const[y,S]=$t(l.pixelType);if(!(u!=null&&u.length)){for(u=[],g=0;g<s;g++)u.push([y,S,1,1]);a==="standardDeviation"&&(a="minMax")}switch(a){case"none":for(g=0;g<s;g++)n[g]=y,m[g]=S;break;case"minMax":for(g=0;g<s;g++)n[g]=u[g][0],m[g]=u[g][1];break;case"standardDeviation":for(g=0;g<s;g++)n[g]=u[g][2]-e.numberOfStandardDeviations*u[g][3],m[g]=u[g][2]+e.numberOfStandardDeviations*u[g][3],n[g]<u[g][0]&&(n[g]=u[g][0]),m[g]>u[g][1]&&(m[g]=u[g][1]);break;case"histogramEqualization":for(Ue(i),g=0;g<s;g++)n[g]=i[g].min,m[g]=i[g].max;break;case"percentClip":for(Ue(i),g=0;g<i.length;g++){for(d=i[g],v=new Uint32Array(d.size),w=[...d.counts],w.length>=20&&(w[0]=w[1]=w[2]=w[w.length-1]=w[w.length-2]=0),I=0,p=(d.max-d.min)/d.size,f=d.min===-.5&&p===1?.5:0,T=0;T<d.size;T++)I+=w[T],v[T]=I;for(h=(e.minPercent||0)*I/100,n[g]=d.min+f,T=0;T<d.size;T++)if(v[T]>h){n[g]=d.min+p*(T+f);break}for(h=(1-(e.maxPercent||0)/100)*I,m[g]=d.max+f,T=d.size-2;T>=0;T--)if(v[T]<h){m[g]=d.min+p*(T+2-f);break}if(m[g]<n[g]){const C=n[g];n[g]=m[g],m[g]=C}}break;default:for(g=0;g<s;g++)n[g]=u[g][0],m[g]=u[g][1]}let b,E,A;return a==="histogramEqualization"?(Ue(i),E=i[0].size||256,b=0,o&&(A=i.map(C=>Vt(C)))):(E=e.max||255,b=e.min||0),Zr({minCutOff:n,maxCutOff:m,outMax:E,outMin:b,histogramLut:A},c)}function Zr(e,t){if(t==null||t.length===0)return e;const r=Math.max.apply(null,t),{minCutOff:c,maxCutOff:o,outMin:l,outMax:u,histogramLut:i}=e;return c.length===t.length||c.length<=r?e:{minCutOff:t.map(a=>c[a]),maxCutOff:t.map(a=>o[a]),histogramLut:i?t.map(a=>i[a]):null,outMin:l,outMax:u}}function Bt(e,t){const r=new Float32Array(e);for(let c=0;c<e;c++)t[c]>1?t[c]>2?r[c]=6.5+(t[c]-2)**2.5:r[c]=6.5+100*(2-t[c])**4:r[c]=1;return r}function We(e,t){var C;if(Fe(e)||!((C=e.pixels)!=null&&C.length))return e;const{mask:r,width:c,height:o,pixels:l}=e,{minCutOff:u,maxCutOff:i,gamma:a}=t,s=t.outMin||0,n=t.outMax||255,m=c*o,d=t.outputPixelType||"u8",p=e.pixels.map(()=>se.createEmptyBand(d,m)),I=p.length;let w,v,h,f,g;const T=n-s,y=[],S=[];for(w=0;w<I;w++)S[w]=i[w]-u[w],y[w]=S[w]===0?0:T/S[w];const b=d.startsWith("u")||d.startsWith("s"),E=a&&a.length>=I,A=!!t.isRenderer;if(E){const O=Bt(I,a);for(v=0;v<m;v++)if(r==null||r[v])for(w=0;w<I;w++)if(S[w]!==0)if(h=l[w][v],g=(h-u[w])/S[w],f=1,a[w]>1&&(f-=(1/T)**(g*O[w])),h<i[w]&&h>u[w]){const L=f*T*g**(1/a[w])+s;p[w][v]=A?Math.floor(L):b?Math.round(L):L}else h>=i[w]?p[w][v]=n:p[w][v]=s;else p[w][v]=s}else for(v=0;v<m;v++)if(r==null||r[v])for(w=0;w<I;w++)if(h=l[w][v],h<i[w]&&h>u[w]){const O=(h-u[w])*y[w]+s;p[w][v]=A?Math.floor(O):b?Math.round(O):O}else h>=i[w]?p[w][v]=n:p[w][v]=s;const P=new se({width:c,height:o,mask:r,pixels:p,pixelType:d});return P.updateStatistics(),P}function Qr(e,t){const{attributeTable:r,bandCount:c}=e;return!(Fe(r)||c>1||t&&r.fields.find(o=>o.name.toLowerCase()===t.toLowerCase())==null)}function en(e){const{bandCount:t,dataType:r,pixelType:c}=e;return r==="elevation"||r==="generic"&&t===1&&(c==="s16"||c==="f32"||c==="f64")}function tn(e){const{bandCount:t,colormap:r}=e;return Z(r)&&r.length>0&&t===1}let be=class extends rt{constructor(e){super(e)}bind(){const{rendererJSON:e}=this;if(!e)return{success:!1};let t;switch(this.lookup={rendererJSON:{}},e.type){case"uniqueValue":t=this._updateUVRenderer(e);break;case"rasterColormap":t=this._updateColormapRenderer(e);break;case"rasterStretch":t=this._updateStretchRenderer(e);break;case"classBreaks":t=this._updateClassBreaksRenderer(e);break;case"rasterShadedRelief":t=this._updateShadedReliefRenderer(e);break;case"vectorField":t=this._updateVectorFieldRenderer();break;case"flowRenderer":t=this._updateFlowRenderer()}return t}symbolize(e){let t=e&&e.pixelBlock;if(!At(t))return t;if(e.simpleStretchParams&&this.rendererJSON.type==="rasterStretch")return this.simpleStretch(t,e.simpleStretchParams);try{let r;switch(t.pixels.length>3&&(t=ut(t,[0,1,2])),this.rendererJSON.type){case"uniqueValue":case"rasterColormap":r=this._symbolizeColormap(t);break;case"classBreaks":r=this._symbolizeClassBreaks(t);break;case"rasterStretch":r=this._symbolizeStretch(t,e.bandIds);break;case"rasterShadedRelief":{const c=e.extent,o=c.spatialReference.isGeographic,l={x:(c.xmax-c.xmin)/t.width,y:(c.ymax-c.ymin)/t.height};r=this._symbolizeShadedRelief(t,{isGCS:o,resolution:l});break}}return r}catch(r){return Ke.getLogger(this.declaredClass).error("symbolize",r.message),t}}simpleStretch(e,t){if(!At(e))return e;try{return e.pixels.length>3&&(e=ut(e,[0,1,2])),We(e,{...t,isRenderer:!0})}catch(r){return Ke.getLogger(this.declaredClass).error("symbolize",r.message),e}}generateWebGLParameters(e){if(["uniqueValue","rasterColormap","classBreaks"].includes(this.rendererJSON.type)){const{indexedColormap:u,offset:i}=this.lookup.colormapLut||{};return{colormap:u,colormapOffset:i,type:"lut"}}const{pixelBlock:t,isGCS:r,resolution:c,bandIds:o}=e,{rendererJSON:l}=this;return l.type==="rasterStretch"?this._generateStretchWebGLParams(t,l,o):l.type==="rasterShadedRelief"?this._generateShadedReliefWebGLParams(l,r,c??void 0):l.type==="vectorField"?this._generateVectorFieldWebGLParams(l):null}_isLUTChanged(e){if(!this.lookup||!this.lookup.rendererJSON)return!0;if("colorRamp"in this.rendererJSON){const t=this.rendererJSON.colorRamp;return e?JSON.stringify(t)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):(this.rendererJSON,this.lookup.rendererJSON,JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolizeColormap(e){return this._isLUTChanged()&&!this.bind().success?e:Be(e,this.lookup.colormapLut)}_symbolizeClassBreaks(e){const{canUseIndexedLUT:t}=this._analyzeClassBreaks(this.rendererJSON);return this._isLUTChanged()&&!this.bind().success?e:t?Be(e,this.lookup.colormapLut):zt(e,this.lookup.remapLut??[])}_symbolizeStretch(e,t){var m,d,p;const{rasterInfo:r}=this,{pixelType:c,bandCount:o}=r,l=this.rendererJSON,u=["u8","u16","s8","s16"].includes(c);let i,a;const{dra:s}=l,{gamma:n}=this.lookup;if(l.stretchType==="histogramEqualization"){const I=s?null:(m=this.lookup)==null?void 0:m.histogramLut,w=Me(l,{rasterInfo:r,pixelBlock:e,bandIds:t,returnHistogramLut:!I}),v=We(e,{...w,gamma:n,isRenderer:!0});a=ht(v,{lut:s?w.histogramLut:I,offset:0})}else if(u){if(s){const I=Me(l,{rasterInfo:r,pixelBlock:e,bandIds:t});i=xt({pixelType:c,...I,gamma:n,rounding:"floor"})}else if(this._isLUTChanged()){if(!this.bind().success)return e;i=this.lookup?this.lookup.stretchLut:null}else i=this.lookup?this.lookup.stretchLut:null;if(!i)return e;o>1&&(t==null?void 0:t.length)===((d=Se(e))==null?void 0:d.pixels.length)&&(i==null?void 0:i.lut.length)===o&&(i={lut:t.map(I=>i.lut[I]),offset:i.offset}),a=ht(e,i)}else{const I=Me(l,{rasterInfo:r,pixelBlock:e,bandIds:t});a=We(e,{...I,gamma:n,isRenderer:!0})}if(l.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return e;a=Be(a,(p=this.lookup)==null?void 0:p.colormapLut)}return a}_symbolizeShadedRelief(e,t){var i;const r=this.rendererJSON,c={...r,...t},o=Wr(e,c);if(!r.colorRamp)return o;let l;if(this._isLUTChanged(!0)){if(!this.bind().success)return o;l=this.lookup?this.lookup.hsvMap:null}else l=this.lookup?this.lookup.hsvMap:null;if(!l)return o;const u=((i=Se(this.rasterInfo.statistics))==null?void 0:i[0])??{min:0,max:8e3};return Kr(o,e,l,u),o}_isVectorFieldData(){const{bandCount:e,dataType:t}=this.rasterInfo;return e===2&&(t==="vector-magdir"||t==="vector-uv")}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; VectorFieldRenderer only supports "vector-magdir" and "vector-uv".`}}_updateFlowRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; FlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(e){var s;const{bandCount:t,attributeTable:r,pixelType:c}=this.rasterInfo,o=e.field1;if(!o)return{success:!1,error:"Unsupported renderer; missing UniqueValueRenderer.field."};const l=e.defaultSymbol,u=t===1&&["u8","s8"].includes(c);if(!Qr(this.rasterInfo,o)&&!u)return{success:!1,error:"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table."};const i=[];if(Z(r)){const n=r.fields.find(m=>m.name.toLowerCase()==="value");if(!n)return{success:!1,error:"Unsupported data; the data's raster attribute table does not have a value field."};r.features.forEach(m=>{var I,w;const d=(I=e.uniqueValueInfos)==null?void 0:I.find(v=>String(v.value)===String(m.attributes[o])),p=(w=d==null?void 0:d.symbol)==null?void 0:w.color;p?i.push([m.attributes[n.name]].concat(p)):l&&i.push([m.attributes[n.name]].concat(l.color))})}else{if(o.toLowerCase()!=="value")return{success:!1,error:'Unsupported renderer; UniqueValueRenderer.field must be "Value" when raster attribute table is not availalbe.'};(s=e.uniqueValueInfos)==null||s.forEach(n=>{var d;const m=(d=n==null?void 0:n.symbol)==null?void 0:d.color;m?i.push([parseInt(""+n.value,10)].concat(m)):l&&i.push([parseInt(""+n.value,10)].concat(l==null?void 0:l.color))})}if(i.length===0)return{success:!1,error:"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table."};const a=Ce({colormap:i});return this.lookup={rendererJSON:e,colormapLut:a},this.canRenderInWebGL=!0,{success:!0}}_updateColormapRenderer(e){if(!tn(this.rasterInfo))return{success:!1,error:"Unsupported data; the data source does not have a colormap."};const t=e.colormapInfos.map(c=>[c.value].concat(c.color)).sort((c,o)=>c[0]-o[0]);if(!t||t.length===0)return{success:!1,error:"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos."};const r=Ce({colormap:t});return this.lookup={rendererJSON:e,colormapLut:r},this.canRenderInWebGL=!0,{success:!0}}_updateShadedReliefRenderer(e){if(!en(this.rasterInfo))return{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; ShadedReliefRenderer only supports "elevation", or single band float/s16 data.`};if(e.colorRamp){const t=ft(e.colorRamp,{interpolateAlpha:!0}),r=Ce({colormap:t}),c=[],o=r.indexedColormap;for(let l=0;l<o.length;l+=4){const u=Yt({r:o[l],g:o[l+1],b:o[l+2]});c.push([u.h/60,u.s/100,255*u.v/100])}this.lookup={rendererJSON:e,colormapLut:r,hsvMap:c}}else this.lookup=null;return this.canRenderInWebGL=!0,{success:!0}}_analyzeClassBreaks(e){const{attributeTable:t,pixelType:r}=this.rasterInfo,c=Z(t)?t.fields.find(u=>u.name.toLowerCase()==="value"):null,o=Z(t)?t.fields.find(u=>u.name.toLowerCase()===e.field.toLowerCase()):null,l=c!=null&&o!==null;return{canUseIndexedLUT:["u8","u16","s8","s16"].includes(r)||l,tableValueField:c,tableBreakField:o}}_updateClassBreaksRenderer(e){const{attributeTable:t}=this.rasterInfo,{canUseIndexedLUT:r,tableValueField:c,tableBreakField:o}=this._analyzeClassBreaks(e),l=e.classBreakInfos;if(!(l!=null&&l.length))return{success:!1,error:"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos."};const u=l.sort((m,d)=>m.classMaxValue-d.classMaxValue),i=u[u.length-1];let a=e.minValue;if(!r){const m=[];for(let d=0;d<u.length;d++)m.push({value:u[d].classMinValue??a,mappedColor:u[d].symbol.color}),a=u[d].classMaxValue;return m.push({value:i.classMaxValue,mappedColor:i.symbol.color}),this.lookup={rendererJSON:e,remapLut:m},this.canRenderInWebGL=!1,{success:!0}}const s=[];if(Z(t)&&c!=null&&o!==null&&c!==o){const m=c.name,d=o.name,p=u[u.length-1],{classMaxValue:I}=p;a=e.minValue;for(const w of t.features){const v=w.attributes[m],h=w.attributes[d],f=h===I?p:h<a?null:u.find(({classMaxValue:g})=>g>h);f&&s.push([v].concat(f.symbol.color))}}else{a=Math.floor(e.minValue);for(let m=0;m<u.length;m++){const d=u[m];for(let p=a;p<d.classMaxValue;p++)s.push([p].concat(d.symbol.color));a=Math.ceil(d.classMaxValue)}i.classMaxValue===a&&s.push([i.classMaxValue].concat(i.symbol.color))}const n=Ce({colormap:s,fillUnspecified:!1});return this.lookup={rendererJSON:e,colormapLut:n},this.canRenderInWebGL=!0,{success:!0}}_isHistogramRequired(e){return e==="percentClip"||e==="histogramEqualization"}_isValidRasterStatistics(e){return Z(e)&&e.length>0&&e[0].min!=null&&e[0].max!=null}_updateStretchRenderer(e){var n,m;let{stretchType:t,dra:r}=e;if(!(t==="none"||(n=e.statistics)!=null&&n.length||this._isValidRasterStatistics(this.rasterInfo.statistics)||r))return{success:!1,error:"Unsupported renderer; StretchRenderer.statistics is required when dynamic range adjustment is not used."};const c=Se(e.histograms||this.rasterInfo.histograms);!this._isHistogramRequired(e.stretchType)||c!=null&&c.length||r||(t="minMax");const{computeGamma:o,useGamma:l,colorRamp:u}=e;let{gamma:i}=e;if(l&&o&&!(i!=null&&i.length)){const d=(m=e.statistics)!=null&&m.length?e.statistics:Se(this.rasterInfo.statistics);i=qr(this.rasterInfo.pixelType,d)}const a=this.rasterInfo.pixelType,s=!r&&["u8","u16","s8","s16"].includes(a);if(t==="histogramEqualization"){const d=c.map(p=>Vt(p));this.lookup={rendererJSON:e,histogramLut:d}}else if(s){const d=Me(e,{rasterInfo:this.rasterInfo}),p=xt({pixelType:a,...d,gamma:l?i:null,rounding:"floor"});this.lookup={rendererJSON:e,stretchLut:p}}if(u){const d=ft(u,{interpolateAlpha:!0});this.lookup||(this.lookup={rendererJSON:e}),this.lookup.colormapLut=Ce({colormap:d}),this.lookup.rendererJSON=e}return this.lookup.gamma=l&&(i!=null&&i.length)?i:null,this.canRenderInWebGL=!0,{success:!0}}_generateStretchWebGLParams(e,t,r){let c=null,o=null;const l=this.lookup&&this.lookup.colormapLut;t.colorRamp&&l&&(c=l.indexedColormap,o=l.offset),t.stretchType==="histogramEqualization"&&(t={...t,stretchType:"minMax"});const{gamma:u}=this.lookup,i=!!(t.useGamma&&u&&u.some(g=>g!==1)),{minCutOff:a,maxCutOff:s,outMin:n,outMax:m}=Me(t,{rasterInfo:this.rasterInfo,pixelBlock:e,bandIds:r});let d=0;Z(e)&&(d=e.getPlaneCount(),d===2&&((e=e.clone()).statistics=[e.statistics[0]],e.pixels=[e.pixels[0]]));const{bandCount:p}=this.rasterInfo,I=Math.min(3,(r==null?void 0:r.length)||d||p,p),w=new Float32Array(I),v=c||i?1:255;let h;for(h=0;h<a.length;h++)w[h]=s[h]===a[h]?0:(m-n)/(s[h]-a[h])/v;const f=new Float32Array(I);if(i&&u)for(h=0;h<I;h++)u[h]>1?u[h]>2?f[h]=6.5+(u[h]-2)**2.5:f[h]=6.5+100*(2-u[h])**4:f[h]=1;return{bandCount:I,outMin:n/v,outMax:m/v,minCutOff:a,maxCutOff:s,factor:w,useGamma:i,gamma:i?u:[1,1,1],gammaCorrection:i?f:[1,1,1],colormap:c,colormapOffset:o,stretchType:t.stretchType,type:"stretch"}}_generateShadedReliefWebGLParams(e,t=!1,r={x:0,y:0}){var s;let c=null,o=null;const l=this.lookup&&this.lookup.colormapLut;e.colorRamp&&l&&(c=l.indexedColormap,o=l.offset);const u={...e,isGCS:t,resolution:r},i=Ft(u),a=(s=Se(this.rasterInfo.statistics))==null?void 0:s[0];return{...i,minValue:(a==null?void 0:a.min)??0,maxValue:(a==null?void 0:a.max)??8e3,hillshadeType:e.hillshadeType==="traditional"?0:1,type:"hillshade",colormap:c,colormapOffset:o}}_generateVectorFieldWebGLParams(e){var h,f,g;const{style:t,inputUnit:r,outputUnit:c,visualVariables:o,symbolTileSize:l,flowRepresentation:u}=e;let i;const a=((h=this.rasterInfo.statistics)==null?void 0:h[0].min)??0,s=((f=this.rasterInfo.statistics)==null?void 0:f[0].max)??50,n=(o==null?void 0:o.find(T=>T.type==="sizeInfo"))??{type:"sizeInfo",field:"Magnitude",maxDataValue:s,maxSize:.8*l,minDataValue:a,minSize:.2*l},m=n.minDataValue??a,d=n.maxDataValue??s,p=Z(n.maxSize)&&Z(n.minSize)?[n.minSize/l,n.maxSize/l]:[.2,.8];if(t==="wind_speed"){const T=(p[0]+p[1])/2;p[0]=p[1]=T}const I=Z(m)&&Z(d)?[m,d]:null;if(t==="classified_arrow")if(Z(m)&&Z(d)&&Z(n)){i=[];const T=(n.maxDataValue-n.minDataValue)/5;for(let y=0;y<6;y++)i.push(n.minDataValue+T*y)}else i=[0,1e-6,3.5,7,10.5,14];const w=u==="flow_to"==(t==="ocean_current_kn"||t==="ocean_current_m")?0:Math.PI,v=o==null?void 0:o.find(T=>T.type==="rotationInfo");return{breakValues:i,dataRange:I,inputUnit:r,outputUnit:c,symbolTileSize:l,symbolPercentRange:p,style:t||"single_arrow",rotation:w,rotationType:(g=this.rasterInfo.storageInfo)!=null&&g.tileInfo&&this.rasterInfo.dataType==="vector-uv"?"geographic":(v==null?void 0:v.rotationType)||e.rotationType,type:"vectorField"}}};function At(e){return Ee(e)&&e.validPixelCount!==0}$([W({json:{write:!0}})],be.prototype,"rendererJSON",void 0),$([W({type:zr,json:{write:!0}})],be.prototype,"rasterInfo",void 0),$([W({json:{write:!0}})],be.prototype,"lookup",void 0),$([W()],be.prototype,"canRenderInWebGL",void 0),be=$([tt("esri.renderers.support.RasterSymbolizer")],be);const Ln=be,Ie=Ke.getLogger("esri.views.2d.engine.flow.dataUtils"),rn=10;async function On(e,t,r,c){const o=performance.now(),l=nn(t,r),u=performance.now(),i=an(t,l,r.width,r.height),a=performance.now(),s=ln(i,!0),n=performance.now(),m=e==="Streamlines"?cn(s,rn):un(s),d=performance.now();return Xt("esri-2d-profiler")&&(Ie.info("I.1","_createFlowFieldFromData (ms)",Math.round(u-o)),Ie.info("I.2","_getStreamlines (ms)",Math.round(a-u)),Ie.info("I.3","createAnimatedLinesData (ms)",Math.round(n-a)),Ie.info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(d-n)),Ie.info("I.5","createFlowMesh (ms)",Math.round(d-o)),Ie.info("I.6","Mesh size (bytes)",m.vertexData.buffer.byteLength+m.indexData.buffer.byteLength)),await Promise.resolve(),Jt(c),m}function nn(e,t){const r=on(t.data,t.width,t.height,e.smoothing);return e.interpolate?(c,o)=>{const l=Math.floor(c),u=Math.floor(o);if(l<0||l>=t.width)return[0,0];if(u<0||u>=t.height)return[0,0];const i=c-l,a=o-u,s=l,n=u,m=l<t.width-1?l+1:l,d=u<t.height-1?u+1:u,p=r[2*(n*t.width+s)],I=r[2*(n*t.width+m)],w=r[2*(d*t.width+s)],v=r[2*(d*t.width+m)],h=r[2*(n*t.width+s)+1],f=r[2*(n*t.width+m)+1];return[(p*(1-a)+w*a)*(1-i)+(I*(1-a)+v*a)*i,(h*(1-a)+r[2*(d*t.width+s)+1]*a)*(1-i)+(f*(1-a)+r[2*(d*t.width+m)+1]*a)*i]}:(c,o)=>{const l=Math.round(c),u=Math.round(o);return l<0||l>=t.width||u<0||u>=t.height?[0,0]:[r[2*(u*t.width+l)+0],r[2*(u*t.width+l)+1]]}}function sn(e,t,r,c,o,l,u,i,a){const s=[];let n=r,m=c,d=0,[p,I]=t(n,m);p*=e.velocityScale,I*=e.velocityScale;const w=Math.sqrt(p*p+I*I);let v,h;s.push({x:n,y:m,t:d,speed:w});for(let f=0;f<e.verticesPerLine;f++){let[g,T]=t(n,m);g*=e.velocityScale,T*=e.velocityScale;const y=Math.sqrt(g*g+T*T);if(y<e.minSpeedThreshold)return s;const S=g/y,b=T/y;if(n+=S*e.segmentLength,m+=b*e.segmentLength,d+=e.segmentLength/y,Math.acos(S*v+b*h)>e.maxTurnAngle)return s;if(e.collisions){const E=Math.round(n*a),A=Math.round(m*a);if(E<0||E>u-1||A<0||A>i-1)return s;const P=l[A*u+E];if(P!==-1&&P!==o)return s;l[A*u+E]=o}s.push({x:n,y:m,t:d,speed:y}),v=S,h=b}return s}function an(e,t,r,c){const o=[],l=new Et,u=1/Math.max(e.lineCollisionWidth,1),i=Math.round(r*u),a=Math.round(c*u),s=new Int32Array(i*a);for(let m=0;m<s.length;m++)s[m]=-1;const n=[];for(let m=0;m<c;m+=e.lineSpacing)for(let d=0;d<r;d+=e.lineSpacing)n.push({x:d,y:m,sort:l.getFloat()});n.sort((m,d)=>m.sort-d.sort);for(const{x:m,y:d}of n)if(l.getFloat()<e.density){const p=sn(e,t,m,d,o.length,s,i,a,u);if(p.length<2)continue;o.push(p)}return o}function on(e,t,r,c){if(c===0)return e;const o=Math.round(3*c),l=new Array(2*o+1);let u=0;for(let s=-o;s<=o;s++){const n=Math.exp(-s*s/(c*c));l[s+o]=n,u+=n}for(let s=-o;s<=o;s++)l[s+o]/=u;const i=new Float32Array(e.length);for(let s=0;s<r;s++)for(let n=0;n<t;n++){let m=0,d=0;for(let p=-o;p<=o;p++){if(n+p<0||n+p>=t)continue;const I=l[p+o];m+=I*e[2*(s*t+(n+p))+0],d+=I*e[2*(s*t+(n+p))+1]}i[2*(s*t+n)+0]=m,i[2*(s*t+n)+1]=d}const a=new Float32Array(e.length);for(let s=0;s<t;s++)for(let n=0;n<r;n++){let m=0,d=0;for(let p=-o;p<=o;p++){if(n+p<0||n+p>=r)continue;const I=l[p+o];m+=I*i[2*((n+p)*t+s)+0],d+=I*i[2*((n+p)*t+s)+1]}a[2*(n*t+s)+0]=m,a[2*(n*t+s)+1]=d}return a}function ln(e,t){const r=new Et,c=e.reduce((a,s)=>a+s.length,0),o=new Float32Array(4*c),l=new Array(e.length);let u=0,i=0;for(const a of e){const s=u;for(const n of a)o[4*u+0]=n.x,o[4*u+1]=n.y,o[4*u+2]=n.t,o[4*u+3]=n.speed,u++;l[i++]={startVertex:s,numberOfVertices:a.length,totalTime:a[a.length-1].t,timeSeed:t?r.getFloat():0}}return{lineVertices:o,lineDescriptors:l}}function cn(e,t){const{lineVertices:c,lineDescriptors:o}=e;let l=0,u=0;for(const p of o)l+=2*p.numberOfVertices,u+=6*(p.numberOfVertices-1);const i=new Float32Array(l*9),a=new Uint32Array(u);let s=0,n=0;function m(){a[n++]=s-2,a[n++]=s,a[n++]=s-1,a[n++]=s,a[n++]=s+1,a[n++]=s-1}function d(p,I,w,v,h,f,g,T){const y=s*9;let S=0;i[y+S++]=p,i[y+S++]=I,i[y+S++]=1,i[y+S++]=w,i[y+S++]=f,i[y+S++]=g,i[y+S++]=v/2,i[y+S++]=h/2,i[y+S++]=T,s++,i[y+S++]=p,i[y+S++]=I,i[y+S++]=-1,i[y+S++]=w,i[y+S++]=f,i[y+S++]=g,i[y+S++]=-v/2,i[y+S++]=-h/2,i[y+S++]=T,s++}for(const p of o){const{totalTime:I,timeSeed:w}=p;let v=null,h=null,f=null,g=null,T=null,y=null;for(let S=0;S<p.numberOfVertices;S++){const b=c[4*(p.startVertex+S)+0],E=c[4*(p.startVertex+S)+1],A=c[4*(p.startVertex+S)+2],P=c[4*(p.startVertex+S)+3];let C=null,O=null,L=null,k=null;if(S>0){C=b-v,O=E-h;const x=Math.sqrt(C*C+O*O);if(C/=x,O/=x,S>1){let M=C+T,R=O+y;const G=Math.sqrt(M*M+R*R);M/=G,R/=G;const D=Math.min(1/(M*C+R*O),t);M*=D,R*=D,L=-R,k=M}else L=-O,k=C;L!==null&&k!==null&&(d(v,h,f,L,k,I,w,P),m())}v=b,h=E,f=A,T=C,y=O,g=P}d(v,h,f,-y,T,I,w,g)}return{vertexData:i,indexData:a}}function un(e){const{lineVertices:o,lineDescriptors:l}=e;let u=0,i=0;for(const x of l){const M=x.numberOfVertices-1;u+=4*M*2,i+=6*M*2}const a=new Float32Array(u*16),s=new Uint32Array(i);let n,m,d,p,I,w,v,h,f,g,T,y,S,b,E=0,A=0;function P(){s[A++]=E-8,s[A++]=E-7,s[A++]=E-6,s[A++]=E-7,s[A++]=E-5,s[A++]=E-6,s[A++]=E-4,s[A++]=E-3,s[A++]=E-2,s[A++]=E-3,s[A++]=E-1,s[A++]=E-2}function C(x,M,R,G,D,U,_,N,V,B,X,ne,fe,de){const H=E*16;let K=0;for(const le of[1,2])for(const ue of[1,2,3,4])a[H+K++]=x,a[H+K++]=M,a[H+K++]=R,a[H+K++]=G,a[H+K++]=_,a[H+K++]=N,a[H+K++]=V,a[H+K++]=B,a[H+K++]=le,a[H+K++]=ue,a[H+K++]=fe,a[H+K++]=de,a[H+K++]=D/2,a[H+K++]=U/2,a[H+K++]=X/2,a[H+K++]=ne/2,E++}function O(x,M){let R=f+T,G=g+y;const D=Math.sqrt(R*R+G*G);R/=D,G/=D;const U=f*R+g*G;R/=U,G/=U;let _=T+S,N=y+b;const V=Math.sqrt(_*_+N*N);_/=V,N/=V;const B=T*_+y*N;_/=B,N/=B,C(n,m,d,p,-G,R,I,w,v,h,-N,_,x,M),P()}function L(x,M,R,G,D,U){if(f=T,g=y,T=S,y=b,f==null&&g==null&&(f=T,g=y),I!=null&&w!=null){S=x-I,b=M-w;const _=Math.sqrt(S*S+b*b);S/=_,b/=_}f!=null&&g!=null&&O(D,U),n=I,m=w,d=v,p=h,I=x,w=M,v=R,h=G}function k(x,M){f=T,g=y,T=S,y=b,f==null&&g==null&&(f=T,g=y),f!=null&&g!=null&&O(x,M)}for(const x of l){n=null,m=null,d=null,p=null,I=null,w=null,v=null,h=null,f=null,g=null,T=null,y=null,S=null,b=null;const{totalTime:M,timeSeed:R}=x;for(let G=0;G<x.numberOfVertices;G++)L(o[4*(x.startVertex+G)+0],o[4*(x.startVertex+G)+1],o[4*(x.startVertex+G)+2],o[4*(x.startVertex+G)+3],M,R);k(M,R)}return{vertexData:a,indexData:s}}export{Er as B,lt as D,vr as L,Bt as M,Rt as N,ot as R,kn as S,Ln as T,Ut as U,Pn as a,xt as b,st as c,Ae as d,On as f,Mn as g,En as j,jr as n,Cn as o,Xr as p,ur as r,zr as u,Ar as v,Me as x,We as y};
