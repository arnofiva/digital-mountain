import{l as H,a as J}from"./mathUtils-5b623c84.js";import{r as K}from"./typedArrayUtil-70e1d79e.js";import{z as $,P as a,_ as x,n as s,o as E,s as L,g as M,u as y,A as B,e as g,a as Q,F as O}from"./vec3-015ca254.js";import{c as m,r as V,f as k}from"./sphere-092242fd.js";function an(n){const r=n[0]*n[0]+n[4]*n[4]+n[8]*n[8],c=n[1]*n[1]+n[5]*n[5]+n[9]*n[9],u=n[2]*n[2]+n[6]*n[6]+n[10]*n[10];return Math.sqrt(Math.max(r,c,u))}function sn(n,r){const c=Math.sqrt(r[0]*r[0]+r[4]*r[4]+r[8]*r[8]),u=Math.sqrt(r[1]*r[1]+r[5]*r[5]+r[9]*r[9]),o=Math.sqrt(r[2]*r[2]+r[6]*r[6]+r[10]*r[10]);return E(n,c,u,o),n}function In(n,r,c){c=c||n;const u=a(n,r);E(c,n[0]-u*r[0],n[1]-u*r[1],n[2]-u*r[2]),$(c,c)}function W(n,r,c){Math.abs(n[0])>Math.abs(n[1])?E(r,0,1,0):E(r,1,0,0),x(c,n,r),$(r,r),x(r,c,n),$(c,c)}function Mn(n,r){return(n%r+r)%r}function Nn(n,r,c,u,o,i){const t=n+(r-n)*o;return t+(c+(u-c)*o-t)*i}function hn(n,r,c,u=s()){const o=L(n),i=L(r),t=a(n,r)/(o*i);if(t<.9999999999999999){const f=Math.acos(t),e=((1-c)*o+c*i)/Math.sin(f),h=e/o*Math.sin((1-c)*f),I=e/i*Math.sin(c*f);return M(T,n,h),M(q,r,I),y(u,T,q)}return B(u,n,r,c)}function $n(n,r,c,u=s(),o=s()){const i=L(n),t=L(r),f=a(n,r)/(i*t);if(f<.9999999999999999){const e=Math.acos(f),h=Math.sin(e),I=Math.sin(c*e),b=Math.sin((1-c)*e),F=(1-c)*i+c*t;{const A=F/h,_=A/t*I;M(T,n,A/i*b),M(q,r,_),y(u,T,q)}{const A=1/i*(-Math.cos((1-c)*e)*e*F+b*(-i+t));M(T,n,A);const _=1/t*(Math.cos(c*e)*e*F+I*(-i+t));M(q,r,_),y(o,T,q),M(o,o,1/h)}return o}return B(u,n,r,c),g(o,r,n),$(o,o),o}function gn(n,r,c){n=$(T,n),r=$(q,r);const u=H(a(n,r));if(c){const o=x(Y,n,r);if(a(o,c)<0)return-u}return u}function An(n){const r=n.length;return c=>{if(c<=n[0][0])return n[0][1];if(c>=n[r-1][0])return n[r-1][1];let u=1;for(;c>n[u][0];)u++;const o=n[u-1][0],i=n[u][0],t=(i-c)/(i-o);return t*n[u-1][1]+(1-t)*n[u][1]}}function En(n,r,c,u){g(j,r,n),g(w,c,n),x(u,j,w),$(u,u),u[3]=-a(n,u)}const j=s(),w=s(),Y=s(),T=s(),q=s();function U(n=d){return[n[0],n[1],n[2],n[3]]}function mn(n=d[0],r=d[1],c=d[2],u=d[3]){return G(n,r,c,u,V.get())}function Z(n,r){return G(r[0],r[1],r[2],r[3],n)}function G(n,r,c,u,o=U()){return o[0]=n,o[1]=r,o[2]=c,o[3]=u,o}function Fn(n,r,c){return Q(c,n),c[3]=r,c}function D(n,r,c){const u=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],o=Math.abs(u-1)>1e-5&&u>1e-12?1/Math.sqrt(u):1;return c[0]=r[0]*o,c[1]=r[1]*o,c[2]=r[2]*o,c[3]=-(c[0]*n[0]+c[1]*n[1]+c[2]*n[2]),c}function R(n,r,c,u=U()){const o=c[0]-r[0],i=c[1]-r[1],t=c[2]-r[2],f=n[0]-r[0],e=n[1]-r[1],h=n[2]-r[2],I=i*h-t*e,b=t*f-o*h,F=o*e-i*f,A=I*I+b*b+F*F,_=Math.abs(A-1)>1e-5&&A>1e-12?1/Math.sqrt(A):1;return u[0]=I*_,u[1]=b*_,u[2]=F*_,u[3]=-(u[0]*n[0]+u[1]*n[1]+u[2]*n[2]),u}function S(n,r,c,u,o){const i=n.length/3;if(i<3)return!1;E(P,n[3*c],n[3*c+1],n[3*c+2]);let t=u,f=!1;for(;t<i-1&&!f;){const e=3*t;E(p,n[e],n[e+1],n[e+2]),t++,f=!O(P,p)}if(!f)return!1;for(t=Math.max(t,o),f=!1;t<i&&!f;){const e=3*t;E(l,n[e],n[e+1],n[e+2]),t++,g(X,P,p),$(X,X),g(C,p,l),$(C,C),f=!O(P,l)&&!O(p,l)&&Math.abs(a(X,C))<nn}return f?(R(P,p,l,r),!0):(c!==0||u!==1||o!==2)&&S(n,r,0,1,2)}const nn=.99619469809,P=s(),p=s(),l=s(),X=s(),C=s();function _n(n,r,c){return r!==n&&Z(n,r),n[3]=-a(n,c),n}function ln(n,r){return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=-n[3],r}function Tn(n,r,c,u){return x(l,r,n),D(c,l,u)}function qn(n,r,c,u){return v(n,r,g(m.get(),c,r),cn,u)}function bn(n,r,c){return!!K(r)&&v(n,r.origin,r.direction,un,c)}function pn(n,r,c){return v(n,r.origin,r.vector,N.NONE,c)}function Pn(n,r,c){return v(n,r.origin,r.vector,N.CLAMP,c)}function dn(n,r){return z(n,r)>=0}function xn(n,r){const c=a(n,r.ray.direction),u=-z(n,r.ray.origin);if(u<0&&c>=0)return!1;if(c>-1e-6&&c<1e-6)return u>0;if((u<0||c<0)&&!(u<0&&c<0))return!0;const o=u/c;return c>0?o<r.c1&&(r.c1=o):o>r.c0&&(r.c0=o),r.c0<=r.c1}function yn(n,r){const c=a(n,r.ray.direction),u=-z(n,r.ray.origin);if(c>-1e-6&&c<1e-6)return u>0;const o=u/c;return c>0?o<r.c1&&(r.c1=o):o>r.c0&&(r.c0=o),r.c0<=r.c1}function Xn(n,r,c){const u=M(m.get(),n,-n[3]),o=rn(n,g(m.get(),r,u),m.get());return y(c,o,u),c}function Cn(n,r,c,u){const o=n,i=m.get(),t=m.get();W(o,i,t);const f=g(m.get(),c,r),e=k(i,f),h=k(t,f),I=k(o,f);return E(u,e,h,I)}function rn(n,r,c){const u=M(m.get(),n,a(n,r));return g(c,r,u),c}function z(n,r){return a(n,r)+n[3]}function v(n,r,c,u,o){const i=a(n,c);if(i===0)return!1;let t=-(a(n,r)+n[3])/i;return u&N.CLAMP&&(t=J(t,0,1)),!(!(u&N.INFINITE_MIN)&&t<0||!(u&N.INFINITE_MAX)&&t>1)&&(y(o,r,M(o,c,t)),!0)}function Ln(n){return n}const d=[0,0,1,0];var N;(function(n){n[n.NONE=0]="NONE",n[n.CLAMP=1]="CLAMP",n[n.INFINITE_MIN=4]="INFINITE_MIN",n[n.INFINITE_MAX=8]="INFINITE_MAX"})(N||(N={}));const cn=N.INFINITE_MIN|N.INFINITE_MAX,un=N.INFINITE_MAX;export{Z as A,dn as B,mn as E,G as F,xn as G,yn as H,Xn as J,Cn as K,_n as L,Tn as O,ln as P,rn as Q,Fn as T,pn as U,z as V,Ln as Y,D as _,An as a,gn as b,sn as c,S as d,Mn as e,En as f,Nn as g,W as h,qn as i,R as j,hn as k,an as l,U as p,In as q,$n as v,Pn as w,bn as x};
