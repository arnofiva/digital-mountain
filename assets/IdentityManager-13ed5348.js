import{F as Xe,r as U,L as je,M as G,$ as Q,U as M,v as pe,e as qe,A as lt,t as xr,K as Cr,J as Or,E as Ur,n as Er}from"./request-fc61835a.js";import{n as rt,t as Pr,E as Rr,G as Nr,e as y,y as _,s as Lr,a as ne,l as Pt}from"./cast-8b575ab3.js";import{s as Rt,a as E,r as Ve}from"./Error-685fdf30.js";import{n as st}from"./Evented-d959ede6.js";import{x as Dr,b as ct,e as Fr,r as Ae,E as $r,D as ge,v as ae,p as jr}from"./promiseUtils-e37fe75d.js";import{p as qr,l as Nt,t as ve}from"./string-7a324480.js";import{l as he,f as Vr,h as Br}from"./reactiveUtils-042dd05a.js";import{t as ut}from"./ArrayPool-5813d861.js";import{a as dt}from"./typedArrayUtil-ce39e5f4.js";import{s as Mr}from"./intl-b84fb3c9.js";import{m as zr}from"./Promise-e757e514.js";import{n as Hr}from"./uuid-73213768.js";import{w as Gr,x as Wr,v as Xr}from"./dom-2ec1e33c.js";import{a as Jr}from"./assets-5052bbaa.js";import{s as Kr}from"./locale-30120714.js";import{u as Qr}from"./messages-8a541332.js";/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.7
 */function ht(){const{classList:e}=document.body,t=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>e.contains(Gr)||e.contains(Wr)&&t?"dark":"light",s=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),i=o=>{n!==o&&s(o),n=o};let n=r();s(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>i(o.matches?"dark":"light")),new MutationObserver(()=>i(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function Yr(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?ht():document.addEventListener("DOMContentLoaded",()=>ht(),{once:!0}))}const Zr=Yr;Zr();function es(e){return typeof e=="string"?document.getElementById(e):e??null}function Sn(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function An(e,t){const r=t.parentNode;r&&r.insertBefore(e,t)}function In(e,t){for(;;){const r=e.firstChild;if(!r)break;t.appendChild(r)}}/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var ts=function(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!=="[object Object]")return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},Y={exports:{}},C={},fe={exports:{}},te={};function Lt(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function rs(e,t,r){}function ss(e,t,r){}var is=/javascript\s*\:/img;function ns(e,t){return is.test(t)?"":t}te.whiteList=Lt();te.getDefaultWhiteList=Lt;te.onAttr=rs;te.onIgnoreAttr=ss;te.safeAttrValue=ns;var os={indexOf:function(e,t){var r,s;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,s=e.length;r<s;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var s,i;if(Array.prototype.forEach)return e.forEach(t,r);for(s=0,i=e.length;s<i;s++)t.call(r,e[s],s,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},le=os;function as(e,t){e=le.trimRight(e),e[e.length-1]!==";"&&(e+=";");var r=e.length,s=!1,i=0,n=0,o="";function l(){if(!s){var h=le.trim(e.slice(i,n)),u=h.indexOf(":");if(u!==-1){var d=le.trim(h.slice(0,u)),f=le.trim(h.slice(u+1));if(d){var v=t(i,o.length,d,f,h);v&&(o+=v+"; ")}}}i=n+1}for(;n<r;n++){var a=e[n];if(a==="/"&&e[n+1]==="*"){var c=e.indexOf("*/",n+2);if(c===-1)break;n=c+1,i=n+1,s=!1}else a==="("?s=!0:a===")"?s=!1:a===";"?s||l():a===`
`&&l()}return le.trim(o)}var ls=as,me=te,cs=ls;function ft(e){return e==null}function us(e){var t={};for(var r in e)t[r]=e[r];return t}function Dt(e){e=us(e||{}),e.whiteList=e.whiteList||me.whiteList,e.onAttr=e.onAttr||me.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||me.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||me.safeAttrValue,this.options=e}Dt.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,r=t.options,s=r.whiteList,i=r.onAttr,n=r.onIgnoreAttr,o=r.safeAttrValue,l=cs(e,function(a,c,h,u,d){var f=s[h],v=!1;if(f===!0?v=f:typeof f=="function"?v=f(u):f instanceof RegExp&&(v=f.test(u)),v!==!0&&(v=!1),u=o(h,u),!!u){var g={position:c,sourcePosition:a,source:d,isWhite:v};if(v){var w=i(h,u,g);return ft(w)?h+":"+u:w}else{var w=n(h,u,g);if(!ft(w))return w}}});return l};var ds=Dt;(function(e,t){var r=te,s=ds;function i(o,l){var a=new s(l);return a.process(o)}t=e.exports=i,t.FilterCSS=s;for(var n in r)t[n]=r[n]})(fe,fe.exports);var it={indexOf:function(e,t){var r,s;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,s=e.length;r<s;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var s,i;if(Array.prototype.forEach)return e.forEach(t,r);for(s=0,i=e.length;s<i;s++)t.call(r,e[s],s,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,r=t.exec(e);return r?r.index:-1}},hs=fe.exports.FilterCSS,fs=fe.exports.getDefaultWhiteList,Ce=it;function Ft(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var $t=new hs;function ps(e,t,r){}function gs(e,t,r){}function vs(e,t,r){}function ms(e,t,r){}function jt(e){return e.replace(_s,"&lt;").replace(bs,"&gt;")}function ys(e,t,r,s){if(r=Ht(r),t==="href"||t==="src"){if(r=Ce.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(t==="background"){if(ye.lastIndex=0,ye.test(r))return""}else if(t==="style"){if(pt.lastIndex=0,pt.test(r)||(gt.lastIndex=0,gt.test(r)&&(ye.lastIndex=0,ye.test(r))))return"";s!==!1&&(s=s||$t,r=s.process(r))}return r=Gt(r),r}var _s=/</g,bs=/>/g,ws=/"/g,Ss=/&quot;/g,As=/&#([a-zA-Z0-9]*);?/gim,Is=/&colon;?/gim,ks=/&newline;?/gim,ye=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,pt=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,gt=/u\s*r\s*l\s*\(.*/gi;function qt(e){return e.replace(ws,"&quot;")}function Vt(e){return e.replace(Ss,'"')}function Bt(e){return e.replace(As,function(r,s){return s[0]==="x"||s[0]==="X"?String.fromCharCode(parseInt(s.substr(1),16)):String.fromCharCode(parseInt(s,10))})}function Mt(e){return e.replace(Is,":").replace(ks," ")}function zt(e){for(var t="",r=0,s=e.length;r<s;r++)t+=e.charCodeAt(r)<32?" ":e.charAt(r);return Ce.trim(t)}function Ht(e){return e=Vt(e),e=Bt(e),e=Mt(e),e=zt(e),e}function Gt(e){return e=qt(e),e=jt(e),e}function Ts(){return""}function xs(e,t){typeof t!="function"&&(t=function(){});var r=!Array.isArray(e);function s(o){return r?!0:Ce.indexOf(e,o)!==-1}var i=[],n=!1;return{onIgnoreTag:function(o,l,a){if(s(o))if(a.isClosing){var c="[/removed]",h=a.position+c.length;return i.push([n!==!1?n:a.position,h]),n=!1,c}else return n||(n=a.position),"[removed]";else return t(o,l,a)},remove:function(o){var l="",a=0;return Ce.forEach(i,function(c){l+=o.slice(a,c[0]),a=c[1]}),l+=o.slice(a),l}}}function Cs(e){for(var t="",r=0;r<e.length;){var s=e.indexOf("<!--",r);if(s===-1){t+=e.slice(r);break}t+=e.slice(r,s);var i=e.indexOf("-->",s);if(i===-1)break;r=i+3}return t}function Os(e){var t=e.split("");return t=t.filter(function(r){var s=r.charCodeAt(0);return s===127?!1:s<=31?s===10||s===13:!0}),t.join("")}C.whiteList=Ft();C.getDefaultWhiteList=Ft;C.onTag=ps;C.onIgnoreTag=gs;C.onTagAttr=vs;C.onIgnoreTagAttr=ms;C.safeAttrValue=ys;C.escapeHtml=jt;C.escapeQuote=qt;C.unescapeQuote=Vt;C.escapeHtmlEntities=Bt;C.escapeDangerHtml5Entities=Mt;C.clearNonPrintableCharacter=zt;C.friendlyAttrValue=Ht;C.escapeAttrValue=Gt;C.onIgnoreTagStripAll=Ts;C.StripTagBody=xs;C.stripCommentTag=Cs;C.stripBlankChar=Os;C.cssFilter=$t;C.getDefaultCSSWhiteList=fs;var Ne={},X=it;function Us(e){var t=X.spaceIndex(e),r;return t===-1?r=e.slice(1,-1):r=e.slice(1,t+1),r=X.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function Es(e){return e.slice(0,2)==="</"}function Ps(e,t,r){var s="",i=0,n=!1,o=!1,l=0,a=e.length,c="",h="";e:for(l=0;l<a;l++){var u=e.charAt(l);if(n===!1){if(u==="<"){n=l;continue}}else if(o===!1){if(u==="<"){s+=r(e.slice(i,l)),n=l,i=l;continue}if(u===">"){s+=r(e.slice(i,n)),h=e.slice(n,l+1),c=Us(h),s+=t(n,s.length,c,h,Es(h)),i=l+1,n=!1;continue}if(u==='"'||u==="'")for(var d=1,f=e.charAt(l-d);f.trim()===""||f==="=";){if(f==="="){o=u;continue e}f=e.charAt(l-++d)}}else if(u===o){o=!1;continue}}return i<e.length&&(s+=r(e.substr(i))),s}var Rs=/[^a-zA-Z0-9\\_:.-]/gim;function Ns(e,t){var r=0,s=0,i=[],n=!1,o=e.length;function l(d,f){if(d=X.trim(d),d=d.replace(Rs,"").toLowerCase(),!(d.length<1)){var v=t(d,f||"");v&&i.push(v)}}for(var a=0;a<o;a++){var c=e.charAt(a),h,u;if(n===!1&&c==="="){n=e.slice(r,a),r=a+1,s=e.charAt(r)==='"'||e.charAt(r)==="'"?r:Ds(e,a+1);continue}if(n!==!1&&a===s){if(u=e.indexOf(c,a+1),u===-1)break;h=X.trim(e.slice(s+1,u)),l(n,h),n=!1,a=u,r=a+1;continue}if(/\s|\n|\t/.test(c))if(e=e.replace(/\s|\n|\t/g," "),n===!1)if(u=Ls(e,a),u===-1){h=X.trim(e.slice(r,a)),l(h),n=!1,r=a+1;continue}else{a=u-1;continue}else if(u=Fs(e,a-1),u===-1){h=X.trim(e.slice(r,a)),h=vt(h),l(n,h),n=!1,r=a+1;continue}else continue}return r<e.length&&(n===!1?l(e.slice(r)):l(n,vt(X.trim(e.slice(r))))),X.trim(i.join(" "))}function Ls(e,t){for(;t<e.length;t++){var r=e[t];if(r!==" ")return r==="="?t:-1}}function Ds(e,t){for(;t<e.length;t++){var r=e[t];if(r!==" ")return r==="'"||r==='"'?t:-1}}function Fs(e,t){for(;t>0;t--){var r=e[t];if(r!==" ")return r==="="?t:-1}}function $s(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function vt(e){return $s(e)?e.substr(1,e.length-2):e}Ne.parseTag=Ps;Ne.parseAttr=Ns;var js=fe.exports.FilterCSS,q=C,Wt=Ne,qs=Wt.parseTag,Vs=Wt.parseAttr,Ie=it;function _e(e){return e==null}function Bs(e){var t=Ie.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=Ie.trim(e.slice(t+1,-1));var r=e[e.length-1]==="/";return r&&(e=Ie.trim(e.slice(0,-1))),{html:e,closing:r}}function Ms(e){var t={};for(var r in e)t[r]=e[r];return t}function zs(e){var t={};for(var r in e)Array.isArray(e[r])?t[r.toLowerCase()]=e[r].map(function(s){return s.toLowerCase()}):t[r.toLowerCase()]=e[r];return t}function Xt(e){e=Ms(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=q.onIgnoreTagStripAll),e.whiteList||e.allowList?e.whiteList=zs(e.whiteList||e.allowList):e.whiteList=q.whiteList,e.onTag=e.onTag||q.onTag,e.onTagAttr=e.onTagAttr||q.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||q.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||q.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||q.safeAttrValue,e.escapeHtml=e.escapeHtml||q.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new js(e.css))}Xt.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,r=t.options,s=r.whiteList,i=r.onTag,n=r.onIgnoreTag,o=r.onTagAttr,l=r.onIgnoreTagAttr,a=r.safeAttrValue,c=r.escapeHtml,h=t.cssFilter;r.stripBlankChar&&(e=q.stripBlankChar(e)),r.allowCommentTag||(e=q.stripCommentTag(e));var u=!1;r.stripIgnoreTagBody&&(u=q.StripTagBody(r.stripIgnoreTagBody,n),n=u.onIgnoreTag);var d=qs(e,function(f,v,g,w,k){var D={sourcePosition:f,position:v,isClosing:k,isWhite:Object.prototype.hasOwnProperty.call(s,g)},j=i(g,w,D);if(!_e(j))return j;if(D.isWhite){if(D.isClosing)return"</"+g+">";var B=Bs(w),A=s[g],b=Vs(B.html,function(p,m){var S=Ie.indexOf(A,p)!==-1,I=o(g,p,m,S);return _e(I)?S?(m=a(g,p,m,h),m?p+'="'+m+'"':p):(I=l(g,p,m,S),_e(I)?void 0:I):I});return w="<"+g,b&&(w+=" "+b),B.closing&&(w+=" /"),w+=">",w}else return j=n(g,w,D),_e(j)?c(w):j},c);return u&&(d=u.remove(d)),d};var Hs=Xt;(function(e,t){var r=C,s=Ne,i=Hs;function n(l,a){var c=new i(a);return c.process(l)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=i,function(){for(var l in r)t[l]=r[l];for(var a in s)t[a]=s[a]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=e.exports)})(Y,Y.exports);var Gs=function(){function e(t,r){var s=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,l,a){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?s.sanitizeUrl(l):Y.exports.safeAttrValue(n,o,l,a)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var i;t&&!r?i=t:t&&r?(i=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?i.whiteList=s._extendObjectOfArrays([s.arcgisWhiteList,t.whiteList||{}]):i[n]=t[n]})):(i=Object.create(this.arcgisFilterOptions),i.whiteList=this.arcgisWhiteList),this.xssFilterOptions=i,this._xssFilter=new Y.exports.FilterXSS(i)}return e.prototype.sanitize=function(t,r){switch(r===void 0&&(r={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,r);default:return r.allowUndefined&&typeof t>"u"?void 0:null}},e.prototype.sanitizeUrl=function(t,r){var s=(r??{}).isProtocolRequired,i=s===void 0?!0:s,n=this._trim(t.substring(0,t.indexOf(":"))),o=t==="/",l=/^#/.test(t),a=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||l||a?Y.exports.escapeAttrValue(t):!n&&!i?Y.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,r,s,i){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,r,s,i):Y.exports.safeAttrValue(t,r,s,i)},e.prototype.validate=function(t,r){r===void 0&&(r={});var s=this.sanitize(t,r);return{isValid:t===s,sanitized:s}},e.prototype.encodeHTML=function(t){var r=this;return String(t).replace(/[&<>"'\/]/g,function(s){return r._entityMap[s]})},e.prototype.encodeAttrValue=function(t){var r=/^[a-zA-Z0-9]$/;return String(t).replace(/[\x00-\xFF]/g,function(s,i){return r.test(s)?s:"&#x".concat(Number(t.charCodeAt(i)).toString(16),";")})},e.prototype._extendObjectOfArrays=function(t){var r={};return t.forEach(function(s){Object.keys(s).forEach(function(i){Array.isArray(s[i])&&Array.isArray(r[i])?r[i]=r[i].concat(s[i]):r[i]=s[i]})}),r},e.prototype._iterateOverObject=function(t,r){var s=this;r===void 0&&(r={});try{var i=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(l,a){var c=s.validate(a,r);return c.isValid?l.concat([a]):(i=!0,l.concat([c.sanitized]))},[]);else if(ts(t)){var o=Object.keys(t);n=o.reduce(function(l,a){var c=t[a],h=s.validate(c,r);return h.isValid?l[a]=c:(i=!0,l[a]=h.sanitized),l},{})}else return r.allowUndefined&&typeof t>"u"?void 0:null;return i?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const Le=new Map;function Jt(){Le.clear()}function Ws(e){return Le.get(e)}function Xs(e,t){Le.set(e,t)}function Be(e){Le.delete(e)}var Z,ie,Js=function(e){if("WebkitTransition"in e.style)Z="webkitTransitionEnd",ie="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");Z="transitionend",ie="animationend"}},Kt=function(e){Z||Js(e)},Ks=function(e,t){return t===void 0&&(t=e+"-active"),function(r){Kt(r);var s=!1,i=function(n){s||(s=!0,r.removeEventListener(Z,i),r.removeEventListener(ie,i),r.classList.remove(e),r.classList.remove(t))};r.classList.add(e),r.addEventListener(Z,i),r.addEventListener(ie,i),requestAnimationFrame(function(){r.classList.add(t)})}},Qs=function(e,t){return t===void 0&&(t=e+"-active"),function(r,s){Kt(r);var i=!1,n=function(o){i||(i=!0,r.removeEventListener(Z,n),r.removeEventListener(ie,n),s())};r.classList.add(e),r.addEventListener(Z,n),r.addEventListener(ie,n),requestAnimationFrame(function(){r.classList.add(t)})}};const Ys=Rt.getLogger("esri.widgets.support.widgetUtils");function Zs(e){const t=ut.acquire();for(let s=0;s<arguments.length;s++){const i=arguments[s],n=typeof i;if(n==="string")t.push(i);else if(Array.isArray(i))t.push.apply(t,i);else if(n==="object")for(const o in i)i[o]&&t.push(o)}const r=t.join(" ");return ut.release(t),r}const kn=(()=>{const e=new Map,t=new ResizeObserver(r=>{var s;Jt();for(const i of r)(s=e.get(i.target))==null||s(i)});return(r,s,i)=>(e.has(r)&&Ys.error("Already observing element",r),e.set(r,s),t.observe(r,i),rt(()=>{t.unobserve(r),e.delete(r)}))})();function Tn(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function xn(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function mt(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function Cn(e,t){return(e==="enter"?Ks:Qs)(t)}const ei=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],ti=ei.reduce((e,t)=>(e[t]=[],e),{}),ri=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Qt=new Gs({whiteList:ti,onTagAttr:(e,t,r)=>{const s=`${t}="${r}"`;if(ri.includes(t))return s},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function On(e){return e==="Enter"||e===" "}const Yt="http://www.w3.org/",De=`${Yt}2000/svg`,Zt=`${Yt}1999/xlink`;let yt=[],nt=(e,t)=>{let r={};return Object.keys(e).forEach(s=>{r[s]=e[s]}),t&&Object.keys(t).forEach(s=>{r[s]=t[s]}),r},ot=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),er=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},si=(e,t,r)=>{if(t.vnodeSelector!==""){for(let s=r;s<e.length;s++)if(ot(e[s],t))return s}return-1},Me=(e,t,r,s)=>{let i=e[t];if(i.vnodeSelector==="")return;let n=i.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<e.length;o++)if(o!==t){let l=e[o];if(ot(l,i))throw new Error(`${r.vnodeSelector} had a ${i.vnodeSelector} child ${s==="added"?s:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},ii=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},Je=[],Ke=!1,tr=e=>{(e.children||[]).forEach(tr),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},_t=()=>{Ke=!1,Je.forEach(tr),Je.length=0},bt=e=>{Je.push(e),Ke||(Ke=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(_t,{timeout:16}):setTimeout(_t,16))},wt=e=>{let t=e.domNode;if(e.properties){let r=e.properties.exitAnimation;if(r)return t.style.pointerEvents="none",void r(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),bt(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),bt(e))},ni=(e,t,r)=>{if(!t)return;let s=r.eventHandlerInterceptor,i=Object.keys(t),n=i.length;for(let o=0;o<n;o++){let l=i[o],a=t[l];if(l==="className")throw new Error('Property "className" is not supported, use "class".');if(l==="class")Qe(e,a,!0);else if(l==="classes"){let c=Object.keys(a),h=c.length;for(let u=0;u<h;u++){let d=c[u];a[d]&&e.classList.add(d)}}else if(l==="styles"){let c=Object.keys(a),h=c.length;for(let u=0;u<h;u++){let d=c[u],f=a[d];f&&(er(f),r.styleApplyer(e,d,f))}}else if(l!=="key"&&a!=null){let c=typeof a;c==="function"?(l.lastIndexOf("on",0)===0&&(s&&(a=s(l,a,e,t)),l==="oninput"&&function(){let h=a;a=function(u){h.apply(this,[u]),u.target["oninput-value"]=u.target.value}}()),e[l]=a):r.namespace===De?l==="href"?e.setAttributeNS(Zt,l,a):e.setAttribute(l,a):c==="string"&&l!=="value"?l==="innerHTML"?e[l]=Qt.sanitize(a):rr(e)&&l in e?e[l]=a:e.setAttribute(l,a):e[l]=a}}};function rr(e){if(!(e instanceof Element&&e.tagName.includes("-")))return!1;const t=window.customElements.get(e.tagName.toLowerCase());return!!t&&e instanceof t}let Oe,oi=(e,t,r)=>{if(t)for(let s of t)se(s,e,void 0,r)},sr=(e,t,r)=>{oi(e,t.children,r),t.text&&(e.textContent=t.text),ni(e,t.properties,r),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,r,t.vnodeSelector,t.properties,t.children])},se=(e,t,r,s)=>{let i,n=0,o=e.vnodeSelector,l=t.ownerDocument;if(o==="")i=e.domNode=l.createTextNode(e.text),r!==void 0?t.insertBefore(i,r):t.appendChild(i);else{for(let a=0;a<=o.length;++a){let c=o.charAt(a);if(a===o.length||c==="."||c==="#"){let h=o.charAt(n-1),u=o.slice(n,a);h==="."?i.classList.add(u):h==="#"?i.id=u:(u==="svg"&&(s=nt(s,{namespace:De})),s.namespace!==void 0?i=e.domNode=l.createElementNS(s.namespace,u):(i=e.domNode=e.domNode||l.createElement(u),u==="input"&&e.properties&&e.properties.type!==void 0&&i.setAttribute("type",e.properties.type)),r!==void 0?t.insertBefore(i,r):i.parentNode!==t&&t.appendChild(i)),n=a+1}}sr(i,e,s)}},Qe=(e,t,r)=>{t&&t.split(" ").forEach(s=>{s&&e.classList.toggle(s,r)})},ai=(e,t,r,s)=>{if(!r)return;let i=!1,n=Object.keys(r),o=n.length;for(let l=0;l<o;l++){let a=n[l],c=r[a],h=t[a];if(a==="class")h!==c&&(Qe(e,h,!1),Qe(e,c,!0));else if(a==="classes"){let u=e.classList,d=Object.keys(c),f=d.length;for(let v=0;v<f;v++){let g=d[v],w=!!c[g];w!==!!h[g]&&(i=!0,w?u.add(g):u.remove(g))}}else if(a==="styles"){let u=Object.keys(c),d=u.length;for(let f=0;f<d;f++){let v=u[f],g=c[v];g!==h[v]&&(i=!0,g?(er(g),s.styleApplyer(e,v,g)):s.styleApplyer(e,v,""))}}else if(c||typeof h!="string"||(c=""),a==="value"){let u=e[a];u!==c&&(e["oninput-value"]?u===e["oninput-value"]:c!==h)&&(e[a]=c,e["oninput-value"]=void 0),c!==h&&(i=!0)}else if(c!==h){let u=typeof c;u==="function"&&s.eventHandlerInterceptor||(s.namespace===De?a==="href"?e.setAttributeNS(Zt,a,c):e.setAttribute(a,c):u==="string"?a==="innerHTML"?e[a]=Qt.sanitize(c):a==="role"&&c===""?e.removeAttribute(a):rr(e)&&a in e?e[a]=c:e.setAttribute(a,c):e[a]!==c&&(e[a]=c),i=!0)}}return i},li=(e,t,r,s,i)=>{if(r===s)return!1;s=s||yt;let n,o=(r=r||yt).length,l=s.length,a=0,c=0,h=!1;for(;c<l;){let u=a<o?r[a]:void 0,d=s[c];if(u!==void 0&&ot(u,d))h=Oe(u,d,i)||h,a++;else{let f=si(r,d,a+1);if(f>=0){for(n=a;n<f;n++)wt(r[n]),Me(r,n,e,"removed");h=Oe(r[f],d,i)||h,a=f+1}else se(d,t,a<o?r[a].domNode:void 0,i),ii(d),Me(s,c,e,"added")}c++}if(o>a)for(n=a;n<o;n++)wt(r[n]),Me(r,n,e,"removed");return h};Oe=(e,t,r)=>{let s=e.domNode,i=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let o=s.ownerDocument.createTextNode(t.text);return s.parentNode.replaceChild(o,s),t.domNode=o,i=!0,i}t.domNode=s}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(r=nt(r,{namespace:De})),e.text!==t.text&&(n=!0,t.text===void 0?s.removeChild(s.firstChild):s.textContent=t.text),t.domNode=s,n=li(t,s,e.children,t.children,r)||n,n=ai(s,e.properties,t.properties,r)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[s,r,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(s,t.properties,e.properties),i};let ce=(e,t)=>({getLastRender:()=>e,update:r=>{if(e.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let s=e;e=r,Oe(s,r,t)},domNode:e.domNode});const ci={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{t.charAt(0)==="-"?e.style.setProperty(t,r):e.style[t]=r}};let re=e=>nt(ci,e),J={create:(e,t)=>(t=re(t),se(e,document.createElement("div"),void 0,t),ce(e,t)),append:(e,t,r)=>(r=re(r),se(t,e,void 0,r),ce(t,r)),insertBefore:(e,t,r)=>(r=re(r),se(t,e.parentNode,e,r),ce(t,r)),merge:(e,t,r)=>(r=re(r),t.domNode=e,sr(e,t,r),ce(t,r)),replace:(e,t,r)=>(r=re(r),se(t,e.parentNode,e,r),e.parentNode.removeChild(e),ce(t,r))},ir,ui=(e,t)=>{let r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r};ir=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let di=(e,t)=>{let r=e;return t.forEach(s=>{r=r&&r.children?ir(r.children,i=>i.domNode===s):void 0}),r},hi=(e,t,r)=>{let s=function(i){r("domEvent",i);let n=t(),o=ui(i.currentTarget,n.domNode);o.reverse();let l,a=di(n.getLastRender(),o);return e.scheduleRender(),a&&(l=a.properties[`on${i.type}`].apply(a.properties.bind||this,arguments)),r("domEventProcessed",i),l};return(i,n,o,l)=>s},Un=e=>{let t,r,s=re(e),i=s.performanceLogger,n=!0,o=!1,l=[],a=[],c=(u,d,f)=>{let v,g=()=>v;s.eventHandlerInterceptor=hi(t,g,i),v=u(d,f(),s),l.push(v),a.push(f)},h=()=>{if(r=void 0,n){n=!1,i("renderStart",void 0);for(let u=0;u<l.length;u++){let d=a[u]();i("rendered",void 0),l[u].update(d),i("patched",void 0)}i("renderDone",void 0),n=!0}};return t={renderNow:h,scheduleRender:()=>{r||o||(r=requestAnimationFrame(h))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,n=!0,t.scheduleRender()},append:(u,d)=>{c(J.append,u,d)},insertBefore:(u,d)=>{c(J.insertBefore,u,d)},merge:(u,d)=>{c(J.merge,u,d)},replace:(u,d)=>{c(J.replace,u,d)},detach:u=>{for(let d=0;d<a.length;d++)if(a[d]===u)return a.splice(d,1),l.splice(d,1)[0];throw new Error("renderFunction was not found")}},t};const fi={handleInterceptedEvent:(e,t,r,s)=>(e.scheduleRender(),t.properties[`on${s.type}`].apply(t.properties.bind||r,[s]))},pi={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{e.style[t]=r}},gi=e=>({...pi,...e}),vi=(e,t)=>{const r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r},mi=(e,t)=>e.find(t),St=(e,t,r=!1)=>{let s=e;return t.forEach((i,n)=>{const o=s!=null&&s.children?mi(s.children,l=>l.domNode===i):void 0;r&&!o&&n!==t.length-1||(s=o)}),s},yi=e=>{let t;const r={...fi,...e},s=gi(r),i=s.performanceLogger;let n,o=!0,l=!1;const a=[],c=[],h=(d,f,v)=>{var k;let g;s.eventHandlerInterceptor=(D,j,B,A)=>function(b){let p;i("domEvent",b);const m=vi(b.currentTarget,g.domNode),S=m.some(T=>{var O;return customElements.get((O=T==null?void 0:T.tagName)==null?void 0:O.toLowerCase())});if(b.eventPhase===Event.CAPTURING_PHASE||!S)m.reverse(),p=St(g.getLastRender(),m);else{const T=b.composedPath(),O=T.slice(T.indexOf(b.currentTarget),T.indexOf(g.domNode)).filter(L=>L.getRootNode()===L.ownerDocument).reverse();p=St(g.getLastRender(),O,!0)}let I;return p&&(I=r.handleInterceptedEvent(t,p,this,b)),i("domEventProcessed",b),I},(k=r.postProcessProjectionOptions)==null||k.call(r,s);const w=v();g=d(f,w,s),a.push(g),c.push(v),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(g,w)};let u=()=>{if(n=void 0,o){o=!1,i("renderStart",void 0);for(let d=0;d<a.length;d++){const f=c[d]();i("rendered",void 0),a[d].update(f),i("patched",void 0)}i("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(u=r.modifyDoRenderImplementation(u,a,c)),t={renderNow:u,scheduleRender:()=>{n||l||(n=requestAnimationFrame(u))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),l=!0},resume:()=>{l=!1,o=!0,t.scheduleRender()},append:(d,f)=>{h(J.append,d,f)},insertBefore:(d,f)=>{h(J.insertBefore,d,f)},merge:(d,f)=>{h(J.merge,d,f)},replace:(d,f)=>{h(J.replace,d,f)},detach:d=>{for(let f=0;f<c.length;f++)if(c[f]===d)return c.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},t};let nr;function _i(){Xr(Xe(Jr(nr)))}nr="components/assets";const or=Symbol("widget"),bi=Symbol("widget-test-data"),wi=[],Si={},Ue=new WeakMap;function ar(e,t){let r=t.children;if(r&&r.length)for(let i=0;i<r.length;++i)r[i]=ar(e,r[i]);else r=wi;const s=t.vnodeSelector;if(at(s)){const i=t.properties||Si,n=i.key||s;return{vnodeSelector:"div",properties:{key:n,afterCreate:Ai,afterUpdate:Ii,afterRemoved:lr,parentWidget:e,widgetConstructor:s,widgetProperties:{...i,key:n,children:r}},children:void 0,text:void 0,domNode:null}}return t}function Ai(e,t,r,{parentWidget:s,widgetConstructor:i,widgetProperties:n}){var l;const o=new i(n);o.container=e,Ue.set(e,o),(l=o.afterCreate)==null||l.call(o,o,e),s._internalHandles.add(rt(()=>lr(e)))}function Ii(e,t,r,{widgetProperties:s}){var n;const i=Ue.get(e);i&&(i.set(s),(n=i.afterUpdate)==null||n.call(i,i,e))}function lr(e){var r;const t=Ue.get(e);t&&((r=t.afterRemoved)==null||r.call(t,t,e),t.destroy(),Ue.delete(e))}function at(e){return typeof e=="function"&&e[or]}const At=new Set;function ki(e){At.add(e),e.finally(()=>At.delete(e))}var cr;const Ti="esri.widgets.Widget";let xi=0;const Ci={widgetIcon:"esri-icon-checkbox-unchecked"};function ur(e,t){for(const r in t)e[r]!=null&&(typeof e[r]=="object"&&typeof t[r]=="object"?ur(e[r],t==null?void 0:t[r]):e[r]=t[r]);return e}const Oi=yi({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,r=/capture$/i;e.eventHandlerInterceptor=(s,i,n,o)=>{const l=t==null?void 0:t(s,i,n,o),a=r.test(s);if(!((s=s.replace(r,"")).toLowerCase()in n)||a){const c=s[2].toLowerCase()+s.slice(3),h=f=>l==null?void 0:l.call(n,f);n.addEventListener(c,h,a);const u=()=>n.removeEventListener(c,h,a),d=o.afterRemoved;o.afterRemoved=f=>{d==null||d(f),u()}}return l}},handleInterceptedEvent(e,t,r,s){const{eventPhase:i,type:n}=s,o=i===Event.CAPTURING_PHASE;let l=`on${n}${o?"capture":""}`;const a=t.properties;(a&&l in a||(l=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,a&&l in a))&&(Jt(),e.scheduleRender(),a[l].call(a.bind||r,s))}});let ze=!1,R=class extends zr(st.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new Pr,this._projector=Oi,this._readyForTrueRender=!1,this.iconClass=Ci.widgetIcon,this.key=this,this._loadLocale=Dr(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const n=await $r(this._messageBundleProps.map(async({bundlePath:o,propertyName:l})=>{let a=await Qr(o);this.uiStrings&&Object.keys(this.uiStrings)&&(a=ur(qr(a),this.uiStrings)),this[l]=a}));for(const o of n)o.error&&Rt.getLogger(this.declaredClass).error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),_i();const r="esri-widget-uid-"+Hr(),s=this.render.bind(this);this._trackingTarget=new Rr(()=>this.scheduleRender());const i=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:r,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0};const n=s();let{properties:o}=n;o||(n.properties=o={});let{key:l,styles:a}=o;l||(o.key=r),a||(o.styles=a={}),a.display||(a.display="");let c=0;return(h=n.children)==null||h.forEach(u=>{if(at(u.vnodeSelector))return;let{properties:d}=u;d||(u.properties=d={}),d.key||(d.key=`${this.id}--${c++}`)}),ar(this,n)};this.render=()=>{if(ze)return i();let n=Ws(this)??null;if(n)return n;this._trackingTarget.clear(),ze=!0;try{n=Nr(this._trackingTarget,i)}catch(o){throw console.error(o),o}finally{ze=!1}return n&&Xs(this,n),n},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),ki(this._resourcesFetch)}normalizeCtorArgs(e,t){const r={...e};return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(ct)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(dt(this._trackingTarget),dt(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,Be(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return es(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+xi++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(cr=or,bi)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(Be(this),this._projector.scheduleRender())}classes(...e){return Zs.apply(this,e)}renderNow(){Be(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),(t=this._delegatedEventNames)!=null&&t.length&&this._internalHandles.add(he(()=>this.viewModel,(r,s)=>{s&&this._internalHandles.remove("delegated-events"),r&&Fr(r)&&this._internalHandles.add(this._delegatedEventNames.map(i=>Ae(r,i,n=>{this.emit(i,n)})),"delegated-events")},Br)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(ct),this.scheduleRender()};this._internalHandles.add([Kr(e),he(()=>this.uiStrings,e),Vr(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var t;this._attached&&(this._projector.detach(this.render),this._attached=!1),(t=e==null?void 0:e.parentNode)==null||t.removeChild(e)}};R[cr]=!0,y([_()],R.prototype,"_readyForTrueRender",void 0),y([_({value:null})],R.prototype,"container",null),y([Lr("container")],R.prototype,"castContainer",null),y([_()],R.prototype,"iconClass",void 0),y([_()],R.prototype,"id",null),y([_()],R.prototype,"label",null),y([_()],R.prototype,"renderable",null),y([_()],R.prototype,"uiStrings",void 0),y([_()],R.prototype,"viewModel",void 0),y([_({value:!0})],R.prototype,"visible",null),y([_()],R.prototype,"key",void 0),y([_()],R.prototype,"children",void 0),y([_()],R.prototype,"afterCreate",void 0),y([_()],R.prototype,"afterUpdate",void 0),y([_()],R.prototype,"afterRemoved",void 0),R=y([ne(Ti)],R);const dr=R;function hr(e){return(t,r)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:r})}}var Ui=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},fr=function(e,t){for(var r=0,s=e.length;r<s;r++){var i=e[r];Array.isArray(i)?fr(i,t):i!=null&&i!==!1&&(i.hasOwnProperty("vnodeSelector")||(i=Ui(i)),t.push(i))}},Ei=function(e,t){for(var r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:r[0],domNode:null};var i=[];return fr(r,i),{vnodeSelector:e,properties:t||void 0,children:i,text:void 0,domNode:null}};function P(e,t,...r){return typeof e!="function"||at(e)?Ei(e,t,...r):e(t,...r)}const be="esri-identity-form",F={base:be,group:`${be}__group`,label:`${be}__label`,footer:`${be}__footer`,esriInput:"esri-input",esriButton:"esri-button",esriButtonSecondary:"esri-button--secondary"},Pi="ArcGIS Online";let z=class extends dr{constructor(t,r){super(t,r),this._usernameInputNode=null,this._passwordInputNode=null,this.signingIn=!1,this.server=null,this.resource=null,this.error=null,this.oAuthPrompt=!1}render(){const{error:t,server:r,resource:s,signingIn:i,oAuthPrompt:n,messages:o}=this,l=P("div",{class:F.group},Mr(n?o.oAuthInfo:o.info,{server:r&&/\.arcgis\.com/i.test(r)?Pi:r,resource:`(${s||o.lblItem})`})),a=n?null:P("div",{class:F.group,key:"username"},P("label",{class:F.label},o.lblUser,P("input",{value:"",required:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:mt,"data-node-ref":"_usernameInputNode",class:F.esriInput}))),c=n?null:P("div",{class:F.group,key:"password"},P("label",{class:F.label},o.lblPwd,P("input",{value:"",required:!0,type:"password",bind:this,afterCreate:mt,"data-node-ref":"_passwordInputNode",class:F.esriInput}))),h=P("div",{class:this.classes(F.group,F.footer)},P("input",{type:"submit",disabled:!!i,value:i?o.lblSigning:o.lblOk,class:F.esriButton}),P("input",{type:"button",value:o.lblCancel,bind:this,onclick:this._cancel,class:this.classes(F.esriButton,F.esriButtonSecondary)})),u=t?P("div",null,t.details&&t.details.httpStatus?o.invalidUser:o.noAuthService):null;return P("form",{class:F.base,bind:this,onsubmit:this._submit},l,u,a,c,h)}_cancel(){this._set("signingIn",!1),this._usernameInputNode&&(this._usernameInputNode.value=""),this._passwordInputNode&&(this._passwordInputNode.value=""),this.emit("cancel")}_submit(t){t.preventDefault(),this._set("signingIn",!0);const r=this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value};this.emit("submit",r)}};y([_(),hr("esri/identity/t9n/identity")],z.prototype,"messages",void 0),y([_()],z.prototype,"signingIn",void 0),y([_()],z.prototype,"server",void 0),y([_()],z.prototype,"resource",void 0),y([_()],z.prototype,"error",void 0),y([_()],z.prototype,"oAuthPrompt",void 0),z=y([ne("esri.identity.IdentityForm")],z);const Ri=z;function Ni(e){return e&&typeof e.render=="function"}function Pn(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}/*!
* tabbable 6.0.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var pr=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],Ee=pr.join(","),gr=typeof Element>"u",ee=gr?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Pe=!gr&&Element.prototype.getRootNode?function(e){return e.getRootNode()}:function(e){return e.ownerDocument},vr=function(t,r,s){var i=Array.prototype.slice.apply(t.querySelectorAll(Ee));return r&&ee.call(t,Ee)&&i.unshift(t),i=i.filter(s),i},mr=function e(t,r,s){for(var i=[],n=Array.from(t);n.length;){var o=n.shift();if(o.tagName==="SLOT"){var l=o.assignedElements(),a=l.length?l:o.children,c=e(a,!0,s);s.flatten?i.push.apply(i,c):i.push({scopeParent:o,candidates:c})}else{var h=ee.call(o,Ee);h&&s.filter(o)&&(r||!t.includes(o))&&i.push(o);var u=o.shadowRoot||typeof s.getShadowRoot=="function"&&s.getShadowRoot(o),d=!s.shadowRootFilter||s.shadowRootFilter(o);if(u&&d){var f=e(u===!0?o.children:u.children,!0,s);s.flatten?i.push.apply(i,f):i.push({scopeParent:o,candidates:f})}else n.unshift.apply(n,o.children)}}return i},yr=function(t,r){return t.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(t.tagName)||t.isContentEditable)&&isNaN(parseInt(t.getAttribute("tabindex"),10))?0:t.tabIndex},Li=function(t,r){return t.tabIndex===r.tabIndex?t.documentOrder-r.documentOrder:t.tabIndex-r.tabIndex},_r=function(t){return t.tagName==="INPUT"},Di=function(t){return _r(t)&&t.type==="hidden"},Fi=function(t){var r=t.tagName==="DETAILS"&&Array.prototype.slice.apply(t.children).some(function(s){return s.tagName==="SUMMARY"});return r},$i=function(t,r){for(var s=0;s<t.length;s++)if(t[s].checked&&t[s].form===r)return t[s]},ji=function(t){if(!t.name)return!0;var r=t.form||Pe(t),s=function(l){return r.querySelectorAll('input[type="radio"][name="'+l+'"]')},i;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")i=s(window.CSS.escape(t.name));else try{i=s(t.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=$i(i,t.form);return!n||n===t},qi=function(t){return _r(t)&&t.type==="radio"},Vi=function(t){return qi(t)&&!ji(t)},Bi=function(t){for(var r,s=Pe(t).host,i=!!((r=s)!==null&&r!==void 0&&r.ownerDocument.contains(s)||t.ownerDocument.contains(t));!i&&s;){var n;s=Pe(s).host,i=!!((n=s)!==null&&n!==void 0&&n.ownerDocument.contains(s))}return i},It=function(t){var r=t.getBoundingClientRect(),s=r.width,i=r.height;return s===0&&i===0},Mi=function(t,r){var s=r.displayCheck,i=r.getShadowRoot;if(getComputedStyle(t).visibility==="hidden")return!0;var n=ee.call(t,"details>summary:first-of-type"),o=n?t.parentElement:t;if(ee.call(o,"details:not([open]) *"))return!0;if(!s||s==="full"||s==="legacy-full"){if(typeof i=="function"){for(var l=t;t;){var a=t.parentElement,c=Pe(t);if(a&&!a.shadowRoot&&i(a)===!0)return It(t);t.assignedSlot?t=t.assignedSlot:!a&&c!==t.ownerDocument?t=c.host:t=a}t=l}if(Bi(t))return!t.getClientRects().length;if(s!=="legacy-full")return!0}else if(s==="non-zero-area")return It(t);return!1},zi=function(t){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(t.tagName))for(var r=t.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var s=0;s<r.children.length;s++){var i=r.children.item(s);if(i.tagName==="LEGEND")return ee.call(r,"fieldset[disabled] *")?!0:!i.contains(t)}return!0}r=r.parentElement}return!1},Re=function(t,r){return!(r.disabled||Di(r)||Mi(r,t)||Fi(r)||zi(r))},Ye=function(t,r){return!(Vi(r)||yr(r)<0||!Re(t,r))},Hi=function(t){var r=parseInt(t.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},Gi=function e(t){var r=[],s=[];return t.forEach(function(i,n){var o=!!i.scopeParent,l=o?i.scopeParent:i,a=yr(l,o),c=o?e(i.candidates):l;a===0?o?r.push.apply(r,c):r.push(l):s.push({documentOrder:n,tabIndex:a,item:i,isScope:o,content:c})}),s.sort(Li).reduce(function(i,n){return n.isScope?i.push.apply(i,n.content):i.push(n.content),i},[]).concat(r)},Wi=function(t,r){r=r||{};var s;return r.getShadowRoot?s=mr([t],r.includeContainer,{filter:Ye.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:Hi}):s=vr(t,r.includeContainer,Ye.bind(null,r)),Gi(s)},Xi=function(t,r){r=r||{};var s;return r.getShadowRoot?s=mr([t],r.includeContainer,{filter:Re.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):s=vr(t,r.includeContainer,Re.bind(null,r)),s},we=function(t,r){if(r=r||{},!t)throw new Error("No node provided");return ee.call(t,Ee)===!1?!1:Ye(r,t)},Ji=pr.concat("iframe").join(","),He=function(t,r){if(r=r||{},!t)throw new Error("No node provided");return ee.call(t,Ji)===!1?!1:Re(r,t)};/*!
* focus-trap 7.2.0
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function kt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,s)}return r}function Tt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?kt(Object(r),!0).forEach(function(s){Ki(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kt(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function Ki(e,t,r){return t=Yi(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qi(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Yi(e){var t=Qi(e,"string");return typeof t=="symbol"?t:String(t)}var xt={activateTrap:function(t,r){if(t.length>0){var s=t[t.length-1];s!==r&&s.pause()}var i=t.indexOf(r);i===-1||t.splice(i,1),t.push(r)},deactivateTrap:function(t,r){var s=t.indexOf(r);s!==-1&&t.splice(s,1),t.length>0&&t[t.length-1].unpause()}},Zi=function(t){return t.tagName&&t.tagName.toLowerCase()==="input"&&typeof t.select=="function"},en=function(t){return t.key==="Escape"||t.key==="Esc"||t.keyCode===27},de=function(t){return t.key==="Tab"||t.keyCode===9},tn=function(t){return de(t)&&!t.shiftKey},rn=function(t){return de(t)&&t.shiftKey},Ct=function(t){return setTimeout(t,0)},Ot=function(t,r){var s=-1;return t.every(function(i,n){return r(i)?(s=n,!1):!0}),s},ue=function(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),i=1;i<r;i++)s[i-1]=arguments[i];return typeof t=="function"?t.apply(void 0,s):t},Se=function(t){return t.target.shadowRoot&&typeof t.composedPath=="function"?t.composedPath()[0]:t.target},sn=[],nn=function(t,r){var s=(r==null?void 0:r.document)||document,i=(r==null?void 0:r.trapStack)||sn,n=Tt({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:tn,isKeyBackward:rn},r),o={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},l,a=function(p,m,S){return p&&p[m]!==void 0?p[m]:n[S||m]},c=function(p){return o.containerGroups.findIndex(function(m){var S=m.container,I=m.tabbableNodes;return S.contains(p)||I.find(function(T){return T===p})})},h=function(p){var m=n[p];if(typeof m=="function"){for(var S=arguments.length,I=new Array(S>1?S-1:0),T=1;T<S;T++)I[T-1]=arguments[T];m=m.apply(void 0,I)}if(m===!0&&(m=void 0),!m){if(m===void 0||m===!1)return m;throw new Error("`".concat(p,"` was specified but was not a node, or did not return a node"))}var O=m;if(typeof m=="string"&&(O=s.querySelector(m),!O))throw new Error("`".concat(p,"` as selector refers to no known node"));return O},u=function(){var p=h("initialFocus");if(p===!1)return!1;if(p===void 0)if(c(s.activeElement)>=0)p=s.activeElement;else{var m=o.tabbableGroups[0],S=m&&m.firstTabbableNode;p=S||h("fallbackFocus")}if(!p)throw new Error("Your focus-trap needs to have at least one focusable element");return p},d=function(){if(o.containerGroups=o.containers.map(function(p){var m=Wi(p,n.tabbableOptions),S=Xi(p,n.tabbableOptions);return{container:p,tabbableNodes:m,focusableNodes:S,firstTabbableNode:m.length>0?m[0]:null,lastTabbableNode:m.length>0?m[m.length-1]:null,nextTabbableNode:function(T){var O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,L=S.findIndex(function(H){return H===T});if(!(L<0))return O?S.slice(L+1).find(function(H){return we(H,n.tabbableOptions)}):S.slice(0,L).reverse().find(function(H){return we(H,n.tabbableOptions)})}}}),o.tabbableGroups=o.containerGroups.filter(function(p){return p.tabbableNodes.length>0}),o.tabbableGroups.length<=0&&!h("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},f=function b(p){if(p!==!1&&p!==s.activeElement){if(!p||!p.focus){b(u());return}p.focus({preventScroll:!!n.preventScroll}),o.mostRecentlyFocusedNode=p,Zi(p)&&p.select()}},v=function(p){var m=h("setReturnFocus",p);return m||(m===!1?!1:p)},g=function(p){var m=Se(p);if(!(c(m)>=0)){if(ue(n.clickOutsideDeactivates,p)){l.deactivate({returnFocus:n.returnFocusOnDeactivate&&!He(m,n.tabbableOptions)});return}ue(n.allowOutsideClick,p)||p.preventDefault()}},w=function(p){var m=Se(p),S=c(m)>=0;S||m instanceof Document?S&&(o.mostRecentlyFocusedNode=m):(p.stopImmediatePropagation(),f(o.mostRecentlyFocusedNode||u()))},k=function(p){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,S=Se(p);d();var I=null;if(o.tabbableGroups.length>0){var T=c(S),O=T>=0?o.containerGroups[T]:void 0;if(T<0)m?I=o.tabbableGroups[o.tabbableGroups.length-1].lastTabbableNode:I=o.tabbableGroups[0].firstTabbableNode;else if(m){var L=Ot(o.tabbableGroups,function(Fe){var $e=Fe.firstTabbableNode;return S===$e});if(L<0&&(O.container===S||He(S,n.tabbableOptions)&&!we(S,n.tabbableOptions)&&!O.nextTabbableNode(S,!1))&&(L=T),L>=0){var H=L===0?o.tabbableGroups.length-1:L-1,Ir=o.tabbableGroups[H];I=Ir.lastTabbableNode}else de(p)||(I=O.nextTabbableNode(S,!1))}else{var oe=Ot(o.tabbableGroups,function(Fe){var $e=Fe.lastTabbableNode;return S===$e});if(oe<0&&(O.container===S||He(S,n.tabbableOptions)&&!we(S,n.tabbableOptions)&&!O.nextTabbableNode(S))&&(oe=T),oe>=0){var kr=oe===o.tabbableGroups.length-1?0:oe+1,Tr=o.tabbableGroups[kr];I=Tr.firstTabbableNode}else de(p)||(I=O.nextTabbableNode(S))}}else I=h("fallbackFocus");I&&(de(p)&&p.preventDefault(),f(I))},D=function(p){if(en(p)&&ue(n.escapeDeactivates,p)!==!1){p.preventDefault(),l.deactivate();return}(n.isKeyForward(p)||n.isKeyBackward(p))&&k(p,n.isKeyBackward(p))},j=function(p){var m=Se(p);c(m)>=0||ue(n.clickOutsideDeactivates,p)||ue(n.allowOutsideClick,p)||(p.preventDefault(),p.stopImmediatePropagation())},B=function(){if(o.active)return xt.activateTrap(i,l),o.delayInitialFocusTimer=n.delayInitialFocus?Ct(function(){f(u())}):f(u()),s.addEventListener("focusin",w,!0),s.addEventListener("mousedown",g,{capture:!0,passive:!1}),s.addEventListener("touchstart",g,{capture:!0,passive:!1}),s.addEventListener("click",j,{capture:!0,passive:!1}),s.addEventListener("keydown",D,{capture:!0,passive:!1}),l},A=function(){if(o.active)return s.removeEventListener("focusin",w,!0),s.removeEventListener("mousedown",g,!0),s.removeEventListener("touchstart",g,!0),s.removeEventListener("click",j,!0),s.removeEventListener("keydown",D,!0),l};return l={get active(){return o.active},get paused(){return o.paused},activate:function(p){if(o.active)return this;var m=a(p,"onActivate"),S=a(p,"onPostActivate"),I=a(p,"checkCanFocusTrap");I||d(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=s.activeElement,m&&m();var T=function(){I&&d(),B(),S&&S()};return I?(I(o.containers.concat()).then(T,T),this):(T(),this)},deactivate:function(p){if(!o.active)return this;var m=Tt({onDeactivate:n.onDeactivate,onPostDeactivate:n.onPostDeactivate,checkCanReturnFocus:n.checkCanReturnFocus},p);clearTimeout(o.delayInitialFocusTimer),o.delayInitialFocusTimer=void 0,A(),o.active=!1,o.paused=!1,xt.deactivateTrap(i,l);var S=a(m,"onDeactivate"),I=a(m,"onPostDeactivate"),T=a(m,"checkCanReturnFocus"),O=a(m,"returnFocus","returnFocusOnDeactivate");S&&S();var L=function(){Ct(function(){O&&f(v(o.nodeFocusedBeforeActivation)),I&&I()})};return O&&T?(T(v(o.nodeFocusedBeforeActivation)).then(L,L),this):(L(),this)},pause:function(){return o.paused||!o.active?this:(o.paused=!0,A(),this)},unpause:function(){return!o.paused||!o.active?this:(o.paused=!1,d(),B(),this)},updateContainerElements:function(p){var m=[].concat(p).filter(Boolean);return o.containers=m.map(function(S){return typeof S=="string"?s.querySelector(S):S}),o.active&&d(),this}},l.updateContainerElements(t),l};const K="esri-identity-modal",V={base:K,open:`${K}--open`,closed:`${K}--closed`,title:`${K}__title`,dialog:`${K}__dialog`,content:`${K}__content`,closeButton:`${K}__close-button`,iconClose:"esri-icon-close"};let W=class extends dr{constructor(e,t){super(e,t),this.container=document.createElement("div"),this.content=null,this.open=!1,this._focusTrap=null,this._close=()=>{this.open=!1},document.body.appendChild(this.container),this.addHandles(he(()=>this.open,()=>this._toggleFocusTrap()))}destroy(){this._destroyFocusTrap()}get title(){var e;return(e=this.messages)==null?void 0:e.auth.signIn}render(){const e=this.id,{open:t,content:r,title:s,messages:i}=this,n=t&&!!r,o={[V.open]:n,[V.closed]:!n},l=P("button",{class:V.closeButton,"aria-label":i.close,title:i.close,bind:this,onclick:this._close,type:"button"},P("span",{"aria-hidden":"true",class:V.iconClose})),a=`${e}_title`,c=`${e}_content`,h=s?P("h1",{id:a,class:V.title},s):null,u=n?P("div",{bind:this,class:V.dialog,role:"dialog","aria-labelledby":a,"aria-describedby":c,afterCreate:this._createFocusTrap},l,h,this._renderContent(c)):null;return P("div",{tabIndex:-1,class:this.classes(V.base,o)},u)}_destroyFocusTrap(){var e;(e=this._focusTrap)==null||e.deactivate({onDeactivate:()=>{}}),this._focusTrap=null}_toggleFocusTrap(){const{_focusTrap:e,open:t}=this;e&&(t?e.activate():e.deactivate())}_createFocusTrap(e){this._destroyFocusTrap();const t=requestAnimationFrame(()=>{this._focusTrap=nn(e,{initialFocus:"input",onDeactivate:this._close}),this._toggleFocusTrap()});this.addHandles(rt(()=>cancelAnimationFrame(t)))}_renderContent(e){const t=this.content;return typeof t=="string"?P("div",{class:V.content,id:e,innerHTML:t}):Ni(t)?P("div",{class:V.content,id:e},t.render()):t instanceof HTMLElement?P("div",{class:V.content,id:e,bind:t,afterCreate:this._attachToNode}):null}_attachToNode(e){const t=this;e.appendChild(t)}};y([_({readOnly:!0})],W.prototype,"container",void 0),y([_()],W.prototype,"content",void 0),y([_()],W.prototype,"open",void 0),y([_(),hr("esri/t9n/common")],W.prototype,"messages",void 0),y([_()],W.prototype,"title",null),W=y([ne("esri.identity.IdentityModal")],W);const Ut=W,Ge="esriJSAPIOAuth";class Ze{constructor(t,r){this.oAuthInfo=null,this.storage=null,this.appId=null,this.codeVerifier=null,this.expires=null,this.refreshToken=null,this.ssl=null,this.stateUID=null,this.token=null,this.userId=null,this.oAuthInfo=t,this.storage=r,this._init()}isValid(){let t=!1;if(this.oAuthInfo&&this.userId&&(this.refreshToken||this.token)){if(this.expires==null&&this.refreshToken)t=!0;else if(this.expires){const r=Date.now();this.expires>r&&(this.expires-r)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(t=!0)}}return t}save(){if(!this.storage)return!1;const t=this._load(),r=this.oAuthInfo;if(r&&r.authNamespace&&r.portalUrl){let s=t[r.authNamespace];s||(s=t[r.authNamespace]={}),this.appId||(this.appId=r.appId),s[r.portalUrl]={appId:this.appId,codeVerifier:this.codeVerifier,expires:this.expires,refreshToken:this.refreshToken,ssl:this.ssl,stateUID:this.stateUID,token:this.token,userId:this.userId};try{this.storage.setItem(Ge,JSON.stringify(t))}catch(i){return console.warn(i),!1}return!0}return!1}destroy(){const t=this._load(),r=this.oAuthInfo;if(r&&r.appId&&r.portalUrl&&(this.expires==null||this.expires>Date.now())&&(this.refreshToken||this.token)){const s=r.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",i=new FormData;if(i.append("f","json"),i.append("auth_token",this.refreshToken||this.token),i.append("client_id",r.appId),i.append("token_type_hint",this.refreshToken?"refresh_token":"access_token"),typeof navigator.sendBeacon=="function")navigator.sendBeacon(s,i);else{const n=new XMLHttpRequest;n.open("POST",s),n.send(i)}}if(r&&r.authNamespace&&r.portalUrl&&this.storage){const s=t[r.authNamespace];if(s){delete s[r.portalUrl];try{this.storage.setItem(Ge,JSON.stringify(t))}catch(i){console.log(i)}}}r&&(r._oAuthCred=null,this.oAuthInfo=null)}_init(){const t=this._load(),r=this.oAuthInfo;if(r&&r.authNamespace&&r.portalUrl){let s=t[r.authNamespace];s&&(s=s[r.portalUrl],s&&(this.appId=s.appId,this.codeVerifier=s.codeVerifier,this.expires=s.expires,this.refreshToken=s.refreshToken,this.ssl=s.ssl,this.stateUID=s.stateUID,this.token=s.token,this.userId=s.userId))}}_load(){let t={};if(this.storage){const r=this.storage.getItem(Ge);if(r)try{t=JSON.parse(r)}catch(s){console.warn(s)}}return t}}Ze.prototype.declaredClass="esri.identity.OAuthCredential";var et;let N=et=class extends Pt{constructor(e){super(e),this._oAuthCred=null,this.appId=null,this.authNamespace="/",this.expiration=20160,this.flowType="auto",this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl="oauth-callback.html",this.popupWindowFeatures="height=490,width=800,resizable,scrollbars,status",this.portalUrl="https://www.arcgis.com",this.preserveUrlHash=!1,this.userId=null}clone(){return et.fromJSON(this.toJSON())}};y([_({json:{write:!0}})],N.prototype,"appId",void 0),y([_({json:{write:!0}})],N.prototype,"authNamespace",void 0),y([_({json:{write:!0}})],N.prototype,"expiration",void 0),y([_({json:{write:!0}})],N.prototype,"flowType",void 0),y([_({json:{write:!0}})],N.prototype,"forceLogin",void 0),y([_({json:{write:!0}})],N.prototype,"forceUserId",void 0),y([_({json:{write:!0}})],N.prototype,"locale",void 0),y([_({json:{write:!0}})],N.prototype,"minTimeUntilExpiration",void 0),y([_({json:{write:!0}})],N.prototype,"popup",void 0),y([_({json:{write:!0}})],N.prototype,"popupCallbackUrl",void 0),y([_({json:{write:!0}})],N.prototype,"popupWindowFeatures",void 0),y([_({json:{write:!0}})],N.prototype,"portalUrl",void 0),y([_({json:{write:!0}})],N.prototype,"preserveUrlHash",void 0),y([_({json:{write:!0}})],N.prototype,"userId",void 0),N=et=y([ne("esri.identity.OAuthInfo")],N);const Et=N;let $=class extends Pt{constructor(t){super(t),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};y([_({json:{write:!0}})],$.prototype,"adminTokenServiceUrl",void 0),y([_({json:{write:!0}})],$.prototype,"currentVersion",void 0),y([_({json:{write:!0}})],$.prototype,"hasPortal",void 0),y([_({json:{write:!0}})],$.prototype,"hasServer",void 0),y([_({json:{write:!0}})],$.prototype,"owningSystemUrl",void 0),y([_({json:{write:!0}})],$.prototype,"owningTenant",void 0),y([_({json:{write:!0}})],$.prototype,"server",void 0),y([_({json:{write:!0}})],$.prototype,"shortLivedTokenValidity",void 0),y([_({json:{write:!0}})],$.prototype,"tokenServiceUrl",void 0),y([_({json:{write:!0}})],$.prototype,"webTierAuth",void 0),$=y([ne("esri.identity.ServerInfo")],$);const We=$,ke={},br=e=>{const t=new Q(e.owningSystemUrl).host,r=new Q(e.server).host,s=/.+\.arcgis\.com$/i;return s.test(t)&&s.test(r)},tt=(e,t)=>!!(br(e)&&t&&t.some(r=>r.test(e.server)));let Te=null,xe=null;try{Te=window.localStorage,xe=window.sessionStorage}catch{}class wr extends st{constructor(){super(),this._portalConfig=globalThis.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this._defaultOAuthInfo=null,this._defaultTokenValidity=60,this.dialog=null,this.formConstructor=Ri,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin=window.origin!=="null"?window.origin:window.location.origin,this._appUrlObj=je(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthLocationParams=null,this._gwTokenUrl="/sharing/rest/generateToken",this._agsRest="/rest/services",this._agsPortal=/\/sharing(\/|$)/i,this._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i,this._adminSvcs=/\/rest\/admin\/services(\/|$)/i,this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}],this._legacyFed=[],this._regexSDirUrl=/http.+\/rest\/services\/?/gi,this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|KnowledgeGraphServer|MapServer|MissionServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer|VideoServer)).*/gi,this._gwUser=/http.+\/users\/([^\/]+)\/?.*/i,this._gwItem=/http.+\/items\/([^\/]+)\/?.*/i,this._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i,this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getOAuthLocationParams(),window.addEventListener("pageshow",t=>{this._pageShowHandler(t)})}registerServers(t){const r=this.serverInfos;r?(t=t.filter(s=>!this.findServerInfo(s.server)),this.serverInfos=r.concat(t)):this.serverInfos=t,t.forEach(s=>{s.owningSystemUrl&&this._portals.push(s.owningSystemUrl),s.hasPortal&&this._portals.push(s.server)})}registerOAuthInfos(t){const r=this.oAuthInfos;if(r){for(const s of t){const i=this.findOAuthInfo(s.portalUrl);i&&r.splice(r.indexOf(i),1)}this.oAuthInfos=r.concat(t)}else this.oAuthInfos=t}registerToken(t){t={...t};const r=this._sanitizeUrl(t.server),s=this._isServerRsrc(r);let i,n=this.findServerInfo(r),o=!0;n||(n=new We,n.server=this._getServerInstanceRoot(r),s?n.hasServer=!0:(n.tokenServiceUrl=this._getTokenSvcUrl(r),n.hasPortal=!0),this.registerServers([n])),i=this._findCredential(r),i?(delete t.server,Object.assign(i,t),o=!1):(i=new x({userId:t.userId,server:n.server,token:t.token,expires:t.expires,ssl:t.ssl,scope:s?"server":"portal"}),i.resources=[r],this.credentials.push(i)),i.emitTokenChange(!1),o||i.refreshServerTokens()}toJSON(){return Nt({serverInfos:this.serverInfos.map(t=>t.toJSON()),oAuthInfos:this.oAuthInfos.map(t=>t.toJSON()),credentials:this.credentials.map(t=>t.toJSON())})}initialize(t){if(!t)return;typeof t=="string"&&(t=JSON.parse(t));const r=t.serverInfos,s=t.oAuthInfos,i=t.credentials;if(r){const n=[];r.forEach(o=>{o.server&&o.tokenServiceUrl&&n.push(o.declaredClass?o:new We(o))}),n.length&&this.registerServers(n)}if(s){const n=[];s.forEach(o=>{o.appId&&n.push(o.declaredClass?o:new Et(o))}),n.length&&this.registerOAuthInfos(n)}i&&i.forEach(n=>{n.server&&n.token&&n.expires&&n.expires>Date.now()&&((n=n.declaredClass?n:new x(n)).emitTokenChange(),this.credentials.push(n))})}findServerInfo(t){let r;t=this._sanitizeUrl(t);for(const s of this.serverInfos)if(this._hasSameServerInstance(s.server,t)){r=s;break}return r}findOAuthInfo(t){let r;t=this._sanitizeUrl(t);for(const s of this.oAuthInfos)if(this._hasSameServerInstance(s.portalUrl,t)){r=s;break}return r}findCredential(t,r){if(!t)return;let s;t=this._sanitizeUrl(t);const i=this._isServerRsrc(t)?"server":"portal";if(r){for(const n of this.credentials)if(this._hasSameServerInstance(n.server,t)&&r===n.userId&&n.scope===i){s=n;break}}else for(const n of this.credentials)if(this._hasSameServerInstance(n.server,t)&&this._getIdenticalSvcIdx(t,n)!==-1&&n.scope===i){s=n;break}return s}getCredential(t,r){let s,i,n=!0;r&&(s=!!r.token,i=r.error,n=r.prompt!==!1),r={...r},t=this._sanitizeUrl(t);const o=new AbortController,l=ge();if(r.signal&&ae(r.signal,()=>{o.abort()}),ae(o,()=>{l.reject(new E("identity-manager:user-aborted","ABORTED"))}),jr(o))return l.promise;r.signal=o.signal;const a=this._isAdminResource(t),c=s?this.findCredential(t):null;let h;if(c&&i&&i.details&&i.details.httpStatus===498)c.destroy();else if(c)return h=new E("identity-manager:not-authorized","You are currently signed in as: '"+c.userId+"'. You do not have access to this resource: "+t,{error:i}),l.reject(h),l.promise;const u=this._findCredential(t,r);if(u)return l.resolve(u),l.promise;let d=this.findServerInfo(t);if(d)!d.hasServer&&this._isServerRsrc(t)&&(d._restInfoPms=this._getTokenSvcUrl(t),d.hasServer=!0);else{const f=this._getTokenSvcUrl(t);if(!f)return h=new E("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),l.reject(h),l.promise;d=new We,d.server=this._getServerInstanceRoot(t),typeof f=="string"?(d.tokenServiceUrl=f,d.hasPortal=!0):(d._restInfoPms=f,d.hasServer=!0),this.registerServers([d])}return d.hasPortal&&d._selfReq===void 0&&(n||G(d.tokenServiceUrl,this._appOrigin)||this._gwDomains.some(f=>f.tokenServiceUrl===d.tokenServiceUrl))&&(d._selfReq={owningTenant:r&&r.owningTenant,selfDfd:this._getPortalSelf(d.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),t)}),this._enqueue(t,d,r,l,a)}getResourceName(t){return this._isRESTService(t)?t.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(t)&&t.replace(this._gwUser,"$1")||this._gwItem.test(t)&&t.replace(this._gwItem,"$1")||this._gwGroup.test(t)&&t.replace(this._gwGroup,"$1")||""}generateToken(t,r,s){const i=this._rePortalTokenSvc.test(t.tokenServiceUrl),n=new Q(this._appOrigin),o=t.shortLivedTokenValidity;let l,a,c,h,u,d,f,v;r&&(v=this.tokenValidity||o||this._defaultTokenValidity,v>o&&o>0&&(v=o)),s&&(l=s.isAdmin,a=s.serverUrl,c=s.token,d=s.signal,f=s.ssl,t.customParameters=s.customParameters),l?h=t.adminTokenServiceUrl:(h=t.tokenServiceUrl,u=new Q(h.toLowerCase()),t.webTierAuth&&(s!=null&&s.serverUrl)&&!f&&n.scheme==="http"&&(G(n.uri,h,!0)||u.scheme==="https"&&n.host===u.host&&n.port==="7080"&&u.port==="7443")&&(h=h.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));const g={query:{request:"getToken",username:r==null?void 0:r.username,password:r==null?void 0:r.password,serverUrl:a,token:c,expiration:v,referer:l||i?this._appOrigin:null,client:l?"referer":null,f:"json",...t.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(t,s),signal:d,...s==null?void 0:s.ioArgs};return i||(g.withCredentials=!1),M(h,g).then(w=>{const k=w.data;if(!k||!k.token)return new E("identity-manager:authentication-failed","Unable to generate token");const D=t.server;return ke[D]||(ke[D]={}),r&&(ke[D][r.username]=r.password),k.validity=v,k})}isBusy(){return!!this._busy}checkSignInStatus(t){return this.checkAppAccess(t,"").then(r=>r.credential)}checkAppAccess(t,r,s){let i=!1;return this.getCredential(t,{prompt:!1}).then(n=>{let o;const l={f:"json"};if(n.scope==="portal")if(r&&(this._doPortalSignIn(t)||s&&s.force))o=n.server+"/sharing/rest/oauth2/validateAppAccess",l.client_id=r;else{if(!n.token)return{credential:n};o=n.server+"/sharing/rest"}else{if(!n.token)return{credential:n};o=n.server+"/rest/services"}return n.token&&(l.token=n.token),M(o,{query:l,authMode:"anonymous"}).then(a=>{if(a.data.valid===!1)throw new E("identity-manager:not-authorized",`You are currently signed in as: '${n.userId}'.`,a.data);return i=!!a.data.viewOnlyUserTypeApp,{credential:n}}).catch(a=>{if(a.name==="identity-manager:not-authorized")throw a;const c=a.details&&a.details.httpStatus;if(c===498)throw n.destroy(),new E("identity-manager:not-authenticated","User is not signed in.");if(c===400)throw new E("identity-manager:invalid-request");return{credential:n}})}).then(n=>({credential:n.credential,viewOnly:i}))}setOAuthResponseHash(t){t&&(t.charAt(0)==="#"&&(t=t.substring(1)),this._processOAuthPopupParams(pe(t)))}setOAuthRedirectionHandler(t){this._oAuthRedirectFunc=t}setProtocolErrorHandler(t){this._protocolFunc=t}signIn(t,r,s={}){const i=ge(),n=()=>{var u;a==null||a.remove(),c==null||c.remove(),h==null||h.remove(),l==null||l.destroy(),(u=this.dialog)==null||u.destroy(),this.dialog=l=a=c=h=null},o=()=>{n(),this._oAuthDfd=null,i.reject(new E("identity-manager:user-aborted","ABORTED"))};s.signal&&ae(s.signal,()=>{o()});let l=new this.formConstructor;l.resource=this.getResourceName(t),l.server=r.server,this.dialog=new Ut,this.dialog.content=l,this.dialog.open=!0,this.emit("dialog-create");let a=l.on("cancel",o),c=he(()=>this.dialog.open,o),h=l.on("submit",u=>{this.generateToken(r,u,{isAdmin:s.isAdmin,signal:s.signal}).then(d=>{n();const f=new x({userId:u.username,server:r.server,token:d.token,expires:d.expires!=null?Number(d.expires):null,ssl:!!d.ssl,isAdmin:s.isAdmin,validity:d.validity});i.resolve(f)}).catch(d=>{l.error=d,l.signingIn=!1})});return i.promise}oAuthSignIn(t,r,s,i){this._oAuthDfd=ge();const n=this._oAuthDfd;let o;i!=null&&i.signal&&ae(i.signal,()=>{const v=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;v&&!v.closed?v.close():this.dialog&&d()}),n.resUrl_=t,n.sinfo_=r,n.oinfo_=s;const l=s._oAuthCred;if(l.storage&&(s.flowType==="authorization-code"||s.flowType==="auto"&&!s.popup&&r.currentVersion>=8.4)){let v=crypto.getRandomValues(new Uint8Array(32));o=qe(v),l.codeVerifier=o,v=crypto.getRandomValues(new Uint8Array(32)),l.stateUID=qe(v),l.save()||(l.codeVerifier=o=null)}else l.codeVerifier=null;let a,c,h,u;this._getCodeChallenge(o).then(v=>{const g=!i||i.oAuthPopupConfirmation!==!1;s.popup&&g?(a=new this.formConstructor,a.oAuthPrompt=!0,a.server=r.server,this.dialog=new Ut,this.dialog.content=a,this.dialog.open=!0,this.emit("dialog-create"),c=a.on("cancel",d),h=he(()=>this.dialog.open,d),u=a.on("submit",()=>{f(),this._doOAuthSignIn(t,r,s,v)})):this._doOAuthSignIn(t,r,s,v)});const d=()=>{f(),this._oAuthDfd=null,n.reject(new E("identity-manager:user-aborted","ABORTED"))},f=()=>{var v;c==null||c.remove(),h==null||h.remove(),u==null||u.remove(),a==null||a.destroy(),(v=this.dialog)==null||v.destroy(),this.dialog=null};return n.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach(t=>{t.destroy()}),this.emit("credentials-destroy")}enablePostMessageAuth(t="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=Ae(window,"message",r=>{var s;if((r.origin===this._appOrigin||r.origin.endsWith(".arcgis.com"))&&((s=r.data)==null?void 0:s.type)==="arcgis:auth:requestCredential"){const i=r.source;this.getCredential(t).then(n=>{i.postMessage({type:"arcgis:auth:credential",credential:{expires:n.expires,server:n.server,ssl:n.ssl,token:n.token,userId:n.userId}},r.origin)}).catch(n=>{i.postMessage({type:"arcgis:auth:error",error:{name:n.name,message:n.message}},r.origin)})}})}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthLocationParams(){var s,i;let t=window.location.hash;if(t){t.charAt(0)==="#"&&(t=t.substring(1));const n=pe(t);let o=!1;if(n.access_token&&n.expires_in&&n.state&&n.hasOwnProperty("username"))try{n.state=JSON.parse(n.state),n.state.portalUrl&&(this._oAuthLocationParams=n,o=!0)}catch{}else if(n.error&&n.error_description&&(console.log("IdentityManager OAuth Error: ",n.error," - ",n.error_description),n.error==="access_denied"&&(o=!0,n.state)))try{n.state=JSON.parse(n.state)}catch{}o&&(window.location.hash=((s=n.state)==null?void 0:s.hash)||"")}let r=window.location.search;if(r){r.charAt(0)==="?"&&(r=r.substring(1));const n=pe(r);let o=!1;if(n.code&&n.state)try{n.state=JSON.parse(n.state),n.state.portalUrl&&n.state.uid&&(this._oAuthLocationParams=n,o=!0)}catch{}else if(n.error&&n.error_description&&(console.log("IdentityManager OAuth Error: ",n.error," - ",n.error_description),n.error==="access_denied"&&(o=!0,n.state)))try{n.state=JSON.parse(n.state)}catch{}if(o){const l={...n};["code","error","error_description","message_code","persist","state"].forEach(h=>{delete l[h]});const a=lt(l),c=window.location.pathname+(a?`?${a}`:"")+(((i=n.state)==null?void 0:i.hash)||"");window.history.replaceState(window.history.state,"",c)}}}_getOAuthToken(t,r,s,i,n){return t=t.replace(/^http:/i,"https:"),M(`${t}/sharing/rest/oauth2/token`,{authMode:"anonymous",method:"post",query:i&&n?{grant_type:"authorization_code",code:r,redirect_uri:i,client_id:s,code_verifier:n}:{grant_type:"refresh_token",refresh_token:r,client_id:s}}).then(o=>o.data)}_getCodeChallenge(t){if(t&&globalThis.isSecureContext){const r=new TextEncoder().encode(t);return crypto.subtle.digest("SHA-256",r).then(s=>qe(new Uint8Array(s)))}return Promise.resolve(null)}_pageShowHandler(t){if(t.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const r=new E("identity-manager:user-aborted","ABORTED");this._errbackFunc(r)}}_findCredential(t,r){let s,i,n,o,l=-1;const a=r&&r.token,c=r&&r.resource,h=this._isServerRsrc(t)?"server":"portal",u=this.credentials.filter(d=>this._hasSameServerInstance(d.server,t)&&d.scope===h);if(t=c||t,u.length)if(u.length===1){if(s=u[0],n=this.findServerInfo(s.server),i=n&&n.owningSystemUrl,o=i?this.findCredential(i,s.userId):void 0,l=this._getIdenticalSvcIdx(t,s),!a)return l===-1&&s.resources.push(t),this._addResource(t,o),s;l!==-1&&(s.resources.splice(l,1),this._removeResource(t,o))}else{let d,f;if(u.some(v=>(f=this._getIdenticalSvcIdx(t,v),f!==-1&&(d=v,n=this.findServerInfo(d.server),i=n&&n.owningSystemUrl,o=i?this.findCredential(i,d.userId):void 0,l=f,!0))),a)d&&(d.resources.splice(l,1),this._removeResource(t,o));else if(d)return this._addResource(t,o),d}}_findOAuthInfo(t){let r=this.findOAuthInfo(t);if(!r){for(const s of this.oAuthInfos)if(this._isIdProvider(s.portalUrl,t)){r=s;break}}return r}_addResource(t,r){r&&this._getIdenticalSvcIdx(t,r)===-1&&r.resources.push(t)}_removeResource(t,r){let s=-1;r&&(s=this._getIdenticalSvcIdx(t,r),s>-1&&r.resources.splice(s,1))}_useProxy(t,r){return r&&r.isAdmin&&!G(t.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(t.tokenServiceUrl)&&String(t.currentVersion)==="10.1"&&!G(t.tokenServiceUrl,this._appOrigin)}_getOrigin(t){const r=new Q(t);return r.scheme+"://"+r.host+(r.port!=null?":"+r.port:"")}_getServerInstanceRoot(t){const r=t.toLowerCase();let s=r.indexOf(this._agsRest);return s===-1&&this._isAdminResource(t)&&(s=this._agsAdmin.test(t)?t.replace(this._agsAdmin,"$1").length:t.search(this._adminSvcs)),s!==-1||xr(r)||(s=r.indexOf("/sharing")),s===-1&&r.substr(-1)==="/"&&(s=r.length-1),s>-1?t.substring(0,s):t}_hasSameServerInstance(t,r){return t.substr(-1)==="/"&&(t=t.slice(0,-1)),t=t.toLowerCase(),r=this._getServerInstanceRoot(r).toLowerCase(),t=this._normalizeAGOLorgDomain(t),r=this._normalizeAGOLorgDomain(r),(t=t.substr(t.indexOf(":")))===(r=r.substr(r.indexOf(":")))}_normalizeAGOLorgDomain(t){const r=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,s=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,i=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return r.test(t)?t=t.replace(r,"https://www.arcgis.com"):s.test(t)?t=t.replace(s,"https://devext.arcgis.com"):i.test(t)&&(t=t.replace(i,"https://qaext.arcgis.com")),t}_sanitizeUrl(t){const r=(Ve.request.proxyUrl||"").toLowerCase(),s=r?t.toLowerCase().indexOf(r+"?"):-1;return s!==-1&&(t=t.substring(s+r.length+1)),t=Cr(t),je(t).path}_isRESTService(t){return t.includes(this._agsRest)}_isAdminResource(t){return this._agsAdmin.test(t)||this._adminSvcs.test(t)}_isServerRsrc(t){return this._isRESTService(t)||this._isAdminResource(t)}_isIdenticalService(t,r){let s=!1;if(this._isRESTService(t)&&this._isRESTService(r)){const i=this._getSuffix(t).toLowerCase(),n=this._getSuffix(r).toLowerCase();if(s=i===n,!s){const o=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;s=i.replace(o,"$1")===n.replace(o,"$1")}}else this._isAdminResource(t)&&this._isAdminResource(r)?s=!0:this._isServerRsrc(t)||this._isServerRsrc(r)||!this._isPortalDomain(t)||(s=!0);return s}_isPortalDomain(t){const r=new Q(t.toLowerCase()),s=this._portalConfig;let i=this._gwDomains.some(n=>n.regex.test(r.uri));return!i&&s&&(i=this._hasSameServerInstance(this._getServerInstanceRoot(s.restBaseUrl),r.uri)),i||Ve.portalUrl&&(i=G(r,Ve.portalUrl,!0)),i||(i=this._portals.some(n=>this._hasSameServerInstance(n,r.uri))),i=i||this._agsPortal.test(r.path),i}_isIdProvider(t,r){let s=-1,i=-1;this._gwDomains.forEach((o,l)=>{s===-1&&o.regex.test(t)&&(s=l),i===-1&&o.regex.test(r)&&(i=l)});let n=!1;if(s>-1&&i>-1&&(s===0||s===4?i!==0&&i!==4||(n=!0):s===1?i!==1&&i!==2||(n=!0):s===2?i===2&&(n=!0):s===3&&i===3&&(n=!0)),!n){const o=this.findServerInfo(r),l=o&&o.owningSystemUrl;l&&br(o)&&this._isPortalDomain(l)&&this._isIdProvider(t,l)&&(n=!0)}return n}_getIdenticalSvcIdx(t,r){let s=-1;for(let i=0;i<r.resources.length;i++){const n=r.resources[i];if(this._isIdenticalService(t,n)){s=i;break}}return s}_getSuffix(t){return t.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")}_getTokenSvcUrl(t){let r,s,i;if(this._isRESTService(t)||this._isAdminResource(t)){const n=this._getServerInstanceRoot(t);return r=n+"/admin/generateToken",s=M(t=n+"/rest/info",{query:{f:"json"}}).then(o=>o.data),{adminUrl:r,promise:s}}if(this._isPortalDomain(t)){let n="";if(this._gwDomains.some(o=>(o.regex.test(t)&&(n=o.tokenServiceUrl),!!n)),n||this._portals.some(o=>(this._hasSameServerInstance(o,t)&&(n=o+this._gwTokenUrl),!!n)),n||(i=t.toLowerCase().indexOf("/sharing"),i!==-1&&(n=t.substring(0,i)+this._gwTokenUrl)),n||(n=this._getOrigin(t)+this._gwTokenUrl),n){const o=new Q(t).port;/^http:\/\//i.test(t)&&o==="7080"&&(n=n.replace(/:7080/i,":7443")),n=n.replace(/http:/i,"https:")}return n}if(t.toLowerCase().includes("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"}_processOAuthResponseParams(t,r,s){const i=r._oAuthCred;if(t.code){const o=i.codeVerifier;return i.codeVerifier=null,i.stateUID=null,i.save(),this._getOAuthToken(s.server,t.code,r.appId,this._getRedirectURI(r,!0),o).then(l=>{const a=new x({userId:l.username,server:s.server,token:l.access_token,expires:Date.now()+1e3*l.expires_in,ssl:l.ssl,oAuthState:t.state,_oAuthCred:i});return r.userId=a.userId,i.storage=l.persist?Te:xe,i.refreshToken=l.refresh_token,i.token=null,i.expires=l.refresh_token_expires_in?Date.now()+1e3*l.refresh_token_expires_in:null,i.userId=a.userId,i.ssl=a.ssl,i.save(),a})}const n=new x({userId:t.username,server:s.server,token:t.access_token,expires:Date.now()+1e3*Number(t.expires_in),ssl:t.ssl==="true",oAuthState:t.state,_oAuthCred:i});return r.userId=n.userId,i.storage=t.persist?Te:xe,i.refreshToken=null,i.token=n.token,i.expires=n.expires,i.userId=n.userId,i.ssl=n.ssl,i.save(),Promise.resolve(n)}_processOAuthPopupParams(t){var s;const r=this._oAuthDfd;if(this._oAuthDfd=null,r)if(clearInterval(this._oAuthIntervalId),(s=this._oAuthOnPopupHandle)==null||s.remove(),t.error){const i=t.error==="access_denied",n=new E(i?"identity-manager:user-aborted":"identity-manager:authentication-failed",i?"ABORTED":"OAuth: "+t.error+" - "+t.error_description);r.reject(n)}else this._processOAuthResponseParams(t,r.oinfo_,r.sinfo_).then(i=>{r.resolve(i)}).catch(i=>{r.reject(i)})}_setOAuthResponseQueryString(t){t&&(t.charAt(0)==="?"&&(t=t.substring(1)),this._processOAuthPopupParams(pe(t)))}_exchangeToken(t,r,s){return M(`${t}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:r,token:s}}).then(i=>i.data.token)}_getPlatformSelf(t,r){return t=t.replace(/^http:/i,"https:"),M(`${t}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":r,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json",expiration:30},withCredentials:!0}).then(s=>s.data)}_getPortalSelf(t,r){let s;return this._gwDomains.some(i=>(i.regex.test(t)&&(s=i.customBaseUrl),!!s)),s?Promise.resolve({allSSL:!0,currentVersion:"8.4",customBaseUrl:s,portalMode:"multitenant",supportsOAuth:!0}):(this._appOrigin.startsWith("https:")?t=t.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(r)&&(t=t.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),M(t,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(i=>i.data))}_doPortalSignIn(t){const r=this._portalConfig,s=window.location.href,i=this.findServerInfo(t);return!(!r&&!this._isPortalDomain(s)||!(i?i.hasPortal||i.owningSystemUrl&&this._isPortalDomain(i.owningSystemUrl):this._isPortalDomain(t))||!(this._isIdProvider(s,t)||r&&(this._hasSameServerInstance(this._getServerInstanceRoot(r.restBaseUrl),t)||this._isIdProvider(r.restBaseUrl,t))||G(s,t,!0)))}_checkProtocol(t,r,s,i){let n=!0;const o=i?r.adminTokenServiceUrl:r.tokenServiceUrl;return o.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&Or(o)&&(n=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:t,serverInfo:r}),!n)&&s(new E("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection.")),n}_enqueue(t,r,s,i,n,o){return i||(i=ge()),i.resUrl_=t,i.sinfo_=r,i.options_=s,i.admin_=n,i.refresh_=o,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(t),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(i)):this._xoReqs.push(i):this._doSignIn(i),i.promise}_doSignIn(t){this._busy=t,this._rejectOnPersistedPageShow=!1;const r=c=>{const h=t.options_&&t.options_.resource,u=t.resUrl_,d=t.refresh_;let f=!1;this.credentials.includes(c)||(d&&this.credentials.includes(d)?(d.userId=c.userId,d.token=c.token,d.expires=c.expires,d.validity=c.validity,d.ssl=c.ssl,d.creationTime=c.creationTime,f=!0,c=d):this.credentials.push(c)),c.resources||(c.resources=[]),c.resources.includes(h||u)||c.resources.push(h||u),c.scope=this._isServerRsrc(u)?"server":"portal",c.emitTokenChange();const v=this._soReqs,g={};this._soReqs=[],v.forEach(w=>{if(!this._isIdenticalService(u,w.resUrl_)){const k=this._getSuffix(w.resUrl_);g[k]||(g[k]=!0,c.resources.push(w.resUrl_))}}),t.resolve(c),v.forEach(w=>{this._hasSameServerInstance(this._getServerInstanceRoot(u),w.resUrl_)?w.resolve(c):this._soReqs.push(w)}),this._busy=t.resUrl_=t.sinfo_=t.refresh_=null,f||this.emit("credential-create",{credential:c}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},s=c=>{t.reject(c),this._busy=t.resUrl_=t.sinfo_=t.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},i=(c,h,u,d)=>{var D,j,B;const f=t.sinfo_,v=!t.options_||t.options_.prompt!==!1,g=f.hasPortal&&this._findOAuthInfo(t.resUrl_);let w,k;if(c)r(new x({userId:c,server:f.server,token:u||null,expires:d!=null?Number(d):null,ssl:!!h}));else if(window!==window.parent&&((D=this._appUrlObj.query)!=null&&D["arcgis-auth-origin"])&&((j=this._appUrlObj.query)!=null&&j["arcgis-auth-portal"])&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),t.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const A=Ae(window,"message",b=>{b.source===window.parent&&b.data&&(b.data.type==="arcgis:auth:credential"?(A.remove(),b.data.credential.expires<Date.now()?s(new E("identity-manager:credential-request-failed","Parent application's token has expired.")):r(new x(b.data.credential))):b.data.type==="arcgis:auth:error"&&(A.remove(),b.data.error.name==="tokenExpiredError"?s(new E("identity-manager:credential-request-failed","Parent application's token has expired.")):s(E.fromJSON(b.data.error))))});ae((B=t.options_)==null?void 0:B.signal,()=>{A.remove()})}else if(g){let A=g._oAuthCred;if(!A){const b=new Ze(g,Te),p=new Ze(g,xe);b.isValid()&&p.isValid()?b.expires>p.expires?(A=b,p.destroy()):(A=p,b.destroy()):A=b.isValid()?b:p,g._oAuthCred=A}if(A.isValid()){w=new x({userId:A.userId,server:f.server,token:A.token,expires:A.expires,ssl:A.ssl,_oAuthCred:A});const b=g.appId!==A.appId&&this._doPortalSignIn(t.resUrl_);b||A.refreshToken?(t._pendingDfd=A.refreshToken?this._getOAuthToken(f.server,A.refreshToken,A.appId).then(p=>(w.expires=Date.now()+1e3*p.expires_in,w.token=p.access_token,w)):Promise.resolve(w),t._pendingDfd.then(p=>b?this._exchangeToken(p.server,g.appId,p.token).then(m=>(p.token=m,p)).catch(()=>p):p).then(p=>{r(p)}).catch(()=>{A==null||A.destroy(),i()})):r(w)}else if(this._oAuthLocationParams&&this._hasSameServerInstance(g.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===A.stateUID&&A.codeVerifier)){const b=this._oAuthLocationParams;this._oAuthLocationParams=null,t._pendingDfd=this._processOAuthResponseParams(b,g,f).then(p=>{r(p)}).catch(s)}else{const b=()=>{v?t._pendingDfd=this.oAuthSignIn(t.resUrl_,f,g,t.options_).then(r,s):(k=new E("identity-manager:not-authenticated","User is not signed in."),s(k))};this._doPortalSignIn(t.resUrl_)?t._pendingDfd=this._getPlatformSelf(f.server,g.appId).then(p=>{G(p.portalUrl,this._appOrigin,!0)?(w=new x({userId:p.username,server:f.server,expires:Date.now()+1e3*p.expires_in,token:p.token}),r(w)):b()}).catch(b):b()}}else if(v){if(this._checkProtocol(t.resUrl_,f,s,t.admin_)){let A=t.options_;t.admin_&&(A=A||{},A.isAdmin=!0),t._pendingDfd=this.signIn(t.resUrl_,f,A).then(r,s)}}else k=new E("identity-manager:not-authenticated","User is not signed in."),s(k)},n=()=>{const c=t.sinfo_,h=c.owningSystemUrl,u=t.options_;let d,f,v,g;if(u&&(d=u.token,f=u.error,v=u.prompt),g=this._findCredential(h,{token:d,resource:t.resUrl_}),!g){for(const w of this.credentials)if(this._isIdProvider(h,w.server)){g=w;break}}if(g){const w=this.findCredential(t.resUrl_,g.userId);if(w)r(w);else if(tt(c,this._legacyFed)){const k=g.toJSON();k.server=c.server,k.resources=null,r(new x(k))}else(t._pendingDfd=this.generateToken(this.findServerInfo(g.server),null,{serverUrl:t.resUrl_,token:g.token,signal:t.options_.signal,ssl:g.ssl})).then(k=>{r(new x({userId:g==null?void 0:g.userId,server:c.server,token:k.token,expires:k.expires!=null?Number(k.expires):null,ssl:!!k.ssl,isAdmin:t.admin_,validity:k.validity}))},s)}else this._busy=null,d&&(t.options_.token=null),(t._pendingDfd=this.getCredential(h.replace(/\/?$/,"/sharing"),{resource:t.resUrl_,owningTenant:c.owningTenant,signal:t.options_.signal,token:d,error:f,prompt:v})).then(()=>{this._enqueue(t.resUrl_,t.sinfo_,t.options_,t,t.admin_)},w=>{t.resUrl_=t.sinfo_=t.refresh_=null,t.reject(w)})};this._errbackFunc=s;const o=t.sinfo_.owningSystemUrl,l=this._isServerRsrc(t.resUrl_),a=t.sinfo_._restInfoPms;a?a.promise.then(c=>{const h=t.sinfo_;if(h._restInfoPms){h.adminTokenServiceUrl=h._restInfoPms.adminUrl,h._restInfoPms=null,h.tokenServiceUrl=(ve("authInfo.tokenServicesUrl",c)||ve("authInfo.tokenServiceUrl",c)||ve("tokenServiceUrl",c))??null,h.shortLivedTokenValidity=ve("authInfo.shortLivedTokenValidity",c)??null,h.currentVersion=c.currentVersion,h.owningTenant=c.owningTenant;const u=h.owningSystemUrl=c.owningSystemUrl;u&&this._portals.push(u)}l&&h.owningSystemUrl?n():i()},()=>{t.sinfo_._restInfoPms=null;const c=new E("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");s(c)}):l&&o?n():t.sinfo_._selfReq?t.sinfo_._selfReq.selfDfd.then(c=>{const h={};let u,d,f,v;return c&&(u=c.user&&c.user.username,h.username=u,h.allSSL=c.allSSL,d=c.supportsOAuth,v=parseFloat(c.currentVersion),c.portalMode==="multitenant"&&(f=c.customBaseUrl),t.sinfo_.currentVersion=v),t.sinfo_.webTierAuth=!!u,u&&this.normalizeWebTierAuth?this.generateToken(t.sinfo_,null,{ssl:h.allSSL}).catch(()=>null).then(g=>(h.portalToken=g&&g.token,h.tokenExpiration=g&&g.expires,h)):!u&&d&&v>=4.4&&!this._findOAuthInfo(t.resUrl_)?this._generateOAuthInfo({portalUrl:t.sinfo_.server,customBaseUrl:f,owningTenant:t.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>h):h}).catch(()=>null).then(c=>{t.sinfo_._selfReq=null,c?i(c.username,c.allSSL,c.portalToken,c.tokenExpiration):i()}):i()}_generateOAuthInfo(t){let r,s=null,i=t.portalUrl;const n=t.customBaseUrl,o=t.owningTenant,l=!this._defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(l){s=window.location.href;let a=s.indexOf("?");a>-1&&(s=s.slice(0,a)),a=s.search(/\/(apps|home)\//),s=a>-1?s.slice(0,a):null}return l&&s?(this._hasTestedIfAppIsOnPortal=!0,r=M(s+"/sharing/rest",{query:{f:"json"}}).then(()=>{this._defaultOAuthInfo=new Et({appId:"arcgisonline",popupCallbackUrl:s+"/home/oauth-callback.html"})})):r=Promise.resolve(),r.then(()=>{if(this._defaultOAuthInfo)return i=i.replace(/^http:/i,"https:"),M(i+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:o,client_id:this._defaultOAuthInfo.appId,redirect_uri:Xe(this._defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(a=>{if(a.data.valid){const c=this._defaultOAuthInfo.clone();a.data.urlKey&&n?c.portalUrl="https://"+a.data.urlKey.toLowerCase()+"."+n:c.portalUrl=i,c.popup=window!==window.top||!(G(i,this._appOrigin)||this._gwDomains.some(h=>h.regex.test(i)&&h.regex.test(this._appOrigin))),this.oAuthInfos.push(c)}})})}_doOAuthSignIn(t,r,s,i){const n=s._oAuthCred,o={portalUrl:s.portalUrl};!s.popup&&s.preserveUrlHash&&window.location.hash&&(o.hash=window.location.hash),n.stateUID&&(o.uid=n.stateUID);const l={client_id:s.appId,response_type:n.codeVerifier?"code":"token",state:JSON.stringify(o),expiration:s.expiration,locale:s.locale,redirect_uri:this._getRedirectURI(s,!!n.codeVerifier)};s.forceLogin&&(l.force_login=!0),s.forceUserId&&s.userId&&(l.prepopulatedusername=s.userId),!s.popup&&this._doPortalSignIn(t)&&(l.redirectToUserOrgUrl=!0),n.codeVerifier&&(l.code_challenge=i||n.codeVerifier,l.code_challenge_method=i?"S256":"plain");const a=s.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",c=a+"?"+lt(l);if(s.popup){const h=window.open(c,"esriJSAPIOAuth",s.popupWindowFeatures);if(h)h.focus(),this._oAuthDfd.oAuthWin_=h,this._oAuthIntervalId=setInterval(()=>{if(h.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle.remove();const u=this._oAuthDfd;if(u){const d=new E("identity-manager:user-aborted","ABORTED");u.reject(d)}}},500),this._oAuthOnPopupHandle=Ae(window,["arcgis:auth:hash","arcgis:auth:location:search"],u=>{u.type==="arcgis:auth:hash"?this.setOAuthResponseHash(u.detail):this._setOAuthResponseQueryString(u.detail)});else{const u=new E("identity-manager:popup-blocked","ABORTED");this._oAuthDfd.reject(u)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:l,authorizeUrl:a,resourceUrl:t,serverInfo:r,oAuthInfo:s}):window.location.href=c}_getRedirectURI(t,r){const s=window.location.href.replace(/#.*$/,"");if(t.popup)return Xe(t.popupCallbackUrl);if(r){const i=je(s);return i.query&&["code","error","error_description","message_code","persist","state"].forEach(n=>{delete i.query[n]}),Ur(i.path,i.query)}return s}}wr.prototype.declaredClass="esri.identity.IdentityManagerBase";let x=class extends st.EventedAccessor{constructor(e){super(e),this._oAuthCred=null,this.tokenRefreshBuffer=2,e&&e._oAuthCred&&(this._oAuthCred=e._oAuthCred)}initialize(){this.resources=this.resources||[],this.creationTime==null&&(this.creationTime=Date.now())}refreshToken(){const e=U.findServerInfo(this.server),t=e&&e.owningSystemUrl,r=!!t&&this.scope==="server",s=r&&tt(e,U._legacyFed),i=e.webTierAuth,n=i&&U.normalizeWebTierAuth,o=ke[this.server],l=o&&o[this.userId];let a,c=this.resources&&this.resources[0],h=r?U.findServerInfo(t):null,u={username:this.userId,password:l};if(i&&!n)return;r&&!h&&U.serverInfos.some(f=>(U._isIdProvider(t,f.server)&&(h=f),!!h));const d=h?U.findCredential(h.server,this.userId):null;if(!r||d){if(!s){if(r)a={serverUrl:c,token:d&&d.token,ssl:d&&d.ssl};else if(n)u=null,a={ssl:this.ssl};else{if(!l){let f;return c&&(c=U._sanitizeUrl(c),this._enqueued=1,f=U._enqueue(c,e,null,null,this.isAdmin,this),f.then(()=>{this._enqueued=0,this.refreshServerTokens()}).catch(()=>{this._enqueued=0})),f}this.isAdmin&&(a={isAdmin:!0})}return U.generateToken(r?h:e,r?null:u,a).then(f=>{this.token=f.token,this.expires=f.expires!=null?Number(f.expires):null,this.creationTime=Date.now(),this.validity=f.validity,this.emitTokenChange(),this.refreshServerTokens()}).catch(()=>{})}d==null||d.refreshToken()}}refreshServerTokens(){this.scope==="portal"&&U.credentials.forEach(e=>{const t=U.findServerInfo(e.server),r=t&&t.owningSystemUrl;e!==this&&e.userId===this.userId&&r&&e.scope==="server"&&(U._hasSameServerInstance(this.server,r)||U._isIdProvider(r,this.server))&&(tt(t,U._legacyFed)?(e.token=this.token,e.expires=this.expires,e.creationTime=this.creationTime,e.validity=this.validity,e.emitTokenChange()):e.refreshToken())})}emitTokenChange(e){clearTimeout(this._refreshTimer);const t=this.server&&U.findServerInfo(this.server),r=t&&t.owningSystemUrl,s=r&&U.findServerInfo(r);e===!1||r&&this.scope!=="portal"&&(!s||!s.webTierAuth||U.normalizeWebTierAuth)||this.expires==null&&this.validity==null||this._startRefreshTimer(),this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const e=U.credentials.indexOf(this);e>-1&&U.credentials.splice(e,1),this.emitTokenChange(),this.emit("destroy")}toJSON(){const e=Nt({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),t=this.resources;return t&&t.length>0&&(e.resources=t.slice()),e}_startRefreshTimer(){clearTimeout(this._refreshTimer);const e=6e4*this.tokenRefreshBuffer,t=2**31-1;let r=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();r<0?r=0:r>t&&(r=t),this._refreshTimer=setTimeout(this.refreshToken.bind(this),r>e?r-e:r)}};y([_()],x.prototype,"creationTime",void 0),y([_()],x.prototype,"expires",void 0),y([_()],x.prototype,"isAdmin",void 0),y([_()],x.prototype,"oAuthState",void 0),y([_()],x.prototype,"resources",void 0),y([_()],x.prototype,"scope",void 0),y([_()],x.prototype,"server",void 0),y([_()],x.prototype,"ssl",void 0),y([_()],x.prototype,"token",void 0),y([_()],x.prototype,"tokenRefreshBuffer",void 0),y([_()],x.prototype,"userId",void 0),y([_()],x.prototype,"validity",void 0),x=y([ne("esri.identity.Credential")],x);class Sr extends wr{}Sr.prototype.declaredClass="esri.identity.IdentityManager";const Ar=new Sr;Er(Ar);const Nn=Object.freeze(Object.defineProperty({__proto__:null,default:Ar},Symbol.toStringTag,{value:"Module"}));export{Nn as I,dr as W,Ni as a,es as b,Sn as c,Et as d,hr as e,Tn as f,kn as g,xn as h,Un as i,On as k,P as n,An as o,Zs as p,In as r,Ar as s,Pn as t,mt as v,Cn as w};
