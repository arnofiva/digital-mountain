import{j as T}from"./Collection-9e42cc30.js";import"./string-7a2f1d87.js";import{E as f}from"./promiseUtils-59dab60c.js";import{a as n}from"./lazyLayerLoader-82e85936.js";import g from"./PortalItem-476b4f2f.js";import{selectLayerClassPath as G}from"./portalLayers-9b8d60fb.js";import{t as M}from"./styleUtils-a2cb1d02.js";import"./JSONSupport-32b5ad86.js";import"./ensureType-249b88cd.js";import"./Error-62cc7aff.js";import"./typedArrayUtil-70e1d79e.js";import"./nextTick-3ee5a785.js";import"./Evented-36093e88.js";import"./SimpleObservable-a6d3d2d8.js";import"./preload-helper-41c905a7.js";import"./assets-640b4d04.js";import"./request-f01affa1.js";import"./Loadable-7c3ecd79.js";import"./Promise-3959c3ee.js";import"./Extent-2ad2c9a9.js";import"./Ellipsoid-89682c5e.js";import"./Portal-52d960e8.js";import"./locale-30120714.js";import"./PortalGroup-b49a7409.js";import"./PortalUser-85cf1ca9.js";import"./layerUtils-ff76096c.js";import"./layersLoader-cc3b7ff4.js";import"./Layer-ab90f8be.js";import"./geometry-f89ca072.js";import"./Polyline-cf51ad23.js";import"./typeUtils-05f9d41d.js";import"./Identifiable-99d92428.js";import"./arcgisLayerUrl-1177870a.js";import"./persistableUrlUtils-ccf13db2.js";import"./fetchService-047756b0.js";import"./jsonContext-49aec13d.js";import"./portalItemUtils-f08de884.js";import"./projection-d42b91be.js";import"./mathUtils-5b623c84.js";import"./vec3-015ca254.js";import"./common-d0b63c2d.js";import"./vec4-c7a19f0d.js";import"./mat4-4714ff8c.js";import"./aaBoundingRect-42f9721f.js";import"./zscale-d428b1da.js";import"./asyncUtils-8de18dd2.js";function A(e){return S(e,"notes")}function v(e){return S(e,"markup")}function w(e){return S(e,"route")}function S(e,r){return!(!e.layerType||e.layerType!=="ArcGISFeatureLayer")&&e.featureCollectionType===r}async function b(e,r,t){if(!r)return;const i=[];for(const a of r){const y=h(a,t);a.layerType==="GroupLayer"?i.push(k(y,a,t)):i.push(y)}const o=await f(i);for(const a of o)a.value&&e.add(a.value)}const W={ArcGISDimensionLayer:"DimensionLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",IntegratedMeshLayer:"IntegratedMeshLayer",OGCFeatureLayer:"OGCFeatureLayer",BuildingSceneLayer:"BuildingSceneLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",GeoJSON:"GeoJSONLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer",KML:"KMLLayer",RasterDataLayer:"UnsupportedLayer",Voxel:"VoxelLayer",LineOfSightLayer:"LineOfSightLayer"},F={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer",RasterDataElevationLayer:"UnsupportedLayer"},C={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",VectorTileLayer:"VectorTileLayer",ArcGISImageServiceLayer:"UnsupportedLayer",WMS:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",ArcGISSceneServiceLayer:"SceneLayer",DefaultTileLayer:"TileLayer"},O={ArcGISAnnotationLayer:"UnsupportedLayer",ArcGISDimensionLayer:"UnsupportedLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",CSV:"CSVLayer",DefaultTileLayer:"TileLayer",GeoRSS:"GeoRSSLayer",GeoJSON:"GeoJSONLayer",GroupLayer:"GroupLayer",KML:"KMLLayer",MediaLayer:"MediaLayer",OGCFeatureLayer:"OGCFeatureLayer",OrientedImageryLayer:"OrientedImageryLayer",SubtypeGroupLayer:"SubtypeGroupLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",WebTiledLayer:"WebTileLayer"},V={ArcGISFeatureLayer:"FeatureLayer"},B={ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"};async function h(e,r){return D(await U(e,r),e,r)}async function D(e,r,t){const i=new e;return i.read(r,t.context),i.type==="group"&&I(r)&&await E(i,r,t.context),await M(i,t.context),i}async function U(e,r){var L;const t=r.context,i=x(t);let o=e.layerType||e.type;!o&&r&&r.defaultLayerType&&(o=r.defaultLayerType);const a=i[o];let y=a?n[a]:n.UnknownLayer;if(d(e)){const p=t==null?void 0:t.portal;if(e.itemId){const c=new g({id:e.itemId,portal:p});await c.load();const l=(await G(c)).className||"UnknownLayer";y=n[l]}}else o==="ArcGISFeatureLayer"?A(e)||v(e)?y=n.MapNotesLayer:w(e)?y=n.RouteLayer:I(e)&&(y=n.GroupLayer):e.wmtsInfo&&e.wmtsInfo.url&&e.wmtsInfo.layerIdentifier?y=n.WMTSLayer:o==="WFS"&&((L=e.wfsInfo)==null?void 0:L.version)!=="2.0.0"&&(y=n.UnsupportedLayer);return y()}function I(e){var r,t;return e.layerType!=="ArcGISFeatureLayer"||d(e)?!1:(((t=(r=e.featureCollection)==null?void 0:r.layers)==null?void 0:t.length)??0)>1}function d(e){return e.type==="Feature Collection"}function x(e){let r;if(e.origin==="web-scene")switch(e.layerContainerType){case"basemap":r=C;break;case"ground":r=F;break;default:r=W}else switch(e.layerContainerType){case"basemap":r=B;break;case"tables":r=V;break;default:r=O}return r}async function k(e,r,t){const i=new T,o=b(i,Array.isArray(r.layers)?r.layers:[],t),a=await e;if(await o,a.type==="group")return a.layers.addMany(i),a}async function E(e,r,t){var p;const i=n.FeatureLayer,o=await i(),a=r.featureCollection,y=a==null?void 0:a.showLegend,L=(p=a==null?void 0:a.layers)==null?void 0:p.map((c,l)=>{var u;const s=new o;s.read(c,t);const m={...t,ignoreDefaults:!0};return s.read({id:`${e.id}-sublayer-${l}`,visibility:((u=r.visibleLayers)==null?void 0:u.includes(l))??!0},m),y!=null&&s.read({showLegend:y},m),s});e.layers.addMany(L??[])}export{b as populateOperationalLayers};
