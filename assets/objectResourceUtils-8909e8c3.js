import{a as zt}from"./devEnvironmentUtils-5002a058.js";import{r as g,y as re,t as Y,b as Bt,l as Dt,e as Vt,x as Ut}from"./typedArrayUtil-ce39e5f4.js";import{y as qt,i as je,g as We}from"./mat3-4fd89d48.js";import{e as He}from"./mat3f64-50f3b9f6.js";import{h as ct,o as Ke,n as Qe,c as Ft,H as ft,G as dt}from"./mat4-4714ff8c.js";import{e as _e,o as Ye,r as kt}from"./mat4f64-abdda1bb.js";import{n as $,E as Xe,u as G,e as le,r as fe,t as Re,A as Ue,p as Ht,s as Ge,_ as Gt,o as j,g as W,U as jt,O as qe,a as Wt,z as pt,P as Kt,S as Qt,c as Je,h as Ze}from"./vec3-015ca254.js";import{S as mt,c as $e}from"./aaBoundingBox-04c58f5a.js";import{c as Ie,x as xe,u as gt,i as pe,L as Yt,O as et,E as Xt}from"./BufferView-da65c548.js";import{t as Jt,r as Zt,f as tt,e as es}from"./vec33-8529ce65.js";import{m as ts,n as ss,o as ue,r as ae,a as rs,b as is,c as st,e as os,t as as,i as ns,f as ls,d as us}from"./DefaultMaterial_COLOR_GAMMA-87d1f8e6.js";import{t as we}from"./resourceUtils-527631ac.js";import{X as hs,t as Ce,e as cs}from"./DefaultMaterial.glsl-7d7dc23e.js";import{c as fs,i as ds}from"./vec2f32-eaf29605.js";import{U as ps}from"./request-fc61835a.js";import{b as _t}from"./asyncUtils-623987a8.js";import{e as ms}from"./byteSizeEstimations-f0cab514.js";import{s as gs,a as _s}from"./Error-685fdf30.js";import{C as Ts,w as Tt}from"./promiseUtils-e37fe75d.js";import{r as xt}from"./Version-419f71e1.js";import{t as xs,G as bt}from"./Texture-87febf19.js";import{s as ce}from"./Attribute-f72d3f37.js";import{N as Fe,t as bs,a as ee,n as te,e as be,u as q}from"./basicInterfaces-7449a8bf.js";import{j as vs,k as Os,e as p}from"./cast-8b575ab3.js";import{s as D}from"./Util-c12e93ba.js";import{j as As,e as Oe,g as ys,E as Ss,h as Es,N as Ms,l as Rs}from"./VisualVariablePassParameters-8cb0a75a.js";import{R as vt,s as Ot}from"./sphere-8ab93b42.js";import{v as $s}from"./lineSegment-b352e49e.js";import{o as rt,n as Is}from"./Indices-37e06e9a.js";import{O as v}from"./VertexAttribute-15d1866a.js";import{g as Ps,v as Ls,f as Ns,a as me}from"./MixExternalColor.glsl-99b269fe.js";import{h as ws}from"./string-7a324480.js";import{l as ke}from"./ViewingMode-5d7d590b.js";import{T as Cs}from"./InterleavedLayout-d75b8228.js";import{h as z}from"./Matrix3PassUniform-0b3b1bba.js";import{i as ne}from"./Normals.glsl-0f400ece.js";import{d as Pe,b as Te}from"./PhysicallyBasedRendering.glsl-32dfb9c7.js";import{n as zs}from"./ShaderBuilder-7bfc11d2.js";import{o as X}from"./TransparencyPassType-a6b20292.js";import{R as Z,I as k,O as V,D as it,E as ze}from"./enums-fc527c7c.js";import{l as Bs,s as At,a as yt,t as St,e as Ds,o as Vs,W as Us,h as qs,_ as Fs}from"./EvaluateSceneLighting.glsl-5da94bb7.js";import{S as ks}from"./quat-99c4e099.js";import{e as Hs}from"./quatf64-f8f1c132.js";import{n as Gs}from"./vec3f32-01c06d8d.js";import{_ as Et}from"./preload-helper-41c905a7.js";import{r as js}from"./vec4f64-6d0e93be.js";import{o as Ws}from"./AlphaCutoff-96178e0d.js";import{r as Ks}from"./context-util-7ede29e5.js";import{r as m}from"./ShaderTechniqueConfiguration-ee770726.js";import{s as Qs}from"./DefaultTechniqueConfiguration-5fedee5c.js";import{R as Ys}from"./RealisticTree.glsl-1e8f0ea9.js";let ao=class{constructor(){this._transform=_e(),this._transformInverse=new Ae({value:this._transform},ct,_e),this._transformInverseTranspose=new Ae(this._transformInverse,Ke,_e),this._transformTranspose=new Ae({value:this._transform},Ke,_e),this._transformInverseRotation=new Ae({value:this._transform},qt,He)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Qe(this._transform,e)}multiplyTransform(e){Ft(this._transform,this._transform,e)}set(e){Qe(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}},Ae=class{constructor(e,t,r){this._original=e,this._update=t,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},Xs=class{constructor(e=0){this.offset=e,this.tmpVertex=$()}applyToVertex(e,t,r){const i=e+this.localOrigin[0],o=t+this.localOrigin[1],a=r+this.localOrigin[2],n=this.offset/Math.sqrt(i*i+o*o+a*a);return this.tmpVertex[0]=e+i*n,this.tmpVertex[1]=t+o*n,this.tmpVertex[2]=r+a*n,this.tmpVertex}applyToAabb(e){for(let o=0;o<3;++o)J[o]=e[0+o]+this.localOrigin[o],ye[o]=e[3+o]+this.localOrigin[o],he[o]=J[o];const t=this.applyToVertex(J[0],J[1],J[2]);for(let o=0;o<3;++o)e[o]=t[o],e[o+3]=t[o];const r=o=>{const a=this.applyToVertex(o[0],o[1],o[2]);for(let n=0;n<3;++n)e[n+0]=Math.min(e[n+0],a[n]),e[n+3]=Math.max(e[n+3],a[n])};for(let o=1;o<8;++o){for(let a=0;a<3;++a)he[a]=o&1<<a?ye[a]:J[a];r(he)}let i=0;for(let o=0;o<3;++o)J[o]*ye[o]<0&&(i|=1<<o);if(i!==0&&i!==7){for(let o=0;o<8;++o)if(!(i&o)){for(let a=0;a<3;++a)i[a]?he[a]=0:he[a]=o&1<<a?J[a]:ye[a];r(he)}}for(let o=0;o<3;++o)e[o+0]-=this.localOrigin[o],e[o+3]-=this.localOrigin[o];return e}};const J=$(),ye=$(),he=$();let Js=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=$(),this._mbs=vt(),this._obb={center:$(),halfSize:Gs(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,t,r){const i=e,o=t,a=r+this.componentLocalOriginLength,n=this._totalOffset/Math.sqrt(i*i+o*o+a*a);return this._tmpVertex[0]=e+i*n,this._tmpVertex[1]=t+o*n,this._tmpVertex[2]=r+a*n,this._tmpVertex}applyToAabb(e){const t=e[0],r=e[1],i=e[2]+this.componentLocalOriginLength,o=e[3],a=e[4],n=e[5]+this.componentLocalOriginLength,u=t*o<0?0:Math.min(Math.abs(t),Math.abs(o)),l=r*a<0?0:Math.min(Math.abs(r),Math.abs(a)),h=i*n<0?0:Math.min(Math.abs(i),Math.abs(n)),c=Math.sqrt(u*u+l*l+h*h);if(c<this._totalOffset)return e[0]-=t<0?this._totalOffset:0,e[1]-=r<0?this._totalOffset:0,e[2]-=i<0?this._totalOffset:0,e[3]+=o>0?this._totalOffset:0,e[4]+=a>0?this._totalOffset:0,e[5]+=n>0?this._totalOffset:0,e;const T=Math.max(Math.abs(t),Math.abs(o)),f=Math.max(Math.abs(r),Math.abs(a)),_=Math.max(Math.abs(i),Math.abs(n)),b=Math.sqrt(T*T+f*f+_*_),x=this._totalOffset/b,R=this._totalOffset/c;return e[0]+=t*(t>0?x:R),e[1]+=r*(r>0?x:R),e[2]+=i*(i>0?x:R),e[3]+=o*(o<0?x:R),e[4]+=a*(a<0?x:R),e[5]+=n*(n<0?x:R),e}applyToMbs(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this._totalOffset/t;return this._mbs[0]=e[0]+e[0]*r,this._mbs[1]=e[1]+e[1]*r,this._mbs[2]=e[2]+e[2]*r,this._mbs[3]=e[3]+e[3]*this._totalOffset/t,this._mbs}applyToObb(e){const t=e.center,r=this._totalOffset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this._obb.center[0]=t[0]+t[0]*r,this._obb.center[1]=t[1]+t[1]*r,this._obb.center[2]=t[2]+t[2]*r,Xe(this._obb.halfSize,e.halfSize,e.quaternion),G(this._obb.halfSize,this._obb.halfSize,e.center);const i=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*i,this._obb.halfSize[1]+=this._obb.halfSize[1]*i,this._obb.halfSize[2]+=this._obb.halfSize[2]*i,le(this._obb.halfSize,this._obb.halfSize,e.center),ks(lt,e.quaternion),Xe(this._obb.halfSize,this._obb.halfSize,lt),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},Zs=class{constructor(e=0){this.offset=e,this.sphere=vt(),this.tmpVertex=$()}applyToVertex(e,t,r){const i=this.objectTransform.transform;let o=i[0]*e+i[4]*t+i[8]*r+i[12],a=i[1]*e+i[5]*t+i[9]*r+i[13],n=i[2]*e+i[6]*t+i[10]*r+i[14];const u=this.offset/Math.sqrt(o*o+a*a+n*n);o+=o*u,a+=a*u,n+=n*u;const l=this.objectTransform.inverse;return this.tmpVertex[0]=l[0]*o+l[4]*a+l[8]*n+l[12],this.tmpVertex[1]=l[1]*o+l[5]*a+l[9]*n+l[13],this.tmpVertex[2]=l[2]*o+l[6]*a+l[10]*n+l[14],this.tmpVertex}applyToMinMax(e,t){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this.offset/t;return this.sphere[0]=e[0]+e[0]*r,this.sphere[1]=e[1]+e[1]*r,this.sphere[2]=e[2]+e[2]*r,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}};const ot=new Zs;function er(s){return g(s)?(ot.offset=s,ot):null}const at=new Js;function fo(s){return g(s)?(at.offset=s,at):null}const nt=new Xs;function po(s){return g(s)?(nt.offset=s,nt):null}const mo="terrain",lt=Hs();let tr=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}ensureTechnique(e,t){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,t),this._technique),this._technique}ensureResources(e){return Fe.LOADED}},sr=class extends tr{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,t=>this._texture=t),this._acquire(e.normalTextureId,t=>this._textureNormal=t),this._acquire(e.emissiveTextureId,t=>this._textureEmissive=t),this._acquire(e.occlusionTextureId,t=>this._textureOcclusion=t),this._acquire(e.metallicRoughnessTextureId,t=>this._textureMetallicRoughness=t)}dispose(){this._texture=re(this._texture),this._textureNormal=re(this._textureNormal),this._textureEmissive=re(this._textureEmissive),this._textureOcclusion=re(this._textureOcclusion),this._textureMetallicRoughness=re(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?Fe.LOADED:Fe.LOADING}get textureBindParameters(){return new rr(g(this._texture)?this._texture.glTexture:null,g(this._textureNormal)?this._textureNormal.glTexture:null,g(this._textureEmissive)?this._textureEmissive.glTexture:null,g(this._textureOcclusion)?this._textureOcclusion.glTexture:null,g(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){(Y(this._texture)||e!==this._texture.id)&&(this._texture=re(this._texture),this._textureId=e,this._acquire(this._textureId,t=>this._texture=t))}_acquire(e,t){if(Y(e))return void t(null);const r=this._textureRepository.acquire(e);if(Ts(r))return++this._numLoading,void r.then(i=>{if(this._disposed)return re(i),void t(null);t(i)}).finally(()=>--this._numLoading);t(r)}},rr=class extends zs{constructor(e=null,t=null,r=null,i=null,o=null){super(),this.texture=e,this.textureNormal=t,this.textureEmissive=r,this.textureOcclusion=i,this.textureMetallicRoughness=o}};var de;(function(s){s[s.INTEGRATED_MESH=0]="INTEGRATED_MESH",s[s.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",s[s.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",s[s.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",s[s.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",s[s.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",s[s.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",s[s.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",s[s.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",s[s.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",s[s.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",s[s.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",s[s.LASERLINES=12]="LASERLINES",s[s.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",s[s.HUD_MATERIAL=14]="HUD_MATERIAL",s[s.LABEL_MATERIAL=15]="LABEL_MATERIAL",s[s.LINE_CALLOUTS=16]="LINE_CALLOUTS",s[s.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",s[s.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",s[s.DRAPED_WATER=19]="DRAPED_WATER",s[s.VOXEL=20]="VOXEL",s[s.MAX_SLOTS=21]="MAX_SLOTS"})(de||(de={}));function ir(s){if(s.length<Bt)return Array.from(s);if(Array.isArray(s))return Float64Array.from(s);switch(s.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(s);case 2:return Uint16Array.from(s);case 4:return Float32Array.from(s);default:return Float64Array.from(s)}}let or=class Mt{constructor(e,t,r,i){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.indices=r,this.position=i,this._children=void 0,D(e.length>=1),D(r.length%this._numIndexPerPrimitive==0),D(r.length>=e.length*this._numIndexPerPrimitive),D(i.size===3||i.size===4);const{data:o,size:a}=i,n=e.length;let u=a*r[this._numIndexPerPrimitive*e[0]];ie.clear(),ie.push(u);const l=fe(o[u],o[u+1],o[u+2]),h=Re(l);for(let f=0;f<n;++f){const _=this._numIndexPerPrimitive*e[f];for(let b=0;b<this._numIndexPerPrimitive;++b){u=a*r[_+b],ie.push(u);let x=o[u];l[0]=Math.min(x,l[0]),h[0]=Math.max(x,h[0]),x=o[u+1],l[1]=Math.min(x,l[1]),h[1]=Math.max(x,h[1]),x=o[u+2],l[2]=Math.min(x,l[2]),h[2]=Math.max(x,h[2])}}this.bbMin=l,this.bbMax=h;const c=Ue($(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-l[0],h[1]-l[1]),h[2]-l[2]);let T=this.radius*this.radius;for(let f=0;f<ie.length;++f){u=ie.getItemAt(f);const _=o[u]-c[0],b=o[u+1]-c[1],x=o[u+2]-c[2],R=_*_+b*b+x*x;if(R<=T)continue;const w=Math.sqrt(R),L=.5*(w-this.radius);this.radius=this.radius+L,T=this.radius*this.radius;const P=L/w;c[0]+=_*P,c[1]+=b*P,c[2]+=x*P}this.center=c,ie.clear()}getChildren(){if(this._children||Ht(this.bbMin,this.bbMax)<=1)return this._children;const e=Ue($(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,r=new Uint8Array(t),i=new Array(8);for(let l=0;l<8;++l)i[l]=0;const{data:o,size:a}=this.position;for(let l=0;l<t;++l){let h=0;const c=this._numIndexPerPrimitive*this.primitiveIndices[l];let T=a*this.indices[c],f=o[T],_=o[T+1],b=o[T+2];for(let x=1;x<this._numIndexPerPrimitive;++x){T=a*this.indices[c+x];const R=o[T],w=o[T+1],L=o[T+2];R<f&&(f=R),w<_&&(_=w),L<b&&(b=L)}f<e[0]&&(h|=1),_<e[1]&&(h|=2),b<e[2]&&(h|=4),r[l]=h,++i[h]}let n=0;for(let l=0;l<8;++l)i[l]>0&&++n;if(n<2)return;const u=new Array(8);for(let l=0;l<8;++l)u[l]=i[l]>0?new Uint32Array(i[l]):void 0;for(let l=0;l<8;++l)i[l]=0;for(let l=0;l<t;++l){const h=r[l];u[h][i[h]++]=this.primitiveIndices[l]}this._children=new Array;for(let l=0;l<8;++l)u[l]!==void 0&&this._children.push(new Mt(u[l],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){ie.prune()}};const ie=new vs({deallocator:null});function ar(s){return s?{p0:Re(s.p0),p1:Re(s.p1),p2:Re(s.p2)}:{p0:$(),p1:$(),p2:$()}}function xo(s,e,t){const r=e[0]-s[0],i=e[1]-s[1],o=t[0]-s[0],a=t[1]-s[1];return .5*Math.abs(r*a-i*o)}function nr(s,e,t){return le(Be,e,s),le(ut,t,s),Ge(Gt(Be,Be,ut))/2}new Ot($s);new Ot(()=>ar());const Be=$(),ut=$();function lr(s,e,t){if(!s||!e)return!1;const{size:r,data:i}=s;j(t,0,0,0),j(F,0,0,0);let o=0,a=0;for(let n=0;n<e.length-2;n+=3){const u=e[n+0]*r,l=e[n+1]*r,h=e[n+2]*r;j(B,i[u+0],i[u+1],i[u+2]),j(Q,i[l+0],i[l+1],i[l+2]),j(Se,i[h+0],i[h+1],i[h+2]);const c=nr(B,Q,Se);c?(G(B,B,Q),G(B,B,Se),W(B,B,1/3*c),G(t,t,B),o+=c):(G(F,F,B),G(F,F,Q),G(F,F,Se),a+=3)}return(a!==0||o!==0)&&(o!==0?(W(t,t,1/o),!0):a!==0&&(W(t,F,1/a),!0))}function ur(s,e,t){if(!s||!e)return!1;const{size:r,data:i}=s;j(t,0,0,0);let o=-1,a=0;for(let n=0;n<e.length;n++){const u=e[n]*r;o!==u&&(t[0]+=i[u+0],t[1]+=i[u+1],t[2]+=i[u+2],a++),o=u}return a>1&&W(t,t,1/a),a>0}function hr(s,e,t,r){if(!s)return!1;j(r,0,0,0),j(F,0,0,0);let i=0,o=0;const{size:a,data:n}=s,u=e?e.length-1:n.length/a-1,l=u+(t?2:0);for(let h=0;h<l;h+=2){const c=h<u?h:u,T=h<u?h+1:0,f=(e?e[c]:c)*a,_=(e?e[T]:T)*a;B[0]=n[f],B[1]=n[f+1],B[2]=n[f+2],Q[0]=n[_],Q[1]=n[_+1],Q[2]=n[_+2],W(B,G(B,B,Q),.5);const b=jt(B,Q);b>0?(G(r,r,W(B,B,b)),i+=b):i===0&&(G(F,F,B),o++)}return i!==0?(W(r,r,1/i),!0):o!==0&&(W(r,F,1/o),!0)}const B=$(),Q=$(),Se=$(),F=$();let cr=class{constructor(e){this.channel=e,this.id=Os()}};function fr(s,e){return Y(s)&&(s=[]),s.push(e),s}function dr(s,e){if(Y(s))return null;const t=s.filter(r=>r!==e);return t.length===0?null:t}function vo(s,e,t,r,i){Ee[0]=s.get(e,0),Ee[1]=s.get(e,1),Ee[2]=s.get(e,2),Ps(Ee,oe,3),t.set(i,0,oe[0]),r.set(i,0,oe[1]),t.set(i,1,oe[2]),r.set(i,1,oe[3]),t.set(i,2,oe[4]),r.set(i,2,oe[5])}const Ee=$(),oe=new Float32Array(6);class Ne extends As{constructor(e,t,r=[],i=null,o=Oe.Mesh,a=null,n=-1){super(),this.material=e,this.mapPositions=i,this.type=o,this.objectAndLayerIdColor=a,this.edgeIndicesLength=n,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[u,l]of t)l&&this._vertexAttributes.set(u,{...l});if(r==null||r.length===0){const u=pr(this._vertexAttributes),l=rt(u);this.edgeIndicesLength=this.edgeIndicesLength<0?u:this.edgeIndicesLength;for(const h of this._vertexAttributes.keys())this._indices.set(h,l)}else for(const[u,l]of r)l&&(this._indices.set(u,Is(l)),u===v.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(u).length:this.edgeIndicesLength))}instantiate(e={}){const t=new Ne(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((r,i)=>{r.exclusive=!1,t._vertexAttributes.set(i,r)}),this._indices.forEach((r,i)=>t._indices.set(i,r)),t._boundingInfo=this._boundingInfo,t.transformation=e.transformation||this.transformation,t}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let t=this._vertexAttributes.get(e);return t&&!t.exclusive&&(t={...t,exclusive:!0,data:ir(t.data)},this._vertexAttributes.set(e,t)),t}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return Y(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Oe.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Oe.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(g(this._transformation)&&qe(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const t=this.indices.get(v.POSITION),r=this.vertexAttributes.get(v.POSITION);return lr(r,t,e)}_computeAttachmentOriginLines(e){const t=this.vertexAttributes.get(v.POSITION),r=this.indices.get(v.POSITION);return hr(t,r,r&&mr(this.material.parameters,t,r),e)}_computeAttachmentOriginPoints(e){const t=this.indices.get(v.POSITION),r=this.vertexAttributes.get(v.POSITION);return ur(r,t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(v.POSITION),t=this.vertexAttributes.get(v.POSITION);if(!e||e.length===0||!t)return null;const r=this.type===Oe.Mesh?3:1;D(e.length%r==0,"Indexing error: "+e.length+" not divisible by "+r);const i=rt(e.length/r);return new or(i,r,e,t)}get transformation(){return Dt(this._transformation,Ye)}set transformation(e){this._transformation=e&&e!==Ye?kt(e):null}get shaderTransformation(){return g(this._shaderTransformer)?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return g(this._shaderTransformer)}addHighlight(){const e=new cr(bs.Highlight);return this.highlights=fr(this.highlights,e),e}removeHighlight(e){this.highlights=dr(this.highlights,e)}}function pr(s){const e=s.values().next().value;return e==null?0:e.data.length/e.size}function mr(s,e,t){return!(!("isClosed"in s)||!s.isClosed)&&(t?t.length>2:e.data.length>6)}let gr=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,t){var r;return(r=this._outer.get(e))==null?void 0:r.get(t)}set(e,t,r){const i=this._outer.get(e);i?i.set(t,r):this._outer.set(e,new Map([[t,r]]))}delete(e,t){const r=this._outer.get(e);r&&(r.delete(t),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((t,r)=>e(t,r))}};function Ao(s,e,t,r,i=1){const o=t.typedBuffer,a=t.typedBufferStride,n=s.length;if(r*=a,i===1)for(let u=0;u<n;++u)o[r]=e[s[u]],r+=a;else for(let u=0;u<n;++u){const l=e[s[u]];for(let h=0;h<i;h++)o[r]=l,r+=a}}function _r(s,e,t,r){const i=t.typedBuffer,o=t.typedBufferStride,a=s.length;r*=o;for(let n=0;n<a;++n){const u=2*s[n];i[r]=e[u],i[r+1]=e[u+1],r+=o}}function Rt(s,e,t,r,i){const o=t.typedBuffer,a=t.typedBufferStride,n=s.length;if(r*=a,i==null||i===1)for(let u=0;u<n;++u){const l=3*s[u];o[r]=e[l],o[r+1]=e[l+1],o[r+2]=e[l+2],r+=a}else for(let u=0;u<n;++u){const l=3*s[u];for(let h=0;h<i;++h)o[r]=e[l],o[r+1]=e[l+1],o[r+2]=e[l+2],r+=a}}function $t(s,e,t,r,i=1){const o=t.typedBuffer,a=t.typedBufferStride,n=s.length;if(r*=a,i===1)for(let u=0;u<n;++u){const l=4*s[u];o[r]=e[l],o[r+1]=e[l+1],o[r+2]=e[l+2],o[r+3]=e[l+3],r+=a}else for(let u=0;u<n;++u){const l=4*s[u];for(let h=0;h<i;++h)o[r]=e[l],o[r+1]=e[l+1],o[r+2]=e[l+2],o[r+3]=e[l+3],r+=a}}function yo(s,e,t){const r=s.typedBuffer,i=s.typedBufferStride;e*=i;for(let o=0;o<t;++o)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=i}function Tr(s,e,t,r,i,o=1){if(!t)return void Rt(s,e,r,i,o);const a=r.typedBuffer,n=r.typedBufferStride,u=s.length,l=t[0],h=t[1],c=t[2],T=t[4],f=t[5],_=t[6],b=t[8],x=t[9],R=t[10],w=t[12],L=t[13],P=t[14];i*=n;let N=0,I=0,M=0;const S=ft(t)?E=>{N=e[E]+w,I=e[E+1]+L,M=e[E+2]+P}:E=>{const A=e[E],O=e[E+1],y=e[E+2];N=l*A+T*O+b*y+w,I=h*A+f*O+x*y+L,M=c*A+_*O+R*y+P};if(o===1)for(let E=0;E<u;++E)S(3*s[E]),a[i]=N,a[i+1]=I,a[i+2]=M,i+=n;else for(let E=0;E<u;++E){S(3*s[E]);for(let A=0;A<o;++A)a[i]=N,a[i+1]=I,a[i+2]=M,i+=n}}function xr(s,e,t,r,i,o=1){if(!t)return void Rt(s,e,r,i,o);const a=t,n=r.typedBuffer,u=r.typedBufferStride,l=s.length,h=a[0],c=a[1],T=a[2],f=a[4],_=a[5],b=a[6],x=a[8],R=a[9],w=a[10],L=!dt(a),P=1e-6,N=1-P;i*=u;let I=0,M=0,S=0;const E=ft(a)?A=>{I=e[A],M=e[A+1],S=e[A+2]}:A=>{const O=e[A],y=e[A+1],C=e[A+2];I=h*O+f*y+x*C,M=c*O+_*y+R*C,S=T*O+b*y+w*C};if(o===1)if(L)for(let A=0;A<l;++A){E(3*s[A]);const O=I*I+M*M+S*S;if(O<N&&O>P){const y=1/Math.sqrt(O);n[i]=I*y,n[i+1]=M*y,n[i+2]=S*y}else n[i]=I,n[i+1]=M,n[i+2]=S;i+=u}else for(let A=0;A<l;++A)E(3*s[A]),n[i]=I,n[i+1]=M,n[i+2]=S,i+=u;else for(let A=0;A<l;++A){if(E(3*s[A]),L){const O=I*I+M*M+S*S;if(O<N&&O>P){const y=1/Math.sqrt(O);I*=y,M*=y,S*=y}}for(let O=0;O<o;++O)n[i]=I,n[i+1]=M,n[i+2]=S,i+=u}}function br(s,e,t,r,i,o=1){if(!t)return void $t(s,e,r,i,o);const a=t,n=r.typedBuffer,u=r.typedBufferStride,l=s.length,h=a[0],c=a[1],T=a[2],f=a[4],_=a[5],b=a[6],x=a[8],R=a[9],w=a[10],L=!dt(a),P=1e-6,N=1-P;if(i*=u,o===1)for(let I=0;I<l;++I){const M=4*s[I],S=e[M],E=e[M+1],A=e[M+2],O=e[M+3];let y=h*S+f*E+x*A,C=c*S+_*E+R*A,H=T*S+b*E+w*A;if(L){const U=y*y+C*C+H*H;if(U<N&&U>P){const se=1/Math.sqrt(U);y*=se,C*=se,H*=se}}n[i]=y,n[i+1]=C,n[i+2]=H,n[i+3]=O,i+=u}else for(let I=0;I<l;++I){const M=4*s[I],S=e[M],E=e[M+1],A=e[M+2],O=e[M+3];let y=h*S+f*E+x*A,C=c*S+_*E+R*A,H=T*S+b*E+w*A;if(L){const U=y*y+C*C+H*H;if(U<N&&U>P){const se=1/Math.sqrt(U);y*=se,C*=se,H*=se}}for(let U=0;U<o;++U)n[i]=y,n[i+1]=C,n[i+2]=H,n[i+3]=O,i+=u}}function vr(s,e,t,r,i,o=1){const a=r.typedBuffer,n=r.typedBufferStride,u=s.length;if(i*=n,t!==e.length||t!==4)if(o!==1)if(t!==4)for(let l=0;l<u;++l){const h=3*s[l];for(let c=0;c<o;++c)a[i]=e[h],a[i+1]=e[h+1],a[i+2]=e[h+2],a[i+3]=255,i+=n}else for(let l=0;l<u;++l){const h=4*s[l];for(let c=0;c<o;++c)a[i]=e[h],a[i+1]=e[h+1],a[i+2]=e[h+2],a[i+3]=e[h+3],i+=n}else{if(t===4){for(let l=0;l<u;++l){const h=4*s[l];a[i]=e[h],a[i+1]=e[h+1],a[i+2]=e[h+2],a[i+3]=e[h+3],i+=n}return}for(let l=0;l<u;++l){const h=3*s[l];a[i]=e[h],a[i+1]=e[h+1],a[i+2]=e[h+2],a[i+3]=255,i+=n}}else{a[i]=e[0],a[i+1]=e[1],a[i+2]=e[2],a[i+3]=e[3];const l=new Uint32Array(r.typedBuffer.buffer,r.start),h=n/4,c=l[i/=4];i+=h;const T=u*o;for(let f=1;f<T;++f)l[i]=c,i+=h}}function Or(s,e,t,r,i=1){const o=e.typedBuffer,a=e.typedBufferStride;if(r*=a,i===1)for(let n=0;n<t;++n)o[r]=s[0],o[r+1]=s[1],o[r+2]=s[2],o[r+3]=s[3],r+=a;else for(let n=0;n<t;++n)for(let u=0;u<i;++u)o[r]=s[0],o[r+1]=s[1],o[r+2]=s[2],o[r+3]=s[3],r+=a}function Ar(s,e,t,r,i,o){for(const a of e.fieldNames){const n=s.vertexAttributes.get(a),u=s.indices.get(a);if(n&&u)switch(a){case v.POSITION:{D(n.size===3);const l=i.getField(a,pe);D(!!l,`No buffer view for ${a}`),l&&Tr(u,n.data,t,l,o);break}case v.NORMAL:{D(n.size===3);const l=i.getField(a,pe);D(!!l,`No buffer view for ${a}`),l&&xr(u,n.data,r,l,o);break}case v.UV0:{D(n.size===2);const l=i.getField(a,gt);D(!!l,`No buffer view for ${a}`),l&&_r(u,n.data,l,o);break}case v.COLOR:case v.SYMBOLCOLOR:{D(n.size===3||n.size===4);const l=i.getField(a,xe);D(!!l,`No buffer view for ${a}`),l&&vr(u,n.data,n.size,l,o);break}case v.TANGENT:{D(n.size===4);const l=i.getField(a,Ie);D(!!l,`No buffer view for ${a}`),l&&br(u,n.data,r,l,o);break}case v.PROFILERIGHT:case v.PROFILEUP:case v.PROFILEVERTEXANDNORMAL:case v.FEATUREVALUE:{D(n.size===4);const l=i.getField(a,Ie);D(!!l,`No buffer view for ${a}`),l&&$t(u,n.data,l,o)}}else if(a===v.OBJECTANDLAYERIDCOLOR&&g(s.objectAndLayerIdColor)){const l=s.indices.get(v.POSITION);if(D(!!l,`No buffer view for ${a}`),l){const h=l.length,c=i.getField(a,xe);Or(s.objectAndLayerIdColor,c,h,o)}}}}const yr=Bs(Z.SRC_ALPHA,Z.ONE,Z.ONE_MINUS_SRC_ALPHA,Z.ONE_MINUS_SRC_ALPHA),Sr=At(Z.ONE,Z.ONE),Er=At(Z.ZERO,Z.ONE_MINUS_SRC_ALPHA);function Mr(s){return s===X.FrontFace?null:s===X.Alpha?Er:Sr}function So(s){return s===X.FrontFace?yt:null}const Rr=5e5,$r={factor:-1,units:-2};function Ir(s){return s?$r:null}function Pr(s,e=k.LESS){return s===X.NONE||s===X.FrontFace?e:k.LEQUAL}const Eo={func:k.LESS},Mo={func:k.ALWAYS},Lr={mask:255},Ro={mask:0},$o=s=>({function:{func:k.NOTEQUAL,ref:s,mask:s},operation:{fail:V.KEEP,zFail:V.KEEP,zPass:V.KEEP}}),Io=s=>({function:{func:k.ALWAYS,ref:s,mask:s},operation:{fail:V.KEEP,zFail:V.KEEP,zPass:V.REPLACE}}),Nr={function:{func:k.ALWAYS,ref:ee.OutlineVisualElementMask,mask:ee.OutlineVisualElementMask},operation:{fail:V.KEEP,zFail:V.KEEP,zPass:V.ZERO}},wr={function:{func:k.ALWAYS,ref:ee.OutlineVisualElementMask,mask:ee.OutlineVisualElementMask},operation:{fail:V.KEEP,zFail:V.KEEP,zPass:V.REPLACE}},Po={function:{func:k.EQUAL,ref:ee.OutlineVisualElementMask,mask:ee.OutlineVisualElementMask},operation:{fail:V.KEEP,zFail:V.KEEP,zPass:V.KEEP}},Lo={function:{func:k.NOTEQUAL,ref:ee.OutlineVisualElementMask,mask:ee.OutlineVisualElementMask},operation:{fail:V.KEEP,zFail:V.KEEP,zPass:V.KEEP}};class Cr{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(v.POSITION).length}write(e,t,r,i,o){Ar(r,this.vertexBufferLayout,e,t,i,o)}}let zr=class extends Ns{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=fe(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=te.Back,this.emissiveFactor=fe(0,0,0),this.instancedDoublePrecision=!1,this.normalType=me.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=fe(.2,.2,.2),this.diffuse=fe(.8,.8,.8),this.externalColor=js(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=$(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=He(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=be.Less,this.textureAlphaMode=q.Blend,this.textureAlphaCutoff=Ws,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=ys.Occlude}},wo=class extends Ls{constructor(){super(...arguments),this.origin=$(),this.slicePlaneLocalOrigin=this.origin}};class ve extends Ds{initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===Ks.WEBGL2,t.spherical=e.viewingMode===ke.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,t.textureCoordinateType=t.hasColorTexture||t.hasMetallicRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture||t.hasNormalTexture?Pe.Default:Pe.None,t.objectAndLayerIdColorInstanced=t.instanced}initializeProgram(e){return this._initializeProgram(e,ve.shader)}_initializeProgram(e,t){return new Vs(e.rctx,t.get().build(this.configuration),Ss)}_convertDepthTestFunction(e){return e===be.Lequal?k.LEQUAL:k.LESS}_makePipeline(e,t){const r=this.configuration,i=e===X.NONE,o=e===X.FrontFace;return Us({blending:r.output!==z.Color&&r.output!==z.Alpha||!r.transparent?null:i?yr:Mr(e),culling:Br(r)?qs(r.cullFace):null,depthTest:{func:Pr(e,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:(i||o)&&r.writeDepth?yt:null,colorWrite:Fs,stencilWrite:r.hasOccludees?Lr:null,stencilTest:r.hasOccludees?t?wr:Nr:null,polygonOffset:i||o?null:Ir(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}function Br(s){return s.cullFace!==te.None||!s.hasSlicePlane&&!s.transparent&&!s.doubleSidedMode}ve.shader=new St(hs,()=>Et(()=>import("./DefaultMaterial.glsl-184fa388.js"),["./DefaultMaterial.glsl-184fa388.js","./mat4f64-abdda1bb.js","./Matrix3PassUniform-0b3b1bba.js","./ShaderBuilder-7bfc11d2.js","./typedArrayUtil-ce39e5f4.js","./Error-685fdf30.js","./string-7a324480.js","./mat3f64-50f3b9f6.js","./vec3f32-01c06d8d.js","./vec3-015ca254.js","./common-d0b63c2d.js","./VertexAttribute-15d1866a.js","./mat4-4714ff8c.js","./MixExternalColor.glsl-99b269fe.js","./cast-8b575ab3.js","./ArrayPool-5813d861.js","./nextTick-3ee5a785.js","./promiseUtils-e37fe75d.js","./ForwardLinearDepth.glsl-a0929473.js","./View.glsl-03db830e.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-70e1e126.js","./vec2-8acac370.js","./vec2f64-f35767d6.js","./ShaderTechniqueConfiguration-ee770726.js","./symbolColorUtils-834d5fca.js","./mathUtils-5b623c84.js","./vec4-c7a19f0d.js","./PhysicallyBasedRendering.glsl-32dfb9c7.js","./FloatPassUniform-e3702139.js","./vec4f64-6d0e93be.js","./Float4PassUniform-7f3c3ce8.js","./RgbaFloatEncoding.glsl-4a25e2a7.js","./compilerUtils-175b9e40.js","./Texture2DDrawUniform-02720a73.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-5ee49495.js","./VisualVariablePassParameters-8cb0a75a.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-bf6b5582.js","./context-util-7ede29e5.js","./aaBoundingBox-04c58f5a.js","./Extent-680ef92a.js","./Ellipsoid-89682c5e.js","./aaBoundingRect-41e05474.js","./ViewingMode-5d7d590b.js","./Util-c12e93ba.js","./Slice.glsl-7975394d.js","./Transform.glsl-7294c426.js","./ObjectAndLayerIdColor.glsl-a64028da.js","./OutputDepth.glsl-f581dcdd.js","./OutputHighlight.glsl-08aacdf4.js","./VisualVariables.glsl-9e988d16.js","./DiscardOrAdjustAlphaBlend.glsl-f19054e7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-a6b20292.js","./Normals.glsl-0f400ece.js","./EvaluateSceneLighting.glsl-5da94bb7.js","./preload-helper-41c905a7.js","./SSAOBlur.glsl-7265df26.js","./ScreenSpacePass.glsl-fee70090.js","./ReadLinearDepth.glsl-53a01bc1.js","./SSAO.glsl-c9cc39dd.js","./DefaultMaterial.glsl-7d7dc23e.js","./VertexColor.glsl-79a8c465.js","./VerticalOffset.glsl-5354e013.js","./MultipassTerrainTest.glsl-43f42334.js"],import.meta.url));let d=class extends Qs{constructor(){super(...arguments),this.output=z.Color,this.alphaDiscardMode=q.Opaque,this.doubleSidedMode=ne.None,this.pbrMode=Te.Disabled,this.cullFace=te.None,this.transparencyPassType=X.NONE,this.normalType=me.Attribute,this.textureCoordinateType=Pe.None,this.customDepthTest=be.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};p([m({count:z.COUNT})],d.prototype,"output",void 0),p([m({count:q.COUNT})],d.prototype,"alphaDiscardMode",void 0),p([m({count:ne.COUNT})],d.prototype,"doubleSidedMode",void 0),p([m({count:Te.COUNT})],d.prototype,"pbrMode",void 0),p([m({count:te.COUNT})],d.prototype,"cullFace",void 0),p([m({count:X.COUNT})],d.prototype,"transparencyPassType",void 0),p([m({count:me.COUNT})],d.prototype,"normalType",void 0),p([m({count:Pe.COUNT})],d.prototype,"textureCoordinateType",void 0),p([m({count:be.COUNT})],d.prototype,"customDepthTest",void 0),p([m()],d.prototype,"spherical",void 0),p([m()],d.prototype,"hasVertexColors",void 0),p([m()],d.prototype,"hasSymbolColors",void 0),p([m()],d.prototype,"hasVerticalOffset",void 0),p([m()],d.prototype,"hasSlicePlane",void 0),p([m()],d.prototype,"hasSliceHighlight",void 0),p([m()],d.prototype,"hasColorTexture",void 0),p([m()],d.prototype,"hasMetallicRoughnessTexture",void 0),p([m()],d.prototype,"hasEmissionTexture",void 0),p([m()],d.prototype,"hasOcclusionTexture",void 0),p([m()],d.prototype,"hasNormalTexture",void 0),p([m()],d.prototype,"hasScreenSizePerspective",void 0),p([m()],d.prototype,"hasVertexTangents",void 0),p([m()],d.prototype,"hasOccludees",void 0),p([m()],d.prototype,"hasMultipassTerrain",void 0),p([m()],d.prototype,"hasModelTransformation",void 0),p([m()],d.prototype,"offsetBackfaces",void 0),p([m()],d.prototype,"vvSize",void 0),p([m()],d.prototype,"vvColor",void 0),p([m()],d.prototype,"receiveShadows",void 0),p([m()],d.prototype,"receiveAmbientOcclusion",void 0),p([m()],d.prototype,"textureAlphaPremultiplied",void 0),p([m()],d.prototype,"instanced",void 0),p([m()],d.prototype,"instancedColor",void 0),p([m()],d.prototype,"objectAndLayerIdColorInstanced",void 0),p([m()],d.prototype,"instancedDoublePrecision",void 0),p([m()],d.prototype,"doublePrecisionRequiresObfuscation",void 0),p([m()],d.prototype,"writeDepth",void 0),p([m()],d.prototype,"transparent",void 0),p([m()],d.prototype,"enableOffset",void 0),p([m()],d.prototype,"cullAboveGround",void 0),p([m()],d.prototype,"snowCover",void 0),p([m()],d.prototype,"hasColorTextureTransform",void 0),p([m()],d.prototype,"hasEmissionTextureTransform",void 0),p([m()],d.prototype,"hasNormalTextureTransform",void 0),p([m()],d.prototype,"hasOcclusionTextureTransform",void 0),p([m()],d.prototype,"hasMetallicRoughnessTextureTransform",void 0),p([m({constValue:!0})],d.prototype,"hasVvInstancing",void 0),p([m({constValue:!1})],d.prototype,"useCustomDTRExponentForWater",void 0),p([m({constValue:!1})],d.prototype,"supportsTextureAtlas",void 0),p([m({constValue:!0})],d.prototype,"useFillLights",void 0);let It=class Pt extends ve{initializeConfiguration(e,t){super.initializeConfiguration(e,t),t.hasMetallicRoughnessTexture=!1,t.hasEmissionTexture=!1,t.hasOcclusionTexture=!1,t.hasNormalTexture=!1,t.hasModelTransformation=!1,t.normalType=me.Attribute,t.doubleSidedMode=ne.WindingOrder,t.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,Pt.shader)}};It.shader=new St(Ys,()=>Et(()=>import("./RealisticTree.glsl-b8d5729b.js"),["./RealisticTree.glsl-b8d5729b.js","./Matrix3PassUniform-0b3b1bba.js","./ShaderBuilder-7bfc11d2.js","./typedArrayUtil-ce39e5f4.js","./Error-685fdf30.js","./string-7a324480.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./vec3f32-01c06d8d.js","./vec3-015ca254.js","./common-d0b63c2d.js","./VertexAttribute-15d1866a.js","./mat4-4714ff8c.js","./MixExternalColor.glsl-99b269fe.js","./cast-8b575ab3.js","./ArrayPool-5813d861.js","./nextTick-3ee5a785.js","./promiseUtils-e37fe75d.js","./ForwardLinearDepth.glsl-a0929473.js","./View.glsl-03db830e.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-70e1e126.js","./vec2-8acac370.js","./vec2f64-f35767d6.js","./ShaderTechniqueConfiguration-ee770726.js","./symbolColorUtils-834d5fca.js","./mathUtils-5b623c84.js","./vec4-c7a19f0d.js","./PhysicallyBasedRendering.glsl-32dfb9c7.js","./FloatPassUniform-e3702139.js","./vec4f64-6d0e93be.js","./Float4PassUniform-7f3c3ce8.js","./RgbaFloatEncoding.glsl-4a25e2a7.js","./compilerUtils-175b9e40.js","./Texture2DDrawUniform-02720a73.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-5ee49495.js","./VisualVariablePassParameters-8cb0a75a.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-bf6b5582.js","./context-util-7ede29e5.js","./aaBoundingBox-04c58f5a.js","./Extent-680ef92a.js","./Ellipsoid-89682c5e.js","./aaBoundingRect-41e05474.js","./ViewingMode-5d7d590b.js","./Util-c12e93ba.js","./Slice.glsl-7975394d.js","./Transform.glsl-7294c426.js","./ObjectAndLayerIdColor.glsl-a64028da.js","./OutputDepth.glsl-f581dcdd.js","./OutputHighlight.glsl-08aacdf4.js","./VisualVariables.glsl-9e988d16.js","./DiscardOrAdjustAlphaBlend.glsl-f19054e7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-a6b20292.js","./EvaluateSceneLighting.glsl-5da94bb7.js","./preload-helper-41c905a7.js","./SSAOBlur.glsl-7265df26.js","./ScreenSpacePass.glsl-fee70090.js","./ReadLinearDepth.glsl-53a01bc1.js","./SSAO.glsl-c9cc39dd.js","./RealisticTree.glsl-1e8f0ea9.js","./VertexColor.glsl-79a8c465.js","./VerticalOffset.glsl-5354e013.js","./MultipassTerrainTest.glsl-43f42334.js"],import.meta.url));let Le=class extends Es{constructor(e){super(e,Ur),this.supportsEdges=!0,this._configuration=new d,this._vertexBufferLayout=qr(this.parameters)}isVisibleForOutput(e){return e!==z.Shadow&&e!==z.ShadowExcludeHighlight&&e!==z.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{instanced:t,hasVertexColors:r,hasSymbolColors:i,vvColorEnabled:o}=e,a=g(t)&&t.includes("color"),n=e.colorMixMode==="replace",u=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0;return r&&(a||o||i)?!!n||u:r?n?l:u:a||o||i?!!n||u:n?l:u}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=!!this.parameters.instanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.hasVerticalOffset=g(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=g(this.parameters.screenSizePerspective),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,g(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?te.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=g(this.parameters.modelTransformation),e!==z.Color&&e!==z.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=ne.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?ne.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?ne.WindingOrder:ne.None,this._configuration.instancedColor=g(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!t.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Te.Schematic:Te.Normal:Te.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<Rr,this._configuration.snowCover=this.hasSnowCover(t),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return g(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,t,r,i,o,a){if(g(this.parameters.verticalOffset)){const n=r.camera;j(Ve,t[12],t[13],t[14]);let u=null;switch(r.viewingMode){case ke.Global:u=pt(ht,Ve);break;case ke.Local:u=Wt(ht,Hr)}let l=0;const h=le(Gr,Ve,n.eye),c=Ge(h),T=W(h,h,1/c);let f=null;this.parameters.screenSizePerspective&&(f=Kt(u,T)),l+=Ms(n,c,this.parameters.verticalOffset,f??0,this.parameters.screenSizePerspective),W(u,u,l),Qt(De,u,r.transform.inverseRotation),i=le(Fr,i,De),o=le(kr,o,De)}Rs(e,r,i,o,er(r.verticalOffset),a)}requiresSlot(e,t){return t===z.Color||t===z.Alpha||t===z.Depth||t===z.Normal||t===z.Shadow||t===z.ShadowHighlight||t===z.ShadowExcludeHighlight||t===z.Highlight||t===z.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?de.TRANSPARENT_MATERIAL:de.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:de.OPAQUE_MATERIAL)||e===de.DRAPED_MATERIAL:!1}createGLMaterial(e){return new Dr(e)}createBufferWriter(){return new Cr(this._vertexBufferLayout)}},Dr=class extends sr{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==z.Color&&this._output!==z.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const t=this._material.parameters;this.updateTexture(t.textureId);const r=e.camera.viewInverseTransposeMatrix;return j(t.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(t.treeRendering?It:ve,e)}},Vr=class extends zr{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const Ur=new Vr;function qr(s){const e=Cs().vec3f(v.POSITION).vec3f(v.NORMAL),t=s.textureId||s.normalTextureId||s.metallicRoughnessTextureId||s.emissiveTextureId||s.occlusionTextureId;return s.hasVertexTangents&&e.vec4f(v.TANGENT),t&&e.vec2f(v.UV0),s.hasVertexColors&&e.vec4u8(v.COLOR),s.hasSymbolColors&&e.vec4u8(v.SYMBOLCOLOR),ws("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(v.OBJECTANDLAYERIDCOLOR),e}const Fr=$(),kr=$(),Hr=fe(0,0,1),ht=$(),De=$(),Ve=$(),Gr=$();function ge(s){if(Y(s))return null;const e=g(s.offset)?s.offset:fs,t=g(s.rotation)?s.rotation:0,r=g(s.scale)?s.scale:ds,i=Ce(1,0,0,0,1,0,e[0],e[1],1),o=Ce(Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1),a=Ce(r[0],0,0,0,r[1],0,0,0,1),n=cs();return je(n,o,a),je(n,i,n),n}class jr{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class Wr{constructor(e,t,r){this.name=e,this.lodThreshold=t,this.pivotOffset=r,this.stageResources=new jr,this.numberOfVertices=0}}const K=gs.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function Kr(s,e){const t=await Qr(s,e),r=await ei(t.textureDefinitions??{},e);let i=0;for(const o in r)if(r.hasOwnProperty(o)){const a=r[o];i+=a!=null&&a.image?a.image.width*a.image.height*4:0}return{resource:t,textures:r,size:i+ms(t)}}async function Qr(s,e){const t=g(e)&&e.streamDataRequester;if(t)return Yr(s,t,e);const r=await _t(ps(s,Vt(e)));if(r.ok===!0)return r.value.data;Tt(r.error),Lt(r.error)}async function Yr(s,e,t){const r=await _t(e.request(s,"json",t));if(r.ok===!0)return r.value;Tt(r.error),Lt(r.error.details.url)}function Lt(s){throw new _s("",`Request for object resource failed: ${s}`)}function Xr(s){const e=s.params,t=e.topology;let r=!0;switch(e.vertexAttributes||(K.warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const o=e.faces;if(o){if(e.vertexAttributes)for(const a in e.vertexAttributes){const n=o[a];n&&n.values?(n.valueType!=null&&n.valueType!=="UInt32"&&(K.warn(`Unsupported indexed geometry indices type '${n.valueType}', only UInt32 is currently supported`),r=!1),n.valuesPerElement!=null&&n.valuesPerElement!==1&&(K.warn(`Unsupported indexed geometry values per element '${n.valuesPerElement}', only 1 is currently supported`),r=!1)):(K.warn(`Indexed geometry does not specify face indices for '${a}' attribute`),r=!1)}}else K.warn("Indexed geometries must specify faces"),r=!1;break}default:K.warn(`Unsupported topology '${t}'`),r=!1}s.params.material||(K.warn("Geometry requires material"),r=!1);const i=s.params.vertexAttributes;for(const o in i)i[o].values||(K.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function Jr(s,e){const t=new Array,r=new Array,i=new Array,o=new gr,a=s.resource,n=xt.parse(a.version||"1.0","wosr");si.validate(n);const u=a.model.name,l=a.model.geometries,h=a.materialDefinitions??{},c=s.textures;let T=0;const f=new Map;for(let _=0;_<l.length;_++){const b=l[_];if(!Xr(b))continue;const x=ti(b),R=b.params.vertexAttributes,w=[];for(const O in R){const y=R[O],C=y.values;w.push([O,new ce(C,y.valuesPerElement,!0)])}const L=[];if(b.params.topology!=="PerAttributeArray"){const O=b.params.faces;for(const y in O)L.push([y,O[y].values])}const P=x.texture,N=c&&c[P];if(N&&!f.has(P)){const{image:O,params:y}=N,C=new bt(O,y);r.push(C),f.set(P,C)}const I=f.get(P),M=I?I.id:void 0,S=x.material;let E=o.get(S,P);if(Y(E)){const O=h[S.substring(S.lastIndexOf("/")+1)].params;O.transparency===1&&(O.transparency=0);const y=N&&N.alphaChannelUsage,C=O.transparency>0||y==="transparency"||y==="maskAndTransparency",H=N?Nt(N.alphaChannelUsage):void 0,U={ambient:Je(O.diffuse),diffuse:Je(O.diffuse),opacity:1-(O.transparency||0),transparent:C,textureAlphaMode:H,textureAlphaCutoff:.33,textureId:M,initTextureTransparent:!0,doubleSided:!0,cullFace:te.None,colorMixMode:O.externalColorMixMode||"tint",textureAlphaPremultiplied:!!N&&!!N.params.preMultiplyAlpha};g(e)&&e.materialParamsMixin&&Object.assign(U,e.materialParamsMixin),E=new Le(U),o.set(S,P,E)}i.push(E);const A=new Ne(E,w,L);T+=L.position?L.position.length:0,t.push(A)}return{engineResources:[{name:u,stageResources:{textures:r,materials:i,geometries:t},pivotOffset:a.model.pivotOffset,numberOfVertices:T,lodThreshold:null}],referenceBoundingBox:Zr(t)}}function Zr(s){const e=mt();return s.forEach(t=>{const r=t.boundingInfo;g(r)&&($e(e,r.bbMin),$e(e,r.bbMax))}),e}async function ei(s,e){const t=[];for(const o in s){const a=s[o],n=a.images[0].data;if(!n){K.warn("Externally referenced texture data is not yet supported");continue}const u=a.encoding+";base64,"+n,l="/textureDefinitions/"+o,h=a.channels==="rgba"?a.alphaChannelUsage||"transparency":"none",c={noUnpackFlip:!0,wrap:{s:it.REPEAT,t:it.REPEAT},preMultiplyAlpha:Nt(h)!==q.Opaque},T=g(e)&&e.disableTextures?Promise.resolve(null):xs(u,e);t.push(T.then(f=>({refId:l,image:f,params:c,alphaChannelUsage:h})))}const r=await Promise.all(t),i={};for(const o of r)i[o.refId]=o;return i}function Nt(s){switch(s){case"mask":return q.Mask;case"maskAndTransparency":return q.MaskBlend;case"none":return q.Opaque;default:return q.Blend}}function ti(s){const e=s.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const si=new xt(1,2,"wosr");async function ri(s,e){const t=wt(zt(s));if(t.fileType==="wosr"){const c=await(e.cache?e.cache.loadWOSR(t.url,e):Kr(t.url,e)),{engineResources:T,referenceBoundingBox:f}=Jr(c,e);return{lods:T,referenceBoundingBox:f,isEsriSymbolResource:!1,isWosr:!0}}const r=await(e.cache?e.cache.loadGLTF(t.url,e,!!e.usePBR):ts(new ss(e.streamDataRequester),t.url,e,e.usePBR)),i=Ut(r.model.meta,"ESRI_proxyEllipsoid"),o=r.meta.isEsriSymbolResource&&g(i)&&r.meta.uri.includes("/RealisticTrees/");o&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,li(r,i));const a=!!e.usePBR,n=r.meta.isEsriSymbolResource?{usePBR:a,isSchematic:!1,treeRendering:o,mrrFactors:[0,1,.2]}:{usePBR:a,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},u={...e.materialParamsMixin,treeRendering:o},{engineResources:l,referenceBoundingBox:h}=Ct(r,n,u,e.skipHighLods&&t.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:t.specifiedLodIndex});return{lods:l,referenceBoundingBox:h,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function wt(s){const e=s.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:s.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:s,specifiedLodIndex:null}:{fileType:"unknown",url:s,specifiedLodIndex:null}}function Ct(s,e,t,r){const i=s.model,o=new Array,a=new Map,n=new Map,u=i.lods.length,l=mt();return i.lods.forEach((h,c)=>{const T=r.skipHighLods===!0&&(u>1&&c===0||u>3&&c===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&c!==r.singleLodIndex;if(T&&c!==0)return;const f=new Wr(h.name,h.lodThreshold,[0,0,0]);h.parts.forEach(_=>{const b=T?new Le({}):ii(i,_,f,e,t,a,n),{geometry:x,vertexCount:R}=oi(_,g(b)?b:new Le({})),w=x.boundingInfo;g(w)&&c===0&&($e(l,w.bbMin),$e(l,w.bbMax)),g(b)&&(f.stageResources.geometries.push(x),f.numberOfVertices+=R)}),T||o.push(f)}),{engineResources:o,referenceBoundingBox:l}}function ii(s,e,t,r,i,o,a){const n=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),u=s.materials.get(e.material),l=g(e.attributes.texCoord0),h=g(e.attributes.normal);if(Y(u))return null;const c=ai(u.alphaMode);if(!o.has(n)){if(l){const P=(N,I=!1)=>{if(g(N)&&!a.has(N)){const M=s.textures.get(N);if(g(M)){const S=M.data;a.set(N,new bt(we(S)?S.data:S,{...M.parameters,preMultiplyAlpha:!we(S)&&I,encoding:we(S)&&g(S.encoding)?S.encoding:void 0}))}}};P(u.textureColor,c!==q.Opaque),P(u.textureNormal),P(u.textureOcclusion),P(u.textureEmissive),P(u.textureMetallicRoughness)}const f=u.color[0]**(1/ue),_=u.color[1]**(1/ue),b=u.color[2]**(1/ue),x=u.emissiveFactor[0]**(1/ue),R=u.emissiveFactor[1]**(1/ue),w=u.emissiveFactor[2]**(1/ue),L=g(u.textureColor)&&l?a.get(u.textureColor):null;o.set(n,new Le({...r,transparent:c===q.Blend,customDepthTest:be.Lequal,textureAlphaMode:c,textureAlphaCutoff:u.alphaCutoff,diffuse:[f,_,b],ambient:[f,_,b],opacity:u.opacity,doubleSided:u.doubleSided,doubleSidedType:"winding-order",cullFace:u.doubleSided?te.None:te.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:h?me.Attribute:me.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:g(L)?L.id:void 0,colorMixMode:u.colorMixMode,normalTextureId:g(u.textureNormal)&&l?a.get(u.textureNormal).id:void 0,textureAlphaPremultiplied:g(L)&&!!L.params.preMultiplyAlpha,occlusionTextureId:g(u.textureOcclusion)&&l?a.get(u.textureOcclusion).id:void 0,emissiveTextureId:g(u.textureEmissive)&&l?a.get(u.textureEmissive).id:void 0,metallicRoughnessTextureId:g(u.textureMetallicRoughness)&&l?a.get(u.textureMetallicRoughness).id:void 0,emissiveFactor:[x,R,w],mrrFactors:[u.metallicFactor,u.roughnessFactor,r.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:ge(u.colorTextureTransform),normalTextureTransformMatrix:ge(u.normalTextureTransform),occlusionTextureTransformMatrix:ge(u.occlusionTextureTransform),emissiveTextureTransformMatrix:ge(u.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:ge(u.metallicRoughnessTextureTransform),...i}))}const T=o.get(n);if(t.stageResources.materials.push(T),l){const f=_=>{g(_)&&t.stageResources.textures.push(a.get(_))};f(u.textureColor),f(u.textureNormal),f(u.textureOcclusion),f(u.textureEmissive),f(u.textureMetallicRoughness)}return T}function oi(s,e){const t=s.attributes.position.count,r=ni(s.indices||t,s.primitiveType),i=ae(pe,t);Jt(i,s.attributes.position,s.transform);const o=[[v.POSITION,new ce(i.typedBuffer,i.elementCount,!0)]],a=[[v.POSITION,r]];if(g(s.attributes.normal)){const n=ae(pe,t);We(Me,s.transform),Zt(n,s.attributes.normal,Me),o.push([v.NORMAL,new ce(n.typedBuffer,n.elementCount,!0)]),a.push([v.NORMAL,r])}if(g(s.attributes.tangent)){const n=ae(Ie,t);We(Me,s.transform),rs(n,s.attributes.tangent,Me),o.push([v.TANGENT,new ce(n.typedBuffer,n.elementCount,!0)]),a.push([v.TANGENT,r])}if(g(s.attributes.texCoord0)){const n=ae(gt,t);is(n,s.attributes.texCoord0),o.push([v.UV0,new ce(n.typedBuffer,n.elementCount,!0)]),a.push([v.UV0,r])}if(g(s.attributes.color)){const n=ae(xe,t);if(s.attributes.color.elementCount===4)s.attributes.color instanceof Ie?st(n,s.attributes.color,255):s.attributes.color instanceof xe?os(n,s.attributes.color):s.attributes.color instanceof Yt&&st(n,s.attributes.color,1/256);else{as(n,255,255,255,255);const u=new et(n.buffer,0,4);s.attributes.color instanceof pe?tt(u,s.attributes.color,255):s.attributes.color instanceof et?es(u,s.attributes.color):s.attributes.color instanceof Xt&&tt(u,s.attributes.color,1/256)}o.push([v.COLOR,new ce(n.typedBuffer,n.elementCount,!0)]),a.push([v.COLOR,r])}return{geometry:new Ne(e,o,a),vertexCount:t}}const Me=He();function ai(s){switch(s){case"BLEND":return q.Blend;case"MASK":return q.Mask;case"OPAQUE":case null:case void 0:return q.Opaque}}function ni(s,e){switch(e){case ze.TRIANGLES:return us(s);case ze.TRIANGLE_STRIP:return ls(s);case ze.TRIANGLE_FAN:return ns(s)}}function li(s,e){for(let t=0;t<s.model.lods.length;++t){const r=s.model.lods[t];for(const i of r.parts){const o=i.attributes.normal;if(Y(o))return;const a=i.attributes.position,n=a.count,u=$(),l=$(),h=$(),c=ae(xe,n),T=ae(pe,n),f=ct(_e(),i.transform);for(let _=0;_<n;_++){a.getVec(_,l),o.getVec(_,u),qe(l,l,i.transform),le(h,l,e.center),Ze(h,h,e.radius);const b=h[2],x=Ge(h),R=Math.min(.45+.55*x*x,1);Ze(h,h,e.radius),f!==null&&qe(h,h,f),pt(h,h),t+1!==s.model.lods.length&&s.model.lods.length>1&&Ue(h,h,u,b>-1?.2:Math.min(-4*b-3.8,1)),T.setVec(_,h),c.set(_,0,255*R),c.set(_,1,255*R),c.set(_,2,255*R),c.set(_,3,255)}i.attributes.normal=T,i.attributes.color=c}}}const Uo=Object.freeze(Object.defineProperty({__proto__:null,fetch:ri,gltfToEngineResources:Ct,parseUrl:wt},Symbol.toStringTag,{value:"Module"}));export{Mr as A,Cr as B,Le as C,Ar as D,de as E,ge as F,wo as G,vo as H,ri as I,xo as J,Kr as K,$o as L,po as M,Or as N,vr as O,Po as P,Io as Q,or as R,Rr as S,Er as T,Ao as U,fo as V,Uo as W,$r as _,$t as a,xr as b,dr as c,tr as d,yr as e,So as f,Tr as g,sr as h,Lr as i,mo as j,wr as k,Pr as l,Nr as m,fr as n,rr as o,yo as p,Lo as q,cr as r,Mo as s,gr as t,ao as u,Ne as v,Ro as w,Eo as x,er as y,Ir as z};
