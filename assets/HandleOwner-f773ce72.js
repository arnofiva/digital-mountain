import{e as a,v as u,t as m,f as y,y as o,a as c}from"./cast-8b575ab3.js";import{t as v}from"./typedArrayUtil-ce39e5f4.js";import{l as _,f as H,a as p,U as $}from"./reactiveUtils-042dd05a.js";let h=class extends u{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new m,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,t,s={}){return this._installWatch(e,t,s,_)}addWhen(e,t,s={}){return this._installWatch(e,t,s,H)}addOnCollectionChange(e,t,{initial:s=!1,final:n=!1}={}){const d=++this._handleId;return this._handles.add([p(e,"after-changes",this._createSyncUpdatingCallback(),$),p(e,"change",t,{onListenerAdd:s?i=>t({added:i.toArray(),removed:[]}):void 0,onListenerRemove:n?i=>t({added:[],removed:i.toArray()}):void 0})],d),{remove:()=>this._handles.remove(d)}}addPromise(e){if(v(e))return e;const t=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(r)||this._set("updating",!1))}},t),this._pendingPromises.add(e),this._set("updating",!0);const s=()=>this._handles.remove(t);return e.then(s,s),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,s={},n){const d=++this._handleId;s.sync||this._installSyncUpdatingWatch(e,d);const i=n(e,t,s);return this._handles.add(i,d),{remove:()=>this._handles.remove(d)}}_installSyncUpdatingWatch(e,t){const s=this._createSyncUpdatingCallback(),n=_(e,s,{sync:!0,equals:()=>!1});return this._handles.add(n,t),n}_createSyncUpdatingCallback(){return()=>{this._handles.remove(r),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(y(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(r))}),r)}}};a([o({readOnly:!0})],h.prototype,"updating",void 0),h=a([c("esri.core.support.WatchUpdatingTracking")],h);const r=-42,f=l=>{let e=class extends l{destroy(){var t,s;this.destroyed||((t=this._get("handles"))==null||t.destroy(),(s=this._get("updatingHandles"))==null||s.destroy())}get handles(){return this._get("handles")||new m}get updatingHandles(){return this._get("updatingHandles")||new h}};return a([o({readOnly:!0})],e.prototype,"handles",null),a([o({readOnly:!0})],e.prototype,"updatingHandles",null),e=a([c("esri.core.HandleOwner")],e),e};let g=class extends f(u){};g=a([c("esri.core.HandleOwner")],g);export{f as a,h as c,g as d};
