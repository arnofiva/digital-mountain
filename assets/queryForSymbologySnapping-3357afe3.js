import"./geometry-bad16232.js";import{t as I,r as $}from"./typedArrayUtil-ce39e5f4.js";import{f as R}from"./promiseUtils-e37fe75d.js";import{M as C}from"./dehydratedFeatures-55779981.js";import{a as q}from"./elevationInfoUtils-ab005f9a.js";import{h as z,i as F,aj as G,a7 as O,ak as E}from"./index-334863ed.js";import{f as P}from"./Extent-680ef92a.js";import{i as k}from"./arcadeOnDemand-a1bf65ec.js";async function L(r,p,d,f,s){const{elevationProvider:m,renderCoordsHelper:i,spatialReference:b}=r,{elevationInfo:g}=p,y=z(g,!0),w=await F(y,b,s);R(s);const c=[],u=new Set,l=new Set;for(const{objectId:e,points:n}of f){const t=d(e);if(I(t)){for(const a of n)c.push(a[2]);u.add(e);continue}t.isDraped&&l.add(e);const o=t.graphic.geometry;S.setFromElevationInfo(q(o,g)),S.updateFeatureExpressionInfoContext(w,t.graphic,p),h.spatialReference=r.spatialReference;for(const{x:a,y:x,z:D}of n)h.x=a,h.y=x,h.z=D??0,G(h,m,S,i,j),c.push(j.z)}return{elevations:c,drapedObjectIds:l,failedObjectIds:u}}const S=new O,h=C(0,0,0,P.WGS84),j=new E;async function N(r,p,d){if(I(r)||p.candidates.length===0)return v;const f=r.graphics3DGraphicsByObjectID??r.graphics3DGraphics,s=[],m=[],{renderer:i}=r,b=$(i)&&"arcadeRequired"in i&&i.arcadeRequired?k():null,g=async(e,{graphic:n,graphics3DSymbol:t})=>{const o=await b,a=await r.getRenderingInfoAsync(n,i,o,{signal:d});return I(a)?[]:t.queryForSnapping(e,w,a,d)},{candidates:y,spatialReference:w}=p;for(let e=0;e<y.length;++e){const n=y[e],{objectId:t}=n,o=typeof t=="number"?f==null?void 0:f.get(t):void 0;if(I(o))continue;const{graphics3DSymbol:a}=o;a.symbologySnappingSupported&&(s.push(g(n,o)),m.push(e))}if(s.length===0)return v;const c=await Promise.all(s);R(d);const u=[],l=[];for(let e=0;e<c.length;++e){const n=c[e],t=m[e];for(const o of n)u.push(o),l.push(t)}return{candidates:u,sourceCandidateIndices:l}}const v={candidates:[],sourceCandidateIndices:[]};export{N as a,L as m};
