import{s as en,a as j}from"./Error-685fdf30.js";import{t as Z,i as sn,r as G}from"./typedArrayUtil-ce39e5f4.js";import{w as un,q as cn}from"./aaBoundingBox-04c58f5a.js";import{o as ln}from"./aaBoundingRect-41e05474.js";import{s as fn,y as an,f as hn,l as dn}from"./jsonUtils-03437bcd.js";import{t as P,s as x}from"./OptimizedFeature-7f37a325.js";import{e as mn}from"./OptimizedFeatureSet-1d1ac4b9.js";function p(n,r){return n?r?4:3:r?3:2}const k=en.getLogger("esri.layers.graphics.featureConversionUtils"),J={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},gn=(n,r,o,t,s,e)=>{n[o]=s,n[o+1]=e},B=(n,r,o,t,s,e)=>{n[o]=s,n[o+1]=e,n[o+2]=r[t+2]},yn=(n,r,o,t,s,e)=>{n[o]=s,n[o+1]=e,n[o+2]=r[t+3]},pn=(n,r,o,t,s,e)=>{n[o]=s,n[o+1]=e,n[o+2]=r[t+2],n[o+3]=r[t+3]};function S(n,r,o,t){if(n){if(o)return r&&t?pn:B;if(r&&t)return yn}else if(r&&t)return B;return gn}function E({scale:n,translate:r},o){return Math.round((o-r[0])/n[0])}function L({scale:n,translate:r},o){return Math.round((r[1]-o)/n[1])}function U({scale:n,translate:r},o,t){return o*n[t]+r[t]}function An(n,r,o){return n?r?o?_(n):V(n):o?Y(n):z(n):null}function z(n){const r=n.coords;return{x:r[0],y:r[1]}}function K(n,r){return n.coords[0]=r.x,n.coords[1]=r.y,n}function V(n){const r=n.coords;return{x:r[0],y:r[1],z:r[2]}}function wn(n,r){return n.coords[0]=r.x,n.coords[1]=r.y,n.coords[2]=r.z,n}function Y(n){const r=n.coords;return{x:r[0],y:r[1],m:r[2]}}function bn(n,r){return n.coords[0]=r.x,n.coords[1]=r.y,n.coords[2]=r.m,n}function _(n){const r=n.coords;return{x:r[0],y:r[1],z:r[2],m:r[3]}}function In(n,r){return n.coords[0]=r.x,n.coords[1]=r.y,n.coords[2]=r.z,n.coords[3]=r.m,n}function Mn(n,r,o,t){let s=z;o&&t?s=_:o?s=V:t&&(s=Y);for(const e of r){const{geometry:u,attributes:c}=e,l=G(u)?s(u):null;n.push({attributes:c,geometry:l})}return n}function A(n,r){return n&&r?In:n?wn:r?bn:K}function Gn(n,r,o,t,s){const e=A(o,t);for(const{geometry:u,attributes:c}of r){const l=G(u)?e(new P,u):null;n.push(new x(l,c,null,s?c[s]:void 0))}return n}function Cn(n,r,o=A(r.z!=null,r.m!=null)){return o(n,r)}function Tn(n,r,o,t){for(const{geometry:s,attributes:e}of r)n.push({attributes:e,geometry:G(s)?Q(s,o,t):null});return n}function Q(n,r,o){if(Z(n))return null;const t=p(r,o),s=[];for(let e=0;e<n.coords.length;e+=t){const u=[];for(let c=0;c<t;c++)u.push(n.coords[e+c]);s.push(u)}return r?o?{points:s,hasZ:r,hasM:o}:{points:s,hasZ:r}:o?{points:s,hasM:o}:{points:s}}function Nn(n,r,o,t,s){const e=p(o,t);for(const{geometry:u,attributes:c}of r){const l=G(u)?W(new P,u,e):null;n.push(new x(l,c,null,s?c[s]:void 0))}return n}function W(n,r,o=p(r.hasZ,r.hasM)){n.lengths[0]=r.points.length;const t=n.coords;let s=0;for(const e of r.points)for(let u=0;u<o;u++)t[s++]=e[u];return n}function Pn(n,r,o,t){for(const{geometry:s,attributes:e}of r)n.push({attributes:e,geometry:G(s)?X(s,o,t):null});return n}function X(n,r,o){if(!n)return null;const t=p(r,o),{coords:s,lengths:e}=n,u=[];let c=0;for(const l of e){const i=[];for(let f=0;f<l;f++){const a=[];for(let h=0;h<t;h++)a.push(s[c++]);i.push(a)}u.push(i)}return r?o?{paths:u,hasZ:r,hasM:o}:{paths:u,hasZ:r}:o?{paths:u,hasM:o}:{paths:u}}function Zn(n,r,o,t,s){const e=p(o,t);for(const{geometry:u,attributes:c}of r){const l=G(u)?$(new P,u,e):null;n.push(new x(l,c,null,s?c[s]:void 0))}return n}function $(n,r,o=p(r.hasZ,r.hasM)){const{lengths:t,coords:s}=n;let e=0;for(const u of r.paths){for(const c of u)for(let l=0;l<o;l++)s[e++]=c[l];t.push(u.length)}return n}function Fn(n,r,o,t){for(const{geometry:s,attributes:e,centroid:u}of r){const c=G(s)?nn(s,o,t):null;if(G(u)){const l=z(u);n.push({attributes:e,centroid:l,geometry:c})}else n.push({attributes:e,geometry:c})}return n}function nn(n,r,o){if(!n)return null;const t=p(r,o),{coords:s,lengths:e}=n,u=[];let c=0;for(const l of e){const i=[];for(let f=0;f<l;f++){const a=[];for(let h=0;h<t;h++)a.push(s[c++]);i.push(a)}u.push(i)}return r?o?{rings:u,hasZ:r,hasM:o}:{rings:u,hasZ:r}:o?{rings:u,hasM:o}:{rings:u}}function xn(n,r,o,t,s){for(const{geometry:e,centroid:u,attributes:c}of r){const l=G(e)?rn(new P,e,o,t):null,i=s?c[s]:void 0;G(u)?n.push(new x(l,c,K(new P,u),i)):n.push(new x(l,c,null,i))}return n}function rn(n,r,o=r.hasZ,t=r.hasM){return vn(n,r.rings,o,t),n}function vn(n,r,o,t){const s=p(o,t),{lengths:e,coords:u}=n;let c=0;N(n);for(const l of r){for(const i of l)for(let f=0;f<s;f++)u[c++]=i[f];e.push(l.length)}return n}const F=[],v=[];function On(n,r,o,t,s){F[0]=n;const[e]=on(v,F,r,o,t,s);return T(F),T(v),e}function on(n,r,o,t,s,e){if(T(n),!o){for(const u of r){const c=e?u.attributes[e]:void 0;n.push(new x(null,u.attributes,null,c))}return n}switch(o){case"esriGeometryPoint":return Gn(n,r,t,s,e);case"esriGeometryMultipoint":return Nn(n,r,t,s,e);case"esriGeometryPolyline":return Zn(n,r,t,s,e);case"esriGeometryPolygon":return xn(n,r,t,s,e);default:k.error("convertToFeatureSet:unknown-geometry",new j(`Unable to parse unknown geometry type '${o}'`)),T(n)}return n}function Bn(n,r,o,t){v[0]=n,tn(F,v,r,o,t);const s=F[0];return T(F),T(v),s}function Dn(n,r,o){if(Z(n))return null;const t=new P;return"hasZ"in n&&r==null&&(r=n.hasZ),"hasM"in n&&o==null&&(o=n.hasM),fn(n)?A(r??n.z!=null,o??n.m!=null)(t,n):an(n)?rn(t,n,r,o):hn(n)?$(t,n,p(r,o)):dn(n)?W(t,n,p(r,o)):void k.error("convertFromGeometry:unknown-geometry",new j(`Unable to parse unknown geometry type '${n}'`))}function jn(n,r,o,t){const s=n&&("coords"in n?n:n.geometry);if(Z(s))return null;switch(r){case"esriGeometryPoint":{let e=z;return o&&t?e=_:o?e=V:t&&(e=Y),e(s)}case"esriGeometryMultipoint":return Q(s,o,t);case"esriGeometryPolyline":return X(s,o,t);case"esriGeometryPolygon":return nn(s,o,t);default:return k.error("convertToGeometry:unknown-geometry",new j(`Unable to parse unknown geometry type '${r}'`)),null}}function kn(n,r){for(const o of r)n.push({attributes:o.attributes});return n}function tn(n,r,o,t,s){if(T(n),Z(o))return kn(n,r);switch(o){case"esriGeometryPoint":return Mn(n,r,t,s);case"esriGeometryMultipoint":return Tn(n,r,t,s);case"esriGeometryPolyline":return Pn(n,r,t,s);case"esriGeometryPolygon":return Fn(n,r,t,s);default:k.error("convertToFeatureSet:unknown-geometry",new j(`Unable to parse unknown geometry type '${o}'`))}return n}function Hn(n){const{objectIdFieldName:r,spatialReference:o,transform:t,fields:s,hasM:e,hasZ:u,features:c,geometryType:l,exceededTransferLimit:i,uniqueIdField:f,queryGeometry:a,queryGeometryType:h}=n,d={features:tn([],c,l,u,e),fields:s,geometryType:l,objectIdFieldName:r,spatialReference:o,uniqueIdField:f,queryGeometry:jn(a,h,!1,!1)};return t&&(d.transform=t),i&&(d.exceededTransferLimit=i),e&&(d.hasM=e),u&&(d.hasZ=u),d}function Jn(n,r){const o=new mn,{hasM:t,hasZ:s,features:e,objectIdFieldName:u,spatialReference:c,geometryType:l,exceededTransferLimit:i,transform:f,fields:a}=n;return a&&(o.fields=a),o.geometryType=l??null,o.objectIdFieldName=u??r??null,o.spatialReference=c??null,o.objectIdFieldName?(e&&on(o.features,e,l,s,t,o.objectIdFieldName),i&&(o.exceededTransferLimit=i),t&&(o.hasM=t),s&&(o.hasZ=s),f&&(o.transform=f),o):(k.error(new j("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),o)}function Kn(n){const{transform:r,features:o,hasM:t,hasZ:s}=n;if(!r)return n;for(const e of o)G(e.geometry)&&H(e.geometry,e.geometry,t,s,r),G(e.centroid)&&H(e.centroid,e.centroid,t,s,r);return n.transform=null,n}function Qn(n,r){const{geometryType:o,features:t,hasM:s,hasZ:e}=r;if(!n)return r;for(let u=0;u<t.length;u++){const c=t[u],l=c.weakClone();l.geometry=new P,D(l.geometry,c.geometry,s,e,o,n),c.centroid&&(l.centroid=new P,D(l.centroid,c.centroid,s,e,"esriGeometryPoint",n)),t[u]=l}return r.transform=n,r}function D(n,r,o,t,s,e,u=o,c=t){if(N(n),Z(r)||!r.coords.length)return null;const l=J[s],{coords:i,lengths:f}=r,a=p(o,t),h=p(o&&u,t&&c),d=S(o,t,u,c);if(!f.length)return d(n.coords,i,0,0,E(e,i[0]),L(e,i[1])),N(n,a,0),n;let m,y,b,I,w=0,g=0,M=g;for(const C of f){if(C<l)continue;let q=0;g=M,b=m=E(e,i[w]),I=y=L(e,i[w+1]),d(n.coords,i,g,w,b,I),q++,w+=a,g+=h;for(let O=1;O<C;O++,w+=a)b=E(e,i[w]),I=L(e,i[w+1]),b===m&&I===y||(d(n.coords,i,g,w,b-m,I-y),g+=h,q++,m=b,y=I);q>=l&&(n.lengths.push(q),M=g)}return T(n.coords,M),n.coords.length?n:null}function Wn(n,r,o,t,s,e,u=o,c=t){if(N(n),!r||!r.coords.length)return null;const l=J[s],{coords:i,lengths:f}=r,a=p(o,t),h=p(o&&u,t&&c),d=S(o,t,u,c);if(!f.length)return d(n.coords,i,0,0,i[0],i[1]),N(n,a,0),n;let m=0;const y=e*e;for(const b of f){if(b<l){m+=b*a;continue}const I=n.coords.length/h,w=m,g=m+(b-1)*a;d(n.coords,i,n.coords.length,w,i[w],i[w+1]),R(n.coords,i,a,y,d,w,g),d(n.coords,i,n.coords.length,g,i[g],i[g+1]);const M=n.coords.length/h-I;M>=l?n.lengths.push(M):T(n.coords,I*h),m+=b*a}return n.coords.length?n:null}function qn(n,r,o,t){const s=n[r],e=n[r+1],u=n[o],c=n[o+1],l=n[t],i=n[t+1];let f=u,a=c,h=l-f,d=i-a;if(h!==0||d!==0){const m=((s-f)*h+(e-a)*d)/(h*h+d*d);m>1?(f=l,a=i):m>0&&(f+=h*m,a+=d*m)}return h=s-f,d=e-a,h*h+d*d}function R(n,r,o,t,s,e,u){let c,l=t,i=0;for(let f=e+o;f<u;f+=o)c=qn(r,f,e,u),c>l&&(i=f,l=c);l>t&&(i-e>o&&R(n,r,o,t,s,e,i),s(n,r,n.length,i,r[i],r[i+1]),u-i>o&&R(n,r,o,t,s,i,u))}function Xn(n,r,o,t){if(Z(r)||!r.coords||!r.coords.length)return null;const s=p(o,t);let e=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(r&&r.coords){const i=r.coords;for(let f=0;f<i.length;f+=s){const a=i[f],h=i[f+1];e=Math.min(e,a),c=Math.max(c,a),u=Math.min(u,h),l=Math.max(l,h)}}return un(n)?cn(n,e,u,c,l):ln(e,u,c,l,n),n}function H(n,r,o,t,s){const{coords:e,lengths:u}=r,c=p(o,t);if(!e.length)return n!==r&&N(n),n;sn(s);const{originPosition:l,scale:i,translate:f}=s,a=En;a.originPosition=l;const h=a.scale;h[0]=i[0]??1,h[1]=-(i[1]??1),h[2]=i[2]??1,h[3]=i[3]??1;const d=a.translate;if(d[0]=f[0]??0,d[1]=f[1]??0,d[2]=f[2]??0,d[3]=f[3]??0,!u.length){for(let y=0;y<c;++y)n.coords[y]=U(a,e[y],y);return n!==r&&N(n,c,0),n}let m=0;for(let y=0;y<u.length;y++){const b=u[y];n.lengths[y]=b;for(let g=0;g<c;++g)n.coords[m+g]=U(a,e[m+g],g);let I=n.coords[m],w=n.coords[m+1];m+=c;for(let g=1;g<b;g++,m+=c){I+=e[m]*h[0],w+=e[m+1]*h[1],n.coords[m]=I,n.coords[m+1]=w;for(let M=2;M<c;++M)n.coords[m+M]=U(a,e[m+M],M)}}return n!==r&&N(n,e.length,u.length),n}function $n(n,r,o,t,s,e){if(N(n),n.lengths.push(...r.lengths),o===s&&t===e)for(let u=0;u<r.coords.length;u++)n.coords.push(r.coords[u]);else{const u=p(o,t),c=S(o,t,s,e),l=r.coords;for(let i=0;i<l.length;i+=u)c(n.coords,l,n.coords.length,i,l[i],l[i+1])}return n}function zn(n,r,o,t){let s=0,e=n[t*r],u=n[t*(r+1)];for(let c=1;c<o;c++){const l=e+n[t*(r+c)],i=u+n[t*(r+c)+1],f=(l-e)*(i+u);e=l,u=i,s+=f}return .5*s}function nr(n,r){const{coords:o,lengths:t}=n;let s=0,e=0;for(let u=0;u<t.length;u++){const c=t[u];e+=zn(o,s,c,r),s+=c}return Math.abs(e)}function rr(n,r){if(Z(n))return null;const o=n.clone(),t=n.coords,s=n.lengths;let e=0;for(let u=0;u<s.length;u++){const c=s[u];let l=t[r*e],i=t[r*e+1];for(let f=1;f<c;f++){const a=l+t[r*(e+f)],h=i+t[r*(e+f)+1];o.coords[r*(e+f)]=a,o.coords[r*(e+f)+1]=h,l=a,i=h}e+=c}return o}function N(n,r=0,o=0){T(n.lengths,o),T(n.coords,r)}function T(n,r=0){n.length!==r&&(n.length=r)}const En={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};export{X as C,E as G,Xn as I,nn as K,$n as M,rr as P,nr as T,Cn as U,rn as W,Jn as a,L as b,Dn as c,Qn as d,Hn as f,Wn as g,Kn as h,An as j,D as m,on as n,On as o,Q as q,Bn as s,jn as u,H as w};
