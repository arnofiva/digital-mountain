import{r as nt}from"./earcut-61f7b102.js";import{h as at}from"./Polyline-cf51ad23.js";import{r as J}from"./deduplicate-3aef92f2.js";import{b as Q,r as c}from"./typedArrayUtil-70e1d79e.js";import{e as o,y as s,l as P,a as S,s as A}from"./JSONSupport-32b5ad86.js";import{p as T}from"./string-7a2f1d87.js";import{s as X}from"./Error-62cc7aff.js";import{v as z}from"./ensureType-249b88cd.js";import{l as Y}from"./Color-5a385b27.js";import{r as st,o as it}from"./Extent-2ad2c9a9.js";import{m as K,f as lt}from"./persistableUrlUtils-ccf13db2.js";function tt(t,e=!1){return t<=Q?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function Mt(t){return length<=Q?Array.from(t):new Float64Array(t)}function ut(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function Wt(t){const e=ht(t.rings,t.hasZ,H.CCW_IS_HOLE),r=new Array;let n=0,a=0;for(const l of e.polygons){const g=l.count,h=l.index,C=ut(e.position,3*h,3*g),D=l.holeIndices.map(d=>d-h),p=new Uint32Array(nt(C,D,3));r.push({position:C,faces:p}),n+=C.length,a+=p.length}const i=ct(r,n,a),m=Array.isArray(i.position)?J(i.position,3,{originalIndices:i.faces}):J(i.position.buffer,6,{originalIndices:i.faces});return i.position=new Float64Array(m.buffer),i.faces=m.indices,i}function ct(t,e,r){if(t.length===1)return t[0];const n=tt(e),a=new Uint32Array(r);let i=0,m=0,l=0;for(const g of t){for(let h=0;h<g.position.length;h++)n[i++]=g.position[h];for(let h=0;h<g.faces.length;h++)a[m++]=g.faces[h]+l;l=i/3}return{position:n,faces:a}}function ht(t,e,r){const n=t.length,a=new Array(n),i=new Array(n),m=new Array(n);let l=0,g=0,h=0,C=0;for(let d=0;d<n;++d)C+=t[d].length;const D=tt(3*C);let p=0;for(let d=n-1;d>=0;d--){const u=t[d],q=r===H.CCW_IS_HOLE&&pt(u);if(q&&n!==1)a[l++]=u;else{let G=u.length;for(let x=0;x<l;++x)G+=a[x].length;const j={index:p,pathLengths:new Array(l+1),count:G,holeIndices:new Array(l)};j.pathLengths[0]=u.length,u.length>0&&(m[h++]={index:p,count:u.length}),p=q?F(u,u.length-1,-1,D,p,u.length,e):F(u,0,1,D,p,u.length,e);for(let x=0;x<l;++x){const M=a[x];j.holeIndices[x]=p,j.pathLengths[x+1]=M.length,M.length>0&&(m[h++]={index:p,count:M.length}),p=F(M,0,1,D,p,M.length,e)}l=0,j.count>0&&(i[g++]=j)}}for(let d=0;d<l;++d){const u=a[d];u.length>0&&(m[h++]={index:p,count:u.length}),p=F(u,0,1,D,p,u.length,e)}return i.length=g,m.length=h,{position:D,polygons:i,outlines:m}}function F(t,e,r,n,a,i,m){a*=3;for(let l=0;l<i;++l){const g=t[e];n[a++]=g[0],n[a++]=g[1],n[a++]=m?g[2]:0,e+=r}return a/3}function pt(t){return!at(t,!1,!1)}var H;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(H||(H={}));let W=null,R=!0;function Lt(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(R)try{return new ImageData(t,e)}catch{R=!1}return et(t,e,r)}function mt(t,e,r,n){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(R)try{return new ImageData(t,e,r)}catch{R=!1}const a=et(e,r,n);return a.data.set(t,0),a}function gt(){return W||(W=document.createElement("canvas"),W.width=1,W.height=1),W}function et(t,e,r){return r||(r=gt()),r.getContext("2d").createImageData(t,e)}var b;const U=new WeakMap;let dt=0,v=b=class extends P{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,n){if(t instanceof HTMLImageElement){const a={type:"image-element",src:K(t.src,n),crossOrigin:t.crossOrigin};e[r]=a}else if(t instanceof HTMLCanvasElement){const a=t.getContext("2d").getImageData(0,0,t.width,t.height),i={type:"canvas-element",imageData:this._encodeImageData(a)};e[r]=i}else if(t instanceof HTMLVideoElement){const a={type:"video-element",src:K(t.src,n),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=a}else if(t instanceof ImageData){const a={type:"image-data",imageData:this._encodeImageData(t)};e[r]=a}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),n=e.substr(0,15).toLocaleLowerCase();if(r===".png"||n==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(U.has(this.data)||U.set(this.data,++dt),e(U.get(this.data))):e()}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new b(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return mt(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new b({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new b({data:t}):z(b,t)}};o([s({type:String,json:{write:lt}})],v.prototype,"url",null),o([s({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),s()],v.prototype,"data",null),o([st("data")],v.prototype,"writeData",null),o([it("data")],v.prototype,"readData",null),o([s({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],v.prototype,"transparent",null),o([s({json:{write:!0}})],v.prototype,"wrap",void 0),o([s({readOnly:!0})],v.prototype,"contentHash",null),v=b=o([S("esri.geometry.support.MeshTexture")],v);const N=v;var B;let w=B=class extends P{constructor(t){super(t),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=c(t)?t.get(this):null;if(r)return r;const n=new B(this.clonePropertiesWithDeduplication(e));return c(t)&&t.set(this,n),n}clonePropertiesWithDeduplication(t){return{color:c(this.color)?this.color.clone():null,colorTexture:c(this.colorTexture)?this.colorTexture.cloneWithDeduplication(t):null,normalTexture:c(this.normalTexture)?this.normalTexture.cloneWithDeduplication(t):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:c(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:c(this.normalTextureTransform)?this.normalTextureTransform:null}}};o([s({type:Y,json:{write:!0}})],w.prototype,"color",void 0),o([s({type:N,json:{write:!0}})],w.prototype,"colorTexture",void 0),o([s({type:N,json:{write:!0}})],w.prototype,"normalTexture",void 0),o([s({nonNullable:!0,json:{write:!0}})],w.prototype,"alphaMode",void 0),o([s({nonNullable:!0,json:{write:!0}})],w.prototype,"alphaCutoff",void 0),o([s({nonNullable:!0,json:{write:!0}})],w.prototype,"doubleSided",void 0),o([s()],w.prototype,"colorTextureTransform",void 0),o([s()],w.prototype,"normalTextureTransform",void 0),w=B=o([S("esri.geometry.support.MeshMaterial")],w);const Z=w;var k;let y=k=class extends Z{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=c(t)?t.get(this):null;if(r)return r;const n=new k(this.clonePropertiesWithDeduplication(e));return c(t)&&t.set(this,n),n}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:c(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:c(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(t):null,occlusionTexture:c(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(t):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:c(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(t):null,occlusionTextureTransform:c(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:c(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:c(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}}};o([s({type:Y,json:{write:!0}})],y.prototype,"emissiveColor",void 0),o([s({type:N,json:{write:!0}})],y.prototype,"emissiveTexture",void 0),o([s({type:N,json:{write:!0}})],y.prototype,"occlusionTexture",void 0),o([s({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],y.prototype,"metallic",void 0),o([s({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],y.prototype,"roughness",void 0),o([s({type:N,json:{write:!0}})],y.prototype,"metallicRoughnessTexture",void 0),o([s()],y.prototype,"occlusionTextureTransform",void 0),o([s()],y.prototype,"emissiveTextureTransform",void 0),o([s()],y.prototype,"metallicRoughnessTextureTransform",void 0),y=k=o([S("esri.geometry.support.MeshMaterialMetallicRoughness")],y);const ft=y;var O;const rt="esri.geometry.support.MeshVertexAttributes",I=X.getLogger(rt);let f=O=class extends P{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return _(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},I)}castPosition(t){return t&&t instanceof Float32Array&&I.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),_(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},I)}castUv(t){return _(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},I)}castNormal(t){return _(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},I)}castTangent(t){return _(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},I)}clone(){const t={position:T(this.position),uv:T(this.uv),normal:T(this.normal),tangent:T(this.tangent),color:T(this.color)};return new O(t)}clonePositional(){const t={position:T(this.position),normal:T(this.normal),tangent:T(this.tangent),uv:this.uv,color:this.color};return new O(t)}};function V(t,e,r,n){const{loggerTag:a,stride:i}=e;return t.length%i!=0?(n.error(a,`Invalid array length, expected a multiple of ${i}`),new r([])):t}function _(t,e,r,n,a){if(!t)return t;if(t instanceof e)return V(t,n,e,a);for(const i of r)if(t instanceof i)return V(new e(t),n,e,a);if(Array.isArray(t))return V(new e(t),n,e,a);{const i=r.map(m=>`'${m.name}'`);return a.error(`Failed to set property, expected one of ${i}, but got ${t.constructor.name}`),new e([])}}function L(t,e,r){e[r]=yt(t)}function yt(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}o([s({json:{write:L}})],f.prototype,"color",void 0),o([A("color")],f.prototype,"castColor",null),o([s({nonNullable:!0,json:{write:L}})],f.prototype,"position",void 0),o([A("position")],f.prototype,"castPosition",null),o([s({json:{write:L}})],f.prototype,"uv",void 0),o([A("uv")],f.prototype,"castUv",null),o([s({json:{write:L}})],f.prototype,"normal",void 0),o([A("normal")],f.prototype,"castNormal",null),o([s({json:{write:L}})],f.prototype,"tangent",void 0),o([A("tangent")],f.prototype,"castTangent",null),f=O=o([S(rt)],f);var E;const ot="esri.geometry.support.MeshComponent",wt=X.getLogger(ot);let $=E=class extends P{static from(t){return z(E,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return _(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},wt)}castMaterial(t){return z(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?ft:Z,t)}clone(){return new E({faces:T(this.faces),shading:this.shading,material:T(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const r={faces:T(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new E(r)}};o([s({json:{write:!0}})],$.prototype,"faces",void 0),o([A("faces")],$.prototype,"castFaces",null),o([s({type:Z,json:{write:!0}})],$.prototype,"material",void 0),o([A("material")],$.prototype,"castMaterial",null),o([s({type:String,json:{write:!0}})],$.prototype,"shading",void 0),o([s({type:Boolean})],$.prototype,"trustSourceNormals",void 0),$=E=o([S(ot)],$);const Et=$;export{ut as a,ft as c,Lt as e,H as f,Et as g,Wt as i,ht as l,N as m,tt as n,f as p,Mt as t};
