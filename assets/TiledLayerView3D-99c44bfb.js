import{e as l,y as s,a as g}from"./cast-8b575ab3.js";import{a as o}from"./Error-685fdf30.js";import{t as m,r as d}from"./typedArrayUtil-ce39e5f4.js";import{j as f}from"./reactiveUtils-042dd05a.js";import"./ArrayPool-5813d861.js";import{O as y,P as v,Q as w}from"./index-334863ed.js";const L=c=>{let a=class extends c{get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}get dataLevelRange(){const e=this.tileInfo.lods,i=e[0].scale,t=e[e.length-1].scale;return this.levelRangeFromScaleRange(i,t)}get displayLevelRange(){const e=this.tileInfo.lods,i=this.layer.minScale||e[0].scale,t=this.layer.maxScale||e[e.length-1].scale,r=this.levelRangeFromScaleRange(i,t);return this.layer.maxScale&&r.maxLevel++,r}getTileUrl(e,i,t){return this.layer.getTileUrl(e,i,t)}_addTilingSchemeMatchPromise(){if(m(this.fullExtent))return this.addResolvingPromise(Promise.reject(new o("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const e=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(d(e))return this.addResolvingPromise(Promise.reject(e));const i=f(()=>{var t,r;return(r=(t=this.view)==null?void 0:t.basemapTerrain)==null?void 0:r.tilingSchemeLocked}).then(()=>{const t=this.view.basemapTerrain.tilingScheme,r=this._getTileInfoCompatibilityError(this.tileInfo,t);if(r)throw r});this.addResolvingPromise(i)}_getTileInfoSupportError(e,i){const t=w(e,i,this.view.spatialReference,this.view.state.viewingMode);if(t){const r={layer:this.layer,error:t};let n;switch(t.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":n=new o("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",r);break;default:n=new o("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",r)}return n}return null}_getTileInfoCompatibilityError(e,i){return m(e)||!i.compatibleWith(e)?new o("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface"):null}levelRangeFromScaleRange(e,i){const t={minLevel:0,maxLevel:1/0},r=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!r)return t;const n=r.levels[0],p=u=>{const h=Math.log(n.scale/u)/Math.LN2;return .5-Math.abs(.5-h%1)<1e-9?Math.round(h):Math.ceil(h)};return e!=null&&e>0&&(t.minLevel=Math.max(0,p(e))),i!=null&&i>0&&(t.maxLevel=Math.max(0,p(i))),t}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return l([s({readOnly:!0})],a.prototype,"imageFormatIsOpaque",null),l([s({readOnly:!0})],a.prototype,"updating",void 0),l([s(y)],a.prototype,"updatingProgress",void 0),l([s(v)],a.prototype,"updatingProgressValue",void 0),l([s()],a.prototype,"fullExtent",null),l([s({readOnly:!0})],a.prototype,"isOpaque",null),l([s({readOnly:!0})],a.prototype,"dataLevelRange",null),l([s({readOnly:!0})],a.prototype,"displayLevelRange",null),l([s()],a.prototype,"layer",void 0),l([s()],a.prototype,"tileInfo",void 0),a=l([g("esri.views.3d.layers.TiledLayerView3D")],a),a};export{L as c};
