import{a as F,d as x}from"./generateRendererUtils-9fa055c1.js";const D="<Null>",z="equal-interval",I=1,N=5,S=10,M=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,V=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),C=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function b(t){return t==null||typeof t=="string"&&!t?D:t}function k(t){const e=t.normalizationField!=null||t.normalizationType!=null,l=t.minValue!=null||t.maxValue!=null,i=!!t.sqlExpression&&t.supportsSQLExpression;return!e&&!l&&!i}function L(t){const e=t.returnDistinct?[...new Set(t.values)]:t.values,l=e.filter(o=>o!=null).length,i={count:l};return t.supportsNullCount&&(i.nullcount=e.length-l),t.percentileParams&&(i.median=y(e,t.percentileParams)),i}function $(t){const{values:e,useSampleStdDev:l,supportsNullCount:i}=t;let o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,n=null,u=null,r=null,f=null,s=0;const d=t.minValue==null?-1/0:t.minValue,c=t.maxValue==null?1/0:t.maxValue;for(const m of e)Number.isFinite(m)?m>=d&&m<=c&&(n=n===null?m:n+m,o=Math.min(o,m),a=Math.max(a,m),s++):typeof m=="string"&&s++;if(s&&n!=null){u=n/s;let m=0;for(const v of e)Number.isFinite(v)&&v>=d&&v<=c&&(m+=(v-u)**2);f=l?s>1?m/(s-1):0:s>0?m/s:0,r=Math.sqrt(f)}else o=null,a=null;const p={avg:u,count:s,max:a,min:o,stddev:r,sum:n,variance:f};return i&&(p.nullcount=e.length-s),t.percentileParams&&(p.median=y(e,t.percentileParams)),p}function y(t,e){const{fieldType:l,value:i,orderBy:o,isDiscrete:a}=e,n=w(l,o==="desc");if((t=[...t].filter(p=>p!=null).sort((p,m)=>n(p,m))).length===0)return null;if(i<=0)return t[0];if(i>=1)return t[t.length-1];const u=(t.length-1)*i,r=Math.floor(u),f=r+1,s=u%1,d=t[r],c=t[f];return f>=t.length||a||typeof d=="string"||typeof c=="string"?d:d*(1-s)+c*s}function w(t,e){const l=e?1:-1,i=E(e),o=g(e);if(!(t&&["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...V].includes(t)))return(a,n)=>typeof a=="number"&&typeof n=="number"?i(a,n):typeof a=="string"&&typeof n=="string"?o(a,n):l;if(t==="esriFieldTypeDate")return(a,n)=>{const u=new Date(a).getTime(),r=new Date(n).getTime();return isNaN(u)||isNaN(r)?l:i(u,r)};if(V.has(t))return(a,n)=>i(a,n);if(t==="esriFieldTypeString")return(a,n)=>o(a,n);if(t==="esriFieldTypeGUID"||t==="esriFieldTypeGlobalID"){const a=g(e);return(n,u)=>a(T(n),T(u))}return e?(a,n)=>1:(a,n)=>-1}function g(t){return t?(e,l)=>(e=e==null?void 0:e.toUpperCase(),l=l==null?void 0:l.toUpperCase(),e>l?-1:e<l?1:0):(e,l)=>(e=e==null?void 0:e.toUpperCase(),l=l==null?void 0:l.toUpperCase(),e<l?-1:e>l?1:0)}function E(t){return t?(e,l)=>l-e:(e,l)=>e-l}function T(t){return t.substr(24,12)+t.substr(19,4)+t.substr(16,2)+t.substr(14,2)+t.substr(11,2)+t.substr(9,2)+t.substr(6,2)+t.substr(4,2)+t.substr(2,2)+t.substr(0,2)}function Y(t,e){let l;for(l in t)C.includes(l)&&(Number.isFinite(t[l])||(t[l]=null));return e&&["avg","stddev","variance"].forEach(i=>{t[i]!=null&&(t[i]=Math.ceil(t[i]))}),t}function _(t){const e={};for(let l of t)(l==null||typeof l=="string"&&l.trim()==="")&&(l=null),e[l]==null?e[l]={count:1,data:l}:e[l].count++;return{count:e}}function h(t){return(t==null?void 0:t.type)!=="coded-value"?[]:t.codedValues.map(e=>e.code)}function Q(t,e,l,i){const o=t.count,a=[];if(l&&e){const n=[],u=h(e[0]);for(const r of u)if(e[1]){const f=h(e[1]);for(const s of f)if(e[2]){const d=h(e[2]);for(const c of d)n.push(`${b(r)}${i}${b(s)}${i}${b(c)}`)}else n.push(`${b(r)}${i}${b(s)}`)}else n.push(r);for(const r of n)o.hasOwnProperty(r)||(o[r]={data:r,count:0})}for(const n in o){const u=o[n];a.push({value:u.data,count:u.count,label:u.label})}return{uniqueValueInfos:a}}function j(t,e,l,i){let o=null;switch(e){case"log":t!==0&&(o=Math.log(t)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(i)&&i!==0&&(o=t/i*100);break;case"field":Number.isFinite(l)&&l!==0&&(o=t/l);break;case"natural-log":t>0&&(o=Math.log(t));break;case"square-root":t>0&&(o=t**.5)}return o}function q(t,e){const l=P({field:e.field,normalizationType:e.normalizationType,normalizationField:e.normalizationField,classificationMethod:e.classificationMethod,standardDeviationInterval:e.standardDeviationInterval,breakCount:e.numClasses||N});return t=G(t,e.minValue,e.maxValue),F({definition:l,values:t,normalizationTotal:e.normalizationTotal})}function G(t,e,l){const i=e??-1/0,o=l??1/0;return t.filter(a=>Number.isFinite(a)&&a>=i&&a<=o)}function P(t){const{breakCount:e,field:l,normalizationField:i,normalizationType:o}=t,a=t.classificationMethod||z,n=a==="standard-deviation"?t.standardDeviationInterval||I:void 0;return new x({breakCount:e,classificationField:l,classificationMethod:a,normalizationField:o==="field"?i:void 0,normalizationType:o,standardDeviationInterval:n})}function H(t,e){let l=t.classBreaks;const i=l.length,o=l[0].minValue,a=l[i-1].maxValue,n=e==="standard-deviation",u=M;return l=l.map(r=>{var d;const f=r.label,s={minValue:r.minValue,maxValue:r.maxValue,label:f};if(n&&f){const c=((d=f.match(u))==null?void 0:d.map(p=>+p.trim()))??[];c.length===2?(s.minStdDev=c[0],s.maxStdDev=c[1],c[0]<0&&c[1]>0&&(s.hasAvg=!0)):c.length===1&&(f.includes("<")?(s.minStdDev=null,s.maxStdDev=c[0]):f.includes(">")&&(s.minStdDev=c[0],s.maxStdDev=null))}return s}),{minValue:o,maxValue:a,classBreakInfos:l,normalizationTotal:t.normalizationTotal}}function J(t,e){const l=U(t,e),i=l.intervals,o=l.min??0,a=l.max??0,n=i.map((u,r)=>({minValue:i[r][0],maxValue:i[r][1],count:0}));for(const u of t)if(u!=null&&u>=o&&u<=a){const r=B(i,u);r>-1&&n[r].count++}return{bins:n,minValue:o,maxValue:a,normalizationTotal:e.normalizationTotal}}function U(t,e){const{field:l,classificationMethod:i,standardDeviationInterval:o,normalizationType:a,normalizationField:n,normalizationTotal:u,minValue:r,maxValue:f}=e,s=e.numBins||S;let d=null,c=null,p=null;if((!i||i==="equal-interval")&&!a){if(r!=null&&f!=null)d=r,c=f;else{const m=$({values:t,minValue:r,maxValue:f,useSampleStdDev:!a,supportsNullCount:k({normalizationType:a,normalizationField:n,minValue:r,maxValue:f})});d=m.min??null,c=m.max??null}p=O(d??0,c??0,s)}else{const{classBreaks:m}=q(t,{field:l,normalizationType:a,normalizationField:n,normalizationTotal:u,classificationMethod:i,standardDeviationInterval:o,minValue:r,maxValue:f,numClasses:s});d=m[0].minValue,c=m[m.length-1].maxValue,p=m.map(v=>[v.minValue,v.maxValue])}return{min:d,max:c,intervals:p}}function B(t,e){let l=-1;for(let i=t.length-1;i>=0;i--)if(e>=t[i][0]){l=i;break}return l}function O(t,e,l){const i=(e-t)/l,o=[];let a,n=t;for(let u=1;u<=l;u++)a=n+i,a=Number(a.toFixed(16)),o.push([n,u===l?e:a]),n=a;return o}export{q as D,Q as F,H as N,J as S,_ as T,Y as V,b as c,$ as d,L as f,k as m,y as p,w as v,j as x};
