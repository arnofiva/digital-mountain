import{e as p,y as d,a as F,v as st,t as xt,n as dt,_ as xe}from"./cast-8b575ab3.js";import{j as At}from"./Collection-47946fa8.js";import{s as ne}from"./Error-685fdf30.js";import{t as f,r as c,l as zt,a as it,o as Ae,p as ze,e as Ut,w as Bt}from"./typedArrayUtil-ce39e5f4.js";import{l as S,w as R,h as mt,U as wt,f as Rt,a as jt}from"./reactiveUtils-042dd05a.js";import"./ArrayPool-5813d861.js";import{n as Re}from"./AnalysisView3D-1c8b14ef.js";import{t as y,r as He,u as ke}from"./DimensionAnalysis-0ac2f8cd.js";import{a7 as Ee,a8 as Le,N as Ve,w as W}from"./Extent-680ef92a.js";import{v as oe,i as Ie,g as Ge}from"./quantityFormatUtils-48a180ea.js";import{m as Nt,b as Fe}from"./mathUtils-5b623c84.js";import{p as qt,r as Ue,f as se,q as Be}from"./mat4-4714ff8c.js";import{e as Ht}from"./mat4f64-abdda1bb.js";import{n as C,a as z,O as Wt,J as k,_ as j,P as L,G as ae,f as Y,z as je,q as ct,X as Yt,v as Pt,g as at,e as re,F as le,s as pe,o as de,r as ut}from"./vec3-015ca254.js";import{c as _,n as Ne}from"./sphere-8ab93b42.js";import{M as qe}from"./dehydratedFeatures-55779981.js";import{aW as Q,aX as We,aY as bt,aZ as Z,a_ as Ye,a$ as Xt,b0 as Xe,b1 as Je,b2 as Ke,aA as ht,b3 as Qe,aQ as J,x as Ze,t as ti,b4 as Jt,b5 as ei,au as ii,b6 as ni,b7 as me,aR as oi,aS as si}from"./index-334863ed.js";import{f as N,g as ai}from"./Segment-9f590ab3.js";import{j as ri,y as li}from"./euclideanLengthMeasurementUtils-29bab6b0.js";import{g as Kt,t as pi}from"./promiseUtils-e37fe75d.js";import{l as G}from"./Color-ad49dc79.js";import"./geometry-bad16232.js";import{s as Ct}from"./Cyclical-34b2a5e3.js";import{u as H}from"./screenUtils-410d12c0.js";import{_ as $t,p as Ot,V as Qt,Y as di}from"./plane-e5e66c24.js";import{N as mi,i as ce,e as tt,x as ue,U as ci,D as ui,C as hi,V as kt}from"./manipulatorUtils-ea52a52a.js";import{B as fi,C as he,z as Et,o as gi}from"./Factory-0c42e0ab.js";import{m as _i,f as yi,s as vi}from"./MarkerSizing.glsl-0f21463c.js";import{y as rt,R as Lt,C as Si}from"./InteractiveToolBase-711b78f1.js";import{d as Mi}from"./HandleOwner-f773ce72.js";import{b as Tt}from"./string-7a324480.js";import{_ as wi,x as Pi}from"./VerticesVisualElement-e62cefd1.js";import{g as U,n as bi,b as Ci,a as $i}from"./LineVisualElement-b2465764.js";import{g as x}from"./VisualVariablePassParameters-8cb0a75a.js";import{c as Oi}from"./ImageMaterial-29c669c5.js";import{V as Ti,g as Di,w as xi}from"./EditGeometryOperations-73b6c5df.js";import{t as Ai}from"./nextTick-3ee5a785.js";import{e as zi}from"./SnappingContext-7b0a2e3a.js";import{h as Ri,m as Hi}from"./SnappingOperation-4f67e764.js";import{a as ki,s as Ei,m as Li,c as Vi}from"./analysisViewUtils-afde4717.js";import"./intl-b84fb3c9.js";import{l as X}from"./vec4f64-6d0e93be.js";import{r as Ii}from"./RenderTexture-35f5407b.js";import{s as Gi}from"./locale-30120714.js";import{u as Fi}from"./messages-8a541332.js";import"./Evented-d959ede6.js";import"./SimpleObservable-6f002ab0.js";import"./Promise-e757e514.js";import"./Analysis-cc5bd6fb.js";import"./Clonable-2b8b60cc.js";import"./Identifiable-96150ecf.js";import"./collectionUtils-25147e5f.js";import"./projection-582e07d8.js";import"./preload-helper-41c905a7.js";import"./Polyline-889037e7.js";import"./assets-5052bbaa.js";import"./request-fc61835a.js";import"./aaBoundingRect-41e05474.js";import"./Ellipsoid-89682c5e.js";import"./zscale-def794ea.js";import"./Portal-7ecdc9f0.js";import"./Loadable-695031ac.js";import"./PortalGroup-ea788274.js";import"./PortalUser-a1aa49cd.js";import"./vec4-c7a19f0d.js";import"./common-d0b63c2d.js";import"./byteSizeEstimations-f0cab514.js";import"./mat3f64-50f3b9f6.js";import"./quatf64-f8f1c132.js";import"./vec2f64-f35767d6.js";import"./aaBoundingBox-04c58f5a.js";import"./quantizationUtils-dc028b68.js";import"./typeUtils-700e0da4.js";import"./Field-1bc3a16a.js";import"./enumeration-4ec8d3f9.js";import"./fieldType-232282e5.js";import"./IdentityManager-13ed5348.js";import"./uuid-73213768.js";import"./dom-2ec1e33c.js";import"./Graphic-96c42a4d.js";import"./PopupTemplate-8ac0cb61.js";import"./fieldUtils-1ecec444.js";import"./arcadeOnDemand-a1bf65ec.js";import"./number-134e9f14.js";import"./symbols-0f3de684.js";import"./CIMSymbol-cdddfd9c.js";import"./opacityUtils-6b5cbdc2.js";import"./symbolLayerUtils3D-51cc6d75.js";import"./persistableUrlUtils-1c5d7615.js";import"./Symbol3DAnchorPosition2D-142c1e90.js";import"./jsonUtils-03437bcd.js";import"./Basemap-f5ca570d.js";import"./deprecate-9828d7d2.js";import"./loadAll-8401c5ec.js";import"./asyncUtils-623987a8.js";import"./PortalItem-6549afda.js";import"./writeUtils-ff257e5e.js";import"./layerUtils-0c01cb0c.js";import"./compilerUtils-175b9e40.js";import"./CollectionFlattener-9bc75576.js";import"./TablesMixin-b6031ef9.js";import"./Layer-b29c44e3.js";import"./MultiOriginJSONSupport-a1d33be9.js";import"./originUtils-1469eeaf.js";import"./multiOriginJSONSupportUtils-c978f4c3.js";import"./HeightModelInfo-42ae0f61.js";import"./arcgisLayerUrl-81a33ec5.js";import"./ViewingMode-5d7d590b.js";import"./saveUtils-bf4b189a.js";import"./resourceUtils-e6e10558.js";import"./OperationalLayer-c3a14c54.js";import"./TimeExtent-d116f9c4.js";import"./ElevationInfo-ad190ee6.js";import"./lengthUtils-1d09729e.js";import"./mat3-4fd89d48.js";import"./Octree-d990d188.js";import"./Util-c12e93ba.js";import"./scaleUtils-87bb90d3.js";import"./lineSegment-b352e49e.js";import"./objectResourceUtils-8909e8c3.js";import"./devEnvironmentUtils-5002a058.js";import"./BufferView-da65c548.js";import"./vec2-8acac370.js";import"./vec33-8529ce65.js";import"./DefaultMaterial_COLOR_GAMMA-87d1f8e6.js";import"./types-e1c0a5bf.js";import"./enums-fc527c7c.js";import"./Version-419f71e1.js";import"./quat-99c4e099.js";import"./resourceUtils-527631ac.js";import"./basicInterfaces-7449a8bf.js";import"./Indices-37e06e9a.js";import"./DefaultMaterial.glsl-7d7dc23e.js";import"./ForwardLinearDepth.glsl-a0929473.js";import"./Matrix3PassUniform-0b3b1bba.js";import"./ShaderBuilder-7bfc11d2.js";import"./vec3f32-01c06d8d.js";import"./VertexAttribute-15d1866a.js";import"./View.glsl-03db830e.js";import"./mat4f32-60a2394b.js";import"./Texture2DPassUniform-70e1e126.js";import"./MixExternalColor.glsl-99b269fe.js";import"./ShaderTechniqueConfiguration-ee770726.js";import"./symbolColorUtils-834d5fca.js";import"./PhysicallyBasedRendering.glsl-32dfb9c7.js";import"./FloatPassUniform-e3702139.js";import"./Float4PassUniform-7f3c3ce8.js";import"./RgbaFloatEncoding.glsl-4a25e2a7.js";import"./Texture2DDrawUniform-02720a73.js";import"./PiUtils.glsl-5ee49495.js";import"./Slice.glsl-7975394d.js";import"./Transform.glsl-7294c426.js";import"./ObjectAndLayerIdColor.glsl-a64028da.js";import"./OutputDepth.glsl-f581dcdd.js";import"./OutputHighlight.glsl-08aacdf4.js";import"./VisualVariables.glsl-9e988d16.js";import"./DiscardOrAdjustAlphaBlend.glsl-f19054e7.js";import"./AlphaCutoff-96178e0d.js";import"./TransparencyPassType-a6b20292.js";import"./VertexColor.glsl-79a8c465.js";import"./VerticalOffset.glsl-5354e013.js";import"./Normals.glsl-0f400ece.js";import"./EvaluateSceneLighting.glsl-5da94bb7.js";import"./Texture-bf6b5582.js";import"./context-util-7ede29e5.js";import"./SSAOBlur.glsl-7265df26.js";import"./ScreenSpacePass.glsl-fee70090.js";import"./ReadLinearDepth.glsl-53a01bc1.js";import"./SSAO.glsl-c9cc39dd.js";import"./MultipassTerrainTest.glsl-43f42334.js";import"./vec2f32-eaf29605.js";import"./Texture-87febf19.js";import"./TextureOnly.glsl-548e665f.js";import"./Attribute-f72d3f37.js";import"./InterleavedLayout-d75b8228.js";import"./DefaultTechniqueConfiguration-5fedee5c.js";import"./RealisticTree.glsl-1e8f0ea9.js";import"./Scheduler-3113abcd.js";import"./GraphicsLayer-70f87af0.js";import"./BlendLayer-291a2b49.js";import"./colorUtils-639f4d25.js";import"./ScaleRangeLayer-7ff6c0d3.js";import"./workers-c3882da6.js";import"./Connection-6bd43370.js";import"./spatialReferenceEllipsoidUtils-23733e37.js";import"./AttachmentInfo-6f2ba68c.js";import"./AttachmentQuery-061e93ef.js";import"./LegendOptions-de492976.js";import"./DimensionalDefinition-4b26df38.js";import"./UniqueValueRenderer-3904f4cc.js";import"./diffUtils-0c65d604.js";import"./colorRamps-ddfecb23.js";import"./sizeVariableUtils-d4870b0d.js";import"./visualVariableUtils-a1979e31.js";import"./jsonUtils-e877a23b.js";import"./styleUtils-305d8f69.js";import"./vectorFieldUtils-3e325848.js";import"./colorUtils-7641d345.js";import"./normalizeUtils-6bee55d6.js";import"./normalizeUtilsCommon-17a95432.js";import"./ItemCache-c0904c4f.js";import"./MemCache-1d0e264b.js";import"./cimSymbolUtils-bff8b59b.js";import"./utils-3d986af0.js";import"./jsonUtils-b2e5d321.js";import"./DictionaryLoader-1438695d.js";import"./LRUCache-16cff7d8.js";import"./heatmapUtils-bc76f08e.js";import"./Query-65d38c02.js";import"./executeQueryJSON-04f85be1.js";import"./query-b200d7cb.js";import"./pbfQueryUtils-f001828a.js";import"./pbf-68e00ce0.js";import"./OptimizedFeature-7f37a325.js";import"./OptimizedFeatureSet-1d1ac4b9.js";import"./queryZScale-bd6bba60.js";import"./FeatureSet-cb704b51.js";import"./featureConversionUtils-c227ec85.js";import"./RelationshipQuery-0abdb3e2.js";import"./TopFeaturesQuery-3a519c5e.js";import"./FeatureLayer-f2f6536e.js";import"./serviceCapabilitiesUtils-6f645c61.js";import"./FeatureLayerBase-b19f7ee7.js";import"./TimeReference-aeda2bb8.js";import"./datetime-b6333958.js";import"./editsZScale-eefb35e6.js";import"./APIKeyMixin-d7cb7220.js";import"./ArcGISService-7ce81abb.js";import"./CustomParametersMixin-0dbce8f2.js";import"./EditBusLayer-faff46ba.js";import"./FeatureReductionLayer-55e6b2c4.js";import"./labelingInfo-8462538e.js";import"./labelUtils-61dff46d.js";import"./defaultsJSON-59981e75.js";import"./OrderedLayer-f840e564.js";import"./PortalLayer-7f6f61d4.js";import"./portalItemUtils-ba37e370.js";import"./RefreshableLayer-51d28698.js";import"./TemporalLayer-12ea8921.js";import"./FeatureTemplate-26b6ba5d.js";import"./FeatureType-474514d1.js";import"./fieldProperties-66b12497.js";import"./FieldsIndex-967913ce.js";import"./versionUtils-f77d2452.js";import"./styleUtils-4d62e921.js";import"./popupUtils-7d1e2de5.js";import"./callExpressionWithFeature-6f3761f2.js";import"./webStyleSymbolUtils-0f876db3.js";import"./ElevationSamplerData-b8eeacdf.js";import"./TileInfo-f339e6a5.js";import"./WaterSurface.glsl-55a88d78.js";import"./NormalUtils.glsl-f259fe4a.js";import"./HUD.glsl-79bd614f.js";import"./edgeProcessing-fa6d4038.js";import"./deduplicate-dffc7dea.js";import"./VertexElementDescriptor-2925c6af.js";import"./MeshComponent-f5ec9479.js";import"./earcut-61f7b102.js";import"./projection-c67d3c7f.js";import"./HUDMaterial.glsl-caa3e151.js";import"./sdfPrimitives-86e63320.js";import"./floatRGBA-11065dbc.js";import"./labelFormatUtils-695eab3b.js";import"./orientedBoundingBox-8bbf4141.js";import"./quatf32-51a323b8.js";import"./LineCallout.glsl-ede36b7c.js";import"./QueryEngineResult-c580d29f.js";import"./WhereClause-cbd158ef.js";import"./executionError-fb3f283a.js";import"./utils-f1e38d04.js";import"./generateRendererUtils-65ba2788.js";import"./json-48e3ea08.js";import"./RibbonLine.glsl-376e988d.js";import"./LineStipple.glsl-dfd34f08.js";import"./LineMarker.glsl-b68d2081.js";import"./NativeLine.glsl-38506d53.js";import"./Path.glsl-5da6ce18.js";import"./ColorMaterial.glsl-d42d7e44.js";import"./Pattern.glsl-cc643bcf.js";import"./LercDecoder-e072a355.js";import"./enums-fb086c25.js";import"./config-f7904f35.js";import"./TileKey-ae8a9188.js";import"./workerHelper-7b69330e.js";import"./capabilities-8176ed28.js";import"./geometryEngine-68f880a9.js";import"./geometryEngineBase-e1a33b0a.js";import"./hydrated-61d2b3c5.js";import"./floating-ui-8c8de742.js";import"./StreamLayer-b816a6d3.js";import"./SceneFilter-8312e3bf.js";import"./persistable-63f0629a.js";import"./resourceExtension-a93bca74.js";import"./elevationInfoUtils-ab005f9a.js";import"./ExportImageParameters-c93de02f.js";import"./sublayerUtils-7a7b4353.js";import"./TextOverlayItem-85184606.js";import"./measurementUtils-7ae47288.js";import"./ShadedColorMaterial.glsl-a97ba27a.js";import"./drawUtils-5bdcf78c.js";import"./RightAngleQuadVisualElement-019b40c1.js";import"./VisualElementResources-04ba0905.js";import"./PointVisualElement-25a13433.js";import"./ImageMaterial.glsl-cead626d.js";import"./PointSnappingHint-d61d3bbf.js";import"./dehydratedFeatureComparison-d263905a.js";function Ui(t,e,i){if(f(t))return null;const n=t.dimensionSegment.startRenderSpace,o=t.dimensionSegment.endRenderSpace,s=ri(n,o,t.spatialReference);if(f(s))return null;const a=e===y.Vertical?Ee(s.value,s.unit,i):Le(s.value,s.unit,i);return oe(s,a)}function ft(t){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i,dimension:{offset:n,measureType:o,orientation:s}}=t;return{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i,offset:n,measureType:o,orientation:s}}function gt({elevationAlignedStartPoint:t,elevationAlignedEndPoint:e,offset:i,measureType:n,orientation:o},s,a=null){if(f(t)||f(e))return null;const l=ge(c(a)?a.directSegment:new N,{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e},s),r=c(a)?a.primaryOffsetAxis:C();yt(r,{measureType:n,elevationAlignedStartPoint:t,elevationAlignedEndPoint:e,directSegment:l,orientation:o,renderCoordsHelper:s});const m=c(a)?a.dimensionSegment:new N;return Vt({elevationAlignedStartPoint:t,elevationAlignedEndPoint:e})&&n===y.Vertical?(z(m.startRenderSpace,l.startRenderSpace),z(m.endRenderSpace,l.endRenderSpace)):_e(m,{offsetAxis:r,offset:i,relativeToSegment:l,renderCoordsHelper:s}),{directSegment:l,dimensionSegment:m,primaryOffsetAxis:r,spatialReference:s.spatialReference}}function Zt(t,e,i,n){return e===nt.Start?(z(t.startRenderSpace,i.startRenderSpace),z(t.endRenderSpace,n.startRenderSpace)):(z(t.startRenderSpace,i.endRenderSpace),z(t.endRenderSpace,n.endRenderSpace)),t}var nt;function Bi(t,e,i,n){ct(t.startRenderSpace,e.startRenderSpace,i,n),ct(t.endRenderSpace,e.endRenderSpace,i,n)}function fe(t,e,i,n){switch(e){case y.Direct:return ge(t,i,n);case y.Horizontal:case y.Vertical:{const{elevationAlignedStartPoint:o,elevationAlignedEndPoint:s,dimension:a,geometry:l}=i;let r;a.measureType===y.Direct?(r=ji(l,n)===o.z>s.z,e===y.Horizontal&&(r=!r)):r=!Ni(l);const[m,u]=r?[o,s]:[s,o],h=Q(u,qi);return e===y.Horizontal?h.z=m.z:(h.x=m.x,h.y=m.y),n.toRenderCoords(m,t.startRenderSpace),n.toRenderCoords(h,t.endRenderSpace),t}}}function ge(t,e,i){return i.toRenderCoords(e.elevationAlignedStartPoint,t.startRenderSpace),i.toRenderCoords(e.elevationAlignedEndPoint,t.endRenderSpace),t}function ji(t,e){const i=t.directSegment.eval(.5,_.get()),n=e.worldUpAtPosition(i,_.get()),o=t.dimensionSegment.eval(.5,_.get()),s=k(_.get(),o,i);return!ae(s,Y)&&L(s,n)>0}function Ni(t){const{startRenderSpace:e,endRenderSpace:i}=t.dimensionSegment,{startRenderSpace:n,endRenderSpace:o}=t.directSegment;return Yt(n,e)<Yt(o,i)}(function(t){t[t.Start=0]="Start",t[t.End=1]="End"})(nt||(nt={}));const qi=qe(0,0,0,null);function Wi(t,e,i,n){const{directSegment:o}=i,s=yt(_.get(),{measureType:e,directSegment:o,renderCoordsHelper:n}),a=_e(Yi,{offsetAxis:s,offset:0,relativeToSegment:o,renderCoordsHelper:n}).eval(.5,_.get()),l=k(_.get(),t,a);return L(l,s)*n.unitInMeters}const Yi=new N;function yt(t,e){const{measureType:i,elevationAlignedStartPoint:n,elevationAlignedEndPoint:o,directSegment:{startRenderSpace:s,endRenderSpace:a},directSegment:l,renderCoordsHelper:r}=e,m=l.eval(.5,_.get()),u=r.worldUpAtPosition(m,_.get()),h=r.worldBasisAtPosition(m,Ne.Y,_.get());switch(i){case y.Horizontal:z(t,u);break;case y.Vertical:L(s,u)<L(a,u)?k(t,a,s):k(t,s,a),j(t,t,u),j(t,t,u);break;case y.Direct:{const g=zt(e.orientation,0);if(Vt({elevationAlignedStartPoint:n,elevationAlignedEndPoint:o}))qt(lt,-Nt(g),u),Wt(t,h,lt);else{const w=k(_.get(),a,s),P=j(_.get(),w,u);j(P,P,w),qt(lt,Nt(g),w),Wt(t,P,lt)}break}}return ae(t,Y)?z(t,h):je(t,t)}const lt=Ht();function Vt({elevationAlignedStartPoint:t,elevationAlignedEndPoint:e}){return c(t)&&c(e)&&t.x===e.x&&t.y===e.y}function _e(t,e){const{offsetAxis:i,offset:n,relativeToSegment:{startRenderSpace:o,endRenderSpace:s},relativeToSegment:a,renderCoordsHelper:l}=e,r=n/l.unitInMeters,[m,u]=Xi(o,s,i,r);return ct(t.startRenderSpace,a.startRenderSpace,i,m),ct(t.endRenderSpace,a.endRenderSpace,i,u),t}function Xi(t,e,i,n=0){const o=L(e,i),s=L(t,i),a=Math.abs(o-s)+n;return o>s?[a,n]:[n,a]}function vt(t,e,i){const n=e.directSegment.eval(.5,_.get());return i.worldUpAtPosition(n,t)}function It(t,e){const{startRenderSpace:i,endRenderSpace:n}=e.directSegment;return k(t,n,i)}function Gt(t,e,i={invert:!1}){const{startRenderSpace:n,endRenderSpace:o}=e.dimensionSegment;return i.invert?k(t,n,o):k(t,o,n)}function Dt(t,e){const i=t.directSegment.eval(.5,_.get());return e.headingAtPosition(i,t.primaryOffsetAxis)}function Ji(t,e){return Pt(Gt(Ki,t))/e**2}const Ki=C();function ye(t){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i}=t;if(f(e)||f(i))return!1;const n=li(e,i);return c(n)&&oe(n,"meters").value>ve}const ve=1e5;function ot(t){return c(t.geometry)}let B=class extends st{constructor(e){super(e),this._handles=new xt}initialize(){const{computations:e}=this.analysisViewData;for(const i of e)this._addComputation(i);this.addHandles(e.on("change",({added:i,removed:n})=>{for(const o of n)this._removeComputation(o);for(const o of i)this._addComputation(o)}))}destroy(){this._handles=it(this._handles)}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return Ie(this.view)}_addComputation(e){this._handles.has(e)||this._handles.add(S(()=>ft(e),i=>{const{measureType:n}=i;if(ye(i)&&n!==y.Direct){const s=Math.round(Ve(ve,"meters","kilometers"));return ne.getLogger(this.declaredClass).warnOnce(`A ${n} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${s} km. Update the measureType of the affected dimension to "direct" to display it.`),void(e.geometry=null)}const o=gt(i,this.view.renderCoordsHelper,e.geometry);e.geometry=o,e.result.length=Ui(o,n,this._defaultUnit)},R),e)}_removeComputation(e){this._handles.remove(e)}};p([d({constructOnly:!0})],B.prototype,"analysisViewData",void 0),p([d({constructOnly:!0})],B.prototype,"view",void 0),p([d()],B.prototype,"analysis",null),p([d()],B.prototype,"_defaultUnit",null),B=p([F("esri.views.3d.analysis.Dimension.support.DimensionController")],B);const Se={main:new G([255,127,0])};let Qi=class{constructor(){this.color=Se.main,this.opacity=.5,this.radius=5}};class Zi{constructor(){this.color=new G([127,127,127]),this.opacity=.5,this.radius=5}}let tn=class{constructor(){this.lineSizeFraction=.8}},en=class{constructor(){this.color=Se.main,this.opacity=.5,this.linePaddingPx=4,this.focusedLinePaddingPx=6,this.lengthFraction=.5,this.minLengthMeters=.1}};class nn{constructor(){this.calloutOffsetPx=18,this.calloutOpacity=.5,this.calloutWidth=2,this.discScale=.3,this.focusMultiplier=2}}let on=class{constructor(){this.lineSizeFraction=.25}},sn=class{constructor(){this.marginPx=20,this.minScreenLengthFontSizeFactor=5}};class an{constructor(){this.color=new G([255,127,0,.5])}}let rn=class{constructor(){this.pointManipulators=new Qi,this.offsetManipulator=new en,this.orientationManipulator=new nn,this.markers=new tn,this.labels=new sn,this.offsetLine=new on,this.constraint=new an,this.constraintThresholdPx=10,this.initialOffsetPx=50,this.orientationSnapThresholdDegrees=5,this.disabledPointIndicator=new Zi,this.smallScreenLengthLineSizeFactor=2,this.pointerMoveTimeoutMs=2500}};const v=new rn;class ln{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical}manipulatorName(e){return Object.keys(this).find(i=>this.hasOwnProperty(i)&&e===this[i])}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const i of He)e(this.manipulatorForMeasureType(i),i)}manipulatorForMeasureType(e){switch(e){case y.Direct:return this.direct;case y.Horizontal:return this.horizontal;case y.Vertical:return this.vertical}}}function pn(t,e){const i=mi(t,G.toUnitRGB(v.pointManipulators.color),v.pointManipulators.opacity,E);return i.available=!1,i.grabCursor="crosshair",i.radius=v.pointManipulators.radius,i.metadata=e.metadata,i.collisionPriority=1,i}function dn(t,e){const i=[ut(-.5,0,0),ut(.5,0,0)],{lengthFraction:n}=v.offsetManipulator,o=bt(e.unfocusedMaterial,i.map(a=>at(C(),a,n))),s=o.instantiate({material:e.focusedMaterial});return new ce({view:t,renderObjects:[new tt(o,Z.Unfocused|Z.Selected|E),new tt(s,Z.Focused|E)],collisionType:{type:"line",paths:[i]},radius:Ft(e.lineSizePt)/2,metadata:e.metadata,available:!1,...ue})}function Me(t,{lineSizePt:e,material:i}){const{calloutOffsetPx:n,calloutOpacity:o,calloutWidth:s,discScale:a,focusMultiplier:l}=v.orientationManipulator;return{calloutLength:.25*_i*v.markers.lineSizeFraction*H(e)+n,calloutOpacity:o,calloutWidth:s,customStateMask:E,discScale:a,focusMultiplier:l,material:i,metadata:t}}function te(t,e){return ci(t,Me(e.metadata,e))}function ee(t,e){ui(t,Me(t.metadata,e))}function mn(t,e){const i=[ut(-.5,0,0),ut(.5,0,0)],{lengthFraction:n}=v.offsetManipulator,o=bt(e.thinOffsetManipulatorMaterial,i),s=bt(e.unfocusedMaterial,i.map(l=>at(C(),l,n))),a=s.instantiate({material:e.focusedMaterial});return new ce({view:t,renderObjects:[new tt(s,Z.Unfocused|E),new tt(a,Z.Focused|E),new tt(o,E)],collisionType:{type:"line",paths:[i]},radius:Ft(e.lineSizePt)/2,available:!1,metadata:e.metadata,...ue})}function cn(t,{isStart:e,createSnappingPipelineStep:i,dimension:n,onUpdate:o,view:s}){const a=e?"startPoint":"endPoint";return[rt(t,(r,m,u,h)=>{const g=Et(r),{snappingStep:w,cancelSnapping:P}=i(h);u=u.next(g).next(Lt(n,[a,"measureType","orientation"])).next(P),m.next(g).next(fi(s)).next(...w).next(O=>{const M=Q(O.mapEnd,new W);o(a==="startPoint"?{startPoint:M}:{endPoint:M})})})]}function un(t,{computation:e,view:i}){return[rt(t,(n,o,s)=>{if(!ot(e)||!n.selected)return;const{geometry:a,dimension:l}=e,r=Et(n);o.next(r).next(Pe(i,l,a.dimensionSegment,a.primaryOffsetAxis)),s.next(r).next(Lt(l,["offset"]))})]}function hn(t,{computation:e,view:i}){return[rt(t,(n,o,s)=>{we({cancel:s,computation:e,settingHeading:!0,steps:o,view:i})})]}function fn(t,{computation:e,view:i}){return[rt(t,(n,o,s)=>{we({cancel:s,computation:e,settingHeading:!1,steps:o,view:i})}),t.events.on("immediate-click",n=>{gn(n,e,i)})]}function gn(t,e,i){const{dimension:n,geometry:o}=e;if(n.orientation===90||n.orientation===270)return n.orientation=0,void t.stopPropagation();if(f(o))return;const{renderCoordsHelper:s}=i,a=gt({...ft(e),orientation:90},s),l=gt({...ft(e),orientation:270},s);if(f(a)||f(l))return;const r=Dt(a,s),m=Dt(l,s),u=be(o,i),h=Ct.shortestSignedDiff(u,r),g=Ct.shortestSignedDiff(u,m);n.orientation=Math.abs(h)<Math.abs(g)?90:270,t.stopPropagation()}function we(t){const{cancel:e,computation:i,settingHeading:n,steps:o,view:s}=t;if(!ot(i))return;const{renderCoordsHelper:a}=s,{dimension:l,geometry:r}=i,m=C(),u=$e(C(),r,r.directSegment,a),h=Oe(_.get(),{forHeading:n,geometry:r,renderCoordsHelper:a}),g=$t(u,h,Ot()),w=zt(l.orientation,n?()=>Dt(r,s.renderCoordsHelper):0);o.next(he(s,g)).next(P=>{P.action==="start"&&z(m,P.renderStart);const O=di(g),M=hi(m,P.renderEnd,u,O);let V=w-Fe(M);n||(V=_n(V)),l.orientation=V}),e.next(Lt(l,["orientation"]))}function _n(t){const e=Ct.normalize(t)%90;return e<v.orientationSnapThresholdDegrees?t-e:90-e<v.orientationSnapThresholdDegrees?t+(90-e):t}function yn(t,{computation:e,manipulatorMeasureType:i,view:n}){let o=y.Direct,s=0,a=0;return[t.events.on("grab-changed",l=>{if(l.action!=="start"||!ot(e))return;const{dimension:r,geometry:m}=e;o=r.measureType,s=r.offset,a=r.orientation;const u=z(_.get(),t.renderLocation);r.measureType=i,r.offset=Wi(u,i,m,n.renderCoordsHelper),r.orientation=0}),rt(t,(l,r,m)=>{if(!ot(e))return;const{geometry:u,dimension:h}=e,{renderCoordsHelper:g}=n,w=fe(Te,i,e,g),P=yt(_.get(),{measureType:i,directSegment:u.directSegment,renderCoordsHelper:g}),O=Et(l);r.next(O).next(Pe(n,h,w,P)),m.next(O).next(M=>(h.measureType=o,h.offset=s,h.orientation=a,M))})]}function Pe(t,e,i,n){const o=re(_.get(),i.endRenderSpace,i.startRenderSpace);j(o,o,n);const s=$t(i.startRenderSpace,o,Ot()),a=$t(i.startRenderSpace,n,Ot()),l=e.offset;let r,m=0;const u=new Si;return u.next(he(t,s)).next(h=>{h.action==="start"&&(m=Qt(a,h.renderStart));const g=(Qt(a,h.renderEnd)-m)*t.renderCoordsHelper.unitInMeters;e.offset=l+g,r=h}),h=>(u.execute(h),r)}function be(t,e){const{directSegment:i}=t,{renderCoordsHelper:n}=e,o=vt(_.get(),t,n),s=It(_.get(),t),a=j(_.get(),s,o),{viewForward:l}=e.state.camera;L(a,l)>0&&at(a,a,-1);const r=i.eval(.5,_.get());return n.headingAtPosition(r,a)}function vn(t,e,i){const{dimensionSegment:n,primaryOffsetAxis:o}=e,s=Gt(et,e),a=le(s,Y)?Ue(_t):kt(s,o,Y,_t),l=Math.max(pe(s),v.offsetManipulator.minLengthMeters/i.unitInMeters);se(a,a,de(et,l,l,l)),t.modelTransform=a,t.renderLocation=n.eval(.5,et)}function Sn(t,e,i){Ce(t,e,i,{forHeading:!0})}function Mn(t,e,i){Ce(t,e,i,{forHeading:!1})}function Ce(t,e,i,{forHeading:n}){const{dimension:o,geometry:s}=e,{primaryOffsetAxis:a}=s,l=at(wn,a,o.offset>=0?1:-1),r=Oe(Pn,{forHeading:n,geometry:s,renderCoordsHelper:i});j(r,r,l);const m=kt(l,r,Y,_t);t.modelTransform=m,t.renderLocation=$e(et,s,s.dimensionSegment,i)}const wn=C(),Pn=C();function bn(t,e,i,n){const{geometry:o}=e,s=fe(Te,i,e,n),a=yt(et,{measureType:i,directSegment:o.directSegment,renderCoordsHelper:n}),l=k(St,s.endRenderSpace,s.startRenderSpace),r=kt(l,a,Y,_t),m=pe(l);se(r,r,de(St,m,m,m)),t.modelTransform=r,t.renderLocation=s.eval(.5,St)}function $e(t,e,i,n){const{startRenderSpace:o,endRenderSpace:s}=i,a=Cn(e,n)?o:s;return z(t,a)}function Oe(t,{forHeading:e,geometry:i,renderCoordsHelper:n}){return e?vt(t,i,n):Gt(t,i,{invert:!0})}function Cn(t,e){const i=It($n,t),n=vt(On,t,e);return L(i,n)>0}const $n=C(),On=C();function Tn(t){return H(t)+v.offsetManipulator.linePaddingPx}function Ft(t){return H(t)+v.offsetManipulator.focusedLinePaddingPx}const E=We.Custom1,et=C(),St=C(),_t=Ht(),Te=new N;function Dn(t){let e,i,n=[],o=!1;function s(...a){return o&&e===this&&xn(a,n)||(i=t.apply(this,a),e=this,n=a,o=!0),i}return s}function xn(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}var A;function An(t,e){return{enabled:e.effectiveFeatureEnabled,elevationAlignedStartPoint:t.elevationAlignedStartPoint,elevationAlignedEndPoint:t.elevationAlignedEndPoint,geometry:t.geometry}}function zn(t,e){if(ye(t))return A.Direct;if(!t.enabled)return null;const{geometry:i}=t;if(f(i)||le(i.directSegment.startRenderSpace,i.directSegment.endRenderSpace))return null;const{constraintThresholdPx:n}=v,{camera:o}=e.state,s=vt(_.get(),i,e.renderCoordsHelper),a=It(_.get(),i),l=at(_.get(),s,L(a,s)),r=re(_.get(),a,l),m=Pt(r),u=Pt(l),{startRenderSpace:h,endRenderSpace:g}=i.directSegment,w=Math.max(o.computeRenderPixelSizeAt(h)*n,o.computeRenderPixelSizeAt(g)*n)**2;return m<w?A.Vertical:u<w?A.Horizontal:null}function Rn(t,e,{constraint:i,view:n}){const{unconstrainedGeometry:o}=t;if(f(o))return;const{renderCoordsHelper:s,spatialReference:a}=n,{startRenderSpace:l,endRenderSpace:r}=o.directSegment,m=s.fromRenderCoords(l,new W,a),u=s.fromRenderCoords(r,new W,a);let h;h=e==="start"?{startPoint:m}:{endPoint:u},De(t,h,{constraint:i,elevationAlignedStartPoint:t.elevationAlignedStartPoint,elevationAlignedEndPoint:t.elevationAlignedEndPoint,unconstrainedGeometry:o,view:n})}function De(t,e,i){const{constraint:n,elevationAlignedStartPoint:o,elevationAlignedEndPoint:s,unconstrainedGeometry:a,view:l}=i,{dimension:r,previousConstraint:m,preConstraintProperties:u}=t;if(f(o)||f(s))return;const h=()=>{"startPoint"in e?r.startPoint=e.startPoint:"endPoint"in e&&(r.endPoint=e.endPoint)};if(f(n))h(),c(m)&&c(u)&&(r.measureType=u.measureType,r.orientation=u.orientation);else switch(r.measureType=y.Direct,n){case A.Horizontal:if(n!==m&&(r.orientation=0),"startPoint"in e){const g=e.startPoint;c(g)&&(g.z=s.z),r.startPoint=g}else if("endPoint"in e){const g=e.endPoint;c(g)&&(g.z=o.z),r.endPoint=g}break;case A.Vertical:if(n!==m&&(r.orientation=be(a,l)),"startPoint"in e){const g=e.startPoint;c(g)&&(g.x=s.x,g.y=s.y),r.startPoint=g}else if("endPoint"in e){const g=e.endPoint;c(g)&&(g.x=o.x,g.y=o.y),r.endPoint=g}break;case A.Direct:n!==m&&c(u)&&(r.orientation=u.orientation),h()}t.previousConstraint=n,t.unconstrainedGeometry=a}(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Direct=2]="Direct"})(A||(A={}));function Hn(t,e){const i=new Ye({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:(e==null?void 0:e.distance)??Xt.distance,touchSensitivityMultiplier:(e==null?void 0:e.touchSensitivityMultiplier)??Xt.touchSensitivityMultiplier});return{...S(()=>{var n,o;return((o=(n=t.map)==null?void 0:n.allLayers)==null?void 0:o.toArray())??[]},n=>{i.featureSources=new At(n.map(o=>new Xe({layer:o,enabled:!0})))},mt),options:i}}const pt=new Map;function kn(t){if(!pt.has(t)){const n=Hn(t,{distance:10}),o=Ln(t,n.options);pt.set(t,{referenceCount:0,snappingManager:o,remove:()=>{n.remove(),o.destroy()}})}const e=pt.get(t);e.referenceCount++;const i=dt(()=>En(t,e));return{snappingManager:e.snappingManager,...i}}function En(t,e){e.referenceCount--,e.referenceCount>0||Ai(()=>{e.referenceCount===0&&(e.remove(),pt.delete(t))})}function Ln(t,e){return new Je({view:t,options:e,snappingEnginesFactory:(i,n)=>[new Ke({view:t,spatialReference:t.spatialReference,options:n})]})}let b=class extends Mi{constructor(t){super(t),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new xt,this._getSnappingContext=Dn(i=>new zi({elevationInfo:{mode:"absolute-height",offset:0},pointer:i,editGeometryOperations:new Ti(new Di("point",xi(!0,!1,this.view.spatialReference))),visualizer:new Pi})),this._snappingManagerResult=kn(t.view),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=Mt(),this._focusedOffsetManipulatorMaterial=Mt(),this._thinOffsetManipulatorMaterial=Mt(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:ht(2)}),this._constraintSnappingIndicator=new U({view:t.view,attached:!0,width:1,color:G.toUnitRGBA(v.constraint.color),renderOccluded:x.OccludeAndTransparent,stipplePattern:ht(5)});const e=G.toUnitRGBA(v.disabledPointIndicator.color);e[3]*=v.disabledPointIndicator.opacity,this._stagedStartIndicator=new wi({view:t.view,attached:!1,color:e,size:2*v.disabledPointIndicator.radius,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:t.view.renderCoordsHelper.spatialReference,outlineSize:0,renderOccluded:x.OccludeAndTransparent})}initialize(){this._snappingOperation=new Ri({view:this.view}),this._orientationManipulatorTexture=gi(this.view.toolViewManager.textures),this._orientationManipulatorMaterial=new Oi({transparent:!0,writeDepth:!1,textureId:this._orientationManipulatorTexture.texture.id,renderOccluded:x.Opaque});const{computations:t}=this.analysisViewData;for(const e of t)this._addComputation(e);this.addHandles([t.on("after-add",e=>this._addComputation(e.item)),t.on("after-remove",e=>this._removeComputation(e.item))]),this.addHandles([S(()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation}),({stagedPoint:e,stagedComputation:i})=>{if(f(i)||f(e))return;const n=Q(e,new W);this._applyPointUpdate(i,{endPoint:n})},wt),S(()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}),(e,i)=>{const{stagedDimension:n,selectedComputation:o,firstGrabbedManipulator:s}=e;if(n===(i==null?void 0:i.stagedDimension)&&s===(i==null?void 0:i.firstGrabbedManipulator)){for(const a of[o,i==null?void 0:i.selectedComputation])if(c(a)){const l=this._computationManipulators.get(a);this._updateManipulators(a,l,e)}}else for(const[a,l]of this._computationManipulators)this._updateManipulators(a,l,e)},R),S(()=>this.analysis.style.lineSize,e=>{this._updateManipulatorStyle(e)},mt),S(()=>this.view.state.camera,()=>{c(this._stagedComputation)&&this._updateStagedDimensionOffset(this._stagedComputation)}),S(()=>Ae(this._stagedComputation,e=>{const i=e.elevationAlignedStartPoint,n=C();return c(i)&&this.view.renderCoordsHelper.toRenderCoords(i,n)?n:null}),e=>{c(e)?(this._stagedStartIndicator.vertices=[e],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1})]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),Qe(this,()=>{const e=this._activeComputation,i=this._stagedComputation;if(f(e)||c(i)){const n=zt(this.view.inputManager.latestPointerType,"mouse"),o=this._getSnappingContext(n);this.updatingHandles.addPromise(Kt(this._snappingOperation.resnap(this._snappingManager,o)))}if(c(e)){const{start:n,end:o}=this._computationManipulators.get(e);if(n.grabbing||o.grabbing){const s=n.grabbing?"start":"end",a=this._computeConstraint(e);Rn(e,s,{constraint:a,view:this.view})}}})}destroy(){this._snappingOperation=it(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorMaterial.dispose(),this._orientationManipulatorTexture.release()}get updating(){return this.updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(c(this._stagedComputation))return this._stagedComputation;const{selectedComputation:t}=this.analysisViewData;return this.hasGrabbedManipulators&&c(t)?t:null}get _stagedComputation(){const t=this._stagedDimension,e=this.analysisViewData.computations.at(-1);return f(t)||f(e)||e.dimension!==t?null:e}get _constraintHandles(){return[Rt(()=>this.analysisViewData.selectedComputation,t=>{t.previousConstraint=this._computeConstraint(t)},{...R,equals:Tt}),S(()=>{const t=this._activeComputation;if(f(t))return null;const{measureType:e,orientation:i}=t.dimension;return{measureType:e,orientation:i,computation:t}},(t,e)=>{if(c(t)&&f(e)){const{measureType:i,orientation:n,computation:o}=t;switch(o.previousConstraint){case A.Horizontal:o.preConstraintProperties={measureType:y.Horizontal,orientation:0};break;case A.Vertical:o.preConstraintProperties={measureType:y.Vertical,orientation:0};break;case A.Direct:o.preConstraintProperties={measureType:y.Direct,orientation:n};break;default:o.preConstraintProperties={measureType:i,orientation:n}}}f(t)&&c(e)&&(e.computation.preConstraintProperties=null)},wt)]}get _snappingIndicatorHandles(){const t="snapping-indicator-event-handles";return[S(()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation}),({stagedComputation:e,activeComputation:i})=>{const n=this._constraintSnappingIndicator;if(this.removeHandles(t),f(i))n.attached=!1;else if(i===e)n.attached=!0;else{const{start:o,end:s}=this._computationManipulators.get(i),a=()=>{n.attached=o.grabbing||s.grabbing};a(),this.addHandles([o.events.on("grab-changed",a),s.events.on("grab-changed",a)],t)}}),S(()=>{const e=this._activeComputation;return c(e)?{geometry:e.geometry,constraint:e.previousConstraint}:{}},({geometry:e,constraint:i})=>{const n=this._constraintSnappingIndicator;c(e)&&c(i)&&i!==A.Direct?(n.visible=!0,n.setGeometryFromSegment(e.directSegment)):n.visible=!1})]}removeStaged(){return!!c(this._stagedDimension)&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(t){const{_stagedDimension:e}=this;if(f(e)){const i=this._onUnstagedClick(t);return this.analysis.dimensions.add(i),null}return this._onStagedClick(t),e}onPointerMove({mapPoint:t,pointerType:e}){if(e==="touch")return;const i=this._getSnappingContext(e);this.updatingHandles.addPromise(Kt(this._snappingOperation.snap({point:t},this._snappingManager,i)))}onManipulatorSelectionChanged(){c(this.analysisViewData.selectedComputation)&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick({mapPoint:t,pointerType:e}){let i=t;if(e==="mouse"){const o=this._getSnappingContext(e);i=this._snappingManager.update({point:t,context:o})}const n=new ke({startPoint:Q(i,new W),endPoint:null,measureType:y.Horizontal});return this._stagedDimension=n,this._resetSnappingState(),n}_onStagedClick({mapPoint:t,pointerType:e}){const i=this._stagedComputation;if(f(i))return;let n=t;if(e==="mouse"){const s=this._getSnappingContext(e);n=this._snappingManager.update({point:t,context:s})}const o=Q(n,new W);this._applyPointUpdate(i,{endPoint:o}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_addComputation(t){if(this._computationManipulators.has(t))return;const e=this._setupPointManipulator(t,{isStart:!0}),i=this._setupPointManipulator(t,{isStart:!1}),n=this._setupOffsetManipulator(t),o=this._setupHeadingManipulator(t),s=this._setupRotationManipulator(t),a=this._setupMeasureTypeManipulator(t,y.Direct),l=this._setupMeasureTypeManipulator(t,y.Horizontal),r=this._setupMeasureTypeManipulator(t,y.Vertical),m=new ln({start:e,end:i,offset:n,heading:o,rotation:s,direct:a,horizontal:l,vertical:r});this._setupComputationToManipulatorsSync(t,m),this._computationManipulators.set(t,m),this.manipulators.addMany(m.values())}_removeComputation(t){const e=this._computationManipulators.get(t);if(!f(e)){this._computationHandles.remove(t),this._computationManipulators.delete(t);for(const i of e.values())this.manipulators.remove(i)}}_setupComputationToManipulatorsSync(t,e){this._computationHandles.add([S(()=>t.geometry,()=>this._updateManipulators(t,e),{...R,equals:Tt})],t)}_setupPointManipulator(t,e){const{view:i}=this,{dimension:n}=t,o=pn(i,{metadata:n}),s=cn(o,{isStart:e.isStart,createSnappingPipelineStep:a=>Hi({snappingContext:this._getSnappingContext(a),snappingManager:this._snappingManager,updatingHandles:this.updatingHandles}),dimension:n,onUpdate:a=>this._applyPointUpdate(t,a),view:i});return this._computationHandles.add(s,t),o}_setupOffsetManipulator(t){const{view:e}=this,i=dn(e,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:t.dimension}),n=un(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupHeadingManipulator(t){const{view:e}=this,i=te(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:t.dimension}),n=hn(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupRotationManipulator(t){const{view:e}=this,i=te(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:t.dimension}),n=fn(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupMeasureTypeManipulator(t,e){const{view:i}=this,n=mn(i,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:t.dimension}),o=yn(n,{computation:t,manipulatorMeasureType:e,view:i});return this._computationHandles.add(o,t),n}_updateManipulators(t,e,i={stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}){const{stagedDimension:n,selectedComputation:o,firstGrabbedManipulator:s}=i,{start:a,end:l,offset:r,heading:m,rotation:u}=e,h=o===t,g=ot(t),{dimension:w}=t;for(const M of e.values()){const V=g&&f(n)&&(f(s)||M===s);M===r?(M.available=V,M.selected=h):M.available=V&&h}if(!g)return;c(this._computeConstraint(t))?e.forEachMeasureTypeManipulator(M=>M.available=!1):e.manipulatorForMeasureType(w.measureType).available=!1;for(const M of[m,u])w.measureType===y.Direct&&w.offset!==0||(M.available=!1);Vt(t)?u.available=!1:m.available=!1;const{geometry:P}=t;a.renderLocation=P.directSegment.startRenderSpace,l.renderLocation=P.directSegment.endRenderSpace;const{renderCoordsHelper:O}=this.view;vn(r,P,O),m.available&&Sn(m,t,O),u.available&&Mn(u,t,O),e.forEachMeasureTypeManipulator((M,V)=>{M.available&&bn(M,t,V,O)})}_updateManipulatorStyle(t){const e=Tn(t),i=Ft(t),n={lineSizePt:t,material:this._orientationManipulatorMaterial};for(const{offset:o,heading:s,rotation:a}of this._computationManipulators.values())o.radius=i/2,ee(s,n),ee(a,n);this._unfocusedOffsetManipulatorMaterial.setParameters({width:e}),this._focusedOffsetManipulatorMaterial.setParameters({width:i})}_applyPointUpdate(t,e){const{view:i}=this,n=ft(t);"startPoint"in e&&(n.elevationAlignedStartPoint=e.startPoint),"endPoint"in e&&(n.elevationAlignedEndPoint=e.endPoint);const o=gt(n,i.renderCoordsHelper);if(f(o))return;const s=this._computeConstraint({...n,geometry:o});De(t,e,{...n,constraint:s,unconstrainedGeometry:o,view:i}),t===this._stagedComputation&&this._updateStagedDimensionOffset(t)}_updateStagedDimensionOffset(t){if(f(t.geometry))return;t.geometry.directSegment.eval(.5,ie);const e=this.view.state.camera.computeRenderPixelSizeAt(ie);t.dimension.offset=v.initialOffsetPx*e}_computeConstraint(t){return zn(An(t,this._snappingManager.options),this.view)}get testInfo(){const t=e=>this.analysisViewData.computations.find(i=>i.dimension===e);return{disableManipulatorPartialOcclusion:()=>{this._stagedStartIndicator.renderOccluded=x.Occlude,this.manipulators.forEach(({manipulator:e})=>{for(const{geometry:i}of e.renderObjects)i.material.setParameters({renderOccluded:x.Occlude})})},getManipulatorsForDimension:e=>this._computationManipulators.get(t(e)),getComputationForDimension:e=>t(e),getConstraintForDimension:e=>{const i=t(e);return c(i)?this._computeConstraint(i):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};function Mt(){const{color:t,opacity:e}=v.offsetManipulator;return new J({color:[...G.toUnitRGB(t),e],width:1,renderOccluded:x.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0})}p([d({constructOnly:!0})],b.prototype,"analysis",void 0),p([d({constructOnly:!0})],b.prototype,"analysisViewData",void 0),p([d({constructOnly:!0})],b.prototype,"manipulators",void 0),p([d({constructOnly:!0})],b.prototype,"parentTool",void 0),p([d({constructOnly:!0,nonNullable:!0})],b.prototype,"view",void 0),p([d({readOnly:!0})],b.prototype,"updating",null),p([d()],b.prototype,"firstGrabbedManipulator",null),p([d()],b.prototype,"hasGrabbedManipulators",null),p([d()],b.prototype,"snappingOptions",null),p([d()],b.prototype,"_stagedDimension",void 0),p([d()],b.prototype,"_activeComputation",null),p([d()],b.prototype,"_stagedComputation",null),b=p([F("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],b);const ie=C();var q;(function(t){t.Ready="ready",t.Creating="creating",t.Created="created"})(q||(q={}));let T=class extends ki{constructor(t){super(t),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=v.pointerMoveTimeoutMs,this._prevPointerMoveTimeout=null}initialize(){this._intersector=Ze(this.view.state.viewingMode),this._intersector.options.store=ti.MIN,this._lengthDimensionSubTool=new b({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([xe(this._lengthDimensionSubTool),dt(()=>this._clearPointerMoveTimeout()),S(()=>this.state,t=>{t===q.Created&&this.finishToolCreation()},R),Rt(()=>this.firstGrabbedManipulator,t=>{this.selectedDimension=t.metadata},R),S(()=>this.selectedDimension,()=>this._resetPointerMoveTimeout(),R)])}get state(){return this.analysis.dimensions.some(t=>t.type==="length")?c(this._activeSubTool)?q.Creating:q.Created:q.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(t){this.analysisViewData.selectedDimension=t}onInputEvent(t){switch(t.type){case"immediate-click":this._clickHandler(t);break;case"immediate-double-click":this._doubleClickHandler(t);break;case"pointer-move":this._pointerMoveHandler(t);break;case"key-down":if(Jt.cancel===t.key){if(c(this._activeSubTool)&&this._activeSubTool.removeStaged())return void t.stopPropagation();this.active||(this.selectedDimension=null)}else Jt.delete.includes(t.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){c(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(t){if(this.hasFocusedManipulators)return void t.stopPropagation();if(f(this._activeSubTool))return;const e=this._intersectScreen(t);f(e)||(this.selectedDimension=this._activeSubTool.onClick({mapPoint:e,pointerType:t.pointerType}),t.stopPropagation())}_doubleClickHandler(t){this.active&&(this.view.activeTool=null,t.stopPropagation())}_pointerMoveHandler(t){if(this._resetPointerMoveTimeout(),f(this._activeSubTool)||this.hasFocusedManipulators)return;const e=this._intersectScreen(t);f(e)||this._activeSubTool.onPointerMove({mapPoint:e,pointerType:t.pointerType})}_deleteKeyHandler(){c(this._activeSubTool)&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(t){const e=ei(t);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(e,this._intersector);const i=this._intersector.results.min,n=_.get();return i.getIntersectionPoint(n)?this.view.renderCoordsHelper.fromRenderCoords(n,this.view.spatialReference):null}_removeSelected(){c(this.selectedDimension)&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=ze(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach(t=>{t.manipulator.state|=E}),this._prevPointerMoveTimeout=pi.setTimeout(()=>{this.manipulators.forEach(t=>{t.manipulator.state&=~E})},this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:t=>{this._pointerMoveTimerMs=t,this._resetPointerMoveTimeout()}}}};p([d({constructOnly:!0})],T.prototype,"view",void 0),p([d({constructOnly:!0})],T.prototype,"analysis",void 0),p([d({readOnly:!0})],T.prototype,"state",null),p([d({readOnly:!0})],T.prototype,"updating",null),p([d({readOnly:!0})],T.prototype,"cursor",null),p([d({constructOnly:!0})],T.prototype,"analysisViewData",void 0),p([d()],T.prototype,"selectedDimension",null),p([d()],T.prototype,"automaticManipulatorSelection",void 0),p([d()],T.prototype,"_activeSubTool",void 0),p([d()],T.prototype,"_lengthDimensionSubTool",void 0),T=p([F("esri.views.3d.analysis.Dimension.DimensionTool")],T);let Vn=class extends bi{constructor(e,i){super(e),this._hasExternalMaterial=!1,this._renderOccluded=x.OccludeAndTransparent,this._width=1,this._color=ii(1,0,1,1),this._placement="end",this._textureId=null,this._material=i,this._hasExternalMaterial=c(i),this.applyProps(e)}setGeometryFromSegment(e,i){const n=e.endRenderSpace;this.transform=Be(In,n),this._normal=i;const{points:o}=e.createRenderGeometry(n,this.view.renderCoordsHelper);this.geometry=[o]}get renderOccluded(){return c(this._material)?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(e){this._renderOccluded=e,c(this._material)&&this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry()}get width(){return c(this._material)?this._material.parameters.width:this._width}set width(e){this._width=e,c(this._material)&&this._material.setParameters({width:e})}get color(){return c(this._material)?this._material.parameters.color:this._color}set color(e){this._color=ni(e),c(this._material)&&this._material.setParameters({color:this._color})}get placement(){return c(this._material)?this._material.parameters.placement:this._placement}set placement(e){this._placement=e,c(this._material)&&this._material.setParameters({placement:this._placement})}get textureId(){return c(this._material)?this._material.parameters.textureId:this._textureId}set textureId(e){this._textureId=e,c(this._material)&&this._material.setParameters({textureId:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new me({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,textureId:this._textureId}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const i of oi(this.geometry,this.normal)){const n=si(Ut(this._material),i);e.addGeometry(n)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(Ut(this._material))}};const In=Ht();class Gn{set visible(e){for(const i of this._visualElements.values())i.attached=e}constructor(e){this.destroyed=!1,this._handles=new xt,this._messages=null,this._labelSegment=new N;const{analysis:i,computation:n,view:o,messages:s}=e;this.analysis=i,this.computation=n,this.view=o,this._messages=s;const a=e.visible,l={view:o,attached:a},{fontSize:r,textColor:m,textBackgroundColor:u}=i.style;this._visualElements=new Nn({marker:new Vn(l,e.markerMaterial),dimension:new U(l,e.dimensionLineMaterial),startOffset:new U(l,e.offsetLineMaterial),endOffset:new U(l,e.offsetLineMaterial),dimensionSmall:new U(l,e.smallDimensionLineMaterial),startOffsetSmall:new U(l,e.smallOffsetLineMaterial),endOffsetSmall:new U(l,e.smallOffsetLineMaterial),label:new ai({view:o,attached:a,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:H(r),textColor:m.clone(),backgroundColor:u.clone()})}),this._handles.add([S(()=>n.geometry,h=>{this.updateCameraDependentElements(o.state.camera,h,i.style),c(n.geometry)&&this._updateLines(n.geometry)},{...mt,equals:Tt}),S(()=>n.length,h=>this._updateLabelContent(h),mt)])}destroy(){this.destroyed=!0,this._handles=it(this._handles);for(const e of this._visualElements.values())e.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(e){const i=Zt(Un,nt.Start,e.directSegment,e.dimensionSegment),n=Zt(Bn,nt.End,e.directSegment,e.dimensionSegment),o=this._visualElements;o.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),o.dimension.setGeometryFromSegment(e.dimensionSegment),o.startOffset.setGeometryFromSegment(i),o.endOffset.setGeometryFromSegment(n),o.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),o.startOffsetSmall.setGeometryFromSegment(i),o.endOffsetSmall.setGeometryFromSegment(n)}updateCameraDependentElements(e,i,n){const o=this._visualElements;if(f(i)){for(const O of o.values())O.visible=!1;return}const s=e.computeScreenPixelSizeAt(i.dimensionSegment.eval(.5,jn)),a=Ji(i,s),l=a<(H(n.lineSize)*v.smallScreenLengthLineSizeFactor)**2,r=!l;o.marker.visible=r,o.dimension.visible=r,o.startOffset.visible=r,o.endOffset.visible=r,o.dimensionSmall.visible=l,o.startOffsetSmall.visible=l,o.endOffsetSmall.visible=l;const m=H(n.fontSize)*v.labels.minScreenLengthFontSizeFactor,{label:u}=o;if(u.visible=a>=m**2,!u.visible)return;const{dimensionSegment:h,primaryOffsetAxis:g}=i,{offset:w}=this.computation.dimension,P=(Math.sign(w)>=0?1:-1)*Fn(n)*s;Bi(this._labelSegment,h,g,P),u.updateLabelPosition()}updateLabelStyle(e){const{label:i}=this._visualElements;i.fontSize=H(e.fontSize),i.textColor=e.textColor,i.backgroundColor=e.textBackgroundColor}updateUnitsMessages(e){this._messages=e;const{length:i}=this.computation;this._updateLabelContent(i)}_updateLabelContent(e){const{label:i}=this._visualElements;f(e)||f(this._messages)?i.text="":i.text=Ge(this._messages,e,e.unit)}}function Fn(t){return 1.5*H(t.fontSize)+v.labels.marginPx+H(t.lineSize/2)}const Un=new N,Bn=new N,jn=C();class Nn{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}let qn=class{constructor(e,i){this._textures=e,this._textureRepository=i,this._texturesByPrimitive=new Map}acquire(e){if(!this._texturesByPrimitive.has(e)){const i=yi(this._textures,e),n=new Ii(this._textureRepository,i.texture.id);return this._texturesByPrimitive.set(e,{result:i,reference:n}),i.texture}return this._texturesByPrimitive.get(e).result.texture}destroy(){this._texturesByPrimitive.forEach(({result:e,reference:i})=>{i.dispose(),e.release()}),this._texturesByPrimitive.clear()}},I=class extends st{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(t){super(t),this.loadingMessages=!1,this._messages=null,this._dimensionVisualizations=new Map,this._markerMaterial=new me({width:1,anchor:vi.Tip,color:X,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:x.OccludeAndTransparent}),this._dimensionLineMaterial=new J({width:1,color:X,renderOccluded:x.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters}),this._offsetLineMaterial=new J({width:1,color:X,renderOccluded:x.OccludeAndTransparent,stipplePattern:ht(5),stippleScaleWithLineWidth:!0}),this._smallDimensionLineMaterial=new J({width:1,color:X,renderOccluded:x.OccludeAndTransparent}),this._smallOffsetLineMaterial=new J({width:1,color:X,renderOccluded:x.OccludeAndTransparent,stipplePattern:ht(5),stippleScaleWithLineWidth:!0})}initialize(){var i;const t=(i=this.view.sharedSymbolResources)==null?void 0:i.textures;if(c(t)){const{textureRepository:n}=this.view._stage.renderView,o=new qn(t,n),s=o.acquire("triangle");this.addHandles(dt(()=>o.destroy())),this._markerMaterial.setParameters({textureId:s.id})}for(const n of this._lineMaterials())this.view._stage.add(n),this.addHandles(dt(()=>{this.view._stage.remove(n),n.dispose()}));const{computations:e}=this.analysisViewData;for(const n of e)this._addComputation(n);this.addHandles([e.on("change",({added:n,removed:o})=>{for(const s of o)this._removeComputation(s);for(const s of n)this._addComputation(s)}),S(()=>G.toUnitRGBA(this.analysis.style.color),n=>{for(const o of this._lineMaterials())o.setParameters({color:n})},R),S(()=>this.analysis.style.lineSize,n=>{const o=H(n);this._markerMaterial.setParameters({width:o*v.markers.lineSizeFraction}),this._dimensionLineMaterial.setParameters({width:o,markerParameters:this._markerMaterial.parameters});const s=Math.max(o*v.offsetLine.lineSizeFraction,1);this._offsetLineMaterial.setParameters({width:s})},R),S(()=>({camera:this.view.state.camera,style:Wn(this.analysis)}),({camera:n,style:o})=>{for(const[s,a]of this._dimensionVisualizations)a.updateCameraDependentElements(n,s.geometry,o),a.updateLabelStyle(o)}),S(()=>this.visible,n=>{for(const o of this._dimensionVisualizations.values())o.visible=n})]),this.addHandles([Gi(()=>this._updateMessageBundle()),Rt(()=>!this.loadingMessages,()=>{for(const n of this._dimensionVisualizations.values())n.updateUnitsMessages(this._messages)},wt)]),this._updateMessageBundle()}destroy(){this._dimensionVisualizations.forEach(t=>{t.destroy()}),this._dimensionVisualizations.clear()}get testInfo(){return{visualizations:Array.from(this._dimensionVisualizations.values()),disablePartialOcclusion:()=>{for(const t of this._lineMaterials())t.setParameters({renderOccluded:x.Occlude})}}}_addComputation(t){this._dimensionVisualizations.has(t)||this._dimensionVisualizations.set(t,new Gn({analysis:this.analysis,computation:t,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages}))}_removeComputation(t){const e=this._dimensionVisualizations.get(t);f(e)||(e.destroy(),this._dimensionVisualizations.delete(t))}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await Fi("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function Wn(t){const{fontSize:e,lineSize:i,textColor:n,textBackgroundColor:o}=t.style;return{fontSize:e,lineSize:i,textBackgroundColor:o.clone(),textColor:n.clone()}}p([d({constructOnly:!0})],I.prototype,"analysisViewData",void 0),p([d({constructOnly:!0,nonNullable:!0})],I.prototype,"view",void 0),p([d()],I.prototype,"analysis",null),p([d()],I.prototype,"visible",null),p([d()],I.prototype,"loadingMessages",void 0),I=p([F("esri.views.3d.analysis.Dimension.DimensionVisualization")],I);let K=class extends st{constructor(t){super(t),this.dimension=null,this.length=null}};p([d({constructOnly:!0,nonNullable:!0})],K.prototype,"dimension",void 0),p([d()],K.prototype,"length",void 0),K=p([F("esri.views.3d.analysis.LengthDimensionResult")],K);const Yn=K;let D=class extends st{constructor(t){super(t),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(t){const{dimension:e,...i}=t;return{result:new Yn({dimension:e}),...i}}initialize(){this.addHandles([S(()=>this.dimension.startPoint,t=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(t),R),S(()=>this.dimension.endPoint,t=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(t),R)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};p([d({constructOnly:!0,nonNullable:!0})],D.prototype,"result",void 0),p([d({constructOnly:!0,nonNullable:!0})],D.prototype,"projectAndAlignPoint",void 0),p([d()],D.prototype,"dimension",null),p([d()],D.prototype,"length",null),p([d()],D.prototype,"geometry",void 0),p([d()],D.prototype,"unconstrainedGeometry",void 0),p([d()],D.prototype,"elevationAlignedStartPoint",void 0),p([d()],D.prototype,"elevationAlignedEndPoint",void 0),p([d()],D.prototype,"preConstraintProperties",void 0),p([d()],D.prototype,"previousConstraint",void 0),D=p([F("esri.views.3d.analysis.LengthDimensionComputation")],D);const Xn=t=>{let e=class extends t{constructor(...i){super(...i),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new At}createLengthDimensions(i){throw new Error("Method not implemented.")}};return p([d({constructOnly:!0})],e.prototype,"view",void 0),p([d({constructOnly:!0,nonNullable:!0})],e.prototype,"analysis",void 0),p([d()],e.prototype,"tool",void 0),p([d({readOnly:!0})],e.prototype,"results",null),p([d()],e.prototype,"selectedDimension",void 0),p([d()],e.prototype,"interactive",void 0),p([d()],e.prototype,"visible",void 0),e=p([F("esri.views.analysis.DimensionAnalysisView")],e),e};let $=class extends Xn(Re(st)){constructor(t){super(t),this.type="dimension-view-3d",this.tool=null,this.computations=new At,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=t=>{if(f(t))return null;const{spatialReference:e,elevationProvider:i}=this.view,n=Ci(t,e,i);return f(n)&&$i(this.analysis,t.spatialReference,ne.getLogger(this.declaredClass)),n},this.addHandles([Ei(this,T),jt(()=>this.analysis.dimensions,"after-add",t=>this._onDimensionAdd(t.item),{onListenerAdd:t=>{for(const e of t)this._onDimensionAdd(e)},onListenerRemove:()=>{this._onDimensionsClear()}}),jt(()=>this.analysis.dimensions,"after-remove",t=>this._onDimensionRemove(t.item))]),this._analysisVisualization=new I({analysisViewData:this,view:this.view}),this._analysisController=new B({analysisViewData:this,view:this.view})}destroy(){this._placementTask=Bt(this._placementTask),this._analysisVisualization=it(this._analysisVisualization),Li(this)}get updating(){var t;return((t=this._analysisVisualization)==null?void 0:t.loadingMessages)??!1}get results(){return this.analysis.dimensions.map(t=>this._dimensionsToComputations.get(t).result)}get selectedComputation(){const{selectedDimension:t}=this;return f(t)?null:this._dimensionsToComputations.get(t)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(t){return this.selectedDimension=null,this._placementTask=Bt(this._placementTask),this._placementTask=Vi(this,t),this._placementTask.promise}_onDimensionAdd(t){const{computations:e,_dimensionsToComputations:i}=this;if(i.has(t))return;const n=new D({dimension:t,projectAndAlignPoint:this._projectAndAlignPoint});e.add(n),i.set(t,n)}_onDimensionRemove(t){const{computations:e,_dimensionsToComputations:i}=this,n=e.findIndex(s=>s.dimension===t),o=e.getItemAt(n);o.dimension===this.selectedDimension&&(this.selectedDimension=null),e.removeAt(n),i.delete(t),it(o)}_onDimensionsClear(){this.computations.drain(t=>t.destroy()),this._dimensionsToComputations.clear()}};p([d({readOnly:!0})],$.prototype,"type",void 0),p([d()],$.prototype,"tool",void 0),p([d()],$.prototype,"updating",null),p([d({readOnly:!0})],$.prototype,"results",null),p([d({readOnly:!0})],$.prototype,"computations",void 0),p([d()],$.prototype,"selectedDimension",void 0),p([d()],$.prototype,"selectedComputation",null),p([d()],$.prototype,"_analysisVisualization",void 0),p([d()],$.prototype,"_analysisController",void 0),p([d()],$.prototype,"_dimensionsToComputations",void 0),p([d()],$.prototype,"_placementTask",void 0),$=p([F("esri.views.3d.analysis.DimensionAnalysisView3D")],$);const Up=$;export{Up as default};
