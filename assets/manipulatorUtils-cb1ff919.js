import{r as z,t as v,l as x,e as Q}from"./typedArrayUtil-70e1d79e.js";import{n as De,s as Pe,c as ne,r as ze,h as Me}from"./mat4-4714ff8c.js";import{n as T,u as N,S as re,O as A,g as K,a as oe,f as xe,p as Ie,o as ee,e as Ee,z as te,_ as Ae,r as Ce}from"./vec3-015ca254.js";import{r as $}from"./vec4f64-6d0e93be.js";import{d as Ne,c as L,e as ke}from"./sphere-092242fd.js";import{b8 as Be,aX as R,aW as ae,b9 as We,ba as X,j as Ue,C as Ve,az as Y,aZ as m,aP as qe,bb as Re,aQ as Ge,bc as He,aY as ce,A as Qe,ai as Xe,bd as Ye}from"./index-a7842505.js";import"./geometry-f89ca072.js";import{n as Ze}from"./compilerUtils-2eb56463.js";import{n as Je}from"./Evented-36093e88.js";import{m as le}from"./mathUtils-5b623c84.js";import{i as $e,x as Ke,d as et,y as he}from"./screenUtils-410d12c0.js";import{q as tt,e as S}from"./JSONSupport-32b5ad86.js";import{a as de}from"./mat3-4fd89d48.js";import{e as it}from"./mat3f64-50f3b9f6.js";import{e as B}from"./mat4f64-abdda1bb.js";import{b as st}from"./vec2-8acac370.js";import{w as k,O as nt}from"./Extent-2ad2c9a9.js";import{A as rt,p as ot,C as at,X as ct}from"./projection-d42b91be.js";import{F as lt}from"./aaBoundingRect-42f9721f.js";import{v as ht,M as dt,b as ue,B as ut}from"./lineSegment-8ffcb750.js";import{p as _t,_ as _e,x as pe}from"./plane-fef3662c.js";import{s as fe}from"./Attribute-f72d3f37.js";import{n as j}from"./basicInterfaces-7449a8bf.js";import{e as pt,A as ft,f as gt,_ as mt,E as F,d as bt,D as vt,g as yt,v as St}from"./objectResourceUtils-f1a10a8c.js";import{h as Ot,l as ge,u as Lt,g as W}from"./VisualVariablePassParameters-ded3d86d.js";import{O as d}from"./VertexAttribute-15d1866a.js";import{c as Tt}from"./ImageMaterial-b61fbd7a.js";import{E as wt,j as Et}from"./aaBoundingBox-dfb04110.js";import{i as At}from"./BufferView-da65c548.js";import{T as Rt}from"./InterleavedLayout-d75b8228.js";import{h as E}from"./Matrix3PassUniform-285be0f9.js";import{s as $t}from"./Util-c12e93ba.js";import{_ as jt}from"./preload-helper-41c905a7.js";import{t as Ft,e as Dt,o as Pt,W as zt,h as Mt,a as xt,_ as It}from"./EvaluateSceneLighting.glsl-ed7fcdc2.js";import{r as O}from"./ShaderTechniqueConfiguration-5b4afc58.js";import{o as U}from"./TransparencyPassType-a1cb0602.js";import{s as Ct}from"./DefaultTechniqueConfiguration-d3c0bf46.js";import{h as Nt}from"./ShadedColorMaterial.glsl-e70bd616.js";import{I as Z}from"./enums-fc527c7c.js";class je{constructor(e){var i;this.metadata=void 0,this._camera=new Be,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=B(),this._worldFrame=null,this._renderLocation=T(),this._renderLocationDirty=!0,this._location=new k({x:0,y:0,z:0}),this._elevationAlignedLocation=new k,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=R.None,this._focused=!1,this.events=new Je.EventEmitter,this._screenLocation={screenPointArray:$e(),renderScreenPointArray:Ke(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference;for(const s in e)this[s]=e[s];const t=(i=this.view.state)==null?void 0:i.camera;t&&this._camera.copyFrom(t)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){var e;return(e=this.view)==null?void 0:e._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,this._noDisplayCount===1&&this._updateEngineObject(),{remove:tt(()=>{this._noDisplayCount--,this._noDisplayCount===0&&this._updateEngineObject()})}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){me(e)&&(this._screenLocationDirty=!0),De(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=B()),kt(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){ae(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){ae(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const e=z(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=We(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:e===!0?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1;let e;if(me(this._modelTransform)){const t=this._calculateModelTransformOffset(Ut);e=N(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;const i=et(e,Bt),s=this._getCollisionRadius(t),o=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(st(this.screenLocation.screenPointArray,i)<s*s)return this.screenLocation.renderScreenPointArray[2]+o;break;case"line":{const n=this.collisionType.paths,a=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(a,I),h=s*this.screenLocation.pixelSize,u=X(this._camera,i,J);if(v(u))return null;for(const g of n){if(g.length===0)continue;const l=A(M,g[0],c);for(let _=1;_<g.length;_++){const p=A(ye,g[_],c),f=ut(ue(l,p,be),u);if(f!=null&&f<h*h){const y=N(L.get(),l,p);K(y,y,.5);const w=he(L.get());return this._camera.projectToRenderScreen(y,w),w[2]+o}oe(l,p)}}break}case"disc":{const n=this.collisionType.direction,a=this.collisionType.offset??xe,c=this._getWorldToScreenObjectScale(),h=this._calculateObjectTransform(c,I),u=s*this.screenLocation.pixelSize,g=X(this._camera,i,J);if(v(g))return null;const l=de(ve,h),_=re(Oe,n,l),p=A(Le,a,h);_e(p,_,C);const f=Se;if(pe(C,g,f)&&Ie(f,p)<u*u)return this.screenLocation.renderScreenPointArray[2]+o;break}case"ribbon":{const{paths:n,direction:a}=this.collisionType,c=this._getWorldToScreenObjectScale(),h=this._calculateObjectTransform(c,I),u=s*this._camera.computeScreenPixelSizeAt(this.renderLocation),g=X(this._camera,i,J);if(v(g))return null;const l=de(ve,h),_=re(Oe,a,l),p=this._calculateModelTransformPosition(Le);_e(p,_,C);const f=Se;if(!pe(C,g,f))break;for(const y of n){if(y.length===0)continue;const w=A(M,y[0],h);for(let q=1;q<y.length;q++){const G=A(ye,y[q],h),ie=dt(ue(w,G,be),f);if(ie!=null&&ie<u*u){const H=N(L.get(),w,G);K(H,H,.5);const se=he(L.get());return this._camera.projectToRenderScreen(H,se),se[2]+o}oe(w,G)}}break}default:Ze(this.collisionType)}return null}attach(e={manipulator3D:{}}){const t=this._stage;if(!t)return;const i=e.manipulator3D;if(v(i.engineLayerId)){const s=new Ue({pickable:!1,updatePolicy:Ve.SYNC});t.add(s),i.engineLayerId=s.id,this._engineLayer=s}else t!=null&&t.getObject&&(this._engineLayer=t.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,v(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),rt(this._location.spatialReference,this.view.spatialReference)||(this.location=new k({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=t.engineLayerReferences===0;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){ot(this.location,Te,e.spatialReference)&&lt(e.extent,Te)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if(v(this.elevationInfo))return;let e=null,t=0;const i=x(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":e=x(Y(this.view.elevationProvider,this.location,"ground"),0);break;case"relative-to-ground":t=x(Y(this.view.elevationProvider,this.location,"ground"),0)+i;break;case"relative-to-scene":t=x(Y(this.view.elevationProvider,this.location,"scene"),0)+i;break;case"absolute-height":t=i}return t!==this._elevation.offset||e!==this._elevation.override?(this._elevation.offset=t,void(this._elevation.override=e)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=I;if(this.autoScaleRenderObjects===!0){const n=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(n,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),s=(this.focused?m.Focused:m.Unfocused)|(this.selected?m.Selected:m.Unselected),o=this._noDisplayCount>0;for(const{stateMask:n,objects:a}of i){if(o){for(const l of a)l.visible=!1;continue}const c=(n&m.All)!==m.None,h=(n&R.All)!==R.None,u=!c||(s&n)==(n&m.All),g=!h||(this.state&n)==(n&R.All);if(u&&g)for(const l of a)l.visible=!0,l.transformation=t;else for(const l of a)l.visible=!1}}_ensureEngineResources(){if(v(this._engineResources)){const e=Q(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach(({geometry:{material:n}})=>{i.has(n)||(t.push(n),i.add(n))});const s=new Map;this._renderObjects.forEach(n=>{const a=new qe({castShadow:!1,geometries:[n.geometry]}),c=s.get(n.stateMask)||[];c.push(a),s.set(n.stateMask,c)});const o=[];s.forEach((n,a)=>o.push({stateMask:a,objects:n})),this._engineResources={objectsByState:o,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const e=this._stage;if(this._engineResourcesAddedToStage||v(this._engineResources)||!e)return;const{objectsByState:t,layer:i,materials:s}=this._engineResources;s.forEach(o=>{const n=Q(this._materialIdReferences),a=n.get(o.id)||0;a===0&&e.add(o),n.set(o.id,a+1)}),t.forEach(({objects:o})=>{i.addMany(o),e.addMany(o)}),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(e=!1){const t=this._stage;if(!this._engineResourcesAddedToStage||v(this._engineResources)||!t)return;const{objectsByState:i,layer:s,materials:o}=this._engineResources;i.forEach(({objects:n})=>{s.removeMany(n),t.removeMany(n)}),o.forEach(n=>{const a=Q(this._materialIdReferences),c=a.get(n.id);c===1?(t.remove(n),a.delete(n.id)):a.set(n.id,c-1)}),e&&t.remove(s),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*(e==="touch"?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,Wt);return ee(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return Ee(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return Pe(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&ne(t,t,this._worldFrame),ne(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,z(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if(z(this._engineResources))for(const t in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[t];for(const s of i.objects)if(s.visible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function me(r){return r[12]!==0||r[13]!==0||r[14]!==0}function kt(r,e,t){switch(r.viewingMode){case"local":return ze(t),!0;case"global":{const i=nt(r.renderCoordsHelper.spatialReference);return at(e,0,M,0,i.radius),ct(le(M[0]),le(M[1]),t),!0}}}const Bt=$e(),be=ht(),J=Ne(),ve=it(),Wt=B(),I=B(),C=_t(),M=T(),ye=T(),Se=T(),Oe=T(),Le=T(),Ut=T(),Te=new k({x:0,y:0,z:0,spatialReference:null});class P{constructor(e,t=m.None){this.geometry=e,this.stateMask=t}}class V extends Dt{initializeProgram(e){return new Pt(e.rctx,V.shader.get().build(this.configuration),Fe)}_setPipelineState(e){const t=this.configuration,i=e===U.NONE,s=e===U.FrontFace;return zt({blending:t.output!==E.Color&&t.output!==E.Alpha||!t.transparent?null:i?pt:ft(e),culling:Mt(t.cullFace),depthTest:{func:s?Z.LESS:t.shadingEnabled?Z.LEQUAL:Z.LESS},depthWrite:i?t.writeDepth?xt:null:gt(e),colorWrite:It,polygonOffset:i||s?null:mt})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}V.shader=new Ft(Nt,()=>jt(()=>import("./ShadedColorMaterial.glsl-9c014679.js"),["./ShadedColorMaterial.glsl-9c014679.js","./vec4f64-6d0e93be.js","./View.glsl-725bf3cf.js","./mat4-4714ff8c.js","./vec3-015ca254.js","./common-d0b63c2d.js","./mat4f32-60a2394b.js","./ShaderBuilder-c7fc4a30.js","./typedArrayUtil-70e1d79e.js","./Error-62cc7aff.js","./string-7a2f1d87.js","./Matrix3PassUniform-285be0f9.js","./mat4f64-abdda1bb.js","./mat3f64-50f3b9f6.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./vec2-8acac370.js","./vec2f64-f35767d6.js","./Texture2DPassUniform-1510cbb0.js","./TransparencyPassType-a1cb0602.js","./ShadedColorMaterial.glsl-e70bd616.js","./FloatPassUniform-8a52db3d.js","./Slice.glsl-e5fdd8d3.js","./Transform.glsl-e6366353.js","./ForwardLinearDepth.glsl-3606f02d.js","./MultipassTerrainTest.glsl-029ffa3f.js","./ReadLinearDepth.glsl-9abddde9.js","./RgbaFloatEncoding.glsl-31b2b966.js","./AlphaCutoff-96178e0d.js","./Float4PassUniform-52993952.js"],import.meta.url));let b=class extends Ct{constructor(){super(...arguments),this.output=E.Color,this.cullFace=j.None,this.transparencyPassType=U.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};S([O({count:E.COUNT})],b.prototype,"output",void 0),S([O({count:j.COUNT})],b.prototype,"cullFace",void 0),S([O({count:U.COUNT})],b.prototype,"transparencyPassType",void 0),S([O()],b.prototype,"hasSlicePlane",void 0),S([O()],b.prototype,"transparent",void 0),S([O()],b.prototype,"writeDepth",void 0),S([O()],b.prototype,"screenSizeEnabled",void 0),S([O()],b.prototype,"shadingEnabled",void 0),S([O()],b.prototype,"hasMultipassTerrain",void 0),S([O()],b.prototype,"cullAboveGround",void 0);const Fe=new Map([[d.POSITION,0],[d.NORMAL,1],[d.OFFSET,2]]);class Vt extends Ot{constructor(e){super(e,new Gt),this.supportsEdges=!0,this._configuration=new b,this._vertexAttributeLocations=Fe}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,i,s,o,n){if(this.parameters.screenSizeEnabled){const a=e.vertexAttributes.get(d.OFFSET);ge(e,i,s,o,{applyToVertex:(h,u,g,l)=>{const _=ee(we,a.data[3*l+0],a.data[3*l+1],a.data[3*l+2]),p=ee(Qt,h,u,g);return K(_,_,this.parameters.screenSizeScale*i.camera.computeRenderPixelSizeAt(_)),N(p,p,_),[p[0],p[1],p[2]]},applyToAabb:h=>{const u=wt(h,we);return Et(h,this.parameters.screenSizeScale*i.camera.computeRenderPixelSizeAt(u))}},n)}else ge(e,i,s,o,void 0,n)}requiresSlot(e,t){if(t===E.Highlight)return e===F.OPAQUE_MATERIAL;if(t===E.Color||t===E.Alpha||t===E.ObjectAndLayerIdColor){let i=F.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?F.TRANSPARENT_MATERIAL:F.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i||e===F.DRAPED_MATERIAL}return!1}createGLMaterial(e){return new qt(e)}createBufferWriter(){return new Ht(this.parameters.screenSizeEnabled)}}class qt extends bt{beginSlot(e){return this.ensureTechnique(V,e)}}let Gt=class extends Lt{constructor(){super(...arguments),this.color=$(1,1,1,1),this.shadingTint=$(0,0,0,.25),this.shadingDirection=te(T(),[.5,-.5,-.5]),this.screenSizeScale=14,this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=j.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}};class Ht{constructor(e){this.screenSizeEnabled=e;const t=Rt().vec3f(d.POSITION).vec3f(d.NORMAL);this.screenSizeEnabled&&t.vec3f(d.OFFSET),this.vertexBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(d.POSITION).length}write(e,t,i,s,o){if(vt(i,this.vertexBufferLayout,e,t,s,o),this.screenSizeEnabled){if(!i.vertexAttributes.has(d.OFFSET))throw new Error(`${d.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const n=i.vertexAttributes.get(d.OFFSET),a=i.indices.get(d.OFFSET);$t(n.size===3);const c=s.getField(d.OFFSET,At);if(!c)throw new Error("unable to acquire view for "+d.OFFSET);yt(a,n.data,t,c,o)}}}}const we=T(),Qt=T();function Xt(r,e=W.OccludeAndTransparent,t=!0){const i=$(r[0],r[1],r[2],r.length>3?r[3]:1),s=r[3]<1;return t?new Vt({color:i,transparent:s,writeDepth:!0,cullFace:j.Back,renderOccluded:e}):new Re({color:i,transparent:s,writeDepth:!0,cullFace:j.Back,renderOccluded:e})}function Bi(r,e=W.OccludeAndTransparent){const t=$(r[0],r[1],r[2],r.length===4?r[3]:1);return new Re({color:t,transparent:!0,writeDepth:!0,cullFace:j.Front,renderOccluded:e})}const D=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1,calloutColor:Ce(1,.5,0)});function Wi(r,e){const t=new je({view:r,autoScaleRenderObjects:!1,collisionPriority:1,metadata:e.metadata});return Yt(t,e),t}function Yt(r,e){var p;const t=e.material??new Tt({transparent:!0,writeDepth:!1,textureId:(p=e.texture)==null?void 0:p.id,renderOccluded:W.Opaque}),i=e.focusMultiplier??D.focusMultiplier,s=e.calloutLength??D.calloutLength,o=D.discRadius*(e.discScale??1),n=o*i,a=(f,y)=>{const w=[0,1,2,2,3,0];return new St(y,[[d.POSITION,new fe([s-f,-f,0,s+f,-f,0,s+f,f,0,s-f,f,0],3,!0)],[d.UV0,new fe([0,0,1,0,1,1,0,1],2,!0)]],[[d.POSITION,w],[d.UV0,w]])},c=D.calloutColor,h=e.calloutWidth??D.calloutWidth,u=new(h>1?Ge:He)({width:h,color:$(c[0],c[1],c[2],e.calloutOpacity??1),renderOccluded:W.OccludeAndTransparent}),g=ce(u,[[0,0,0],[s-o,0,0]]),l=ce(u,[[0,0,0],[s-n,0,0]]),_=e.customStateMask??R.None;r.collisionType={type:"disc",direction:[0,0,1],offset:[s,0,0]},r.focusMultiplier=i,r.metadata=e.metadata,r.radius=o,r.renderObjects=[new P(a(o,t),m.Unfocused|_),new P(g,m.Unfocused|_),new P(a(n,t),m.Focused|_),new P(l,m.Focused|_)]}function Ui(r,e,t=1,i=R.None){const s=Xt($(e[0],e[1],e[2],t??1)),o=[new P(Ye(s,1,32,32),i)];return new je({view:r,renderObjects:o})}const Vi=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function qi(r,e,t,i){const s=Ee(L.get(),r,t),o=Zt(s,Ae(L.get(),i,s),t,ke.get());Me(o,o);const n=A(L.get(),e,o);return Math.atan2(n[1],n[0])}function Zt(r,e,t,i){const s=te(L.get(),r),o=te(L.get(),e),n=Ae(L.get(),s,o);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=0,i[4]=o[0],i[5]=o[1],i[6]=o[2],i[7]=0,i[8]=n[0],i[9]=n[1],i[10]=n[2],i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i}function Jt(r,e){const t=r.getViewForGraphic(e);return z(t)&&"computeAttachmentOrigin"in t?t.computeAttachmentOrigin(e,r.spatialReference):null}function Gi(r,e,t){const i=Jt(r,t);z(i)?e.elevationAlignedLocation=i:Kt(e,t.geometry)}function Kt(r,e){if(v(e))return;const t=e.type==="mesh"?e.anchor:Qe(e);v(t)||(r.location=Xe(t))}export{qi as C,Yt as D,Gi as G,Bi as L,Ui as N,Xt as R,Wi as U,Zt as V,P as e,je as i,Vt as v,Vi as x,Jt as z};
