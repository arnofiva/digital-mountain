import{l as gt}from"./Color-5a385b27.js";import"./string-7a2f1d87.js";import{r as Nt,t as Ft}from"./typedArrayUtil-70e1d79e.js";import{u as zt}from"./screenUtils-410d12c0.js";import{r as ct,e as Yt}from"./vec4f64-6d0e93be.js";import{p as Bt}from"./mat3-4fd89d48.js";import{e as Lt}from"./mat3f64-50f3b9f6.js";import{S as nt,B as At}from"./quat-99c4e099.js";import{r as vt,n as Ot}from"./quatf32-51a323b8.js";import{e as ft}from"./quatf64-f8f1c132.js";import{t as Rt,E as w,n as H,k as Ut,a as ot,e as Gt,Y as Qt,w as St,y as _t,J as kt,s as Pt,u as at,o as jt,g as xt,q as W,B as Jt,d as Kt}from"./vec3-015ca254.js";import{t as Ht,e as Wt}from"./vec3f32-01c06d8d.js";import"./vec4-c7a19f0d.js";import{a as Xt}from"./aaBoundingBox-dfb04110.js";import{V as ut,Y as ht}from"./plane-fef3662c.js";import{l as Ct}from"./ViewingMode-5d7d590b.js";import{s as Dt}from"./Attribute-f72d3f37.js";var et;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(et||(et={}));function Zt(t){return t.type==="fill"}function t0(t){return t.type==="extrude"}function v0(t){return t&&t.enabled&&(t0(t)||Zt(t))&&Nt(t.edges)}function n0(t){return t&&t.enabled&&t.edges||null}function O0(t,n){return e0(n0(t),n)}function e0(t,n){if(Ft(t))return null;const e=Nt(t.color)?Yt(gt.toUnitRGBA(t.color)):ct(0,0,0,0),o=zt(t.size),a=zt(t.extensionLength);switch(t.type){case"solid":return r0({color:e,size:o,extensionLength:a,...n});case"sketch":return o0({color:e,size:o,extensionLength:a,...n});default:return}}function r0(t){return{...a0,...t,type:"solid"}}function o0(t){return{...i0,...t,type:"sketch"}}const a0={color:ct(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:et.OPAQUE,hasSlicePlane:!1},i0={color:ct(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:et.OPAQUE,hasSlicePlane:!1},G=1e-6,Q=[0,0,0],X=[0,0,0];function s0(t,n){const{data:e,size:o}=t,a=e.length/o;if(a<=0)return;const i=new z0(t);tt(Q,i.minProj,i.maxProj),V(Q,Q,.5),P(X,i.maxProj,i.minProj);const s=it(X),c=new S0;c.quality=s,a<14&&(t=new Dt(new Float64Array(i.buffer,112,42),3));const r=[0,0,0],f=[0,0,0],x=[0,0,0],E=[0,0,0],mt=[0,0,0],$t=[0,0,0],bt=[0,0,0];switch(c0(i,t,bt,r,f,x,E,mt,$t,c)){case 1:return void yt(Q,X,n);case 2:return void b0(t,E,n)}f0(t,bt,r,f,x,E,mt,$t,c),Vt(t,c.b0,c.b1,c.b2,R,U);const rt=[0,0,0];P(rt,U,R),c.quality=it(rt),c.quality<s?dt(c.b0,c.b1,c.b2,R,U,rt,n):yt(Q,X,n)}function c0(t,n,e,o,a,i,s,c,r,f){return u0(t,o,a),st(o,a)<G?1:(P(s,o,a),h(s,s),h0(n,o,s,i)<G?2:(P(c,a,i),h(c,c),P(r,i,o),h(r,r),j(e,c,s),h(e,e),A(n,e,s,c,r,f),0))}const _=[0,0,0],k=[0,0,0],$=[0,0,0],b=[0,0,0],z=[0,0,0],I=[0,0,0],y=[0,0,0],M=[0,0,0];function f0(t,n,e,o,a,i,s,c,r){l0(t,n,e,_,k),_[0]!==void 0&&(P($,_,e),h($,$),P(b,_,o),h(b,b),P(z,_,a),h(z,z),j(I,b,i),h(I,I),j(y,z,s),h(y,y),j(M,$,c),h(M,M),A(t,I,i,b,$,r),A(t,y,s,z,b,r),A(t,M,c,$,z,r)),k[0]!==void 0&&(P($,k,e),h($,$),P(b,k,o),h(b,b),P(z,k,a),h(z,z),j(I,b,i),h(I,I),j(y,z,s),h(y,y),j(M,$,c),h(M,M),A(t,I,i,b,$,r),A(t,y,s,z,b,r),A(t,M,c,$,z,r))}function u0(t,n,e){let o=st(t.maxVert[0],t.minVert[0]),a=0;for(let i=1;i<7;++i){const s=st(t.maxVert[i],t.minVert[i]);s>o&&(o=s,a=i)}l(n,t.minVert[a]),l(e,t.maxVert[a])}const S=[0,0,0];function h0(t,n,e,o){const{data:a,size:i}=t;let s=Number.NEGATIVE_INFINITY,c=0;for(let r=0;r<a.length;r+=i){S[0]=a[r]-n[0],S[1]=a[r+1]-n[1],S[2]=a[r+2]-n[2];const f=e[0]*S[0]+e[1]*S[1]+e[2]*S[2],x=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],E=S[0]*S[0]+S[1]*S[1]+S[2]*S[2]-f*f/x;E>s&&(s=E,c=r)}return l(o,a,c),s}const u=[0,0];function l0(t,n,e,o,a){$0(t,n,u,a,o);const i=Et(e,n);u[1]-G<=i&&(o[0]=void 0),u[0]+G>=i&&(a[0]=void 0)}const pt=[0,0,0],qt=[0,0,0],It=[0,0,0],T=[0,0,0],g=[0,0,0],C=[0,0,0];function A(t,n,e,o,a,i){if(wt(n)<G)return;j(pt,e,n),j(qt,o,n),j(It,a,n),O(t,n,u),g[1]=u[0],T[1]=u[1],C[1]=T[1]-g[1];const s=[e,o,a],c=[pt,qt,It];for(let r=0;r<3;++r){O(t,s[r],u),g[0]=u[0],T[0]=u[1],O(t,c[r],u),g[2]=u[0],T[2]=u[1],C[0]=T[0]-g[0],C[2]=T[2]-g[2];const f=it(C);f<i.quality&&(l(i.b0,s[r]),l(i.b1,n),l(i.b2,c[r]),i.quality=f)}}const m0=[0,0,0];function O(t,n,e){const{data:o,size:a}=t;e[0]=Number.POSITIVE_INFINITY,e[1]=Number.NEGATIVE_INFINITY;for(let i=0;i<o.length;i+=a){const s=o[i]*n[0]+o[i+1]*n[1]+o[i+2]*n[2];e[0]=Math.min(e[0],s),e[1]=Math.max(e[1],s)}}function $0(t,n,e,o,a){const{data:i,size:s}=t;l(o,i),l(a,o),e[0]=Et(m0,n),e[1]=e[0];for(let c=s;c<i.length;c+=s){const r=i[c]*n[0]+i[c+1]*n[1]+i[c+2]*n[2];r<e[0]&&(e[0]=r,l(o,i,c)),r>e[1]&&(e[1]=r,l(a,i,c))}}function yt(t,n,e){l(e.center,t),V(e.halfSize,n,.5),e.quaternion[0]=0,e.quaternion[1]=0,e.quaternion[2]=0,e.quaternion[3]=1}const q=[0,0,0],F=[0,0,0],J=[0,0,0],R=[0,0,0],U=[0,0,0],Mt=[0,0,0];function b0(t,n,e){l(q,n),Math.abs(n[0])>Math.abs(n[1])&&Math.abs(n[0])>Math.abs(n[2])?q[0]=0:Math.abs(n[1])>Math.abs(n[2])?q[1]=0:q[2]=0,wt(q)<G&&(q[0]=q[1]=q[2]=1),j(F,n,q),h(F,F),j(J,n,F),h(J,J),Vt(t,n,F,J,R,U),P(Mt,U,R),dt(n,F,J,R,U,Mt,e)}function Vt(t,n,e,o,a,i){O(t,n,u),a[0]=u[0],i[0]=u[1],O(t,e,u),a[1]=u[0],i[1]=u[1],O(t,o,u),a[2]=u[0],i[2]=u[1]}const D=[0,0,0],p=[1,0,0,0,1,0,0,0,1],Y=[0,0,0];function dt(t,n,e,o,a,i,s){p[0]=t[0],p[1]=t[1],p[2]=t[2],p[3]=n[0],p[4]=n[1],p[5]=n[2],p[6]=e[0],p[7]=e[1],p[8]=e[2],P0(s.quaternion,p),tt(Y,o,a),V(Y,Y,.5),V(s.center,t,Y[0]),V(D,n,Y[1]),tt(s.center,s.center,D),V(D,e,Y[2]),tt(s.center,s.center,D),V(s.halfSize,i,.5)}const m=7;class z0{constructor(n){this.minVert=new Array(m),this.maxVert=new Array(m);const e=64*m;this.buffer=new ArrayBuffer(e);let o=0;this.minProj=new Float64Array(this.buffer,o,m),o+=8*m,this.maxProj=new Float64Array(this.buffer,o,m),o+=8*m;for(let r=0;r<m;++r)this.minVert[r]=new Float64Array(this.buffer,o,3),o+=24;for(let r=0;r<m;++r)this.maxVert[r]=new Float64Array(this.buffer,o,3),o+=24;for(let r=0;r<m;++r)this.minProj[r]=Number.POSITIVE_INFINITY,this.maxProj[r]=Number.NEGATIVE_INFINITY;const a=new Array(m),i=new Array(m),{data:s,size:c}=n;for(let r=0;r<s.length;r+=c){let f=s[r];f<this.minProj[0]&&(this.minProj[0]=f,a[0]=r),f>this.maxProj[0]&&(this.maxProj[0]=f,i[0]=r),f=s[r+1],f<this.minProj[1]&&(this.minProj[1]=f,a[1]=r),f>this.maxProj[1]&&(this.maxProj[1]=f,i[1]=r),f=s[r+2],f<this.minProj[2]&&(this.minProj[2]=f,a[2]=r),f>this.maxProj[2]&&(this.maxProj[2]=f,i[2]=r),f=s[r]+s[r+1]+s[r+2],f<this.minProj[3]&&(this.minProj[3]=f,a[3]=r),f>this.maxProj[3]&&(this.maxProj[3]=f,i[3]=r),f=s[r]+s[r+1]-s[r+2],f<this.minProj[4]&&(this.minProj[4]=f,a[4]=r),f>this.maxProj[4]&&(this.maxProj[4]=f,i[4]=r),f=s[r]-s[r+1]+s[r+2],f<this.minProj[5]&&(this.minProj[5]=f,a[5]=r),f>this.maxProj[5]&&(this.maxProj[5]=f,i[5]=r),f=s[r]-s[r+1]-s[r+2],f<this.minProj[6]&&(this.minProj[6]=f,a[6]=r),f>this.maxProj[6]&&(this.maxProj[6]=f,i[6]=r)}for(let r=0;r<m;++r){let f=a[r];l(this.minVert[r],s,f),f=i[r],l(this.maxVert[r],s,f)}}}let S0=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function it(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function tt(t,n,e){t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2]}function P(t,n,e){t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2]}function V(t,n,e){t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e}function l(t,n,e=0){t[0]=n[e+0],t[1]=n[e+1],t[2]=n[e+2]}function j(t,n,e){const o=n[0],a=n[1],i=n[2],s=e[0],c=e[1],r=e[2];t[0]=a*r-i*c,t[1]=i*s-o*r,t[2]=o*c-a*s}function h(t,n){const e=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(e>0){const o=1/Math.sqrt(e);t[0]=n[0]*o,t[1]=n[1]*o,t[2]=n[2]*o}}function wt(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function st(t,n){const e=n[0]-t[0],o=n[1]-t[1],a=n[2]-t[2];return e*e+o*o+a*a}function Et(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function P0(t,n){const e=n[0]+n[4]+n[8];if(e>0){let o=Math.sqrt(e+1);t[3]=.5*o,o=.5/o,t[0]=(n[5]-n[7])*o,t[1]=(n[6]-n[2])*o,t[2]=(n[1]-n[3])*o}else{let o=0;n[4]>n[0]&&(o=1),n[8]>n[3*o+o]&&(o=2);const a=(o+1)%3,i=(o+2)%3;let s=Math.sqrt(n[3*o+o]-n[3*a+a]-n[3*i+i]+1);t[o]=.5*s,s=.5/s,t[3]=(n[3*a+i]-n[3*i+a])*s,t[a]=(n[3*a+o]+n[3*o+a])*s,t[i]=(n[3*i+o]+n[3*o+i])*s}}const K=ft(),d=H(),j0=H(),x0=Lt();class U0{constructor(n){const s=n*56;this.buffer=new ArrayBuffer(s),this.obbs=new Array(n);for(let c=0;c<n;c++)this.obbs[c]={center:Ut(this.buffer,56*c+0),halfSize:Wt(this.buffer,56*c+24),quaternion:Ot(this.buffer,56*c+36)}}}function Tt(t=[0,0,0],n=[-1,-1,-1],e=ft()){return{center:Rt(t),halfSize:Ht(n),quaternion:vt(e)}}function G0(t){return Tt(t.center,t.halfSize,t.quaternion)}function Q0(t,n){ot(n.center,t.center),ot(n.halfSize,t.halfSize),At(n.quaternion,t.quaternion)}function _0(t,n){return n=n||Tt(),s0(t,n),n}function B(t,n){const e=ut(n,t.center),o=lt(t,ht(n));return e>o?1:e<-o?-1:0}function k0(t,n){n||(n=Xt());const e=Bt(x0,t.quaternion),o=t.halfSize[0]*Math.abs(e[0])+t.halfSize[1]*Math.abs(e[3])+t.halfSize[2]*Math.abs(e[6]),a=t.halfSize[0]*Math.abs(e[1])+t.halfSize[1]*Math.abs(e[4])+t.halfSize[2]*Math.abs(e[7]),i=t.halfSize[0]*Math.abs(e[2])+t.halfSize[1]*Math.abs(e[5])+t.halfSize[2]*Math.abs(e[8]);return n[0]=t.center[0]-o,n[1]=t.center[1]-a,n[2]=t.center[2]-i,n[3]=t.center[0]+o,n[4]=t.center[1]+a,n[5]=t.center[2]+i,n}function J0(t,n){return ut(n,t.center)-lt(t,ht(n))}function K0(t,n){return ut(n,t.center)+lt(t,ht(n))}function H0(t,n){return B(t,n[0])<=0&&B(t,n[1])<=0&&B(t,n[2])<=0&&B(t,n[3])<=0&&B(t,n[4])<=0&&B(t,n[5])<=0}function W0(t,n,e,o=0){nt(K,t.quaternion),Gt(d,n,t.center);const a=w(d,d,K),i=w(j0,e,K);let s=-1/0,c=1/0;for(let r=0;r<3;r++)if(Math.abs(i[r])>1e-6){const f=(o+t.halfSize[r]-a[r])/i[r],x=(-o-t.halfSize[r]-a[r])/i[r];s=Math.max(s,Math.min(f,x)),c=Math.min(c,Math.max(f,x))}else if(a[r]>t.halfSize[r]+o||a[r]<-t.halfSize[r]-o)return!1;return s<=c}(()=>{const t=new Int8Array(162);let n=0;const e=o=>{for(let a=0;a<o.length;a++)t[n+a]=o[a];n+=6};return e([6,2,3,1,5,4]),e([0,2,3,1,5,4]),e([0,2,3,7,5,4]),e([0,1,3,2,6,4]),e([0,1,3,2,0,0]),e([0,1,5,7,3,2]),e([0,1,3,7,6,4]),e([0,1,3,7,6,2]),e([0,1,5,7,6,2]),e([0,1,5,4,6,2]),e([0,1,5,4,0,0]),e([0,1,3,7,5,4]),e([0,2,6,4,0,0]),e([0,0,0,0,0,0]),e([1,3,7,5,0,0]),e([2,3,7,6,4,0]),e([2,3,7,6,0,0]),e([2,3,1,5,7,6]),e([0,1,5,7,6,2]),e([0,1,5,7,6,4]),e([0,1,3,7,6,4]),e([4,5,7,6,2,0]),e([4,5,7,6,0,0]),e([4,5,1,3,7,6]),e([0,2,3,7,5,4]),e([6,2,3,7,5,4]),e([6,2,3,1,5,4]),t})();function lt(t,n){nt(K,t.quaternion),w(d,n,K);const e=t.halfSize;return Math.abs(d[0]*e[0])+Math.abs(d[1]*e[1])+Math.abs(d[2]*e[2])}function X0(t,n){for(let e=0;e<8;++e){const o=n[e];o[0]=1&e?-t.halfSize[0]:t.halfSize[0],o[1]=2&e?-t.halfSize[1]:t.halfSize[1],o[2]=4&e?-t.halfSize[2]:t.halfSize[2],w(o,o,t.quaternion),at(o,o,t.center)}}function C0(t){return Qt(t.halfSize)}function D0(t,n,e,o,a){if(At(a.quaternion,t.quaternion),o===Ct.Global){nt(Z,t.quaternion),w(N,t.center,Z),St(L,N),_t(v,L,t.halfSize),kt(v,L,v);const i=Pt(v);at(v,L,t.halfSize);const s=Pt(v);if(i<e)ot(a.center,t.center),jt(N,e,e,e),at(a.halfSize,t.halfSize,N);else{const c=s>0?1+n/s:1,r=i>0?1+e/i:1,f=(r+c)/2,x=(r-c)/2;xt(a.halfSize,L,x),W(a.halfSize,a.halfSize,t.halfSize,f),xt(a.center,L,f),W(a.center,a.center,t.halfSize,x),Jt(N,N),Kt(a.center,a.center,N),w(a.center,a.center,a.quaternion)}}else{const i=jt(N,0,0,1);W(a.center,t.center,i,(e+n)/2),nt(Z,t.quaternion),w(i,i,Z),St(i,i),W(a.halfSize,t.halfSize,i,(e-n)/2)}return a}const N=H(),L=H(),v=H(),Z=ft();export{et as A,U0 as L,Tt as N,G0 as O,Q0 as P,_0 as Q,B as R,k0 as T,J0 as U,K0 as W,H0 as X,W0 as Y,v0 as a,C0 as b,lt as e,O0 as f,r0 as m,D0 as n,e0 as p,X0 as t};
