import{g as Bt}from"./Graphic-96c42a4d.js";import{r as c,t as X}from"./typedArrayUtil-ce39e5f4.js";import{w as L,p as Zt,a as it,f as Vt}from"./Extent-680ef92a.js";import{_ as Y}from"./preload-helper-41c905a7.js";import{e as A,y as F,a as Wt}from"./cast-8b575ab3.js";import{s as x,a as st}from"./Error-685fdf30.js";import{a as Jt}from"./HandleOwner-f773ce72.js";import{m as Xt}from"./Loadable-695031ac.js";import{m as Yt}from"./Promise-e757e514.js";import{y as pt,L as Ht,p as qt,f as Kt}from"./promiseUtils-e37fe75d.js";import{l as Qt}from"./reactiveUtils-042dd05a.js";import"./ArrayPool-5813d861.js";import{n as y,u as ft,S as H,z as te,o as Pt,e as q,O as ee,f as Et,g as It,r as nt}from"./vec3-015ca254.js";import{v as re}from"./Polyline-889037e7.js";import{M as ut,j as mt,k as ht,R as gt,h as dt,L as xt,a as Z,b as at,g as lt,x as ne,c as J}from"./projection-c67d3c7f.js";import{g as U,p as K,i as oe}from"./MeshComponent-f5ec9479.js";import{r as rt,b as ie,x as se,_ as ae,L as Q}from"./georeference-76e18bad.js";import{g as C,Z as Ct}from"./projection-582e07d8.js";import{p as le,G as ce}from"./request-fc61835a.js";import{a as _t}from"./mat3-4fd89d48.js";import{e as yt}from"./mat3f64-50f3b9f6.js";import{e as zt}from"./mat4f64-abdda1bb.js";import{c as wt}from"./spatialReferenceEllipsoidUtils-23733e37.js";import{p as pe}from"./mat4-4714ff8c.js";import{x as fe}from"./FeatureSet-cb704b51.js";import"./geometry-bad16232.js";import"./typeUtils-700e0da4.js";import"./PopupTemplate-8ac0cb61.js";import"./Clonable-2b8b60cc.js";import"./string-7a324480.js";import"./Collection-47946fa8.js";import"./Evented-d959ede6.js";import"./SimpleObservable-6f002ab0.js";import"./fieldUtils-1ecec444.js";import"./arcadeOnDemand-a1bf65ec.js";import"./enumeration-4ec8d3f9.js";import"./number-134e9f14.js";import"./locale-30120714.js";import"./Identifiable-96150ecf.js";import"./symbols-0f3de684.js";import"./CIMSymbol-cdddfd9c.js";import"./Color-ad49dc79.js";import"./colorUtils-639f4d25.js";import"./mathUtils-5b623c84.js";import"./vec4-c7a19f0d.js";import"./common-d0b63c2d.js";import"./screenUtils-410d12c0.js";import"./opacityUtils-6b5cbdc2.js";import"./symbolLayerUtils3D-51cc6d75.js";import"./aaBoundingBox-04c58f5a.js";import"./aaBoundingRect-41e05474.js";import"./persistableUrlUtils-1c5d7615.js";import"./Symbol3DAnchorPosition2D-142c1e90.js";import"./collectionUtils-25147e5f.js";import"./Portal-7ecdc9f0.js";import"./PortalGroup-ea788274.js";import"./PortalUser-a1aa49cd.js";import"./nextTick-3ee5a785.js";import"./Ellipsoid-89682c5e.js";import"./jsonUtils-03437bcd.js";import"./quat-99c4e099.js";import"./quatf64-f8f1c132.js";import"./BufferView-da65c548.js";import"./vec2-8acac370.js";import"./vec33-8529ce65.js";import"./earcut-61f7b102.js";import"./deduplicate-dffc7dea.js";import"./Indices-37e06e9a.js";import"./assets-5052bbaa.js";import"./zscale-def794ea.js";import"./Field-1bc3a16a.js";import"./fieldType-232282e5.js";const ct=x.getLogger("esri.geometry.support.meshUtils.centerAt");function ue(t,r,e){if(!t.vertexAttributes||!t.vertexAttributes.position)return;const n=(e==null?void 0:e.origin)??t.origin;c(t.transform)?((e==null?void 0:e.geographic)!=null&&e.geographic!==t.transform.geographic&&ct.warn(`Specifying the 'geographic' parameter (${e.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`),me(t.transform,r,n)):rt(t.spatialReference,e)?he(t,r,n):ge(t,r,n)}function me(t,r,e){const n=r.x-e.x,o=r.y-e.y,s=r.hasZ&&e.hasZ?r.z-e.z:0,i=t.origin;t.origin=[i[0]+n,i[1]+o,i[2]+s]}function he(t,r,e){const n=ie(t.vertexAttributes,e,{geographic:!0}),{position:o,normal:s,tangent:i}=se(n,r,{geographic:!0});t.vertexAttributes.position=o,t.vertexAttributes.normal=s,t.vertexAttributes.tangent=i,t.vertexAttributesChanged()}function ge(t,r,e){const n=ye,o=xe;if(C(r,o,t.spatialReference)){if(!C(e,n,t.spatialReference)){const s=t.origin;n[0]=s.x,n[1]=s.y,n[2]=s.z,ct.error(`Failed to project specified origin (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}).`)}de(t.vertexAttributes.position,o,n),t.vertexAttributesChanged()}else ct.error(`Failed to project centerAt location (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid})`)}function de(t,r,e){if(t)for(let n=0;n<t.length;n+=3)for(let o=0;o<3;o++)t[n+o]+=r[o]-e[o]}const xe=y(),ye=y();async function we(t,r,e){const{loadGLTFMesh:n}=await pt(Y(()=>import("./loadGLTFMesh-5853dd7f.js"),["./loadGLTFMesh-5853dd7f.js","./Color-ad49dc79.js","./colorUtils-639f4d25.js","./mathUtils-5b623c84.js","./vec3-015ca254.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./typedArrayUtil-ce39e5f4.js","./ArrayPool-5813d861.js","./string-7a324480.js","./Error-685fdf30.js","./request-fc61835a.js","./preload-helper-41c905a7.js","./promiseUtils-e37fe75d.js","./mat3-4fd89d48.js","./mat3f64-50f3b9f6.js","./vec4f64-6d0e93be.js","./MeshComponent-f5ec9479.js","./earcut-61f7b102.js","./Polyline-889037e7.js","./cast-8b575ab3.js","./nextTick-3ee5a785.js","./Extent-680ef92a.js","./Ellipsoid-89682c5e.js","./deduplicate-dffc7dea.js","./Indices-37e06e9a.js","./persistableUrlUtils-1c5d7615.js","./BufferView-da65c548.js","./vec2-8acac370.js","./vec33-8529ce65.js","./DefaultMaterial_COLOR_GAMMA-87d1f8e6.js","./types-e1c0a5bf.js","./asyncUtils-623987a8.js","./mat4f64-abdda1bb.js","./enums-fc527c7c.js","./Version-419f71e1.js","./mat4-4714ff8c.js","./quat-99c4e099.js","./quatf64-f8f1c132.js","./compilerUtils-175b9e40.js","./resourceUtils-527631ac.js","./basicInterfaces-7449a8bf.js","./georeference-76e18bad.js","./projection-582e07d8.js","./SimpleObservable-6f002ab0.js","./assets-5052bbaa.js","./aaBoundingRect-41e05474.js","./zscale-def794ea.js","./spatialReferenceEllipsoidUtils-23733e37.js","./projection-c67d3c7f.js"],import.meta.url),e),o=await St(r,e),s=n(new L({x:0,y:0,z:0,spatialReference:t.spatialReference}),o.url,{resolveFile:ve(o),useTransform:!0,signal:c(e)?e.signal:null});s.then(()=>o.dispose(),()=>o.dispose());const{vertexAttributes:i,components:a}=await s;t.vertexAttributes=i,t.components=a}function ve(t){const r=le(t.url);return e=>{const n=ce(e,r,r),o=n?n.replace(/^ *\.\//,""):null;return(o?t.files.get(o):null)??e}}async function St(t,r){return t instanceof Blob?tt.fromBlob(t):typeof t=="string"?new tt(t):Array.isArray(t)?be(t,r):Ae(t,r)}async function be(t,r){const e=new Map;let n=null;const o=await Ht(t.map(async i=>({name:i.name,source:await St(i instanceof Blob?i:i.source,r)}))),s=[];for(const i of o)i&&(qt(r)?i.source.dispose():s.push(i));Kt(r);for(const{name:i,source:a}of s)(X(n)||/\.(gltf|glb)/i.test(i))&&(n=a.url),e.set(i,a.url),a.files&&a.files.forEach((l,f)=>e.set(f,l));if(X(n))throw new st("mesh-load-external:missing-files","Missing files to load external mesh source");return new tt(n,()=>s.forEach(({source:i})=>i.dispose()),e)}async function Ae(t,r){const{default:e}=await pt(Y(()=>import("./request-fc61835a.js").then(o=>o.O),["./request-fc61835a.js","./preload-helper-41c905a7.js","./Error-685fdf30.js","./string-7a324480.js","./typedArrayUtil-ce39e5f4.js","./promiseUtils-e37fe75d.js"],import.meta.url),r),n=typeof t.multipart[0]=="string"?await Promise.all(t.multipart.map(async o=>(await e(o,{responseType:"array-buffer"})).data)):t.multipart;return tt.fromBlob(new Blob(n))}let tt=class Dt{constructor(r,e=()=>{},n=new Map){this.url=r,this.dispose=e,this.files=n}static fromBlob(r){const e=URL.createObjectURL(r);return new Dt(e,()=>URL.revokeObjectURL(e))}};function $e(t,r,e){t.vertexAttributes&&t.vertexAttributes.position&&(c(t.transform)?((e==null?void 0:e.geographic)!=null&&e.geographic!==t.transform.geographic&&x.getLogger("esri.geometry.support.meshUtils.offset").warn(`Specifying the 'geographic' parameter (${e.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`),Re(t.transform,r)):rt(t.spatialReference,e)?Fe(t,r):Me(t,r))}function Re(t,r){const e=t.origin;t.origin=ft(y(),e,r)}function Fe(t,r){const e=t.spatialReference,n=t.vertexAttributes.position,o=t.vertexAttributes.normal,s=t.vertexAttributes.tangent,i=new Float64Array(n.length),a=c(o)?new Float32Array(o.length):null,l=c(s)?new Float32Array(s.length):null,f=t.extent.center,p=Le;Ct(e,[f.x,f.y,f.z],vt,wt(e)),_t(bt,vt),H(p,r,bt),ut(n,e,i),c(o)&&c(a)&&mt(o,n,i,e,a),c(s)&&c(l)&&ht(s,n,i,e,l),kt(i,p),gt(i,n,e),c(o)&&c(a)&&dt(a,n,i,e,o),c(s)&&c(l)&&xt(l,n,i,e,s),t.vertexAttributesChanged()}function Me(t,r){kt(t.vertexAttributes.position,r),t.vertexAttributesChanged()}function kt(t,r){if(t)for(let e=0;e<t.length;e+=3)for(let n=0;n<3;n++)t[e+n]+=r[n]}const Le=y(),vt=zt(),bt=yt();function Oe(){const{faceDescriptions:t,faceVertexOffsets:r,uvScales:e}=De,n=4*t.length,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(2*t.length*3);let l=0,f=0,p=0,u=0;for(let h=0;h<t.length;h++){const m=t[h],v=l/3;for(const d of r)a[u++]=v+d;const O=m.corners;for(let d=0;d<4;d++){const $=O[d];let b=0;i[p++]=.25*e[d][0]+m.uvOrigin[0],i[p++]=m.uvOrigin[1]-.25*e[d][1];for(let R=0;R<3;R++)m.axis[R]!==0?(o[l++]=.5*m.axis[R],s[f++]=m.axis[R]):(o[l++]=.5*$[b++],s[f++]=0)}}return{position:o,normal:s,uv:i,faces:a}}function Pe(t,r){const e=t.components[0],n=e.faces,o=ke[r],s=6*o,i=new Array(6),a=new Array(n.length-6);let l=0,f=0;for(let p=0;p<n.length;p++)p>=s&&p<s+6?i[l++]=n[p]:a[f++]=n[p];if(c(t.vertexAttributes.uv)){const p=new Float32Array(t.vertexAttributes.uv),u=4*o*2,h=[0,1,1,1,1,0,0,0];for(let m=0;m<h.length;m++)p[u+m]=h[m];t.vertexAttributes.uv=p}return t.components=[new U({faces:i,material:e.material}),new U({faces:a})],t}function Ee(t=0){const r=Math.round(8*2**t),e=2*r,n=(r-1)*(e+1)+2*e,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(3*((r-1)*e*2));let l=0,f=0,p=0,u=0;for(let h=0;h<=r;h++){const m=h/r*Math.PI+.5*Math.PI,v=Math.cos(m),O=Math.sin(m);g[2]=O;const d=h===0||h===r,$=d?e-1:e;for(let b=0;b<=$;b++){const R=b/$*2*Math.PI;g[0]=-Math.sin(R)*v,g[1]=Math.cos(R)*v;for(let P=0;P<3;P++)o[l]=.5*g[P],s[l]=g[P],++l;i[f++]=(b+(d?.5:0))/e,i[f++]=h/r,h!==0&&b!==e&&(h!==r&&(a[p++]=u,a[p++]=u+1,a[p++]=u-e),h!==1&&(a[p++]=u,a[p++]=u-e,a[p++]=u-e-1)),u++}}return{position:o,normal:s,uv:i,faces:a}}function Ie(t=0){const e=Math.round(16*2**t),n=(5-1)*(e+1)+2*e,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(3*(4*e));let l=0,f=0,p=0,u=0,h=0;for(let m=0;m<=5;m++){const v=m===0||m===5,O=m<=1||m>=5-1,d=m===2||m===4,$=v?e-1:e;for(let b=0;b<=$;b++){const R=b/$*2*Math.PI,P=v?0:.5;g[0]=P*Math.sin(R),g[1]=P*-Math.cos(R),g[2]=m<=2?.5:-.5;for(let z=0;z<3;z++)o[l++]=g[z],s[f++]=O?z===2?m<=1?1:-1:0:z===2?0:g[z]/P;i[p++]=(b+(v?.5:0))/e,i[p++]=m<=1?1*m/3:m<=3?1*(m-2)/3+1/3:1*(m-4)/3+2/3,d||m===0||b===e||(m!==5&&(a[u++]=h,a[u++]=h+1,a[u++]=h-e),m!==1&&(a[u++]=h,a[u++]=h-e,a[u++]=h-e-1)),h++}}return{position:o,normal:s,uv:i,faces:a}}function Ce(t,r){const e=typeof r=="number"?r:r!=null?r.width:1,n=typeof r=="number"?r:r!=null?r.height:1;switch(t){case"up":case"down":return{width:e,depth:n};case"north":case"south":return{width:e,height:n};case"east":case"west":return{depth:e,height:n}}}function _e(t){const r=B.facingAxisOrderSwap[t],e=B.position,n=B.normal,o=new Float64Array(e.length),s=new Float32Array(n.length);let i=0;for(let a=0;a<4;a++){const l=i;for(let f=0;f<3;f++){const p=r[f],u=Math.abs(p)-1,h=p>=0?1:-1;o[i]=e[l+u]*h,s[i]=n[l+u]*h,i++}}return{position:o,normal:s,uv:new Float32Array(B.uv),faces:new Uint32Array(B.faces),isPlane:!0}}const S=1,D=2,k=3,B={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[k,S,D],west:[-k,-S,D],north:[-S,k,D],south:[S,-k,D],up:[S,D,k],down:[S,-D,-k]}};function V(t,r,e){t.isPlane||ze(t),Se(t,e==null?void 0:e.size);const{vertexAttributes:n,transform:o}=ae(t,r,e);return{vertexAttributes:new K({...n,uv:t.uv}),transform:o,components:[new U({faces:t.faces,material:e&&e.material||null})],spatialReference:r.spatialReference}}function ze(t){for(let r=0;r<t.position.length;r+=3)t.position[r+2]+=.5}function Se(t,r){if(r==null)return;const e=typeof r=="number"?[r,r,r]:[r.width!=null?r.width:1,r.depth!=null?r.depth:1,r.height!=null?r.height:1];E[0]=e[0],E[4]=e[1],E[8]=e[2];for(let n=0;n<t.position.length;n+=3){for(let o=0;o<3;o++)g[o]=t.position[n+o];H(g,g,E);for(let o=0;o<3;o++)t.position[n+o]=g[o]}if(e[0]!==e[1]||e[1]!==e[2]){E[0]=1/e[0],E[4]=1/e[1],E[8]=1/e[2];for(let n=0;n<t.normal.length;n+=3){for(let o=0;o<3;o++)g[o]=t.normal[n+o];H(g,g,E),te(g,g);for(let o=0;o<3;o++)t.normal[n+o]=g[o]}}}const De={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},ke={south:0,east:1,north:2,west:3,up:4,down:5},g=y(),E=yt(),jt=x.getLogger("esri.geometry.support.meshUtils.rotate");function je(t,r,e){if(!t.vertexAttributes||!t.vertexAttributes.position||r[3]===0)return;const n=t.spatialReference;if(c(t.transform)){(e==null?void 0:e.geographic)!=null&&e.geographic!==t.transform.geographic&&jt.warn(`Specifying the 'geographic' parameter (${e.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`);const o=(e==null?void 0:e.origin)??t.transform.getOriginPoint(n);Te(t.transform,r,o)}else{const o=(e==null?void 0:e.origin)??t.origin;rt(t.spatialReference,e)?Ne(t,r,o):Ge(t,r,o)}}function Te(t,r,e){const n=Pt(T,e.x,e.y,e.z),o=q(T,n,t.origin);t.applyLocalInverse(o,At),t.rotation=at(t.rotation,r,Z()),t.applyLocalInverse(o,o),q(o,o,At),t.translation=ft(y(),t.translation,o)}function Ne(t,r,e){const n=t.spatialReference,o=wt(n),s=Tt;C(e,s,o)||C(t.origin,s,o);const i=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,f=new Float64Array(i.length),p=c(a)?new Float32Array(a.length):null,u=c(l)?new Float32Array(l.length):null;Ct(o,s,et,o),_t(Rt,et);const h=$t;H(lt($t),lt(r),Rt),h[3]=r[3],ut(i,n,f),c(a)&&c(p)&&mt(a,i,f,n,p),c(l)&&c(u)&&ht(l,i,f,n,u),G(f,h,3,s),gt(f,i,n),c(a)&&c(p)&&(G(p,h,3),dt(p,i,f,n,a)),c(l)&&c(u)&&(G(u,h,4),xt(u,i,f,n,l)),t.vertexAttributesChanged()}function Ge(t,r,e){const n=Tt;if(!C(e,n,t.spatialReference)){const o=t.origin;n[0]=o.x,n[1]=o.y,n[2]=o.z,jt.error(`Failed to project specified origin (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}).`)}G(t.vertexAttributes.position,r,3,n),G(t.vertexAttributes.normal,r,3),G(t.vertexAttributes.tangent,r,4),t.vertexAttributesChanged()}function G(t,r,e,n=Et){if(!X(t)){pe(et,ne(r),lt(r));for(let o=0;o<t.length;o+=e){for(let s=0;s<3;s++)T[s]=t[o+s]-n[s];ee(T,T,et);for(let s=0;s<3;s++)t[o+s]=T[s]+n[s]}}}const T=y(),At=y(),$t=Z(),et=zt(),Rt=yt(),Tt=y(),Nt=x.getLogger("esri.geometry.support.meshUtils.scale");function Ue(t,r,e){if(!t.vertexAttributes||!t.vertexAttributes.position)return;const n=t.spatialReference;if(c(t.transform)){(e==null?void 0:e.geographic)!=null&&e.geographic!==t.transform.geographic&&Nt.warn(`Specifying the 'geographic' parameter (${e.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`);const o=(e==null?void 0:e.origin)??t.transform.getOriginPoint(n);Be(t.transform,r,o)}else{const o=rt(t.spatialReference,e),s=e&&e.origin||t.origin;o?Ze(t,r,s):Ve(t,r,s)}}function Be(t,r,e){const n=Pt(N,e.x,e.y,e.z),o=q(N,n,t.origin);t.applyLocalInverse(o,Ft);const s=It(y(),t.scale,r);t.scale=s,t.applyLocalInverse(o,o),q(o,o,Ft),t.translation=ft(y(),t.translation,o)}function Ze(t,r,e){const n=t.spatialReference,o=wt(n),s=Ut;C(e,s,o)||C(t.origin,s,o);const i=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,f=new Float64Array(i.length),p=c(a)?new Float32Array(a.length):null,u=c(l)?new Float32Array(l.length):null;ut(i,n,f),c(a)&&c(p)&&mt(a,i,f,n,p),c(l)&&c(u)&&ht(l,i,f,n,u),Gt(f,r,s),gt(f,i,n),c(a)&&c(p)&&dt(p,i,f,n,a),c(l)&&c(u)&&xt(u,i,f,n,l),t.vertexAttributesChanged()}function Ve(t,r,e){const n=Ut;if(!C(e,n,t.spatialReference)){const o=t.origin;n[0]=o.x,n[1]=o.y,n[2]=o.z,Nt.error(`Failed to project specified origin (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}).`)}Gt(t.vertexAttributes.position,r,n),t.vertexAttributesChanged()}function Gt(t,r,e=Et){if(t)for(let n=0;n<t.length;n+=3){for(let o=0;o<3;o++)N[o]=t[n+o]-e[o];It(N,N,r);for(let o=0;o<3;o++)t[n+o]=N[o]+e[o]}}const N=y(),Ft=y(),Ut=y();var M;const _="esri.geometry.Mesh";let w=M=class extends Jt(Xt.LoadableMixin(Yt(Zt))){constructor(t){super(t),this.components=null,this.transform=null,this.external=null,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new K,this.type="mesh"}initialize(){(X(this.external)||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.handles.add(Qt(()=>{var t;return{vertexAttributes:this.vertexAttributes,components:(t=this.components)==null?void 0:t.map(r=>r.clone())}},()=>this._set("external",null),{once:!0,sync:!0}))})}get hasExtent(){return!this.loaded&&c(this.external)&&c(this.external.extent)||this.loaded&&this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0)}get _boundingInfo(){const t=this.vertexAttributes.position,r=this.spatialReference;if(t.length===0||this.components&&this.components.length===0)return{extent:new it({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:r}),center:new L({x:0,y:0,z:0,spatialReference:r})};const e=c(this.transform)?this.transform.project(t,r):t;let n=1/0,o=1/0,s=1/0,i=-1/0,a=-1/0,l=-1/0,f=0,p=0,u=0;const h=e.length,m=1/(h/3);let v=0;for(;v<h;){const O=e[v++],d=e[v++],$=e[v++];n=Math.min(n,O),o=Math.min(o,d),s=Math.min(s,$),i=Math.max(i,O),a=Math.max(a,d),l=Math.max(l,$),f+=m*O,p+=m*d,u+=m*$}return{extent:new it({xmin:n,ymin:o,zmin:s,xmax:i,ymax:a,zmax:l,spatialReference:r}),center:new L({x:f,y:p,z:u,spatialReference:r})}}get anchor(){if(c(this.transform))return this.transform.getOriginPoint(this.spatialReference);const t=this._boundingInfo;return new L({x:t.center.x,y:t.center.y,z:t.extent.zmin,spatialReference:this.spatialReference})}get origin(){return c(this.transform)?this.transform.getOriginPoint(this.spatialReference):this._boundingInfo.center}get extent(){return!this.loaded&&c(this.external)&&c(this.external.extent)?this.external.extent.clone():this._boundingInfo.extent}addComponent(t){this.loaded?(this.components||(this.components=[]),this.components.push(U.from(t)),this.notifyChange("components")):x.getLogger(this.declaredClass).error("addComponent()","Mesh must be loaded before applying operations")}removeComponent(t){if(this.loaded){if(this.components){const r=this.components.indexOf(t);if(r!==-1)return this.components.splice(r,1),void this.notifyChange("components")}x.getLogger(this.declaredClass).error("removeComponent()","Provided component is not part of the list of components")}else x.getLogger(this.declaredClass).error("removeComponent()","Mesh must be loaded before applying operations")}rotate(t,r,e,n){return J(ot.x,t,j),J(ot.y,r,Mt),J(ot.z,e,Lt),at(j,Mt,j),at(j,Lt,j),je(this,j,n),this}offset(t,r,e,n){return this.loaded?(W[0]=t,W[1]=r,W[2]=e,$e(this,W,n),this):(x.getLogger(this.declaredClass).error("offset()","Mesh must be loaded before applying operations"),this)}scale(t,r){return this.loaded?(Ue(this,t,r),this):(x.getLogger(this.declaredClass).error("scale()","Mesh must be loaded before applying operations"),this)}centerAt(t,r){return this.loaded?(ue(this,t,r),this):(x.getLogger(this.declaredClass).error("centerAt()","Mesh must be loaded before applying operations"),this)}load(t){return c(this.external)&&this.addResolvingPromise(we(this,this.external.source,t)),Promise.resolve(this)}updateExternalSource(t){this._set("external",t)}clone(){let t=null;if(this.components){const e=new Map,n=new Map;t=this.components.map(o=>o.cloneWithDeduplication(e,n))}const r={components:t,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),transform:c(this.transform)?this.transform.clone():null,external:c(this.external)?{source:this.external.source,extent:c(this.external.extent)?this.external.extent.clone():null}:null};return new M(r)}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(t){const r=Y(()=>import("./gltfexport-37246ab0.js"),["./gltfexport-37246ab0.js","./request-fc61835a.js","./preload-helper-41c905a7.js","./Error-685fdf30.js","./string-7a324480.js","./typedArrayUtil-ce39e5f4.js","./promiseUtils-e37fe75d.js","./Extent-680ef92a.js","./cast-8b575ab3.js","./ArrayPool-5813d861.js","./nextTick-3ee5a785.js","./Ellipsoid-89682c5e.js","./quat-99c4e099.js","./mat3f64-50f3b9f6.js","./quatf64-f8f1c132.js","./vec3-015ca254.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./MeshComponent-f5ec9479.js","./earcut-61f7b102.js","./Polyline-889037e7.js","./deduplicate-dffc7dea.js","./mathUtils-5b623c84.js","./Indices-37e06e9a.js","./Color-ad49dc79.js","./colorUtils-639f4d25.js","./persistableUrlUtils-1c5d7615.js","./georeference-76e18bad.js","./mat4-4714ff8c.js","./mat4f64-abdda1bb.js","./mat3-4fd89d48.js","./projection-582e07d8.js","./SimpleObservable-6f002ab0.js","./assets-5052bbaa.js","./aaBoundingRect-41e05474.js","./zscale-def794ea.js","./spatialReferenceEllipsoidUtils-23733e37.js","./projection-c67d3c7f.js","./BufferView-da65c548.js","./vec2-8acac370.js","./vec33-8529ce65.js","./enums-fc527c7c.js","./imageutils-8bc6cc4e.js","./resourceUtils-527631ac.js","./basicInterfaces-7449a8bf.js"],import.meta.url),e=this.load(),n=await Promise.all([r,e]),{toBinaryGLTF:o}=n[0];return o(this,t)}static createBox(t,r){if(!(t instanceof L))return x.getLogger(_).error(".createBox()","expected location to be a Point instance"),null;const e=new M(V(Oe(),t,r));return r&&r.imageFace&&r.imageFace!=="all"?Pe(e,r.imageFace):e}static createSphere(t,r){return t instanceof L?new M(V(Ee(r&&r.densificationFactor||0),t,r)):(x.getLogger(_).error(".createSphere()","expected location to be a Point instance"),null)}static createCylinder(t,r){return t instanceof L?new M(V(Ie(r&&r.densificationFactor||0),t,r)):(x.getLogger(_).error(".createCylinder()","expected location to be a Point instance"),null)}static createPlane(t,r){if(!(t instanceof L))return x.getLogger(_).error(".createPlane()","expected location to be a Point instance"),null;const e=(r==null?void 0:r.facing)??"up",n=Ce(e,r==null?void 0:r.size);return new M(V(_e(e),t,{...r,size:n}))}static createFromPolygon(t,r){if(!(t instanceof re))return x.getLogger(_).error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const e=oe(t);return new M({vertexAttributes:new K({position:e.position}),components:[new U({faces:e.faces,shading:"flat",material:(r==null?void 0:r.material)??null})],spatialReference:t.spatialReference})}static async createFromGLTF(t,r,e){if(!(t instanceof L))throw x.getLogger(_).error(".createfromGLTF()","expected location to be a Point instance"),new st("invalid-input","Expected location to be a Point instance");const{loadGLTFMesh:n}=await pt(Y(()=>import("./loadGLTFMesh-5853dd7f.js"),["./loadGLTFMesh-5853dd7f.js","./Color-ad49dc79.js","./colorUtils-639f4d25.js","./mathUtils-5b623c84.js","./vec3-015ca254.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./typedArrayUtil-ce39e5f4.js","./ArrayPool-5813d861.js","./string-7a324480.js","./Error-685fdf30.js","./request-fc61835a.js","./preload-helper-41c905a7.js","./promiseUtils-e37fe75d.js","./mat3-4fd89d48.js","./mat3f64-50f3b9f6.js","./vec4f64-6d0e93be.js","./MeshComponent-f5ec9479.js","./earcut-61f7b102.js","./Polyline-889037e7.js","./cast-8b575ab3.js","./nextTick-3ee5a785.js","./Extent-680ef92a.js","./Ellipsoid-89682c5e.js","./deduplicate-dffc7dea.js","./Indices-37e06e9a.js","./persistableUrlUtils-1c5d7615.js","./BufferView-da65c548.js","./vec2-8acac370.js","./vec33-8529ce65.js","./DefaultMaterial_COLOR_GAMMA-87d1f8e6.js","./types-e1c0a5bf.js","./asyncUtils-623987a8.js","./mat4f64-abdda1bb.js","./enums-fc527c7c.js","./Version-419f71e1.js","./mat4-4714ff8c.js","./quat-99c4e099.js","./quatf64-f8f1c132.js","./compilerUtils-175b9e40.js","./resourceUtils-527631ac.js","./basicInterfaces-7449a8bf.js","./georeference-76e18bad.js","./projection-582e07d8.js","./SimpleObservable-6f002ab0.js","./assets-5052bbaa.js","./aaBoundingRect-41e05474.js","./zscale-def794ea.js","./spatialReferenceEllipsoidUtils-23733e37.js","./projection-c67d3c7f.js"],import.meta.url),e);return new M(await n(t,r,e))}static createWithExternalSource(t,r,e){var i;const n=(e==null?void 0:e.extent)??null,o=((i=e==null?void 0:e.transform)==null?void 0:i.clone())??new Q;o.origin=[t.x,t.y,t.z??0];const s=t.spatialReference;return new M({external:{source:r,extent:n},transform:o,spatialReference:s})}static createIncomplete(t,r){var s;const e=((s=r==null?void 0:r.transform)==null?void 0:s.clone())??new Q;e.origin=[t.x,t.y,t.z??0];const n=t.spatialReference,o=new M({transform:e,spatialReference:n});return o.addResolvingPromise(Promise.reject(new st("mesh-incomplete","Mesh resources are not complete"))),o}};A([F({type:[U],json:{write:!0}})],w.prototype,"components",void 0),A([F({type:Q,json:{write:!0}})],w.prototype,"transform",void 0),A([F({constructOnly:!0})],w.prototype,"external",void 0),A([F({readOnly:!0})],w.prototype,"hasExtent",null),A([F({readOnly:!0})],w.prototype,"_boundingInfo",null),A([F({readOnly:!0})],w.prototype,"anchor",null),A([F({readOnly:!0})],w.prototype,"origin",null),A([F({readOnly:!0,json:{read:!1}})],w.prototype,"extent",null),A([F({readOnly:!0,json:{read:!1,write:!0,default:!0}})],w.prototype,"hasZ",void 0),A([F({readOnly:!0,json:{read:!1,write:!0,default:!1}})],w.prototype,"hasM",void 0),A([F({type:K,nonNullable:!0,json:{write:!0}})],w.prototype,"vertexAttributes",void 0),w=M=A([Wt(_)],w);const ot={x:nt(1,0,0),y:nt(0,1,0),z:nt(0,0,1)},j=Z(),Mt=Z(),Lt=Z(),W=y(),Ot=w;function xn(t,r,e){const n=e.features;e.features=[],delete e.geometryType;const o=fe.fromJSON(e);if(o.geometryType="mesh",!e.assetMaps)return o;const s=He(r,e.assetMaps),i=o.spatialReference??Vt.WGS84,a=e.globalIdFieldName,{outFields:l}=t,f=c(l)&&l.length>0?We(l.includes("*")?null:new Set(l)):()=>({});for(const p of n){const u=Je(p,a,i,r,s);c(u)&&o.features.push(new Bt({geometry:u,attributes:f(p)}))}return o}function We(t){return({attributes:r})=>{if(!r)return{};if(!t)return r;for(const e in r)t.has(e)||delete r[e];return r}}function Je(t,r,e,n,o){const s=t.attributes[r],i=o.get(s);if(i==null||i.status===I.FAILED||i.url==null)return null;const a=Xe(t,e,n),l=it.fromJSON(t.geometry);l.spatialReference=e;const f=Ye(t.attributes,n,i.projectVertices);return i.status===I.PENDING?Ot.createIncomplete(a,{extent:l,transform:f}):Ot.createWithExternalSource(a,[{name:i.name,source:i.url}],{extent:l,transform:f})}function Xe({attributes:t},r,{transformFieldRoles:e}){return new L({x:t[e.originX],y:t[e.originY],z:t[e.originZ],spatialReference:r})}function Ye(t,{transformFieldRoles:r},e){return new Q({translation:[t[r.translationX],-t[r.translationZ],t[r.translationY]],rotation:J([t[r.rotationX],t[r.rotationZ],t[r.rotationY]],t[r.rotationDeg]),scale:[t[r.scaleX],t[r.scaleY],t[r.scaleZ]],geographic:e})}var I;function He(t,r){const e=new Map;for(const n of r){const o=n.parentGlobalId;if(o==null)continue;const s=n.assetName,i=n.assetURL,a=n.conversionStatus;let l=e.get(o);if(l==null)switch(l={name:s,status:I.FAILED,url:i,projectVertices:qe(n.flags).projectVertices},e.set(o,l),a){case"COMPLETED":case"SUBMITTED":l.status=I.COMPLETED;break;case"INPROGRESS":l.status=I.PENDING;break;default:l.status=I.FAILED}else console.warn(`Multiple asset parts not expected. Ignoring additional parts. conflicting assetname: ${n.assetName}`)}return e}function qe(t){return{projectVertices:t.includes("PROJECT_VERTICES")}}(function(t){t[t.FAILED=0]="FAILED",t[t.PENDING=1]="PENDING",t[t.COMPLETED=2]="COMPLETED"})(I||(I={}));export{xn as meshFeatureSetFromJSON};
